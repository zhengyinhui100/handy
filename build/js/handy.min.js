/* handy v1.0 | 2014-10-18 | zhengyinhui100@gmail.com */
!function(){function a(a,b,c){c||(c=b,b=null);var d=c;if("function"==typeof c){var f=[];if(b)if("string"==typeof b)f.push(e.base.Object.ns(b));else for(var g=0;g<b.length;g++)f.push(e.base.Object.ns(b[g]));d=c.apply(window,f)}e.base[a]=e[a]=d;for(var h in d)e.isDebug&&"undefined"!=typeof e[h]&&"console"in window&&!Function[h]&&(console.log(e[h]),console.log(a+"命名冲突:"+h)),e[h]=d[h]}function b(a){return window.$===e&&(window.$=d),a&&window.handy===e&&(window.handy=c),e}var c=window.handy,d=window.$,e=window.handy=window.$H=function(){};e.version="1.0.0",e.isDebug="undefined"==typeof gEnv?!1:"dev"==gEnv,e.expando=("handy-"+e.version).replace(/\./g,"_"),e.base={},e.add=a,e.noConflict=b,e.noop=function(){}}(),handy.add("Json",function(){function _fQuote(a){return _rEscapable.lastIndex=0,_rEscapable.test(a)&&(a=a.replace(_rEscapable,function(a){var b=_oMeta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),'"'+a+'"'}function _fToString(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof _replacer&&(i=_replacer.call(b,a,i)),typeof i){case"undefined":return"undefined";case"string":return _fQuote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=_indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=_fToString(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(_replacer&&"object"==typeof _replacer)for(f=_replacer.length,c=0;f>c;c+=1)"string"==typeof _replacer[c]&&(d=_replacer[c],e=_fToString(d,i),e&&g.push(_fQuote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=_fToString(d,i),e&&g.push(_fQuote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}function fStringify(a,b,c,d){if(_bNativeJson&&!d)return JSON.stringify.apply(null,arguments);var e;if(gap="",_indent="","number"==typeof c)for(e=0;c>e;e+=1)_indent+=" ";else"string"==typeof c&&(_indent=c);return _replacer=b,!b||"function"==typeof b||"object"==typeof b&&"number"==typeof b.length?_fToString("",{"":a}):void $D.error(new Error("Json.stringify:替换参数只能是函数或者数组"))}function fParseJson(sText,fReviver,bNotNative){function _fReviver(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=_fReviver(e,c),void 0!==d?e[c]=d:delete e[c]);return fReviver.call(a,b,e)}if(_bNativeJson&&!bNotNative)return JSON.parse.apply(null,arguments);var j;return sText=String(sText),_rCx.lastIndex=0,_rCx.test(sText)&&(sText=sText.replace(_rCx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),_rValidchars.test(sText.replace(_rValidescape,"@").replace(_rValidtokens,"]").replace(_rValidbraces,""))?(j=eval("("+sText+")"),"function"==typeof fReviver?_fReviver({"":j},""):j):void $D.error(new SyntaxError("JSON.parse"))}var Json={stringify:fStringify,parseJson:fParseJson},_bNativeJson="JSON"in window,_replacer,gap,_indent,_rEscapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,_oMeta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},_rCx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,_rValidchars=/^[\],:{}\s]*$/,_rValidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,_rValidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,_rValidbraces=/(?:^|:|,)(?:\s*\[)+/g;return Json}),handy.add("Object",function(){function a(a,b){var c,d,e,f,g,h=null;for(a=C.alias(a),d=a.split("."),e=d[0],f=2==arguments.length,h=f?A[e]||(A[e]={}):A[e],c=1,g=d.length;g>c;++c){if(c==g-1&&f)h[d[c]]=b;else{if(!(f||h&&h[d[c]]))return;h[d[c]]=h[d[c]]||{}}h=h[d[c]]}var i="handy.base.";return f&&0===a.indexOf(i)&&$H.add(a.replace(i,""),h),h}function b(a,b){if("object"!=typeof a){var c=C._alias;if(!b){if(a){var d=a,e=a.length;do{if(c[d])return c[d]+a.substring(e);e=d.lastIndexOf(".")}while(e>0&&(d=d.substring(0,e)));return a}return c}c[a]?$D.error("别名已被使用"+a+":"+c[a]):c[a]=b}else for(var f in a)C.alias(f,a[f])}function c(a,b,c){if(!b||C.isStr(b)||C.isNum(b))return a;var d=c?c.notCover:!1,e=c?c.cover:null,f=c?c.IsClone:!1;a=a||{};var g,h=a.constructor,i=h.$isClass;for(var j in b)if(g=b[j],(!e||C.contains(e,j))&&b.hasOwnProperty(j)){var k=a.hasOwnProperty(j),l=d===!0?k:!1;if(C.isArr(d)?l=C.contains(d,j)&&k:C.isFunc(d)&&(l=d(j,g)),!l){var g=f?C.clone(g):g;i&&C.isFunc(g)&&!g.$name&&(g.$name=j,g.$owner=h),a[j]=g}}return a}function d(a,b){return C.extend(a,b,{notCover:!0})}function e(a,b,c,d){a.superProto||(a.superProto={});for(var e in b){if(C.isFunc(b[e]))if(a.superProto[e]){var f=a.superProto[e];a.superProto[e]=function(a,c){return function(){c.apply(this,arguments),b[a].apply(this,arguments)}}(e,f)}else a.superProto[e]=b[e];else a.superProto[e]=b[e];a[e]||(a[e]=b[e])}return c&&C.extend(a,c),b.toString!=b.constructor.prototype.toString&&(a.superProto.toString=function(){b.toString.apply(a,arguments)}),d&&a.prototype&&b.prototype,a}function f(a){return"number"==typeof a}function g(a){return"string"==typeof a}function h(a){return"boolean"==typeof a}function i(a){return C.isStr(a)||C.isNum(a)||C.isBool(a)}function j(a){return"undefined"==typeof a}function k(a){return"[object Function]"===B.prototype.toString.call(a)}function l(a){return"[object Array]"===B.prototype.toString.call(a)}function m(a){return"object"==typeof a&&!C.isArr(a)}function n(a){return C.isFunc(a)&&a.$isClass===!0}function o(a){return a&&a.constructor&&a.constructor.$isClass===!0}function p(a,b,c){if(typeof a==typeof b){if("object"!=typeof a)return a===b;if(a===b)return!0;if(C.isArr(a)&&C.isArr(b)){if(a.length!=b.length)return!1;for(var d=0,e=a.length;e>d;d++)if(!C.equals(a[d],b[d]))return!1;return!0}if(C.isArr(a)||C.isArr(b))return!1;if(C.count(a)!=C.count(b))return!1;for(var f in a){if(void 0===b[f])return!1;if(!C.equals(a[f],b[f]))return!1}return!0}return c!==!0&&C.isSimple(a)&&C.isSimple(b)&&a+""==b+""?!0:!1}function q(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor;if(b!=B&&b!=A.Array)return a;if(b==A.Date||b==A.RegExp||b==A.Function||b==A.String||b==A.Number||b==A.Boolean)return new b(a);try{var c=new b;for(var d in a)c[d]=C.clone(a[d]);return c}catch(e){return a}}function r(a){if(C.isArr(a))return 0==a.length;for(var b in a)return!1;return!0}function s(a,b,c){if(a){var d,e,f=0,g=a.length,h=void 0===g||C.isFunc(a);if(c)if(h){for(d in a)if(b.apply(a[d],c)===!1)break}else for(;g>f&&b.apply(a[f],c)!==!1;)e=a.length,g==e?f++:g=e;else if(h){for(d in a)if(b.call(a[d],d,a[d])===!1)break}else for(;g>f&&b.call(a[f],f,a[f])!==!1;)e=a.length,g==e?f++:g=e;return a}}function t(a,b){if(!a)return!1;var c=!1;return C.each(a,function(a,d){return C.equals(d,b)?(c=!0,!1):void 0}),c}function u(a,b){if("object"==typeof a&&"object"==typeof b){var c=!0;return C.each(b,function(d){return C.equals(b[d],a[d])?void 0:c=!1}),c}}function v(a){if(C.isArr(a))return a.length;var b=0;for(var c in a)b++;return b}function w(a,b){var c=C.isArr(a);if(b){if(c){var d=[];return C.each(a,function(a,b){void 0!==b&&d.push(b)}),d}return C.extend({},a,{isClone:!0,notCover:function(a,b){return void 0===b}})}return C.each(a,function(b,d){void 0===d&&(c?a.splice(b,1):delete a[b])}),a}function x(){var a=A.navigator.userAgent.match(/MSIE ([\d.]+)/);return a&&parseInt(a[0])<9?function(a,b,c){var d=[];if(a.length)for(var e=b||0,f=c||a.length;f>e;e++)d.push(a[e]);return d}:function(a,b,c){return Array.prototype.slice.call(a,b||0,c||a.length)}}function y(a){for(var b={},c=0,d=a.length;d>c;c++){var e=a[c];b[e.name]=e.value}return b}function z(a,b,c){for(var d=C.isArr(b)?b:b.split(","),e=0;e<d.length;e++){var f=d[e];a[f]=c(f)}}var A=window,B=A.Object,C={_alias:{B:"handy.base",C:"handy.component",M:"handy.module",U:"handy.util",E:"handy.effect",CM:"handy.common",D:"handy.data",V:"handy.view",P:"handy.plugin"},ns:a,alias:b,extend:c,extendIf:d,mix:e,isNum:f,isStr:g,isBool:h,isSimple:i,isUndef:j,isFunc:k,isArr:l,isObj:m,isClass:n,isInstance:o,equals:p,clone:q,isEmpty:r,each:s,contains:t,largeThan:u,count:v,removeUndefined:w,toArray:x(),fromArray:y,generateMethod:z};return C}),handy.add("Browser","handy.base.Object",function(a){function b(){var a=window.navigator.userAgent;c(a),d(a),e(a),f(a),g(a),h(),"ontouchend"in document&&(i.hasTouch=!0)}function c(a){var b,c=a;(b=c.match(/MSIE ([\d.]+)/))?i.ie=b[1]:(b=c.match(/Firefox\/([\d.]+)/))?i.firefox=b[1]:(b=c.match(/Chrome\/([\d.]+)/))?i.chrome=b[1]:(b=c.match(/Opera.([\d.]+)/))?i.opera=b[1]:(b=c.match(/Version\/([\d.]+).*Safari/))?i.safari=b[1]:0}function d(a){/windows|win32/i.test(a)?i.windows=!0:/linux/i.test(a)?i.linux=!0:/macintosh/i.test(a)?i.mac=!0:0}function e(a){var b=a;/trident/i.test(b)?i.trident=!0:/webkit/i.test(b)?i.webkit=!0:/gecko/i.test(b)?i.gecko=!0:/presto/i.test(b)?i.presto=!0:0}function f(a){var b=a;/MetaSr/i.test(b)?i.sogou=!0:/Maxthon/i.test(b)?i.maxthon=!0:/TencentTraveler/i.test(b)?i.tt=!0:/TheWorld/i.test(b)?i.theWorld=!0:/360[S|E]E/i.test(b)?i.is360=!0:0}function g(a){var b,c=a;(b=c.match(/AppleWebKit\/?([\d.]*)/))&&b[1]&&(/ Mobile\//.test(c)&&c.match(/iPad|iPod|iPhone/)?(i.mobile="ios",b=c.match(/OS ([^\s]*)/),b&&b[1]&&(i.ios=b[1].replace("_",".")),b=c.match(/iPad|iPod|iPhone/),b&&b[0]&&(i[b[0].toLowerCase()]=i.ios),/ipad/.test(c)?i.tablet="ios":i.phone="ios"):/Android/i.test(c)?(i.mobile="android",/Mobile/.test(c)?i.phone="android":i.tablet="android",b=c.match(/Android ([^\s]*);/),b&&b[1]&&(i.android=b[1])):(b=c.match(/NokiaN[^\/]*|Android \d\.\d|webOS\/\d\.\d/))&&(i.mobile=b[0].toLowerCase()))}function h(){var a;try{if(i.ie){var b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");b&&(a=b.getVariable("$version").split(" ")[1])}else if(navigator.plugins&&navigator.plugins.length>0){var b=navigator.plugins["Shockwave Flash"];if(b)for(var c=b.description.split(" "),d=0,e=c.length;e>d;d++)if(parseInt(c[d])>0){a=c[d];break}}}catch(f){}i.flash=a?a:null}var i={},j={};return a.generateMethod(j,["ie","firefox","chrome","safari","opera","windows","linux","mac","trident","webkit","gecko","presto","sogou","maxthon","tt","theWorld","is360","mobile","android","ios","iPhone","iPod","iPad","tablet","phone","hasTouch","flash"],function(a){return function(b){var c=i[a];return!b&&"string"==typeof c&&/^[\d\.]+$/.test(c)?parseInt(c):c}}),b(),j}),handy.add("Debug",["handy.base.Json","handy.base.Browser"],function(a,b){function c(a,b,c){if(c=c||"log",b||k.showInPage){var d=$H.expando+"debugDiv",e=top.document,f=e.getElementById(d);f?f.style.display="block":(f=e.createElement("DIV"),f.id=d,f.innerHTML=['<a href="javascript:void(0)" onclick="this.parentNode.style.display=\'none\'">关闭</a>',"<a href=\"javascript:void(0)\" onclick=\"this.parentNode.getElementsByTagName('DIV')[0].innerHTML='';\">清空</a>","<a href=\"javascript:void(0)\" onclick=\"if(this.innerHTML=='全屏'){this.parentNode.style.height='"+e.body.offsetHeight+"px';this.innerHTML='收起'}else{this.parentNode.style.height='6.25em';this.innerHTML='全屏';}\">收起</a>","<a href=\"javascript:void(0)\" onclick=\"var oDv=this.parentNode.getElementsByTagName('div')[0];if(this.innerHTML=='底部'){oDv.scrollTop=oDv.scrollHeight;this.innerHTML='顶部';}else{oDv.scrollTop=0;this.innerHTML='底部';}\">顶部</a>",'<a href="javascript:void(0)" onclick="location.reload();">刷新</a>','<a href="javascript:void(0)" onclick="history.back();">后退</a>'].join("&nbsp;&nbsp;&nbsp;&nbsp;")+'<div style="padding-top:0.313;height:90%;overflow:auto;font-size:0.75em;"></div>',f.style.position="fixed",f.style.width="100%",f.style.left=0,f.style.top=0,f.style.right=0,f.style.height="100%",f.style.backgroundColor="#aaa",f.style.fontSize="1em",f.style.padding="0.625em",f.style.zIndex=9999999999,f.style.opacity=.95,f.style.filter="alpha(opacity=95)",e.body.appendChild(f));var g=f.getElementsByTagName("DIV")[0];a=a instanceof Error?a.message:a;var h="string"==typeof a?a:$H.Json.stringify(a,null,"&nbsp;&nbsp;&nbsp;&nbsp;",!0);h=h.replace(/\n|\\n/g,"<br/>");var i;i="log"==c?"":' style="color:'+("error"==c?"red":"info"==c?"green":"yellow"),g.innerHTML+="<div"+i+'">'+c+":<br/>"+h+"</div><br/><br/>",g.scrollTop=g.scrollHeight}var j=arguments.callee.caller;j.$owner||(j=j.caller);try{j.$owner&&console[c]("["+j.$owner.$ns+"->"+j.$name+"]"),console[c](a)}catch(l){}}function d(a,b){k.level>k.LOG_LEVEL||k.out(a,!!b,"log")}function e(a,b){this.level>k.INFO_LEVEL||k.out(a,!!b,"info")}function f(a,b){k.level>k.WARN_LEVEL||k.out(a,!!b,"warn")}function g(a,b){if(!(k.level>k.ERROR_LEVEL))if(k.out(a,!!b,"error"),$H.isDebug){if(a instanceof Error)throw a}else k.debugLog&&k.debugLog(a)}function h(a,b,c){if(!(k.level>k.INFO_LEVEL)){var d=window.performance?window.performance.now():(new Date).getTime();a?("boolean"==typeof b&&(c=b,b=""),k.out((b||"")+(d-(k.lastTime||0)),!!c)):k.lastTime=d}}function i(a){var b=a.out,c=k._traceTimes||(k._traceTimes={});if(b){for(var d in c){var e=c[d];e.average=e.total/e.num}var f=a.method||"log";return void k[f](c)}var d=a.name,g=a.end,e=c[d]||(c[d]={}),h=window.performance?window.performance.now():(new Date).getTime();g?e.total=(e.total||0)+h-e.start:(e.num=(e.num||0)+1,e.start=h)}function j(a){k.level>k.DEBUG_LEVEL}var k=window.$D={level:$H.isDebug?0:5,LOG_LEVEL:1,DEBUG_LEVEL:2,INFO_LEVEL:3,WARN_LEVEL:4,ERROR_LEVEL:5,showInPage:!("console"in window&&!b.mobile()),out:c,log:d,info:e,warn:f,error:g,time:h,trace:i,debug:j};return k}),handy.add("Loader",["B.Debug","B.Object"],function(a,b){function c(a){function c(a){return/\.(css|js)/.test(a)?w[a]&&"loaded"==w[a].status:x.sourceMap&&x.sourceMap[a]?x.sourceMap[a].chkExist():b.ns(a)}var d={},e=[],f=[];"string"==typeof a&&(a=[a]);for(var g=0,h=a.length;h>g;g++){var i=a[g];i=b.alias(i);var j=c(i);j?e.push(j):f.push(i)}return d.exist=e,d.notExist=f,d}function d(a){if(/\/+/.test(a))return a;var b=x.sourceMap&&x.sourceMap[a]&&x.sourceMap[a].url;if(!b){var c="",d=x.rootPath;if("string"==typeof d)c=d;else if("object"==typeof d)for(var e in d)0==a.indexOf(e)&&(c=d[e],a=a.replace(e,""));else c="";b=/\.css$/.test(a)?0==a.indexOf("/")?a:"/css/"+a:/\.js$/.test(a)?a:a.replace(/\./g,"/")+".js",b=c.replace(/\/$/,"")+"/"+b.replace(/^\//,"")}return x.isMin&&(b=b.replace(/\.(css|js)$/,".min.$1")),b}function e(a,b){var c=document.createElement("script");c.async="async",c.src=a,c.type="text/javascript",g(c,b),r.appendChild(c)}function f(a,b){for(var c=r.getElementsByTagName("link"),d=0;d<c.length;d++){var e=c[d].href;if(!x.skinNode&&e.indexOf(x.skinName)>=0&&(x.skinNode=c[d]),e.indexOf(a)>=0||a.indexOf(e)>=0)return}var f=document.createElement("link");f.rel="stylesheet",f.href=a,g(f,b),x.skinNode?r.insertBefore(f,x.skinNode):r.appendChild(f)}function g(b,c){function d(){d.isCalled||(d.isCalled=!0,clearTimeout(e),c())}"SCRIPT"===b.nodeName?h(b,d):i(b,d);var e=setTimeout(function(){a.error("Time is out:"+b.src),d()},x.timeout)}function h(b,c){var d=function(){/loaded|complete|undefined/.test(b.readyState)&&(b.onload=b.onerror=b.onreadystatechange=null,b=null,setTimeout(c,0))};b.onload=b.onreadystatechange=d,b.onerror=function(){a.error(p+"load script error:\n"+b.src),d()}}function i(a,b){window.hasOwnProperty("attachEvent")?a.attachEvent("onload",b):setTimeout(function(){j(a,b)},0)}function j(a,b){if(!b.isCalled){var c;if(t)a.sheet&&(c=!0);else if(a.sheet)try{a.sheet.cssRules&&(c=!0)}catch(d){("SecurityError"===d.name||"NS_ERROR_DOM_SECURITY_ERR"===d.name)&&(c=!0)}setTimeout(function(){c?b():j(a,b)},1)}}function k(b){for(var c=!1,g=x.combine,h={},i={},j=0,k=b.length;k>j;j++){var m=b[j];if(!w[m]){var n=d(m);if(c=!0,w[m]={id:m,status:"loading"},g){var o=n.match(/([^:]+:\/\/)?[^/]+\/?/);o=o&&o[0]||"";var q=n.substring(o.length);if(/\.css/.test(n)){var r=i[o];r||(r=i[o]={ids:[],uris:[]}),r.ids.push(m),r.uris.push(q)}else{var s=h[o];s||(s=h[o]={ids:[],uris:[]}),s.ids.push(m),s.uris.push(q)}}else{var t=function(){l(m)};x.traceLog&&a.log(p+"request:\n"+n),/\.css/.test(n)?f(n,t):e(n,t),v++}}}var u=function(b){for(var c in b){var d=b[c],f=d.uris,g=function(){l(d.ids)},h=c+(f.length>1?"??"+f.join(","):f[0]);x.traceLog&&a.log(p+"request:\n"+h),e(h,g),v++}};c&&(g&&(u(h),u(i)),x.showLoading(!0))}function l(b){x.showLoading(!1),v--,b="string"==typeof b?[b]:b;for(var c=0;c<b.length;c++)w[b[c]].status="loaded";x.traceLog&&a.log(p+"Response:\n"+b.join("\n")),m()}function m(){for(var d=u.length-1;d>=0;d--){var e=u[d],f=c(e.deps);if(0===f.notExist.length){u.splice(d,1),e.callback.apply(null,f.exist),m();break}if(0==d&&0==v){for(var d=u.length-1;d>=0;d--){for(var e=u[d],f=c(e.deps),g=f.notExist,h=!1,i=u.length-1;i>=0;i--)if(b.contains(g,u[i].id)){h=!0;break}h||a.error(q+e.id),a.warn(e.id),a.warn("----notExist : "+f.notExist)}a.error(q+f.notExist)}}}function n(c,d,e){c=b.alias(c);var f=arguments.length;if(2==f?(e=d,d=[]):d="string"==typeof d?[d]:d,b.isFunc(e))for(var g,h=e.toString(),i=/\$Require\s*\(\s*['"]([^'"]+)['"]\s*\)/g;g=i.exec(h);)d.push(g[1]);x.require(d,function(){var d;if("function"==typeof e)try{x.traceLog&&a.log(p+"define:\n"+c),d=e.apply(null,arguments)}catch(f){return f.message=p+c+":\nfactory define error:\n"+f.message,void a.error(f)}else d=e;if(d){b.ns(c,d);var g=typeof d;("object"==g||"function"==g)&&(d.$ns=c)}else a.warn(p+"factory no return:\n"+c)},c)}function o(d,e,f){var g="string"==typeof d?[d]:d;e=e||$H.noop;for(var h=[],i=[],j=!0,l=0,m=g.length;m>l;l++){var n=g[l];n=b.alias(n);var o=c(n);o.notExist.length>0?(h.push(n),j&&(j=!1,u.push({id:f,deps:g,callback:e})),x.traceLog&&a.log(q+n)):i.push(o.exist[0])}return 0==h.length?(e&&e.apply(null,i),1==i.length?i[0]:i):void k(h)}var p="[Handy Loader] ",q=p+"not found: ",r=document.head||document.getElementsByTagName("head")[0]||document.documentElement,s=navigator.userAgent,t=s.indexOf("AppleWebKit"),u=[],v=0,w={},x={traceLog:!1,combine:$H.isDebug?!1:!0,isMin:!1,timeout:15e3,skinName:"skin",showLoading:function(){},define:n,require:o};return window.$Define=x.define,window.$Require=x.require,x}),$Define("B.Class",["B.Object","B.Debug"],function(a,b){function c(b){var c=function(){var a,b,d=arguments;if(this.constructor!=c){a=d.callee;var e=function(){};e.prototype=a.prototype;var f=new e;return a.apply(f,d),f}return a=this,b=a.initialize,b?b.apply(a,d):void 0};return c.$isClass=!0,c.derive=function(a,b,c){var d=f.createClass();return f.inherit(d,this,a,b,c),d},c.prototype.callSuper=function(b,c){var d=this;b&&!b.$isClass&&void 0!==b.length&&(c=b,b=null);var e=arguments.callee.caller,f=e.$owner.superProto;c=c||e.arguments,b=b?b.prototype:f||d.constructor.superProto;var g=e.$name;if(b){var h=b[g];if(a.isFunc(h))return h.apply(d,c)}},b&&this.ns(b,c),c}function d(c,d,e,f,g){var h=function(){};if(h.prototype=d.prototype,a.extend(c,d,g),c.prototype=new h,c.prototype.constructor=c,c.superClass=d,c.superProto=d.prototype,d._onInherit)try{d._onInherit(c)}catch(i){b.error(i)}f&&a.extend(c,f),e&&a.extend(c.prototype,e)}function e(b){var c;return c="string"==typeof b?a.ns(b):b,c&&(c.$singleton||(c.$singleton=new c))}var f={createClass:c,inherit:d,getSingleton:e};return f}),$Define("B.Function",function(){function a(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){var d=c.slice();return Array.prototype.push.apply(d,arguments),a.apply(b,d)}}function b(a,b,c,d){return $H.Object.isFunc(a)&&$H.Object.isFunc(b)?function(){var e=c||this,f={},g=arguments;return f.scope=d,f.target=e,f.method=a,0!=b.apply(f,g)?a.apply(e,g):!1}:a||b}var c={bind:a,intercept:b};return c}),$Define("B.Events",function(){function a(a,b){var c=/\s+/;if("object"==typeof a){for(var d in a)b([d,a[d]]);return!0}if("string"==typeof a&&c.test(a)){for(var e=a.split(c),f=0,g=e.length;g>f;f++)b([e[f]]);return!0}return!1}function b(a,b){var c=this,d=$H.toArray(arguments,2);return c._parseEvents(b,function(b){c[a].apply(c,b.concat(d))})}function c(a,b){var c=this;return function(d){return 1!=c.isSuspend||"string"==typeof d&&d.indexOf(":")>0?a.apply(b||c,arguments):void 0}}function d(a){var b=this;b._execEvtCache.push(a)}function e(){var a,b=this,c=b._execEvtCache;return $H.each(c,function(d,e){c.splice(d,1);var f=e.delegation;return"number"==typeof e.times&&(e.times>1?e.times--:b.off(e.name,e.handler)),a=f.apply(b,e.args),b._stopEvent?(c.splice(0,c.length),!1):void 0}),b._stopEvent=!1,a}function f(a,b,c,d){var e=this;if(!e._parseCustomEvents("on",a,b,c,d)){"number"==typeof c&&(d=c,c=null);var f=e._eventCache,g=f[a];g||(g=f[a]=[]);var h=e._delegateHandler(b,c);g.push({times:d,handler:b,context:c,delegation:h})}}function g(){var a=this,b=$H.toArray(arguments);b.push(1),a.on.apply(a,b)}function h(a,b){var c=this;if("all"==a)return c._eventCache={},!0;if(!c._parseCustomEvents("off",a,b)){var d=c._eventCache,e=a.indexOf(".");if(!b&&0>=e){for(var f in d)(f.split(".")[0]==a||0==e&&f.indexOf(a)>=0)&&delete d[f];return!0}var g=d[a];if(!g)return!1;if(!b)return delete d[a],!0;for(var h=0,i=g.length;i>h;h++)if(g[h].handler==b)return g.splice(h,1),!0;return!1}}function i(){this._stopEvent=!0}function j(a){function b(b){if(b)for(var d=0,e=b.length;e>d;d++){var f=b[d];f.args=g,f.name=a,c._pushEvent(f)}}var c=this,d=$H.toArray(arguments);if(d.unshift("trigger"),!c._parseCustomEvents.apply(c,d)){var e,f=c._eventCache,g=$H.toArray(arguments);if(a.indexOf(".")>0)e=f[a],b(e);else for(var h in f){var i=a.indexOf(".");(h.split(".")[0]==a||0==i&&h.indexOf(a)>=0)&&(e=f[h],b(e))}return b(f.all),c._execEvents()}}function k(){var a=this;return a.isSuspend?!1:void(a.isSuspend=!0)}function l(){var a=this;return a.isSuspend?void(a.isSuspend=!1):!1}var m={_eventCache:{},_execEvtCache:[],_parseEvents:a,_parseCustomEvents:b,_delegateHandler:c,_pushEvent:d,_execEvents:e,on:f,once:g,off:h,suspend:k,resume:l,stop:i,trigger:j};return m}),$Define("B.Date",function(){function a(a,b){var c=["日","一","二","三","四","五","六"],d=a.getDay();return b&&(d+=b%7+7,d%=7),c[d]}function b(a){return 0==a.getDay()||6==a.getDay()}function c(a){return a=new j(a.getFullYear(),a.getMonth()+1,0),a.getDate()}function d(a){var b=new j(a.getFullYear(),0,0),c=new j(a.getFullYear()+1,0,0);return Math.floor((c.getTime()-b.getTime())/864e5)}function e(a){var b=new j("1/1/"+a.getFullYear());return Math.ceil((a.getTime()-b.getTime())/864e5)}function f(a,b){if("string"==typeof a&&(a=k.parseDate(a)),"object"!=typeof a)return a;var b=b||"yyyy-MM-dd HH:mm:ss",c=a.getHours(),d=Math.floor((a.getMonth()+3)/3),e={"y+":a.getFullYear(),"M+":a.getMonth()+1,"d+":a.getDate(),"h+":c%12==0?12:c%12,"H+":c,"m+":a.getMinutes(),"s+":a.getSeconds(),"w+":k.getWeek(a),"q+":d,"Q+":["一","二","三","四"][d-1],"S+":a.getMilliseconds()};for(var f in e)if(new RegExp("("+f+")").test(b)){var g=RegExp.$1.length;b=b.replace(RegExp.$1,1==g?e[f]:("00"+e[f]).slice(-g))}return b}function g(a,b){var c=typeof a,d=new j;if("number"==c)return d.setTime(a),d;if("string"!=c)return a;var b=b||"yyyy-MM-dd HH:mm:ss",e=b.match(/[a-zA-Z]+/g),f=a.match(/\d+/g);if(f){d.setDate(1);for(var g=0;g<f.length;g++){var h=e[g],i=parseInt(f[g]);switch(h){case"yyyy":d.setFullYear(i);break;case"MM":d.setMonth(i-1);break;case"dd":var l=k.getDaysInMonth(d);i>l&&(i=l),d.setDate(i);break;case"HH":d.setHours(i);break;case"mm":d.setMinutes(i);break;case"ss":d.setSeconds(i);break;case"SS":d.setMilliseconds(i)}}return d}}function h(a){var b=new j;return a&&a!==!0?("number"!=typeof a&&(a=k.parseDate(a).getTime()),void(l=a-b.getTime())):(b.setTime(b.getTime()+l),a&&(b=k.formatDate(b)),b)}function i(a,b){if(a){a=k.parseDate(a);var c=k.now(),d=c.getTime()-a.getTime();if(0!=b){var e;if((d/=6e4)<60)e="分钟",d=d||1;else if((d/=60)<24)e="小时";else{if(!((d/=24)<30))return"30天前";e="天"}d=d>0?d:1,d=(Math.floor(d)||1)+e+"前"}return d}}var j=window.Date,k={getWeek:a,isWeeken:b,getDaysInMonth:c,getDaysInYear:d,getDayIndexOfYear:e,formatDate:f,parseDate:g,now:h,howLong:i},l=0;return k}),$Define("B.String",function(){function a(a){return a.replace(/<\/?[^>]+>/gi,"")}function b(a){if(!a)return a;var b=document.createElement("div"),c=document.createTextNode(a);return b.appendChild(c),b.innerHTML}function c(a){var b=document.createElement("div");return b.innerHTML=o.stripTags(a),b.childNodes[0].nodeValue}function d(a){return a=a.replace(/&/gi,"&amp;"),a=a.replace(/</gi,"&lt;"),a=a.replace(/>/gi,"&gt;"),a=a.replace(/\"/gi,"&quot;"),a=a.replace(/\'/gi,"&apos;"),a=a.replace(/\n/gi,"</br>"),a=a.replace(/ /gi,"&nbsp;")}function e(a){return a=a.replace(/&lt;/gi,"<"),a=a.replace(/&gt;/gi,">"),a=a.replace(/&quot;/gi,'"'),a=a.replace(/&apos;/gi,"'"),a=a.replace(/<\/?br>/gi,"\n"),a=a.replace(/&amp;/gi,"&"),a=a.replace(/&nbsp;/gi," ")}function f(){return sHtml=sHtml.replace(/\n/gi,""),sHtml=sHtml.replace(/\\s+/gi,""),bIgnore||(sHtml=sHtml.replace(/<\/(address|blockquote|center|dir|div|dl|fieldset|form|hr|h[1-6]|isindex|iframe|menu|ol|p|pre|table|ul)>/gi,"\n"),sHtml=sHtml.replace(/<br>/gi,"\n")),sHtml=sHtml.replace(/<li>/gi," . "),sHtml=sHtml.replace(/<[^>]+>/g,""),sHtml=o.decodeHTML(sHtml)}function g(a){return o.encodeHTML(a)}function h(a){return a=a.replace(/(^(\s|　)+)|((\s|　)+$)/g,"")}function i(a,b){return b||(b=/[,%\'\"\/\\;|\<\>\^]/),a.search(b)>-1}function j(a){return a.replace(/[^\x00-\xff]/g,"**").length}function k(a,b,c){if(o.len(a)>b){c===!0?c=2:c>0||(c=0);var d=0,e=0;for(b-=c;b>e;)a.charCodeAt(d)>255?e+=2:e++,d++;a=a.substring(0,d);for(var d=0;c>d;d++)a+="."}return a}function l(a){return 0==a.search(/^\d+$/g)}function m(a){return/[\u4E00-\u9FA5]+/.test(a)}function n(a){return/^[\u4E00-\u9FA5]+$/.test(a)}var o={stripTags:a,escape:b,unescape:c,encodeHTML:d,decodeHTML:e,htmlToTxt:f,TxtToHtml:g,trim:h,check:i,len:j,left:k,isNumStr:l,hasChn:m,isChn:n};return o}),$Define("B.Cookie",function(){function a(a,b){var c=a+"=",d="",e=document.cookie;if(e.length>0){var f=e.indexOf(c);if(-1!=f){f+=c.length;var g=e.indexOf(";",f);-1==g&&(g=e.length),d=e.substring(f,g),b||(d=unescape(d))}}return d}function b(a,b,c){var d=[];void 0!==a&&void 0!==b&&d.push(a+"="+escape(b)),c&&(void 0!==c.path&&d.push("path="+c.path),void 0!==c.domain&&d.push("domain="+c.domain),void 0!==c.expires&&d.push("expires="+c.expires),c.secure&&d.push("secure")),document.cookie=d.join(";")}function c(a){var b=new Date;b.setTime(b.getTime()-1),document.cookie=a+"=;expires="+b.toGMTString()}var d={getCookie:a,setCookie:b,delCookie:c};return d}),$Define("B.Util","B.Object",function(a){function b(a){return null!=a&&a==a.window}function c(){return++n}function d(){var a=top.location.hash;return a.replace(/\?.*/,"")}function e(a){var b=top.location.hash;b.indexOf("#")>=0&&(a=b.replace(/#[^\?]*/,a)),top.location.hash=a}function f(a){var b=!a;if(b&&l)return l;a=a||document.body;var c=document.createElement("div");c.style.cssText="display:inline-block; padding:0; line-height:1; position:absolute; visibility:hidden; font-size:1em",c.appendChild(document.createTextNode("M")),a.appendChild(c);var d=c.offsetHeight;return b&&(l=d),a.removeChild(c),d}function g(a,b){b=b||document.body,"number"==typeof a&&(a+="px"),b.style.fontSize=a}function h(a){"string"==typeof a&&(a=parseFloat(a.replace("em","")));var b=m.getDefFontSize();return Math.floor(a*b)}function i(a){var b=m.getDefFontSize(),c=1/b*a;return c=Math.ceil(1e3*c)/1e3}function j(a){for(var b=0,c=0;a;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;return{top:c,left:b}}function k(b,c){var d=b[c];return a.isFunc(d)?d():d}var l,m={isWindow:b,uuid:c,getHash:d,setHash:e,getDefFontSize:f,setDefFontSize:g,em2px:h,px2em:i,position:j,result:k},n=0;return m}),$Define("B.Url",function(){function a(a){return/^(\w+:\/\/)?(\w+\.\w+)?[\w\/\.]+/.test(a)}function b(a){return/^(\w+:\/\/)?\w+\.\w+/.test(a)}function c(a){return/\.(jpg|jpeg|png|bmp|gif)$/.test(a)}function d(a,b){var c,b=b||location.href;if(c=b.match(/\?([^#]+)/)){for(var d=c[1],e=d.split("&"),f={},g=0,h=e.length;h>g;g++){var i=e[g].split("=");f[i[0]]=i[1]}return a?f[a]:f}}function e(a,b){return b&&(a+=(a.indexOf("?")>-1?"&":"?")+b),a}var f={isUrl:a,isAbsUrl:b,isPic:c,getParam:d,addParam:e};return f}),$Define("B.Array","B.Object",function(a){function b(a){return a}function c(a){return function(b){return b[a]}}function d(a){return null==a?b:$H.isFunc(a)?a:c(a)}function e(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}}function f(b){return function(c,e,f){var g={};return e=d(e),a.each(c,function(a,d){var h=e.call(f,d,a,c);b(g,h,d)}),g}}function g(b,c,d){var e=[];if(null==b)return e;var f=Array.prototype.map;return f&&b.map===f?b.map(c,d):(a.each(b,function(a,b){e.push(c.call(d,b,a))}),e)}function h(a,b){return this.map(a,c(b))}function i(a,b,c){var d=!1;if(null==a||!b)return d;var e=Array.prototype.some;return e&&a.some===e?a.some(b,c):($H.each(a,function(a,e,f){return d||(d=b.call(c,e,a,f))?!1:void 0}),!!d)}function j(a,b,c){var d=!0;if(null==a||!b)return d;var e=Array.prototype.every;return e&&a.every===e?a.every(b,c):($H.each(a,function(a,e,f){return(d=b.call(c,e,a,f))?void 0:!1}),!!d)}function k(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=u.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}var f=Array.prototype.indexOf;if(f&&a.indexOf===f)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1}function l(a,b,c){var d;return this.some(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d}function m(a,b,c){var d=[];if(null==a)return d;var e=Array.prototype.filter;return e&&a.filter===e?a.filter(b,c):($H.each(a,function(a,e,f){b.call(c,e,a,f)&&d.push(e)}),d)}function n(a,b){return this.filter(a,e(b))}function o(a,b){return this.find(a,e(b))}function p(b,c){var d=Array.prototype.slice.call(arguments,2),e=a.isFunc(c);return this.map(b,function(a){return(e?c:a[c]).apply(a,d)})}function q(a,b,c,e,f){c=d(c);for(var g=c.call(e,b),h=0,i=a.length;i>h;){var j=h+i>>>1,k=c.call(e,a[j]);(f?k>g:g>k)?h=j+1:i=j}return h}function r(a,b,c,e){var f=this;return b=d(b),f.pluck(f.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return e?-1:1;if(d>c||void 0===d)return e?1:-1}return a.index-b.index}),"value")}function s(){return f(function(a,b,c){a[b]?a[b].push(c):a[b]=[c]})}function t(){return f(function(a,b){a[b]?a[b]++:a[b]=1})}var u={map:g,pluck:h,some:i,every:j,indexOf:k,find:l,filter:m,where:n,findWhere:o,invoke:p,sortedIndex:q,sortBy:r,groupBy:s(),countBy:t()};return u}),$Define("B.Geo",function(){function a(a,b,c){function d(a){return a*Math.PI/180}function e(a){return a.get?a=[a.get("latitude"),a.get("longitude")]:$H.isObj(a)&&(a=[a.latitude,a.longitude]),a}if(a&&b){var f,g,h,i,j=6371;a=e(a),f=a[0],g=a[1],b=e(b),h=b[0],i=b[1];var k=d(f),l=d(h),m=j*Math.acos(Math.cos(l)*Math.cos(k)*Math.cos(d(g)-d(i))+Math.sin(l)*Math.sin(k));if(m=m.toFixed(2),0!=c){if(isNaN(m)){if(f!=h||g!=i||!$H.isNum(f)||!$H.isNum(g))return"未知";m=0}m+="km"}return m}}var b={distance:a};return b}),$Define("B.Template",["B.Object","B.String","B.Debug","B.Function"],function(a,b,c){function d(a){var b=typeof a;return"string"!==b&&("number"===b?a+="":a=""),a}function e(a){return b.encodeHTML(d(a))}function f(b,c){var d=c.data;return a.isFunc(b)&&(b=b.call(d)),b&&!c.inverse||!b&&c.inverse?c.fn(d):void 0}function g(a,b){return b.inverse=!0,b.helpers["if"].call(this,a,b)}function h(a,b){var c=b.fn,d="";if(a){if(void 0!==a.length)for(var e=0,f=a.length;f>e;e++)d+=c(a[e]);else for(var e in a)d+=c(a[e]);return d}}function i(a,b){var c=b.fn,d=[];if(a){if(void 0!==a.length)for(var e=0,f=a.length;f>e;e++)d.push(c(a[e]));else for(var e in a)d.push(c(a[e]));return d.join("")}}function j(a){return v?"$r+="+a+";":"$r.push("+a+");"}function k(a){return a=a.replace(/("|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n"),j('"'+a+'"')}function l(a,c){var c=c||{},d=a.exp.replace(/"/g,"'");d=b.trim(d).replace(/\s{2,}/g," ");var e,f=c.helpers,g=f&&f.getValue,h=f&&f.parseValue,i=a.blockName,k=a.children,l=a.num,m="\nif($tmp||$tmp===0){"+j("$tmp")+"}",o=(a.inverse?"inverse:true,":"")+"num:"+l+',context:$me,exp:"'+d+'",helpers:$helpers,data:$data}',p=g?'$helpers.getValue.call($me,"'+d+'",$data,{'+o+")":"($data&&$data."+d+")";
if(i){var q="$program"+l;if(e='$tmp = $helpers["'+i+'"].call($me,'+p+", {fn:"+q+","+o+");"+m,k){var r=n(k,c),u=x[0]+"\n"+r.join("\n")+"\n"+x[1];s.splice(2,0,"\nfunction "+q+"($data){\n"+u+"\n}\n")}}else{var v;(v=d.match(/([^\s]+)\s([^\n]+)/))?(d=v[1],e="if (helper = $helpers."+d+') {\n$tmp = helper.call($me,"'+v[2]+'",{'+o+'); \n}else{$tmp="";}'):(e="if (helper = $helpers."+d+') {\n$tmp = helper.call($me,"",{'+o+"); \n}else{\nhelper = "+p+"; $tmp = typeof helper === functionType ? helper.call($me,{"+o+") : helper;\n"+(h?"\n$tmp=$helpers.parseValue.call($me,$tmp,{"+o+");":"")+"}",t.isEscape?"\n$tmp=escape($tmp);":""),e+=m}return e}function m(a,b){function d(a,b,c){for(var d,e=new RegExp(h+"[#/]"+a+"((?!"+i+").)*"+i,"ig"),f=0;d=e.exec(c);)if(d[0]==b){if(0==f)return d.index;f--}else f++;return-1}if(a){var e,f,g=b||{},h=t.openTag,i=t.closeTag;if(g.children?f=g.children:g.children=f=[],(e=a.indexOf(h))>=0){var j=a.substring(0,e);if(j&&f.push({html:j}),a=a.substring(e+h.length),0==a.indexOf("#")){a=a.substring(1);var k=a.match(/^[a-z]+/);if(!k)return void c.error("找不到辅助函数:"+a);var l=k[0];e=a.indexOf(i);var n=a.substring(l.length+1,e);a=a.substring(e+i.length);var o={num:++w,blockName:l,exp:n};f.push(o);var p=h+"/"+l+i;e=d(l,p,a);var q;if(-1==e)return void c.error("未找到块结束位置:"+p);if(q=a.substring(0,e),a=a.substring(e+p.length),m(q,o),"if"==l)for(var r=o.children,s=0,u=r.length;u>s;s++){var v=r[s];"else"==v.exp&&(v.exp=o.exp,v.blockName="if",v.num=++w,v.inverse=!0,v.children=r.slice(s+1),f.push(v),o.children=r.slice(0,s))}}else e=a.indexOf(i),f.push({num:++w,exp:a.substring(0,e)}),a=a.substring(e+i.length);m(a,g)}else a&&f.push({html:a});return g}}function n(a,b){var c=[];if(a)for(var d=0,e=a.length;e>d;d++){var f=a[d];f.html?c.push(k(f.html)):f.exp&&c.push(l(f,b))}return c}function o(b,d){var e=t.openTag,f=t.closeTag;b=b.replace(new RegExp(e+"!((?!"+f+").)*"+f,"ig"),""),t.isTrim&&(b=b.replace(/^[\s\n]+/,"").replace(/[\s\n]+$/,"").replace(new RegExp("("+f+"|\\>)(\\s|\\n)+(?=("+e+"|<))","ig"),"$1").replace(new RegExp(f+"[\\s\\n]+([^\\n]+)[\\s\\n]+(?=("+e+"|<))","ig"),f+"$1")),s=[x[0]],s.push('var escape=$helpers.escape,functionType="function",$me=this;');var g,h=d&&d.ns;h?(g=a.extend({},y["default"]),g=a.extend(g,y[h])):g=y["default"],d.helpers=g;var i=m(b);w=0;var j=n(i.children,d);s=s.concat(j),s.push(x[1]);var k=s.join("\n");try{var l=["$T","$helpers","$data",k],o=window.Function.apply(null,l);return function(a,b){return o.call(b||a,t,g,a)}}catch(p){c.log(k),c.error(p)}}function p(){return v}function q(b,c,d){a.isObj(c)?(y[b]||(y[b]={}),a.extend(y[b],c)):y[b][c]=d}function r(a,b,d){var e,f,g;if("string"==typeof a)e=a;else if(void 0!==a.length)e=a.join("");else if(e=a.tmpl,g=a.id)if(u[g])f=u[g];else if(!e){var h=document.getElementById(g);h&&(e=(h.value||h.innerHTML).replace(/\s/g,""))}if(!f){if(!e)return void c.error("模板未定义");f=o(e,a),g&&(u[g]=f)}if(!b)return f;try{return f(b,d)}catch(i){c.log(f.toString()),c.error(i)}}var s,t={openTag:"{{",closeTag:"}}",isTrim:!0,isEscape:!1,getIfPlusJoin:p,registerHelper:q,tmpl:r},u={},v="".trim,w=0,x=["var $r="+(v?'""':"[]")+",$tmp,helper;","return "+(v?"$r;":'$r.join("");')],y={"default":{"if":f,unless:g,each:v?h:i,escape:e,trim:b.trim}};return t}),$Define("B.HashChange",["handy.base.Debug","handy.base.Util"],function(a,b){function c(){i||(i=!0,p.listeners={},o?$(window).on("hashchange",function(){f(b.getHash())}):(j=$('<iframe id="fff" tabindex="-1" style="display:none" width=0 height=0 title="empty" />').appendTo(m.body)[0],$(j).one("load",function(){d(b.getHash()),setInterval(e,p.delay)})))}function d(b){if(b==k)return!1;var c=j.contentWindow,d=c.document;d.open(),d.write("<!doctype html><html><body>"+b+"</body></html>"),d.close(),k=b,a.log("set:"+j.contentWindow.document.body.innerText)}function e(){var c=b.getHash(),e=j.contentWindow.document.body.innerText;c!=k?(d(c),f(c)):e!=k&&(a.log("update:"+j.contentWindow.document.body.innerText),b.setHash(e))}function f(a){var b=p.listeners;for(var c in b)b[c](a)}function g(a,b){return i||c(),b in p.listeners?void $D.error(new Error("Duplicate name")):(b=b||$H.expando+ ++l,p.listeners[b]=a,b)}function h(a){for(var b in p.listeners)a&&a!=b||delete p.listeners[b]}var i,j,k,l=0,m=document,n=m.documentMode,o="onhashchange"in window&&(void 0===n||n>7),p={delay:50,listen:g,unListen:h};return p}),$Define("B.Support","B.Browser",function(a){function b(){var b;if(a.mobile())b="hui-mobile";else{b="hui-pc";var c=a.ie();c&&(b+=" ie"+c)}document.documentElement.className+=" "+b+" hui"}var c={mediaQuery:b};if(c.mediaQuery(),6==a.ie())try{document.execCommand("BackgroundImageCache",!1,!0)}catch(d){}return c}),$Define("B.Validator",["B.String","B.Object"],function(a,b){function c(a,b){var c=b.rules;for(var d in c){var e=c[d],f="function"==typeof e?e:s[d],g=f(a,e);if(!g){var h=b.error||s.error,i=b.messages&&b.messages[d]||s.messages[d];return i=i.replace(/\{([^\}]+)\}/g,function(a,c){return e[c]||0==c&&e||b[c]||e||""}),h&&h(i),g}}return!0}function d(b){return a.trim(""+b).length>0}function e(a){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)}function f(a){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)}function g(a){return!/Invalid|NaN/.test(new Date(a).toString())}function h(a){return/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(a)}function i(a){return/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)}function j(a){return/^\d+$/.test(a)}function k(a){if(/[^0-9 \-]+/.test(a))return!1;var b=0,c=0,d=!1;a=a.replace(/\D/g,"");for(var e=a.length-1;e>=0;e--){var f=a.charAt(e);c=parseInt(f,10),d&&(c*=2)>9&&(c-=9),b+=c,d=!d}return b%10===0}function l(a,b){return a>=b}function m(a,b){return b>=a}function n(a,b){return a>=b[0]&&a<=b[1]}function o(c,d){var e=b.isArr(c)?c.length:a.trim(""+c).length;return e>=d}function p(c,d){var e=b.isArr(c)?c.length:a.trim(""+c).length;return d>=e}function q(c,d){var e=b.isArr(c)?c.length:a.trim(""+c).length;return e>=d[0]&&e<=d[1]}function r(a,b){return a===b}var s={messages:{required:"{name}不能为空",email:"请输入正确的邮件地址",url:"请输入正确的链接地址",date:"请输入正确的日期",dateISO:"请输入正确格式的日期",number:"{name}须是数字",digits:"{name}须是整数",creditcard:"请输入正确的信用卡号码",equalTo:"请输入相同的{name}",min:"{name}不能小于{0}",max:"{name}不能大于{0}",range:"{name}要在{0}到{1}之间",maxlength:"{name}长度不能超过{0}",minlength:"{name}长度不能少于{0}",rangelength:"{name}长度要在{0}到{1}之间"},valid:c,required:d,email:e,url:f,date:g,dateISO:h,number:i,digits:j,creditcard:k,min:l,max:m,range:n,minlength:o,maxlength:p,rangelength:q,equalTo:r};return s}),$Define("B.LocalStorage",["B.Browser","B.Events","B.Json"],function(a,b,c){function d(){if(!k&&a.ie()){var b="LocalStorageUserDataDiv";i=document.getElementById(b),i||(i=document.createElement("DIV"),i.style.display="none",i.id=b,i.addBehavior("#default#userData"),document.body.appendChild(i),i.load(m))}}function e(a){var b;return b=k?l.getItem(a):i.getAttribute(a),b=c.parseJson(b)}function f(a,b){b=c.stringify(b);try{k?l.setItem(a,b):(i.setAttribute(a,b),i.save(m))}catch(d){return $D.error(d),!1}return!0}function g(a){k?l.removeItem(a):(i.removeAttribute(a),i.save(m))}function h(){k?l.clear():i.unload()}var i,j={_init:d,getItem:e,setItem:f,removeItem:g,clear:h},k=window.localStorage&&window.localStorage.getItem,l=window.localStorage,m=document.domain;return j._init(),j}),$Define("B.Adapt","B.Function",function(){$G={config:{}};var a=window.$;return a.fn.remove=$H.intercept(a.fn.remove,function(){var a=this.target;$H.trigger("removeEl",a)}),1}),$Define("U.ImgCompress","B.Class",function(){function a(a,c){if(a){var d=a;if("object"==typeof File&&a instanceof File){var e=URL||webkitURL;d=e.createObjectURL(a)}var f=new Image;f.src=d,f.onload=function(){var d=f.width,e=f.height,g=void 0!==c.cropX,h=c.maxWidth,i=c.maxHeight,j=c.width,k=c.height,l=Math.ceil,m=function(a,b){var c=a/b;return j?(a=j,k||(b=a/c)):a>h&&(a=h,b=a/c),k?(b=k,j||(a=b*c)):b>i&&(b=i,a=b*c),{w:l(a),h:l(b)}},n=document.createElement("canvas"),o=n.getContext("2d"),p=$(n),q=c.cropW,r=c.cropH,s=c.cropX,t=c.cropY,u=$H.ios();if(g){var v=m(q,r);if(u){q=v.w,r=v.h;var w=q/c.cropW;1!=w&&(d=l(d*w),s=l(s*w)),w=r/c.cropH,1!=w&&(e=l(e*w),t=l(t*w)),p.attr({width:d,height:e}),o.drawImage(f,0,0,d,e)}else d=v.w,e=v.h,p.attr({width:d,height:e}),o.drawImage(f,s,t,q,r,0,0,d,e)}else{var v=m(d,e);d=v.w,e=v.h,p.attr({width:d,height:e}),o.drawImage(f,0,0,d,e)}o.globalCompositeOperation="destination-over",o.fillStyle="#ffffff",o.fillRect(0,0,d,e);var x,y=c.quality||.5;if(u){var z=new MegaPixImage(f);if(z.render(n,{maxWidth:d,maxHeight:e,quality:y,orientation:6}),g){var A=o.getImageData(s,t,q,r);p.attr({width:q,height:r}),o.putImageData(A,0,0)}x=n.toDataURL("image/jpeg",y)}else if($H.android()){var B=new b;x=B.encode(o.getImageData(0,0,d,e),100*y)}else x=n.toDataURL("image/jpeg",y);var C={orig:a,base64:x,clearBase64:x.substr(x.indexOf(",")+1)};c&&c.success&&c.success(C)}}}function b(a){function b(a){var b,c,d,e,f,g,h,i,j,k=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(b=0;64>b;b++)c=t((k[b]*a+50)/100),1>c?c=1:c>255&&(c=255),u[P[b]]=c;for(d=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],e=0;64>e;e++)f=t((d[e]*a+50)/100),1>f?f=1:f>255&&(f=255),v[P[e]]=f;for(g=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],h=0,i=0;8>i;i++)for(j=0;8>j;j++)w[h]=1/(8*u[P[h]]*g[i]*g[j]),x[h]=1/(8*v[P[h]]*g[i]*g[j]),h++}function c(a,b){var c,d,e=0,f=0,g=new Array;for(c=1;16>=c;c++){for(d=1;d<=a[c];d++)g[b[f]]=[],g[b[f]][0]=e,g[b[f]][1]=c,f++,e++;e*=2}return g}function d(){y=c(Q,R),z=c(U,V),A=c(S,T),B=c(W,X)}function e(){var a,b,c,d=1,e=2;for(a=1;15>=a;a++){for(b=d;e>b;b++)D[32767+b]=a,C[32767+b]=[],C[32767+b][1]=a,C[32767+b][0]=b;for(c=-(e-1);-d>=c;c++)D[32767+c]=a,C[32767+c]=[],C[32767+c][1]=a,C[32767+c][0]=e-1+c;d<<=1,e<<=1}}function f(){for(var a=0;256>a;a++)N[a]=19595*a,N[a+256>>0]=38470*a,N[a+512>>0]=7471*a+32768,N[a+768>>0]=-11059*a,N[a+1024>>0]=-21709*a,N[a+1280>>0]=32768*a+8421375,N[a+1536>>0]=-27439*a,N[a+1792>>0]=-5329*a}function g(a){for(var b=a[0],c=a[1]-1;c>=0;)b&1<<c&&(H|=1<<I),c--,I--,0>I&&(255==H?(h(255),h(0)):h(H),I=7,H=0)}function h(a){G.push(M[a])}function i(a){h(255&a>>8),h(255&a)}function j(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z=0,$=8,_=64;for(k=0;$>k;++k)c=a[Z],d=a[Z+1],e=a[Z+2],f=a[Z+3],g=a[Z+4],h=a[Z+5],i=a[Z+6],j=a[Z+7],l=c+j,m=c-j,n=d+i,o=d-i,p=e+h,q=e-h,r=f+g,s=f-g,t=l+r,u=l-r,v=n+p,w=n-p,a[Z]=t+v,a[Z+4]=t-v,x=.707106781*(w+u),a[Z+2]=u+x,a[Z+6]=u-x,t=s+q,v=q+o,w=o+m,y=.382683433*(t-w),z=.5411961*t+y,A=1.306562965*w+y,B=.707106781*v,C=m+B,D=m-B,a[Z+5]=D+z,a[Z+3]=D-z,a[Z+1]=C+A,a[Z+7]=C-A,Z+=8;for(Z=0,k=0;$>k;++k)c=a[Z],d=a[Z+8],e=a[Z+16],f=a[Z+24],g=a[Z+32],h=a[Z+40],i=a[Z+48],j=a[Z+56],F=c+j,G=c-j,H=d+i,I=d-i,J=e+h,K=e-h,L=f+g,M=f-g,N=F+L,O=F-L,P=H+J,Q=H-J,a[Z]=N+P,a[Z+32]=N-P,R=.707106781*(Q+O),a[Z+16]=O+R,a[Z+48]=O-R,N=M+K,P=K+I,Q=I+G,S=.382683433*(N-Q),T=.5411961*N+S,U=1.306562965*Q+S,V=.707106781*P,W=G+V,X=G-V,a[Z+40]=X+T,a[Z+24]=X-T,a[Z+8]=W+U,a[Z+56]=W-U,Z++;for(k=0;_>k;++k)Y=a[k]*b[k],E[k]=Y>0?0|Y+.5:0|Y-.5;return E}function k(){i(65504),i(16),h(74),h(70),h(73),h(70),h(0),h(1),h(1),h(0),i(1),i(1),h(0),h(0)}function l(a,b){i(65472),i(17),h(8),i(b),i(a),h(3),h(1),h(17),h(0),h(2),h(17),h(1),h(3),h(17),h(1)}function m(){var a,b;for(i(65499),i(132),h(0),a=0;64>a;a++)h(u[a]);for(h(1),b=0;64>b;b++)h(v[b])}function n(){var a,b,c,d,e,f,g,j;for(i(65476),i(418),h(0),a=0;16>a;a++)h(Q[a+1]);for(b=0;11>=b;b++)h(R[b]);for(h(16),c=0;16>c;c++)h(S[c+1]);for(d=0;161>=d;d++)h(T[d]);for(h(1),e=0;16>e;e++)h(U[e+1]);for(f=0;11>=f;f++)h(V[f]);for(h(17),g=0;16>g;g++)h(W[g+1]);for(j=0;161>=j;j++)h(X[j])}function o(){i(65498),i(12),h(3),h(1),h(0),h(2),h(17),h(3),h(17),h(0),h(63),h(0)}function p(a,b,c,d,e){var f,h,i,k,l,m,n,o,p,q,r=e[0],s=e[240],t=16,u=63,v=64;for(h=j(a,b),i=0;v>i;++i)F[P[i]]=h[i];for(k=F[0]-c,c=F[0],0==k?g(d[0]):(f=32767+k,g(d[D[f]]),g(C[f])),l=63;l>0&&0==F[l];l--);if(0==l)return g(r),c;for(m=1;l>=m;){for(o=m;0==F[m]&&l>=m;++m);if(p=m-o,p>=t){for(n=p>>4,q=1;n>=q;++q)g(s);p=15&p}f=32767+F[m],g(e[(p<<4)+D[f]]),g(C[f]),m++}return l!=u&&g(r),c}function q(){var a,b=String.fromCharCode;for(a=0;256>a;a++)M[a]=b(a)}function r(a){if(0>=a&&(a=1),a>100&&(a=100),O!=a){var c=0;c=Math.floor(50>a?5e3/a:200-2*a),b(c),O=a,console.log("Quality set to: "+a+"%")}}function s(){var b,c=(new Date).getTime();a||(a=50),q(),d(),e(),f(),r(a),b=(new Date).getTime()-c,console.log("Initialization "+b+"ms")}var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X;Math.round,t=Math.floor,u=new Array(64),v=new Array(64),w=new Array(64),x=new Array(64),C=new Array(65535),D=new Array(65535),E=new Array(64),F=new Array(64),G=[],H=0,I=7,J=new Array(64),K=new Array(64),L=new Array(64),M=new Array(256),N=new Array(2048),P=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Q=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],R=[0,1,2,3,4,5,6,7,8,9,10,11],S=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],T=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],U=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],V=[0,1,2,3,4,5,6,7,8,9,10,11],W=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],X=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250],this.encode=function(a,b){var c,d,e,f,h,j,q,s,t,u,v,C,D,E,F,M,O,P,Q,R,S=(new Date).getTime();for(b&&r(b),G=new Array,H=0,I=7,i(65496),k(),m(),l(a.width,a.height),n(),o(),c=0,d=0,e=0,H=0,I=7,this.encode.displayName="_encode_",f=a.data,h=a.width,j=a.height,q=4*h,t=0;j>t;){for(s=0;q>s;){for(D=q*t+s,E=D,F=-1,M=0,O=0;64>O;O++)M=O>>3,F=4*(7&O),E=D+M*q+F,t+M>=j&&(E-=q*(t+1+M-j)),s+F>=q&&(E-=s+F-q+4),u=f[E++],v=f[E++],C=f[E++],J[O]=(N[u]+N[v+256>>0]+N[C+512>>0]>>16)-128,K[O]=(N[u+768>>0]+N[v+1024>>0]+N[C+1280>>0]>>16)-128,L[O]=(N[u+1280>>0]+N[v+1536>>0]+N[C+1792>>0]>>16)-128;c=p(J,w,c,y,A),d=p(K,x,d,z,B),e=p(L,x,e,z,B),s+=32}t+=8}return I>=0&&(P=[],P[1]=I+1,P[0]=(1<<I+1)-1,g(P)),i(65497),Q="data:image/jpeg;base64,"+btoa(G.join("")),G=[],R=(new Date).getTime()-S,console.log("Encoding time: "+R+"ms"),Q},s()}var c=$H.createClass();return $H.extend(c,{compress:a}),!function(){function a(a){var b,c,d=a.naturalWidth,e=a.naturalHeight;return d*e>1048576?(b=document.createElement("canvas"),b.width=b.height=1,c=b.getContext("2d"),c.drawImage(a,-d+1,0),0===c.getImageData(0,0,1,1).data[3]):!1}function b(a,b,c){var d,e,f,g,h,i,j,k=document.createElement("canvas");for(k.width=1,k.height=c,d=k.getContext("2d"),d.drawImage(a,0,0),e=d.getImageData(0,0,1,c).data,f=0,g=c,h=c;h>f;)i=e[4*(h-1)+3],0===i?g=h:f=h,h=g+f>>1;return j=h/c,0===j?1:j}function c(a,b,c){var e=document.createElement("canvas");return d(a,e,b,c),e.toDataURL("image/jpeg",b.quality||.8)}function d(c,d,f,g){var h,i,j,k,l,m,n,o,p,q,r,s=c.naturalWidth,t=c.naturalHeight,u=f.width,v=f.height,w=d.getContext("2d");for(w.save(),e(d,w,u,v,f.orientation),h=a(c),h&&(s/=2,t/=2),i=1024,j=document.createElement("canvas"),j.width=j.height=i,k=j.getContext("2d"),l=g?b(c,s,t):1,m=Math.ceil(i*u/s),n=Math.ceil(i*v/t/l),o=0,p=0;t>o;){for(q=0,r=0;s>q;)k.clearRect(0,0,i,i),k.drawImage(c,-q,-o),w.drawImage(j,0,0,i,i,r,p,m,n),q+=i,r+=m;o+=i,p+=n}w.restore(),j=k=null}function e(a,b,c,d,e){switch(e){case 5:case 6:case 7:case 8:a.width=d,a.height=c;break;default:a.width=c,a.height=d}switch(e){case 2:b.translate(c,0),b.scale(-1,1);break;case 3:b.translate(c,d),b.rotate(Math.PI);break;case 4:b.translate(0,d),b.scale(1,-1);break;case 5:b.rotate(.5*Math.PI),b.scale(1,-1);break;case 6:b.rotate(.5*Math.PI),b.translate(0,-d);break;case 7:b.rotate(.5*Math.PI),b.translate(c,-d),b.scale(-1,1);break;case 8:b.rotate(-.5*Math.PI),b.translate(-c,0)}}function f(a){var b,c,d;if(window.Blob&&a instanceof Blob){if(b=new Image,c=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null,!c)throw Error("No createObjectURL function found to create blob url");b.src=c.createObjectURL(a),this.blob=a,a=b}a.naturalWidth||a.naturalHeight||(d=this,a.onload=function(){var a,b,c=d.imageLoadListeners;if(c)for(d.imageLoadListeners=null,a=0,b=c.length;b>a;a++)c[a]()},this.imageLoadListeners=[]),this.srcImage=a}f.prototype.render=function(a,b){var e,f,g,h,i,j,k,l,m,n,o;if(this.imageLoadListeners)return e=this,void this.imageLoadListeners.push(function(){e.render(a,b)});b=b||{},f=this.srcImage.naturalWidth,g=this.srcImage.naturalHeight,h=b.width,i=b.height,j=b.maxWidth,k=b.maxHeight,l=!this.blob||"image/jpeg"===this.blob.type,h&&!i?i=g*h/f<<0:i&&!h?h=f*i/g<<0:(h=f,i=g),j&&h>j&&(h=j,i=g*h/f<<0),k&&i>k&&(i=k,h=f*i/g<<0),m={width:h,height:i};for(n in b)m[n]=b[n];o=a.tagName.toLowerCase(),"img"===o?a.src=c(this.srcImage,m,l):"canvas"===o&&d(this.srcImage,a,m,l),"function"==typeof this.onrender&&this.onrender(a)},"function"==typeof define&&define.amd?define([],function(){return f}):this.MegaPixImage=f}(),c}),$Define("E.Draggable","B.Class",function(){function a(a,b){var c=this;c.options=b||{};var d=c.el=$(a),e=c.startHandler=function(a){c.start(a)};d.on(g[0],e),e=c.moveHandler=function(a){c.move(a)},d.on(g[1],e),e=c.endHandler=function(a){c.end(a)},d.on(g[2],e)}function b(a){var b=this;b.drag=!0,$H.hasTouch()&&(a=a.originalEvent||a,a=a.touches[0]),b.eventX=a.clientX,b.eventY=a.clientY;var c=b.el[0],d=c.style.left||0;$H.isStr(d)&&(d=parseInt(d.replace("px",""))),b.elX=d;var e=c.style.top||0;$H.isStr(e)&&(e=parseInt(e.replace("px",""))),b.elY=e;var f=b.options;f.start&&f.start()}function c(a){var b=this;if(a.preventDefault(),b.drag===!0){$H.hasTouch()&&(a=a.originalEvent||a,a=a.touches[0]);var c=a.clientX-b.eventX,d=a.clientY-b.eventY,e=b.el[0],f=b.elX+c,g=b.elY+d,h=b.options,i=h.move&&h.move({origX:b.elX,origY:b.elY,curX:f,curY:g,offsetX:c,offsetY:d});i!==!1&&(e.style.left=(i&&i.curX||f)+"px",e.style.top=(i&&i.curY||g)+"px")}}function d(){var a=this;a.drag=!1;var b=a.options;b.end&&b.end()}function e(){var a=this,b=a.el;b.off(g[0],a.startHandler),b.off(g[1],a.moveHandler),b.off(g[2],a.endHandler)}var f=$H.createClass(),g=$H.hasTouch()?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup"];return $H.extend(f.prototype,{initialize:a,start:b,move:c,end:d,destroy:e}),f}),$Define("CM.AbstractEvents",["B.Class","B.Events"],function(){function a(){var a=this;a._eventCache={},a._execEvtCache=[],a._listenTo=[]}function b(a,b,c){var d=this,e=$H.toArray(arguments,3);return d._parseEvents(c,function(c){c.unshift(b),d[a].apply(d,c.concat(e))})}function c(a,b,c,d,e){var f=this;if(!f._parseListenToEvents("listenTo",a,b,c,d,e)){"number"==typeof d&&(e=d,d=null),d=d||f;var g=f._delegateHandler(c,d);f._listenTo.push({target:a,name:b,delegation:g,handler:c}),a.on(b,g,d,e)}}function d(a,b,c){var d=this;if(!d._parseListenToEvents("unlistenTo",a,b,c)){var e=d._listenTo,f="all"==a;$H.each(e,function(d,g){(f||g.name==b&&g.handler==c&&g.target==a)&&(g.target.off(g.name,g.delegation),e.splice(d,1))})}}var e=$H.createClass();return $H.extend(e.prototype,$H.Events),$H.extend(e.prototype,{initialize:a,_parseListenToEvents:b,listenTo:c,unlistenTo:d}),e}),$Define("P.Device",function(){function a(){return!!window.cordova}function b(){var a=navigator.connection;return a&&a.type}function c(){return Connection&&d.getNetType()===Connection.WIFI}var d={isPhonegap:a,getNetType:b,isWifi:c};return d}),$Define("P.Camera",function(){function a(a){var b=a.success,c=a.error,d=a.sourceType,e=Camera.PictureSourceType[d];navigator.camera.getPicture(function(a){b&&b(a)},function(a){c&&c(a)!==!1&&"no image selected"!=a&&a.indexOf("cancel")<0&&$C.Tips({text:"获取照片失败: "+a,theme:"error"})},{quality:a.quality||50,mediaType:Camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,sourceType:e})}var b={getPicture:a};return b}),$Define("P.Geolocation",function(){function a(a,b){var c=this,d=$H.intercept(c.onSuccess,a),e=$H.intercept(c.onError,b);navigator.geolocation?navigator.geolocation.getCurrentPosition(d,e):new $C.Tips({showPos:"top",size:"mini",timeout:null,theme:"error",noMask:!0,text:"当前设备不支持获取位置"})}function b(){}function c(a){var b;switch(a.code){case a.PERMISSION_DENIED:b="您拒绝了位置请求";break;case a.POSITION_UNAVAILABLE:b="位置不可用";break;case a.TIMEOUT:b="请求超时";break;case a.UNKNOWN_ERROR:b="未知错误"}new $C.Tips({showPos:"top",size:"mini",noMask:!0,text:b,theme:"error"})}var d={getCurrentPosition:a,onSuccess:b,onError:c};return d}),$Define("D.DataStore","B.Class",function(){function a(a,b){var c;if(a=$H.isClass(a)?a.$ns:$H.isInstance(a)?a.constructor.$ns:$H.alias(a),c=e[a]){if(void 0===b)return c;$H.isObj(b)||(b={id:b});var d=[];return $H.each(c,function(a,c){$H.largeThan(c,b)&&d.push(c)}),d.length>0?d[0]:null}}function b(){}function c(a,b){"string"!=typeof a&&(b=a,a=null);var c=b.constructor.$ns,d=e[c]||(e[c]={});d[b.uuid]=b,a&&(e[a]||(e[a]=b))}var d=$H.createClass();$H.extend(d.prototype,{get:a,find:b,push:c});var e={};return $S=$H.getSingleton(d),d}),$Define("D.AbstractDao",["B.LocalStorage","B.Class"],function(a){function b(a){var b=this;a=b.parseParam(a);var c=$H.intercept(a.error,b.error);a.error=$H.intercept(c,a.beforeErr);var d=$H.intercept(a.success,b.success);return a.success=$H.intercept(d,a.beforeSucc),a.beforeSend=$H.intercept($H.bind(b.beforeSend,b,a),a.beforeSend),a.complete=$H.intercept($H.bind(b.complete,b,a),a.complete),$.ajax(a)}function c(a){this.showLoading(!0,a)}function d(a){this.showLoading(!1,a)}function e(){}function f(){}function g(){}function h(b,c,d){var e=this;d=d||{};var f=d.storeType||"remote",g={type:"POST",dataType:"json"};d.url||(g.url=c.getUrl()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(g.data=d.attrs||c.toJSON(d));var h;return"remote"==f?(g.url+="/"+b+".do",$H.extend(g,d),h=e.ajax(g)):h=a[e._localMethodMap[b]](g),c.trigger("request",c,d),h}var i=$H.createClass();return $H.extend(i.prototype,{_ajaxMethodMap:{create:"POST",update:"POST",patch:"PATCH","delete":"DELETE",read:"GET"},_localMethodMap:{create:"setItem",update:"setItem",patch:"setItem","delete":"removeItem",read:"getItem"},ajax:b,parseParam:$H.noop,beforeSend:c,complete:d,error:$H.noop,success:$H.noop,showLoading:$H.noop,get:e,set:f,remove:g,sync:h}),i}),$Define("D.AbstractData",["D.AbstractDao","CM.AbstractEvents","D.DataStore"],function(a,b){function c(){var b=this;b.callSuper(),b.uuid=$H.uuid(),b.dao=b.dao||$H.getSingleton(a)}function d(){var a=this,b=a._isDirty;if(!b&&a.lastSyncTime){var c=$H.now();b=c.getTime()-a.lastSyncTime.getTime()>=a.dirtyTime}return b}function e(){this._isDirty=!0}function f(a,b,c){var d=this;return d.lastSyncTime=$H.now(),this._isDirty=!1,d.dao.sync(a,b,c)}function g(a){var b=this;return b.isDirty()?b.fetch(a):void 0}var h=b.derive({_isDirty:!0,dirtyTime:18e5,initialize:c,isDirty:d,setDirty:e,sync:f,fetch:$H.noop,fetchIf:g});return h}),$Define("D.Model",["D.AbstractData","D.DataStore"],function(a){function b(a,b,c){if(a){var d,e,f=this,g=f.prototype.idAttribute,h=!1;if((e=a[g])&&(d=$S.get(f,{id:e})),d)h=d.set(a).changed;else{var i,d=new f(a,b);(i=$S.get(d,{id:d.id}))?(h=i.set(a).changed,d=i):(h=!0,$S.push(d))}return c&&(c.changed=h),d}}function c(a,b){var c=this;if(!b.validate||!c.validate)return!0;a=$H.extend({},c._attributes,a);var d=c.validationError=c.validate(a,b)||null;return d?(c.trigger("invalid",c,d,$H.extend(b,{validationError:d})),!1):!0}function d(a,b){var c,d,e,f=this,g=f.fields,h={};for(var i in g){var c=g[i];if(c&&(d=c.depends))for(var j=0;j<d.length;j++)if(a.hasOwnProperty(d[j])){h[i]=void 0,e=!0;break}}e&&f.set(h,null,{silent:b})}function e(a){var b,c=this;if(!(b=c.fields))return a;var d,e,f,g,h,i={};for(var j in a){if(f=a[j],(d=b[j])&&(g=d.type,h=d.options,(e=d.parse)&&(f=e.apply(c,[f,a])),$H.isStr(g)&&("Date"==g?f=$H.parseDate(f):"string"==g||"str"==g?f=f?""+f:"":"number"==g||"num"==g?f=f?parseFloat(f):0:"boolean"==g||"bool"==g?f=f&&"false"!==f:g.indexOf(".")>0&&(g=$H.ns(g))),$H.isClass(g)&&!(f instanceof g)))if(g.get){var k={};f=g.get(f,h,k),f&&(f._changedTmp=k.changed)}else{var l=c.get(j);if(l){var m=l.set(f);f=l,f._changedTmp=m.changed}else f=new g(f,h),f._changedTmp=!0}i[j]=f}return i}function f(a,b,c,d){if("invalid"!=b&&"sync"!=b&&"request"!=b&&0!=b.indexOf("change:")&&("add"!=b||$H.isInstance(d))){var e=this,f=e.get(a),g=$H.toArray(arguments,1);e.trigger.apply(e,["change:"+a,e,f].concat(g)),e.trigger.apply(e,["change",e].concat(g)),e._attrEvts[a]=1;var h={};h[a]=f,e._doDepends(h)}}function g(a,b){var c=this;c.callSuper();var d=a||{};b||(b={}),c.cid="md_"+$H.Util.uuid(),c._attributes={},c._attrEvts={},b.custom&&$H.extend(c,b.custom),b.collection&&(c.collection=b.collection),b.parse&&(d=c.parse(d,b)||{}),d=$H.extendIf(d,c.getDefaults()),c.init&&c.init(),c.set(d,b),c._changed={}}function h(){var a,b=this,c={};if(a=b.fields)for(var d in a){var e=a[d];c[d]=e&&$H.isObj(e)?e.def:e}return c}function i(){return $H.clone(this._attributes)}function j(a){return this._attributes[a]}function k(a){return $H.String.escape(this.get(a))}function l(a){var b=this.get(a);return null!==b&&void 0!==b}function m(a,b,c){var d,e=this,f={result:e};if("object"==typeof a?(d=a,c=b):(d={})[a]=b,c||(c={}),d instanceof C&&(d=d._attributes),d=e._parseFields(d),!e._validate(d,c))return f.invalid=!0,f;var g=c.unset,h=c.silent,i={},j=e._changing;e._changing=!0,j||(e._previousAttributes=$H.Object.clone(e._attributes),e._changed={});var k=e._attributes,l=e._previousAttributes;e.idAttribute in d&&(e.id=d[e.idAttribute]);for(var m in d){b=d[m];var n=k[m],o=n&&$H.isInstance(n),p=b&&$H.isInstance(b);o||p?(g?(delete k[m],n&&e.unlistenTo(n,"all")):(k[m]=b,n&&b&&n.id==b.id||(n&&e.unlistenTo(n,"all"),b&&(b._changedTmp=!0,e.listenTo(b,"all",$H.bind(e._onAttrEvent,e,m))))),(g||!b||b._changedTmp)&&(i[m]=b),b&&delete b._changedTmp):($H.equals(k[m],b)||(i[m]=b),$H.equals(l[m],b)?delete e._changed[m]:e._changed[m]=b,g?delete k[m]:k[m]=b)}var q=!$H.isEmpty(i);if(!h){q&&(e._pending=c);for(var r in i)e._attrEvts[r]||e.trigger("change:"+r,e,k[r],c)}if(!h)for(;e._pending;)c=e._pending,e._pending=!1,e.trigger("change",e,c);return e._pending=!1,e._changing=!1,q&&e._doDepends(i,h),f.changed=q,e._attrEvts={},f}function n(a,b){return b=b||{},b.unset=!0,this.set(a,void 0,b)}function o(a){var b=this,c={};for(var d in b._attributes)c[d]=void 0;return a=a||{},a.unset=!0,b.set(c,a)}function p(a){var b=this._attributes;$H.each(b,a)}function q(a,b){if($H.isBool(a)&&(b=a,a=void 0),b){var c=this._changed;return null==a?!$H.isEmpty(c):$H.contains(c,a)}var c=this.changedAttrs();return null==a?!!c:c&&$H.contains(c,a)}function r(a,b){var c=this;$H.isBool(a)&&(b=a,a=void 0);var d,e=!1,f=c.fields,g=c._changing?c._previousAttributes:c._attributes,h=function(c){for(var h in c){var i=!0;if(d=c[h],!b){var j=f.hasOwnProperty(h);i=!j||j&&$H.isSimple(d)&&!f[h].unsave}i&&(!a||a&&!$H.equals(g[h],d))&&((e||(e={}))[h]=d)}};return h(a?a:c._changed),e}function s(a){var b=this,c=b.fields;a=a||b._attributes;var d={};return $H.each(a,function(a,b){var e=c.hasOwnProperty(a),f=!e||e&&$H.isSimple(b)&&!c[a].unsave;f&&(d[a]=b)}),d}function t(a){var b=this;return null!=a&&b._previousAttributes?b._previousAttributes[a]:null}function u(a){var b=this;a=a?$H.clone(a):{},void 0===a.parse&&(a.parse=!0);var c=a.success,d=a.beforeSet;return a.success=function(e){b.set("fetching",!1);var f=b.parse(e,a);if(!d||0!=d(b,f,a)){var g=b.set(f,a);if(g.invalid)return!1;c&&c(b,f,a),b.trigger("sync",b,f,a)}},b.set("fetching",!0),b.sync("read",b,a)}function v(a,b,c){var d,e,f=this;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,$H.isFunc(c)&&(c={success:c}),c=$H.extend({validate:!0},c),d&&c.now){if(f.set(d,c).invalid)return!1}else if(!f._validate(d,c))return!1;void 0===c.parse&&(c.parse=!0);var g=c.success;c.success=function(a){f.saving=!1;var b=f.parse(a,c);return c.now||(b=$H.extend(d||{},b)),$H.isObj(b)&&f.set(b,c).invalid?!1:(g&&g(f,a,c),void f.trigger("sync",f,a,c))};var h=c.error;c.error=function(){f.saving=!1,h&&h.apply(f,arguments)},e=f.isNew()?"create":c.update?"update":"patch";var i;if("patch"===e){var j=f.changedAttrs(d);if(!j){var k=c.noChange;return void(k&&k(f,c))}i=j}else{var l=$H.extend({},f._attributes);i=$H.extend(l,d)}i=f.filterUnsave(i),c.extAttrs&&$H.extend(i,c.extAttrs),c.attrs=i,f.saving=!0,f.sync(e,f,c)}function w(a){var b=this;a=a?$H.clone(a):{};var c=a.success,d=function(){b.trigger("destroy",b,b.collection,a),b.off("all"),b.destroyed=!0};return a.success=function(e){(!a.now||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},b.isNew()?(a.success(),!1):(b.sync("delete",b,a),void(a.now&&d()))}function x(){var a=this,b=$H.result(a,"url")||$H.result(a.collection,"url");return b||$D.error(new Error("必须设置一个url属性或者函数")),a.isNew()?b:b.replace(/([^\/])$/,"$1/")+encodeURIComponent(a.id)}function y(a){return a.code?a.data:a
}function z(){var a=this;return new a.constructor(a._attributes)}function A(){var a=this;return void 0===a.id}function B(a){return this._validate({},$H.extend(a||{},{validate:!0}))}var C=a.derive({idAttribute:"id",$isModel:!0,_pending:!1,_validate:c,_doDepends:d,_parseFields:e,_onAttrEvent:f,initialize:g,getDefaults:h,toJSON:i,get:j,escape:k,has:l,set:m,unset:n,clear:o,each:p,hasChanged:q,changedAttrs:r,filterUnsave:s,previous:t,fetch:u,save:v,destroy:w,getUrl:x,parse:y,clone:z,isNew:A,isValid:B},{get:b});return C}),$Define("D.Collection",["B.Array","D.AbstractData","D.Model","D.DataStore"],function(a,b,c){function d(a){return $H.isFunc(a)?a:function(b){return b.get(a)}}function e(){var a=this;a.length=0,a._models=[],a._byId={}}function f(a,b){var d=this;if(a instanceof c)return a;b=b?$H.clone(b):{},b.collection=d;var e=d.model.get(a,b);return e.validationError?(d.trigger("invalid",d,e.validationError,b),!1):e}function g(a){var b=this;b._byId[a.cid]=a,null!=a.id&&(b._byId[a.id]=a),a.collection||(a.collection=b),a.on("all",b._onModelEvent,b)}function h(a){var b=this;b===a.collection&&delete a.collection,a.off("all",b._onModelEvent,b)}function i(a,b,c,d){var e=this;("add"!==a&&"remove"!==a||c===e)&&("destroy"===a&&e.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete e._byId[b.previous(b.idAttribute)],null!=b.id&&(e._byId[b.id]=b)),e.trigger.apply(e,arguments))}function j(a,b){var c=this;c.callSuper(),b||(b={}),b.model&&(c.model=b.model),b.custom&&$H.extend(c,b.custom),c._reset(),a&&c.reset(a,$H.extend({silent:!0},b));var d=c.comparator;$H.isStr(d)&&c.on("change:"+d,function(a,b){c.sortItem(b)})}function k(a){var b=this;return $H.map(b._models,function(b){return b.toJSON(a)})}function l(a,b){return b=$H.extend({add:!0,remove:!1,merge:!1},b),this.set(a,b).result}function m(a,b){var c=this,d=!$H.isArr(a);a=d?[a]:$H.clone(a),b||(b={});var e,f,g,h;for(e=0,f=a.length;f>e;e++)h=a[e]=c.get(a[e]),h&&(delete c._byId[h.id],delete c._byId[h.cid],g=c.indexOf(h),c._models.splice(g,1),c.length--,b.silent||(b.index=g,h.trigger("remove",h,c,b)),c._removeReference(h,b));return d?a[0]:a}function n(a,b){var d=this;if(!a)return{result:d};b=$H.extend({add:!0,remove:!1,merge:!0},b),a instanceof J&&(a=a._models),b.parse&&(a=d.parse(a,b));var e,f,g,h,i,j,k=!$H.isArr(a),l=k?a?[a]:[]:$H.clone(a),m=d._models,n=b.at,o=d.model,p=d.comparator&&null==n&&b.sort!==!1,q=b.add,r=b.merge,s=b.remove,t=!1;for(e=0,f=l.length;f>e;e++)if(i=l[e]||{},g=i instanceof c?h=i:i[o.prototype.idAttribute||"id"],j=d.get(g)){if(s&&(d.remove(j,b),t=!0),r){i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b));var u=j.set(i,b).changed;t=t||u}l[e]=j}else if(q){if(b.id=g,h=l[e]=d._prepareModel(i,b),!h)continue;d._addReference(h,b),p&&(n=d.sortedIndex(h)),null!=n?m.splice(n,0,h):m.push(h),d.length+=1,b.silent||h.trigger("add",h,d,b,n),t=!0}return{changed:t,result:d}}function o(a){$H.each(this._models,a)}function p(a){for(var b=this._models,c=b.length-1;c>=0;c--)a(c,b[c])}function q(a,b){var c=this;b||(b={});for(var d=0,e=c._models.length;e>d;d++)c._removeReference(c._models[d],b);return b.previousModels=c._models,c._reset(),a&&(a=c.add(a,$H.extend({silent:!0},b)).result),b.silent||c.trigger("reset",c,b),a}function r(a,b){var c=this;return c.add(a,$H.extend({at:c.length},b)).result}function s(a){var b=this,c=b.at(b.length-1);return b.remove(c,a),c}function t(a,b){return this.add(a,$H.extend({at:0},b)).result}function u(a){var b=this,c=b.at(0);return b.remove(c,a),c}function v(){return Array.prototype.slice.apply(this._models,arguments)}function w(a){var b=this;return null==a?void 0:b._byId[a]||b._byId[a.id]||b._byId[a.cid]}function x(){return this.length}function y(a){return this._models[a]}function z(a,b){var c=this;return $H.isEmpty(a)?b?void 0:[]:c[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})}function A(a){return this.where(a,!0)}function B(a){var b=this;return b.comparator||$D.error(new Error("没有比较器")),a||(a={}),"string"==typeof b.comparator||1===b.comparator.length?b._models=b.sortBy(b.comparator,b,a.desc):b._models.sort($H.Function.bind(b.comparator,b)),a.silent||b.trigger("sort",b,a),b}function C(a,b){var c=this;void 0===b&&(b=c.sortedIndex(a));var d=c.indexOf(a),e=c._models;e.splice(d,1),e.splice(b,0,a),c.trigger("sortItem",a,b,d,c)}function D(a){return $H.invoke(this._models,"get",a)}function E(){return this.url}function F(a){var b=this;a=a?$H.clone(a):{};var c=a.success,d=a.beforeSet;return a.success=function(e){b.fetching=!1;var f=b.parse(e,a);if(!d||0!=d(b,f,a)){var g=a.reset?"reset":a.add?"add":"set";b[g](f,a),c&&c(b,f,a),b.trigger("sync",b,f,a)}},b.fetching=!0,b.sync("read",b,a)}function G(a,b){var c=this;if(b=b?$H.clone(b):{},!(a=c._prepareModel(a,b)))return!1;b.now&&c.add(a,b);var d=b.success;return b.success=function(a,e){b.now||c.add(a,b),d&&d(a,e,b)},a.save(null,b),a}function H(a){return a.code?a.data:a}function I(){var a=this;return new a.constructor(a._models)}var J=b.derive({model:c,$isCollection:!0,_getIterator:d,_reset:e,_prepareModel:f,_addReference:g,_removeReference:h,_onModelEvent:i,initialize:j,toJSON:k,add:l,remove:m,set:n,each:o,eachDesc:p,reset:q,push:r,pop:s,unshift:t,shift:u,slice:v,get:w,size:x,at:y,where:z,findWhere:A,sort:B,sortItem:C,pluck:D,getUrl:E,fetch:F,create:G,parse:H,clone:I});return $H.each(["map","some","every","find","filter","invoke","indexOf"],function(b,c){J.prototype[c]=function(){var b=Array.prototype.slice.call(arguments);return b.unshift(this._models),a[c].apply(a,b)}}),J.prototype.sortedIndex=function(b,c,d){var e=this._getIterator(this.comparator);return d=this.desc||d,a.sortedIndex(this._models,b,e,c,d)},$H.each(["sortBy","groupBy","countBy"],function(b,c){J.prototype[c]=function(b,d,e){var f=this._getIterator(b);return e=this.desc||e,a[c](this._models,f,d,e)}}),J}),$Define("V.AbstractManager","B.Class",function(){function a(){var a=this;a._types={},a._all={},a._allForCid={}}function b(a,b){var c=this;c._types[a]=b,b.prototype.xtype=a}function c(a){return $H.isClass(a)?a:this._types[a]||$H.ns(a)}function d(a,b){var c=this,d=a.cid=b.cid||$H.uuid(),e=a._id=c.generateId(d,a.xtype);c._all[e]=a,c._allForCid[d]=a}function e(a){var b=this._all,c=a.getId(),d=a.getCid();b[c]==a&&delete b[c];var e=this._allForCid;e[d]==a&&delete e[d]}function f(a,b){var c=this,d=a.find(".js-"+c.type);d.each(function(a,d){d=$(d);var e=d.attr("id"),f=c.get(e);f&&b(f)})}function g(a,b){var c=this,d=$H.expando+"-"+c.type+"-"+b+"-"+(a||$H.uuid());return c._all[d]?void $D.error("id重复:"+d):d}function h(a){var b=this;return b._all[a]||b._allForCid[a]}function i(a){var b=this,c=b._all,d=[];for(var e in c){var f=c[e];if(!f.parent){f.match(a)&&d.push(f);var g=f.find(a);g.length>0&&(d=d.concat(g))}}return d}var j=$H.createClass();return $H.extend(j.prototype,{initialize:a,type:"manager",registerType:b,getClass:c,register:d,unregister:e,eachInEl:f,generateId:g,get:h,find:i}),j}),$Define("V.ViewManager",["V.AbstractManager","B.Events"],function(a){function b(){var a=this;a.callSuper(),$H.on("afterRender",function(b,c){a.afterRender(c)}),$H.on("removeEl",function(b,c){a.destroy(c)})}function c(a){this.eachInEl(a,function(a){a.afterRender()})}function d(a){this.eachInEl(a,function(a){a.destroy(!0)})}var e=a.derive({type:"view",initialize:b,afterRender:c,destroy:d});return $V=$H.getSingleton(e),e}),$Define("V.AbstractView",["V.ViewManager","CM.AbstractEvents"],function(a,b){function c(a,b){var c=this,d=b.name;return c._parseEvents(d,function(d){var e=$H.extend({},b);e.name=d[0],2==d.length&&(e.handler=d[1]),c[a].call(c,e)})}function d(b){var c=this;b=b||{},c.callSuper(),c._listeners=[],c.listeners=$H.clone(c.listeners),c.manager=c.constructor.manager||$H.getSingleton(a),c.manager.register(c,b),c.doConfig(b),c.init(b),c.parseItems(),0!=c.autoRender&&c.render(),c.inited=!0}function e(a){var b=this;b.initParam=a;var c=a||{};$H.extend(b,c);var d;b.renderTo=$((d=c.renderTo)?d:document.body)}function f(){return this._id}function g(){return this.cid}function h(){return this._container}function i(){return this.html}function j(){var a=this,b=a.getHtml();a.renderTo[a.renderBy](b),a._container=$("#"+a.getId()),a.initListeners()}function k(a){return this.getEl().find(a)}function l(a){var b=this;if(!b._parseListenEvents("listen",a)&&(!a.hasOwnProperty("condition")||a.condition)){var c=a.name,d=a.context,e=a.times,f=a.target,g=a.custom||f||$H.contains(b._customEvents,c),h=a.handler;if($H.isFunc(f)&&(f=f.call(b)),g){var i=$H.removeUndefined([f,c,h,d,e]);b[f?"listenTo":"on"].apply(b,i)}else{if(!b.listened)return void b.listeners.push(a);var j=b._listeners,k=a.el,l=a.method||"bind",m=a.selector,n=a.data,o=a.delegation=b._delegateHandler(h,d);$H.isFunc(k)&&(k=k.call(b)),k=k?"string"==typeof k?b.findEl(k):k:b.getEl(),m?n?k[l](m,c,n,o):k[l](m,c,o):n?k[l](c,n,o):k[l](c,o),j.push(a)}}}function m(a){var b=this;if(!b._parseListenEvents("unlisten",a)){var c=a.name,d=a.handler;if(a.custom)b.off(c,d);else{var e,f=a.el,g="delegate"==a.method?"undelegate":"unbind",h=a.selector;f=f?"string"==typeof f?b.findEl(f):f:b.getEl();for(var i=b._listeners.length-1;i>=0;i--){var j=b._listeners[i];if(j.handler==d){e=j.delegation,b._listeners.splice(i,1);break}}h?f[g](h,c,e):f[g](c,e)}}}function n(){var a=this;if(a.listened)return!1;a.listened=!0;for(var b=a.listeners,c=b.length-1;c>=0;c--)a.listen(b[c]);a.callChild()}function o(){for(var a=this,b=a._listeners,c=b.length-1;c>=0;c--)a.unlisten(b[c]);a.off("all"),a.unlistenTo("all"),a.callChild()}function p(){var a=this;if(!a.destroyed)return a.clearListeners(),a.unlistenTo("all"),a.getEl().remove(),a.destroyed=!0,a.manager.unregister(a),delete a._container,delete a.renderTo,delete a.html,!0}var q=b.derive({xtype:"View",renderBy:"append",autoRender:!0,listeners:[],_parseListenEvents:c,initialize:d,init:$H.noop,doConfig:e,getId:f,getCid:g,getEl:h,getHtml:i,render:j,findEl:k,parseItems:$H.noop,callChild:$H.noop,listen:l,unlisten:m,initListeners:n,clearListeners:o,destroy:p});return q}),$Define("V.ModelView",["B.Template","V.AbstractView","D.Model","D.Collection"],function(a,b,c,d){function e(a,b){var c=b.context,d=b.data,e=b.exp;$H.isFunc(a)&&(a=a.call(d));var f;(a&&!b.inverse||!a&&b.inverse)&&(f=b.fn(d));var g=b.num,h=c.getCid()+"-"+g;return c.ifBind(g,d)&&c.listenTo(d,"change:"+e,function(a,d,e){var f;(e&&!b.inverse||!e&&b.inverse)&&(f=b.fn(d)),c.updateMetaMorph(h,f)}),c.wrapMetaMorph(h,f)}function f(a,b){return b.inverse=!0,b.helpers["if"].call(this,a,b)}function g(a,b){var c=b.context,e=b.fn,f=C?"":[],g=b.num,h=c.getCid()+"-"+g;if(a){var i;if(a instanceof d)a.each(function(a,b){i=c.wrapMetaMorph(h+"-"+b.uuid,e(b)),C?f+=i:f.push(i)}),c.ifBind(g,a)&&(c.listenTo(a,"add",function(a,b,d,f){var g=c.wrapMetaMorph(h+"-"+b.uuid,e(b)),i=f.at;if(i){var j=d.at(i-1),k=h+"-"+j.uuid;$("#metamorph-"+k+"-end").after(g)}else $("#metamorph-"+h+"-end").before(g)}),c.listenTo(a,"remove",function(a,b){var d=h+"-"+b.uuid;c.updateMetaMorph(d,"","remove")}));else if(void 0!==a.length)for(var j=0,k=a.length;k>j;j++)i=c.wrapMetaMorph(h+"-"+j,e(a[j])),C?f+=i:f.push(i);else for(var j in a)i=c.wrapMetaMorph(h+"-"+j,e(a[j])),C?f+=i:f.push(i);return c.wrapMetaMorph(h,C?f:f.join(""))}}function h(a,b){var c=b.get?b.get(a):b[a];return c}function i(b,c){var d=c.context,e=c.data,f=c.exp,g=a.isEscape,h=c.helpers,i=c.num,j=d.getCid()+"-"+i;return d.ifBind(i,e)&&d.listenTo(e,"change:"+f,function(a,b,c){g&&(c=h.escape(c)),d.updateMetaMorph(j,c)}),g&&(b=h.escape(b)),d.wrapMetaMorph(j,b)}function j(a,b){for(var c,d=b.context,e=b.data,f=b.num,g=b.type,h=d.getCid()+"-"+f,i="bindAttr-"+h,j=[],m=[],n=d.ifBind(f,e),o=g&&d.ifBind(f,e,!0);c=D.exec(a);)"id"==c[2]?i=0==c[3].indexOf("this.")?d[c[3].substring(5)]:k(c[3],e):m.push(c);j.push('id="'+i+'"');for(var p,q,r,s,t,u=0,v=m.length;v>u;u++){c=m[u],q=c[2],p=c[3],r=p.split(" "),s=[];for(var w=0;w<r.length;w++)t=l(d,i,q,r[w],n,o,e),(t||0===t)&&s.push(t);var x=s.join(" ");if(q){if(g&&"value"==q&&(b.value=x,"textarea"===g))continue;x=(c[1]||"")+x+c[4]}else x&&(x=x+'="'+x+'"');x&&j.push(x)}return" "+j.join(" ")+" "}function k(a,b){return a?0==a.indexOf("#")?a.substring(1):h(a,b):a}function l(a,b,c,d,e,f,g){var h,i=a,b="#"+b,j=d.indexOf("?"),l=d.indexOf(":");if(0==d.indexOf("this."))return i[d.substring(5)];if(j>0||l>0){var m=d.substring(0,j>0?j:l),n=0>j?"":d.substring(j+1,l>0?l:d.length),o=0>l?"":d.substring(l+1,d.length);return h=k(m,g),e&&0!=m.indexOf("#")&&i.listenTo(g,"change:"+m,function(a,d,e){var f=$(b);c?"class"==c?e?(o&&f.removeClass(o),n&&f.addClass(n)):(n&&f.removeClass(n),o&&f.addClass(o)):f.attr(c,e?n:o):e?f.prop(n,!0):f.prop(n,!1)}),h?n:o}return h=k(d,g),0!=d.indexOf("#")&&(e&&i.listenTo(g,"change:"+d,function(a,d,e){var f=$(b);if("class"==c)f.removeClass(h),f.addClass(e),h=e;else{var g=e||"";"value"===c?g!==f.val()&&f.val(g):f.attr(c,g)}}),"value"==c&&f&&i.listen({name:"input propertychange",el:b,handler:function(a){g.set(d,a.target.value)}})),h}function m(a,b){b.type="input";var c=j(a,b);return"<input "+c+"/>"}function n(a,b){b.type="textarea";var c=j(a,b);return"<textarea "+c+">"+b.value+"</textarea>"}function o(){var a=this;a._bindModelNums={},a._bindElNums={},a.callSuper()}function p(){var a=this;a.callSuper();var b=a.modelClass||c;a.model||(a.model=new b(a.data)),a.xmodel=a.model}function q(){var a=this,b=a.tmpl;$H.isArr(b)&&(b=b.join(""));var c=F.test(b),d="#js-"+a.manager.type+" #js-"+a.xtype;if(c){var e=b.match(G)[1];e&&(I.test(b)||(e=e.replace(/([^\s]+)/g,"#$1")),d+=" "+e),b=b.replace(G,"")}var f=' id=this._id class="'+d+'"';b=H.test(b)?b.replace(J,"$1"+f):b.replace(E,"$1 {{bindAttr"+f+"}}"),a.tmpl=b}function r(){var a=this,b=a.tmpl,c=a.constructor;return $H.isFunc(b)||$H.isFunc(b=c.tmpl)||(a.preTmpl(),b=c.tmpl=$H.tmpl({tmpl:a.tmpl,ns:"ModelView"})),a.tmpl=b}function s(){var a=this;if(a.html)return a.html;var b=a.getTmplFn(),c=a.html=b(a.xmodel,a);return c}function t(a,b,e){var f=this;if(!e&&"el"==f.bindType||e&&"model"==f.bindType)return!1;var g=e?f._bindElNums:f._bindModelNums,h=!g[a]&&(b&&(b instanceof c||b instanceof d)||!b);return g[a]=1,h}function u(a,b){return $("#metamorph-"+a+(b?"-end":"-start"))}function v(a,b,c){var d=this;if("append"==c)return void d.getMetaMorph(a,!0).before(b);var e=d.getMetaMorph(a);if(0!=e.length){for(var f,g="metamorph-"+a+"-end",h=e[0].nextSibling;h&&h.id!=g;)f=$(h),h=h.nextSibling,f.remove();void 0!==b&&e.after(b),"remove"==c&&(e.remove(),$(h).remove())}}function w(a,b){var c='<script id="metamorph-',d='" type="text/x-placeholder"></script>';return b=void 0===b?"":b,c+a+"-start"+d+b+c+a+"-end"+d}function x(a){return this.xmodel.get(a)}function y(a,b){this.xmodel.set(a,b)}function z(a){this.xmodel.set(a)}function A(){return this.xmodel}var B=b.derive({bindType:"model",initialize:o,doConfig:p,preTmpl:q,getTmplFn:r,getHtml:s,ifBind:t,getMetaMorph:u,updateMetaMorph:v,wrapMetaMorph:w,get:x,set:y,update:z,getXmodel:A});a.registerHelper("ModelView",{"if":e,unless:f,each:g,getValue:h,parseValue:i,bindAttr:j,input:m,textarea:n});var C=a.getIfPlusJoin(),D=/((\w+)=['"]?)?([#\w][\s\w\.\?:#-]*)(['"]?)(?!\w*=)/g,E=/[^<]*(<[a-zA-Z]+)/,F=/^[^>]+class=/,G=/class=['"]?([#\w][\s\w\.\?:#-]*)(['"]?)(?!\w*=)/,H=/^[^>]+{{bindAttr/,I=/^[^>]+{{bindAttr((?!}}).)class=/,J=/({{bindAttr)/;return B}),$Define("V.View",["V.ViewManager","V.ModelView","D.Model","B.Template"],function(a,b,c,d){function e(a,b){var c=b.context,d=b.num,e=c.getCid()+"-"+d,f=c.findHtml(a);return c.ifBind(d)&&c.on("add",function(b,d,f){if(d.match(a.replace(/^>\s?/,""))){if(void 0!==f){for(var g=c.getMetaMorph(e),h=0;f>h;h++)g=g.next();g.after(d.getHtml())}else c.updateMetaMorph(e,d.getHtml(),"append");d.afterRender()}}),c.wrapMetaMorph(e,f)}function f(a){var b=this.prototype;$H.extend(b,a,{notCover:function(c){return"_customEvents"==c||"listeners"==c?(b[c]=(a[c]||[]).concat(b[c]||[]),!0):"xtype"==c||"constructor"==c?!0:"xConfig"==c||"fastUpdateMethod"==c?(b[c]=$H.extendIf(a[c],b[c]),!0):void 0}})}function g(a){var b=new this($H.extend({autoRender:!1},a));return b.getHtml()}function h(a,b){var c=this,d=arguments,e=d.callee.caller,f=e.$owner.prototype;return 0==d.length?(d=e.arguments,d=$H.toArray(d),a=e.$name,b=d.shift()):d=$H.toArray(d,2),$H.isArr(b)?($H.each(b,function(b,e){f[a].apply(c,[e].concat(d))}),!0):!1}function i(){var a=this;a.items=[],a.children=[],a.callSuper()}function j(a){var b=this;if(!b.configed){b.configed=!0,b.initParam=a,"string"==typeof a&&(a={text:a});var d=a||{};$H.extend(b,d,{notCover:function(a,c){var e;(e=/^{{(((?!}}).)+)}}$/.exec(c))&&(e=e[1],(b.refModelAttrs||(b.refModelAttrs={}))[a]=e);var f=(b[a],$H.contains(b._customEvents,a)),g=$H.contains(b._defaultEvents,a);return g?(b.listeners.push({name:a,handler:d[a]}),!0):f?(b.on(a,d[a]),!0):"defItem"==a?(b[a]=$H.extend(b[a],c),!0):"listener"==a?(b.listeners=b.listeners.concat($H.isArr(c)?c:[c]),!0):"items"==a?(b.add(c),!0):"extCls"==a&&b[a]?(b[a]+=" "+c,!0):"xtype"==a?("View"==b[a]&&(b[a]="string"==typeof c?c:c.$ns),!0):void 0}});var e;if(e=d.renderTo){if($H.isFunc(e))e=e.call(b);else if($H.isStr(e)&&0==e.indexOf(">")){var f=b.parent;e=f.inited&&f.findEl(e.substring(1))}else e=$(e);b.renderTo=e}else b.renderTo=$(document.body);var g=b.getRefModel();if(g){var h=b.refModelAttrs;for(var i in h){var j,k=h[i];if(k.indexOf(".")>0){var l=k.split(".");j=g.get(l[0]),j=j&&j.get(l[1])}else j=g.get(k);b[i]=j}}var m=b.xConfig,n=b.modelClass;if(!n&&!(n=b.constructor.modelClass)){var o;o=m?c.derive({fields:m}):c,n=b.constructor.modelClass=o}var p={};$H.each(m,function(a){var c=b[a];void 0!==c&&(p[a]=c)}),b.xmodel=new n(p),b.bindRefModel()}}function k(){var a,b=this,c=(b.getId(),b.extCls||"");"visibility"==b.displayMode?a="visibility:hidden;":c+=" hui-hidden";var d=b.callSuper();a&&(d=d.replace(Y,'$1 style="'+a+'"')),c&&(d=d.replace(/(class=['"])/,"$1"+c+" "));var e;return(e=b.wrapHtml)&&(d=e[0]+d+e[1]),b.html=d}function l(a){for(var b=this,c=b.find(a),d=[],e=0;e<c.length;e++)d.push(c[e].getHtml());return d.join("")}function m(){var a=this,b=this.getEl(),c=a.style||{};void 0!==a.width&&(c.width=a.width),void 0!==a.height&&(c.height=a.height),b.css(c)}function n(){return this.trigger("beforeRender")}function o(){var a=this;if(0==a.beforeRender())return!1;var b=a.getHtml();a.renderTo[a.renderBy](b),a.afterRender()}function p(a){var b=this;return b.rendered?!1:(b.trigger("render"),b._container=$("#"+b.getId()),b.callChild([!0]),b.rendered=!0,b.initStyle(),1!=b.notListen&&b.initListeners(),b.disabled&&b.disable(),b.trigger("afterRender"),void(a||b.hidden||b.show()))}function q(){return this.trigger("beforeShow")}function r(a,b){var c=this;if(0==c.beforeShow()||c.showed||b&&c.hidden)return!1;if(!a&&c.delayShow)return void setTimeout(function(){Z.prototype.show.call(c,!0)},0);c.trigger("show"),c.showed=!0,c.hidden=!1;var d=c.getEl();"visibility"==c.displayMode?d.css({visibility:"visible"}):d.removeClass("hui-hidden"),c.callChild([null,!0]),c.afterShow()}function s(){var a=this;setTimeout(function(){a.trigger("afterShow")},0)}function t(){return this.trigger("beforeHide")}function u(a){var b=this;if(0==b.beforeHide()||!b.showed)return!1;b.showed=!1;var c=b.getEl();"visibility"==b.displayMode?c.css({visibility:"hidden"}):c.addClass("hui-hidden"),1!=a&&(b.hidden=!0),b.trigger("hide"),b.callChild([!0]),b.afterHide()}function v(){this.trigger("afterHide")}function w(){var a=this;a.resume(),a.getEl().removeClass("hui-disable").find("input,textarea,select").removeAttr("disabled")}function x(){var a=this;a.suspend(),a.getEl().addClass("hui-disable").find("input,textarea,select").attr("disabled","disabled")}function y(a,b){var c=this;if(b?!b instanceof Z&&(b=c.find(b)[0]):b=c,0==a){var d=b.children;return d}return b.getEl().html()}function z(a,b){var c=this;return b?(!b instanceof Z&&(b=c.find(b)[0]),b.setContent(a)):"string"!=typeof a?(c.set("content",""),c.add(a)):(c.set("content",a),void c.remove())}function A(){var a=this;return a.isSuspend?!1:(a.isSuspend=!0,void a.callChild())}function B(){var a=this;return a.isSuspend?(a.isSuspend=!1,void a.callChild()):!1}function C(a){return this.getEl().parents(a)}function D(a){var b,c=this,d=c.xConfig,e=c.xmodel;return b=e&&void 0!==d[a]?e.get(a):c[a]}function E(a,b){var c=this,d={};d[a]=b,c.fastUpdate(d)||(c[a]=b)}function F(){var a,b=this;if(a=b.refModel||b.model)return a;for(var c=b.parent;c;){if(a=c.refModel||c.model)return b.refModel=a;if(!c.parent)return c.model;c=c.parent}}function G(){function a(a,d){var g;if(d.indexOf(".")>0){var h=d.split(".");d=h[0],g=h[1]}("both"==c||"bindRef"==c)&&b.listenTo(e,"change:"+d,function(c,d,e){g&&(e=e&&e.get(g)),b.set(a,e)}),("both"==c||"bindXmodel"==c)&&b.listenTo(f,"change:"+a,function(a,b,c){if(g){var f=e;f=f.get(d),f&&f.set(g,c)}else e.set(d,c)})}var b=this,c=b.bindRefType,d=b.refModelAttrs;if(c&&d){var e=b.getRefModel(),f=b.xmodel;for(var g in d)a(g,d[g])}}function H(a,b){for(var c,d=this.children,e=d.length,f=0;e>f;){var g=d[f];if(c=b?a.apply(g,b):a(f,g),c===!1)break;e==d.length?f++:e=d.length}}function I(a,b){if("*"==a)return!0;b=b||this;var c,d,e,f,g;a=a.replace(/^#([^\s,\[]+)/,"[cid=$1]"),a=a.replace(/^\.([^\s,\[]+)/,"[cClass=$1]"),a=a.replace(/^([^\[]+)/,"[xtype=$1]");for(var h=/\[(\!?[^=|\!]+)(=|\!=)?([^=]*)?\]/g;c=h.exec(a);)if(d=c[1],g=b.get?b.get(d):b[d],e=c[2]){if(f=c[3],"false"===f?f=!1:"true"===f?f=!0:"null"===f?f=null:"undefined"===f&&(f=void 0),"="===e?g!=f:g==f)return!1}else if(0==d.indexOf("!")&&g||d.indexOf("!")<0&&!g)return!1;return!0}function J(a,b){var c=this,b=b||[];if(a){if($H.isNum(a)){var d=c.children[a];b.push(d)}else if($H.isStr(a)){if(a.indexOf(",")>0)return $H.each(a.split(","),function(a,d){b=b.concat(c.find(d))}),b;var e,f,g=0==a.indexOf(">"),e=a.replace(/^>?\s?/,""),h=e.search(/\s/);h>0&&(f=e.substring(h+1),e=e.substring(0,h)),c.each(function(c,d){var h=d.match(e);h&&(f?d.find(f,b):b.push(d)),g||d.find(a,b)})}else if($H.isFunc(a)){var i=$H.isClass(a);c.each(function(c,d){(i&&d instanceof a||!i&&a(d))&&b.push(d),d.find(a,b)})}}else b=b.concat(c.children);return b}function K(a){for(var b=this,c=b;c.parent;)if(c=c.parent,a&&b.match(a,c))return c;return a||c===b?null:c}function L(){var a=this,b=a.parent;if(b){var c;return b.each(function(b,d){return d==a?(c=b,!1):void 0}),c}return null}function M(a,b){var c=this;0!=c.children.length&&(a&&"string"!=typeof a&&(b=a,a=null),a=a||arguments.callee.caller.$name,c.each(function(c,d){b?d[a].apply(d,b):d[a].call(d)}))}function N(a,b){var c=this;if(!c._applyArray()&&(!a.hasOwnProperty("condition")||a.condition)){var d=void 0===b;if(!c.startParseItems){var e=c.items;return void(d?e.push(a):e.splice(b,0,a))}if(a instanceof Z)a.parent=c;else{c.defItem&&$H.extend(a,c.defItem,{notCover:!0}),c.parseItem(a);var f=c.manager.getClass(a.xtype);if(f){var g=a.renderTo;!c.inited&&$H.isStr(g)&&0==g.indexOf(">")&&(g=null),g||(a.autoRender=!1),a.parent=c,a=new f(a)}else $D.error("xtype:"+a.xtype+"未找到")}var h=c.children;return d?h.push(a):h.splice(b,0,a),c.trigger("add",a,b),a}}function O(a){var b=this;if(!b._applyArray()){var c,d=b.children,e=!1;if($H.isNum(a))c=a,a=d[c];else if($H.isStr(a)||$H.isFunc(a)){a=b.find(a);for(var f=0,g=a.length;g>f;f++){if(0==b.remove(a[f]))return!1;e=!0}}else if(a instanceof Z){if(a.parent!=b)return a.parent.remove(a);for(var f=0,g=d.length;g>f;f++)if(d[f]==a){c=f;break}}return void 0!==c&&0!=a.destroy(!0)&&(d.splice(c,1),e=!0),b.trigger("remove",a),e}}function P(){var a=this;a.startParseItems=!0;var b=a.items;if(b){b=$H.isArr(b)?b:[b];for(var c=0,d=b.length;d>c;c++)a.add(b[c])}}function Q(){return this.trigger("beforeUpdate")}function R(a){var b=this,c=b.xmodel;if(!c)return!1;var d=b.xConfig,e=b.fastUpdateMethod,f=!0,g={},h={},i={};return $H.each(a,function(a,b){d.hasOwnProperty(a)?g[a]=b:e[a]?h[a]=b:(i[a]=b,f=!1)}),f?(c.set(a),$H.each(h,function(a,c){e[a].call(b,c)}),!0):!1}function S(a,b){var c=this;if(!a||0==c.beforeUpdate())return!1;var d;if(c.fastUpdate(a)===!0)d=c;else{var e=c.parent,f=$("<span></span>").insertBefore(c.getEl());if(b||(void 0===a.autoRender&&(a.autoRender=!0),a=$H.extend(a,c.initParam,{notCover:!0})),a=$H.extend(a,{xtype:c.xtype,renderBy:"replaceWith",renderTo:f},{notCover:["xtype"]}),a.cid&&a.cid!=c.cid||(a._id=c._id),e){var g=c.index();if(0==e.remove(c))return f.remove(),!1;d=e.add(a,g)}else{if(0==c.destroy())return f.remove(),!1;d=new c.constructor(a)}}return c.trigger("update",d),c.afterUpdate(d),d}function T(a){return this.update(a,!0)}function U(a){this.trigger("afterUpdate",a)}function V(){return this.trigger("beforeDestroy")}function W(a){var b=this;if(0==b.beforeDestroy())return!1;if(!b.destroyed)return b.callChild(),b.trigger("destroy"),b.clearListeners(),b.getEl().remove(),b.destroyed=!0,!a&&b.parent&&b.parent.remove(b),b.manager.unregister(b),delete b.initParam,delete b._container,delete b.renderTo,delete b._listeners,delete b.html,delete b.xmodel,delete b.children,b.afterDestroy(),!0}function X(){this.trigger("afterDestroy")}var Y=/^(<[a-zA-Z]+)/,Z=b.derive({xtype:"View",xConfig:{},tmpl:"<div>{{placeItem}}</div>",bindRefType:"bindRef",fastUpdateMethod:{renderTo:function(a){this.getEl()[this.renderBy]($(a))},hidden:function(a){a?this.hide():this.show()},disabled:function(a){a?this.disable():this.enable()}},_customEvents:["beforeRender","render","afterRender","beforeShow","show","afterShow","beforeHide","hide","afterHide","beforeUpdate","update","afterUpdate","beforeDestroy","destroy","afterDestroy","add","remove"],_defaultEvents:["mousedown","mouseup","mouseover","mousemove","mouseenter","mouseleave","dragstart","drag","dragenter","dragleave","dragover","drop","dragend","touchstart","touchmove","touchend","touchcancel","keydown","keyup","keypress","click","dblclick","focus","focusin","focusout","contextmenu","change","submit"],_applyArray:h,initialize:i,doConfig:j,getHtml:k,findHtml:l,initStyle:m,beforeRender:n,render:o,afterRender:p,beforeShow:q,show:r,afterShow:s,beforeHide:t,hide:u,afterHide:v,enable:w,disable:x,getContent:y,setContent:z,suspend:A,resume:B,parentsEl:C,get:D,set:E,getRefModel:F,bindRefModel:G,each:H,match:I,find:J,parents:K,index:L,callChild:M,add:N,remove:O,parseItem:$H.noop,parseItems:P,beforeUpdate:Q,fastUpdate:R,update:S,replace:T,afterUpdate:U,beforeDestroy:V,destroy:W,afterDestroy:X},{extend:f,html:g});d.registerHelper("ModelView",{placeItem:e});var Y=/[^<]*(<[a-zA-Z]+)/;return Z}),$Define("M.AbstractModule","V.View",function(a){function b(a){var b=this;!a.model&&b.modCls&&(b.model=new b.modCls,b.model.id=a.modelId),b.callSuper()}function c(){this.clearCache=!0}var d=a.derive({xtype:"Module",useCache:$H.noop,cache:$H.noop,init:$H.noop,entry:$H.noop,reset:$H.noop,exit:function(){return!0},initialize:b,cleanCache:c});return d}),$Define("M.AbstractNavigator",["handy.base.Object","B.Class"],function(a){var b=$H.createClass();return a.extend(b.prototype,{navigate:function(){}}),b}),$Define("M.History",["handy.base.HashChange","B.Class"],function(a){function b(b,c){var d=this;"function"==typeof b&&(c=b,b=null),d.error=c||$H.noop,d.key=b||"handy",d.states=[],a.listen($H.Function.bind(d.stateChange,d))}function c(){var a=this,b=a.getHashParam();if(b){var c=b.hKey,d=a.currentKey,e=a.states,f=e[d];if(c==d)return!1;var g=e[c],h=$H.trigger("hisoryChange",g,f);if(h!==!1&&(g?h=g.onStateChange(g.param,!0):($D.warn("hisory state not found"),h=a.error("stateNotFound",b))),h===!1){var i=f.param;b=$H.extend({hKey:d},i),a.saveHash(b)}else a.currentKey=c}}function d(a){var b=this,c=b.currentKey=b.key+ ++k;b.states.push(c),b.states[c]=a;var d=a.param,e=$H.extend({hKey:c},d);b.saveHash(e)}function e(a){var b=$H.Json.stringify(a);$H.setHash("#"+b)}function f(){try{var a=$H.getHash().replace("#",""),b=$H.parseJson(a);return b}catch(c){$H.Debug.warn("History.getCurrentState:parse hash error:"+c.message)}}function g(){var a=this;try{var b=a.getHashParam();return a.states[b.hKey]}catch(c){$H.Debug.warn("History.getCurrentState:parse hash error:"+c.message)}}function h(){var a=this;try{for(var b=a.getHashParam(),c=b.hKey,d=a.states,e=d.length,f=1;e>f;f++)if(d[f]==c)return f>0?d[d[--f]]:null}catch(g){$H.Debug.error("History.getPreState error:"+g.message,g)}}function i(){var a=this,b=a.getPreState();b&&b.onStateChange(b.param)}var j=$H.createClass(),k=0;return $H.extend(j.prototype,{initialize:b,stateChange:c,saveState:d,saveHash:e,getHashParam:f,getCurrentState:g,getPreState:h,back:i}),j}),$Define("M.ModuleManager",["M.History","V.AbstractManager"],function(a,b){function c(a,b){return a+(b?"-"+b:"")}function d(a){var b=this,c=a.modName,d=a.modId,e=$Require(c),f={renderTo:b.container,modName:c,modId:d,name:c,xtype:c,cid:d.replace(/\./g,"-"),extCls:"js-module m-module "+c.replace(/\./g,"-"),hidden:!0};$H.extend(f,a);var g=new e(f),h=b._modules[d];return g.referer=h.referer,b._modules[d]=g,$H.trigger("afterRender",g.getEl()),g.entry(a),b.requestMod==d&&b._showMod(g),g}function e(a){var b=this,c=b._modules[b.currentMod];(b.navigator&&b.navigator.navigate(a,c,b))!==!1&&(c&&c.hide(),a.show()),c&&(c.isActive=!1),a.isActive=!0,b.currentMod=a.modId}function f(b){var c=this;c.callSuper(),b&&(c.conf=b,$H.extend(c,b),c.container=$(b.container?b.container:document.body)),c.history=new a(function(a,b){c.go(b.param)}),c._modules={},c._modStack=[],c._modNum={}}function g(a,b,c){var d=this,e=d._modules,f=d._modStack,g=d._modNum,h=d._getModId(b,c);if(e[h]=a,f.push({modId:h,modName:b}),g[b]?g[b]++:g[b]=1,f.length>d.maxModNum)for(var i=$H.count(g),j=d.maxModNum/i,k=0,l=f.length;l>k;k++){var m=f[k];if(g[m.modName]>j){d.destroy(e[m.modId]);break}}}function h(a,b){var c=this,d=c._getModId(a,b);return c._modules[d]}function i(a,b){if(a){var c=this;"string"==typeof a&&(a={modName:a});var d=a.modName;if(!d){var e=a.modId;if(!($H.isStr(e)&&e.indexOf("-")<0))return;d=a.modName=e}var e=d;if(a.model){var f=a.modelId=a.model.id;e=c._getModId(d,f)}a.modId=e;var g=c.currentMod,h=c._modules,i=h[g];if(g==e)return void(i.waiting||i.reset());if(i&&!i.waiting)if(i._forceExit)i._forceExit=!1;else if(0==i.exit())return!1;c.requestMod=e;var j=h[e];if(j){if(j.waiting)return;if(i){var k=i.referer===j;k||(j.referer=i)}1!=j.notCache&&1!=j.clearCache&&0!=j.useCache(a)?(0==j.clearCache,c._showMod(j),j.cache(a),j.entry(a)):(c.destroy(j),j=c._createMod(a),k||(j.referer=i))}else c.setModule({waiting:!0,referer:i},d,f),$Require(d,function(){c._createMod(a)});return 1!=b&&c.history.saveState({onStateChange:$H.Function.bind(c.go,c),param:{modName:a.modName,modelId:a.modelId}}),!0}}function j(a){var b=this,c=b._modStack,d=a.modId;b.currentMod===d&&$M.back();for(var e=0,f=c.length;f>e;e++)if(c[e].modId===d){c.splice(e,1),b._modNum[a.modName]--;break}a.destroy(),delete b._modules[d]}function k(a,b){var c=a.update(b);return c&&(this._modules[a.modId]=c,$H.trigger("afterRender",c.getEl())),c}function l(a,b){$H.isStr(a)&&(a=this.getModule(a,b)),a&&(a.notCache=!0)}function m(a){var b=this,c=b._modules[b.currentMod];a&&(c._forceExit=!0),b.history.getPreState()?history.back():b.go(b.defEntry)}var n=b.derive({type:"module",maxModNum:$H.mobile()?20:50,_getModId:c,_createMod:d,_showMod:e,initialize:f,setModule:g,getModule:h,go:i,destroy:j,update:k,clearCache:l,back:m});return n}),$Define("C.ComponentManager",["V.AbstractManager","V.ViewManager"],function(a,b){function c(){var a=this,c=$H.getSingleton(b);a._types=c._types,a._all=c._all}var d=a.derive({type:"component",initialize:c});return $CM=new d,d}),$Define("C.AbstractComponent",["V.ViewManager","V.View","C.ComponentManager","B.Class"],function(a,b){function c(b,c){var d=$H.createClass(),e=c||k;return $H.inherit(d,e,null,null,{notCover:function(a){return"define"==a}}),$H.getSingleton(a).registerType(b,d),$C[b]=d,d}function d(a,b){var c=this;if(!b)return!1;if($H.isArr(b)){for(var d=0,e=b.length;e>d;d++)if(c.match(a,b[d]))return!0}else if(c.match(a,b))return!0;return!1}function e(){var a=this;a.callSuper();var b;(b=a.icon)&&("string"==typeof b?a.add({xtype:"Icon",name:b}):(b.xtype="Icon",a.add(b)))}function f(){var a=this;a.callSuper(),a.tmpl=a.tmpl.replace(/(class=['"])/,"$1#js-component cmpCls tTypeCls themeCls radiusCls sizeCls shadow?hui-shadow shadowSurround?hui-shadow-surround shadowOverlay?hui-shadow-overlay shadowInset?hui-shadow-inset activeClass isFocus?hui-focus isInline?hui-inline ")
}function g(){this.update({isActive:!0})}function h(){this.update({isActive:!1})}function i(a){var b=this;return void 0!==a?b.set("text",a):b.get("text")}function j(){var a=this,b=a.validator;if(b){var c=a.val();b.error||(b.error=function(a){new $C.Tips({text:a,theme:"error"})});var d=$H.Validator.valid(c,b);return d}for(var e=a.children,f=0,g=e.length;g>f;f++){var d=e[f].valid();if(!d)return d}return!0}$C=$H.ns("C");var k=b.derive({xtype:"AbstractComponent",xConfig:{extCls:"",tType:"",theme:"",cls:"",radius:null,shadow:!1,shadowInset:!1,shadowSurround:!1,shadowOverlay:!1,size:"",isActive:!1,isFocus:!1,isInline:!1,activeCls:"hui-active",cmpCls:{depends:["cls"],parse:function(){return"hui-"+this.get("cls")}},sizeCls:{depends:["size"],parse:function(){var a=this.get("size");return a&&"hui-size-"+a}},tTypeCls:{depends:["tType"],parse:function(){var a=this.get("tType");return a?"hui-"+this.get("cls")+"-"+a:""}},themeCls:{depends:["theme"],parse:function(){var a=this.get("theme");return a?"hui-"+this.get("cls")+"-"+this.get("theme"):""}},activeClass:{depends:["isActive","activeCls"],parse:function(){return this.get("isActive")?this.get("activeCls"):""}},radiusCls:{depends:["radius"],parse:function(){var a=this.get("radius");return a?"hui-radius-"+a:""}}},hasConfig:d,doConfig:e,preTmpl:f,active:g,unactive:h,txt:i,valid:j},{define:c});return k}),$Define("C.Icon","C.AbstractComponent",function(a){function b(a){var b=this;$H.isStr(a)&&(a={name:a}),a.bgColor&&(a.style=$H.extend(a.style,{backgroundColor:a.bgColor})),b.callSuper([a])}var c=a.define("Icon");return c.extend({xConfig:{cls:"icon",theme:"gray",isAlt:!1,radius:"big",name:"",iconName:{depends:["name"],parse:function(){return"hui-icon-"+this.get("name")}}},bgColor:"",tmpl:'<span {{bindAttr class="isAlt?hui-alt-icon iconName"}}></span>',doConfig:b}),c}),$Define("C.Link","C.AbstractComponent",function(a){var b=a.define("Link");return b.extend({xConfig:{cls:"link",text:""},tmpl:'<a hidefocus="true" href="javascript:;">{{text}}</a>'}),b}),$Define("C.Button","C.AbstractComponent",function(a){function b(a){var b=this;"adapt"===a.tType&&(a=$H.clone(a),$H.extend(a,{isInline:!0,radius:null,shadow:null,shadowSurround:null}),"string"==typeof a.icon&&(a.icon={name:a.icon,theme:null})),b.callSuper([a])}var c=a.define("Button");return c.extend({xConfig:{cls:"btn",text:"",extTxt:"",theme:"gray",markType:"",iconPos:"",activeCls:"hui-btn-active",isBack:!1,radius:"little",gradient:!1,isInline:!0,noTxtCls:{depends:["text","tType"],parse:function(){var a=this.get("text");return"adapt"==this.get("tType")||a||0===a?void 0:"hui-btn-icon-notxt"}},iconPosCls:{depends:["iconPos"],parse:function(){var a=this.get("iconPos");return a?"hui-btn-icon-"+a:""}},markCls:{depends:["markType"],parse:function(){var a=this.get("markType");return a?"hui-btn-mark-"+a:""}}},defItem:{xtype:"Icon"},tmpl:['<a href="javascript:;" hidefocus="true" {{bindAttr class="noTxtCls isBack?hui-btn-back gradient?hui-gradient markCls iconPosCls"}}>','<span class="hui-btn-txt">{{text}}</span>','<span class="hui-btn-ext">{{extTxt}}</span>',"{{placeItem}}",'<span class="hui-btn-mark"></span>',"</a>"].join(""),doConfig:b}),c}),$Define("C.Desc",["C.AbstractComponent","D.Model","D.Collection"],function(a){function b(a){"Icon"===a.xtype&&$H.extendIf(a,{xrole:"icon",isAlt:!0,extCls:"hui-light",size:"mini",theme:null})}var c=a.define("Desc");return c.extend({xConfig:{cls:"desc",icon:"",text:"",txtOverflow:!0,iconCls:{depends:["icon"],parse:function(){var a=this.get("icon");return a?"hui-icon-"+a:""}}},tmpl:['<div {{bindAttr class="#c-clear txtOverflow?c-txt-overflow"}}>',"{{placeItem > [xrole=icon]}}",'<span class="hui-desc-txt">{{text}}</span>','<div class="hui-desc-right">',"{{placeItem > [xrole=right]}}","</div>","{{placeItem > [!xrole]}}","</div>"].join(""),parseItem:b}),c}),$Define("C.Panel","C.AbstractComponent",function(a){var b=a.define("Panel");return b.extend({xConfig:{cls:"panel",content:"",isLoading:!1,loadingTxt:"正在加载中..."},tmpl:["<div>","{{#if isLoading}}",'<div class="hui-panel-loading">','<div class="hui-mask"></div>','<div class="hui-loading-container">','<div class="hui-tips hui-tips-big hui-tips-black hui-radius-little">','<span class="hui-icon hui-icon-loading"></span>','<span class="hui-tips-txt">{{loadingTxt}}</span>',"</div>","</div>","</div>","{{/if}}","{{#if content}}","{{content}}","{{else}}","{{placeItem}}","{{/if}}","</div>"].join("")}),b}),$Define("C.Popup","C.AbstractComponent",function(a){function b(){var a=this;a.callSuper(),a.extCls=(a.extCls||"")+" hui-popup"+(a.isFixed?" hui-popup-fixed":""),a.clickHide&&a.listeners.push({name:"click",el:$(document),handler:function(){this.hide()}}),$H.android()&&(a.listeners.push({name:"show",custom:!0,handler:function(){var a=$H.Events.trigger("component.popup.show");1!=a&&$("input,textarea,select").attr("disabled","disabled")}}),a.listeners.push({name:"hide",custom:!0,handler:function(){var a=$H.Events.trigger("component.popup.hide");1!=a&&setTimeout(function(){$("input,textarea,select").removeAttr("disabled")},500)}}))}function c(){var a=this,b=a.getEl();if(b.css("z-index",1e3*m+1e3),!a.width&&a.parent){var c=a.parent.getEl(),d=a.width=c[0].clientWidth;b.css("width",d)}var e=a.showPos,f=typeof e;"string"===f?a[e]():"function"===f?e.call(a):"object"===f&&null!==e&&b.css(a.showPos),a.noMask||a.mask(),a.timeout&&setTimeout(function(){a.destroyed||a.hide()},a.timeout),$H.once("hisoryChange",function(){return a.showed&&!a.destroyed?(a.hide(),$H.stop(),!1):void 0}),a.callSuper()}function d(){var a=this,b=a.callSuper();0!=b&&(a.noMask||a.unmask(),a.destroyWhenHide&&a.destroy())}function e(){var a=this,b=a.getEl();b.css({left:"50%",top:$H.em2px(.5),position:"fixed"})}function f(){var a=this,b=a.getEl(),c=b[0].clientWidth,d=b[0].clientHeight,e=document,f=((e.documentElement.offsetWidth||e.body.offsetWidth)-c)/2,g=e.documentElement.clientHeight||e.body.clientHeight,h=g-d,i=h/2-h/10;a.isFixed||(i+=e.documentElement.scrollTop||e.body.scrollTop),i=10>i?window.screen.height/2-200:i,b.css({left:f+"px",top:i-(a.offsetTop||0)+"px"})}function g(){var a=this,b=a.getEl(),c=b[0].clientWidth,d=document,e=((d.documentElement.offsetWidth||d.body.offsetWidth)-c)/2;b.css({left:e+"px",bottom:a.get("hasArrow")?"1em":0})}function h(a){var b=this,c=a||b.parent.getEl(),d=$H.position(c[0]);b.getEl().css(d)}function i(){var a=this;k?k.appendTo(a.renderTo):k=$('<div class="hui-mask hui-hidden"></div>').appendTo(a.renderTo),k.css("z-index",1e3*m+998),0==m&&k.removeClass("hui-hidden"),m++}function j(){m--,0==m?k.addClass("hui-hidden"):k.css("z-index",1e3*(m-1)+998)}var k,l=a.define("Popup"),m=0;return l.extend({delayShow:!0,clickHide:!0,isFixed:!1,showPos:"center",destroyWhenHide:!0,shadowOverlay:!0,tmpl:"<div>{{placeItem}}</div>",doConfig:b,afterShow:c,hide:d,top:e,center:f,bottom:g,followEl:h,mask:i,unmask:j}),l}),$Define("C.ControlGroup","C.AbstractComponent",function(a){function b(){var a=this;a.callSuper(),"h"==a.get("direction")&&a.listen({name:"afterRender add remove",custom:!0,handler:function(){a.layout()}})}function c(a){a.extCls=(a.extCls||"")+" js-item"}function d(){var a=this;if(a.rendered){var b=a.children.length,c=Math.floor(100/b),d=a.getEl().children(".js-item"),e="hui-item-first",f="hui-item-last";d.each(function(a,d){var g=$(d);0==a?(g.removeClass(f),g.addClass(e)):a==b-1?(g.removeClass(e),g.addClass(f)):(g.removeClass(e),g.removeClass(f)),d.style.width=b-1>a?c+"%":100-c*(b-1)+"%"})}}function e(a){var b,c=this;if(!c.notSelect&&(b="number"==typeof a?c.children[a]:"string"==typeof a?c.find(a)[0]:a))if(c.multi||b.multi)c.selectItem(b,!b.get("selected"));else{var d=c.getSelected();d&&c.selectItem(d,!1),c.selectItem(b)}}function f(a){var b=this,c=[];return b.each(function(b,d){d.get(d.select?"selected":"isActive")&&c.push(a?b:d)}),c.length>0?b.multi?c:c[0]:null}function g(a,b){b=0!=b,b?a.select?a.select():a.active():a.select?a.select(b):a.unactive()}function h(a){var b=this;if(void 0===a){var c=[];return b.each(function(a,b){b.get("selected")&&c.push(b.value)}),c.join(",")}var c=(""+a).split(",");b.each(function(a,d){$H.contains(c,d.get("value"))?b.selectItem(d,!0):b.selectItem(d,!1)})}function i(a,b){var c,d=this;if(d.itemClick){var e=d.children[b];c=d.itemClick(e,b)}c!==!1&&d.select(b)}var j=a.define("ControlGroup");return j.extend({xConfig:{cls:"ctrlgp",direction:"v",directionCls:{depends:["direction"],parse:function(){return"hui-ctrlgp-"+this.get("direction")}}},multi:!1,defItem:{xtype:"Button",radius:null,shadow:!1,isInline:!1},tmpl:'<div {{bindAttr class="directionCls"}}>{{placeItem}}</div>',listeners:[{name:"click",selector:".js-item",method:"delegate",handler:function(a){var b=this,c=$(a.currentTarget),d=b.find("> [_id="+c.attr("id")+"]");if(d.length>0){var e=d[0].index();b.onItemClick(a,e)}}}],doConfig:b,parseItem:c,layout:d,select:e,getSelected:f,selectItem:g,val:h,onItemClick:i}),j}),$Define("C.Radio","C.AbstractComponent",function(a){function b(a){this.update({selected:!(0==a)})}function c(a){var b=this;return void 0===a?b.get("value"):void b.set("value",a)}var d=a.define("Radio");return d.extend({xConfig:{cls:"radio",name:"",text:"",value:"",selected:!1},tmpl:['<div {{bindAttr class="#hui-btn #hui-btn-gray selected?hui-radio-on"}}>','<span class="hui-icon hui-icon-radio"></span>','<input type="radio" {{bindAttr selected?checked name="name" value="value"}}/>','<span class="hui-radio-txt">{{text}}</span>',"</div>"].join(""),select:b,val:c}),d}),$Define("C.Checkbox","C.AbstractComponent",function(a){function b(a){this.update({selected:!(0==a)})}function c(a){var b=this;return void 0===a?b.get("value"):void b.set("value",a)}var d=a.define("Checkbox");return d.extend({xConfig:{cls:"chkbox",name:"",text:"",value:"",selected:!1},multi:!0,tmpl:['<div {{bindAttr class="#hui-btn #hui-btn-gray selected?hui-chkbox-on"}}>','<span class="hui-icon hui-icon-chkbox"></span>','<input type="checkbox" {{bindAttr selected?checked name="name" value="value"}}/>','<span class="hui-chkbox-txt">{{text}}</span>',"</div>"].join(""),select:b,val:c}),d}),$Define("C.Select","C.AbstractComponent",function(a){function b(a){var b=this;b.callSuper();var c=$H.clone(a.options);b.defTxt=b.get("text");for(var d=b.get("value"),e=!1,f=0,g=c.length;g>f;f++){var h=c[f],i=h.value;if(void 0!==i&&i==d){b.set("text",h.text),h.selected=!0,e=!0;break}}e||delete b.value,b.add({itemClick:function(a){var c=a.get("value");b.val(c)},width:b.optionWidth||b.width,items:c})}function c(){var a=this;a.children[0].show()}function d(a){var b=this;if(void 0===a)return b.get("value");if(b.get("value")!=a){var c=b.children[0],d=c.find("> [value="+a+"]");d.length>0&&(d=d[0],b.set("value",a),b.txt(d.get("text")),c.select(d),b.trigger("change",a,d))}}function e(){var a=this,b=a.children[0];b.selectItem(b.getSelected(),!1),a.set("value",""),a.set("text",a.defTxt)}var f=a.define("Select");return f.extend({xConfig:{cls:"select",name:"",text:"请选择...",value:"",radius:"little",iconPos:"right",iconPosCls:{depends:["iconPos"],parse:function(){var a=this.get("iconPos");return a?"hui-btn-icon-"+a:""}}},optionClick:function(){},defItem:{xtype:"Menu",hidden:!0,markType:"hook",showPos:$H.mobile()?"center":"followEl",renderTo:"body"},_customEvents:["change"],tmpl:['<div {{bindAttr class="#hui-btn #hui-btn-gray iconPosCls"}}>','<span class="hui-icon hui-alt-icon hui-icon-carat-d hui-light"></span>','<input {{bindAttr value="value" name="name"}}/>','<span class="hui-btn-txt">{{text}}</span>',"</div>"].join(""),listeners:[{name:"click",handler:function(){this.showOptions()}}],doConfig:b,showOptions:c,val:d,clearValue:e}),f}),$Define("C.Input","C.AbstractComponent",function(a){function b(a){var b=this;"search"==a.type&&(b.icon="search"),b.callSuper(),b.maxHeight=$H.em2px(b.maxHeight),a.isTextarea&&b.listeners.push({name:"input propertychange",el:".js-input",handler:function(){var a=b.getEl();a.height("auto");var c=b.findEl(".js-input"),d=c[0].scrollHeight;if(d>=50){var e=b.inputHeight&&b.maxHeight<b.inputHeight?b.inputHeight:b.maxHeight;d=e>=d?d:e,c.css("height",d)}}}),b.withClear&&b.add({xtype:"Button",radius:"big",icon:"delete",click:function(){this.parent.findEl("input").val("").focus()}}),a.inputHeight&&b.on("afterRender",function(){b.findEl("input,textarea").css("height",a.inputHeight)})}function c(a){var b=this;"Icon"==a.xtype?b.get("iconPos")||b.set("iconPos","left"):"Button"==a.xtype&&(b.get("btnPos")||b.set("btnPos","right"))}function d(a){var b=this.findEl(".js-input");return void 0===a?b.val():void b.val(a)}function e(){this.findEl(".js-input").focus()}function f(){this.findEl(".js-input").blur()}var g=a.define("Input");return g.extend({xConfig:{cls:"input",isTextarea:!1,name:"",value:"",placeholder:"",radius:"little",iconPos:"",btnPos:"",iconPosCls:{depends:["iconPos"],parse:function(){var a=this.get("iconPos");return a?"hui-input-icon-"+a:""}},btnPosCls:{depends:["btnPos"],parse:function(){var a=this.get("btnPos");return a?"hui-input-btn-"+a:""}}},fastUpdateMethod:{inputHeight:function(a){this.findEl("input,textarea").css("height",a)}},type:"",maxHeight:"5.313em",withClear:!1,tmpl:['<div {{bindAttr class="iconPosCls btnPosCls"}}>',"{{placeItem}}","{{#if isTextarea}}",'{{textarea class="#js-input #hui-input-txt" name="name" placeholder="placeholder" value=value}}',"{{else}}",'{{input type="#text" class="#js-input #hui-input-txt" name="name" placeholder="placeholder" value="value"}}',"{{/if}}","</div>"].join(""),listeners:[{name:"focus",el:".js-input",handler:function(){var a=this;a.getEl().addClass("hui-focus"),a.focused=!0,$H.mobile()&&$H.once("hisoryChange",function(){return a.focused&&!a.destroyed?(a.blur(),$H.stop(),!1):void 0})}},{name:"blur",el:".js-input",handler:function(){var a=this;a.getEl().removeClass("hui-focus"),a.focused=!1}}],doConfig:b,parseItem:c,val:d,focus:e,blur:f}),g}),$Define("C.Label","C.AbstractComponent",function(a){var b=a.define("Label");return b.extend({xConfig:{cls:"label",text:"",color:"",textAlign:"",forName:"",colorCls:{depends:["color"],parse:function(){var a=this.get("color");return a?"hui-label-"+a:""}},textAlignCls:{depends:["textAlign"],parse:function(){var a=this.get("textAlign");return a?"c-txt-"+a:""}}},tmpl:['<label {{bindAttr class="colorCls textAlignCls" for="forName"}}>',"{{text}}","</label>"].join("")}),b}),$Define("C.RowItem","C.AbstractComponent",function(a){function b(a){var b=this;b.callSuper();var c=b.get("text");c||0===c||b.set("text","&nbsp;"),void 0===b.text||a.hasOwnProperty("underline")||b.set("underline",!0),a.click&&!a.hasOwnProperty("hasArrow")&&b.set("hasArrow",!0),a.comment&&void 0===a.padding&&b.set("padding","normal")}var c=a.define("RowItem");return c.extend({xConfig:{cls:"rowitem",text:"",comment:"",underline:!1,hasArrow:!1,newsNum:0,padding:"big",paddingCls:{depends:["padding"],parse:function(){var a=this.get("padding");return a?"hui-rowitem-padding-"+a:""}},newsNumTxt:{depends:["newsNum"],parse:function(){var a=this.get("newsNum");return a?a>9?"9+":a:0}}},tmpl:['<div {{bindAttr class="underline?hui-rowitem-underline paddingCls hasArrow?hui-rowitem-padding-right"}}>',"{{placeItem}}",'<div class="hui-rowitem-txt">{{text}}</div>','<div class="hui-rowitem-comment">{{comment}}</div>',"{{#if newsNumTxt}}",'<span class="hui-news-tips">{{newsNumTxt}}</span>',"{{else}}","{{#if hasArrow}}",'<a href="javascript:;" hidefocus="true" class="hui-click-arrow" title="详情"><span class="hui-icon hui-alt-icon hui-icon-carat-r hui-light"></span></a>',"{{/if}}","{{/if}}","</div>"].join(""),doConfig:b}),c}),$Define("C.Set","C.AbstractComponent",function(a){var b=a.define("Set");return b.extend({xConfig:{cls:"set",theme:"normal",title:""},tmpl:["<div>",'<div class="hui-set-title">',"{{#if title}}",'<h1 class="hui-title-txt">{{title}}</h1>',"{{/if}}","{{placeItem > [xrole=title]}}","</div>",'<div class="hui-set-content">',"{{placeItem > [xrole!=title]}}","</div>","</div>"].join("")}),b}),$Define("C.Field","C.AbstractComponent",function(a){function b(a){var b=this,c=a.title;$H.isSimple(c)&&(c={text:c}),c=$H.extend({xtype:"Label",xrole:"title"},c),b.add(c);var d=a.content;void 0!==d||a.items||(d=""),$H.isSimple(d)&&(d={text:d,underline:!0}),d&&(b.noPadding=!0,b.add(d));var e=$.extend({},a);delete e.title,delete e.content,b.callSuper([e])}var c=a.define("Field");return c.extend({xConfig:{cls:"field",noPadding:!1},defItem:{xtype:"RowItem",xrole:"content"},tmpl:["<div>",'<div class="hui-field-left">',"{{placeItem > [xrole=title]}}","</div>",'<div {{bindAttr class="#hui-field-right noPadding?hui-field-nopadding"}}>',"{{placeItem > [xrole=content]}}","</div>","</div>"].join(""),doConfig:b}),c}),$Define("C.Form","C.AbstractComponent",function(a){function b(){var a=this,b=!1;return a.findEl("input,textarea").each(function(a,c){if("checkbox"===c.type||"radio"===c.type){if(c.checked!=c.defaultChecked)return b=!0,!1}else if(c.value!=c.defaultValue)return b=!0,!1}),a.findEl("select").each(function(a,c){for(var d,e=0,a=0,f=c.options.length;f>a;a++)d=c.options[a],b=b||d.selected!=d.defaultSelected,d.defaultSelected&&(e=a);return b&&!c.multiple&&(b=e!=c.selectedIndex),b?!1:void 0}),b}var c=a.define("Form");return c.extend({xConfig:{cls:"form"},tmpl:["<div>",'<form action="">','<div class="hui-form-tips c-txt-error"></div>',"{{placeItem}}","</form>","</div>"].join(""),hasChanged:b}),c}),$Define("C.TabItem",["C.AbstractComponent","C.Panel"],function(a){function b(){var a=this;a.callSuper(),a.titleCmp=a.find("> [xrole=title]")[0],a.contentCmp=a.find("> [xrole=content]")[0]}function c(a){var b=this;b.callSuper();var c=a.title;"string"==typeof c&&(c={text:c}),"object"==typeof c&&b.add(c);var d=a.content;"string"==typeof d&&(d={xtype:"Panel",content:d}),"object"==typeof d&&($H.extend(d,{xrole:"content",hidden:!b.selected,extCls:(d.extCls||"")+" js-content"}),b.add(d))}function d(a){var b=this;b.selected&&"title"==a.xrole&&(a.isActive=!0),a.icon&&void 0===a.iconPos&&(a.iconPos="top"),b.activeType&&(a.activeCls="hui-btn-active-"+b.activeType)}function e(a){var b=this,c=b.titleCmp,d=b.contentCmp;0==a?(c.unactive(),d&&d.hide(),b.set("selected",!1),b.trigger("selectchange",!1)):(c.active(),d&&d.show(),b.set("selected",!0),b.trigger("selectchange",!0))}function f(a,b){var c=this;return b||(b=c.contentCmp),c.callSuper([a,b])}function g(a,b){var c=this;return b||(b=c.contentCmp),c.callSuper([a,b])}var h=a.define("TabItem");return h.extend({xConfig:{cls:"tabitem"},defItem:{xtype:"Button",xrole:"title",radius:null,isInline:!1,shadow:!1},_customEvents:["selectchange"],tmpl:"<div>{{placeItem > [xrole=title]}}</div>",initialize:b,doConfig:c,parseItem:d,select:e,getContent:f,setContent:g}),h}),$Define("C.Tab",["C.AbstractComponent","C.TabItem","C.ControlGroup"],function(a,b,c){function d(a){var b=this;b.activeType&&(a.activeType=b.activeType),b.callSuper()}function e(a,b){var c=this;b=b||c.getSelected(!0),c.findEl(".js-tab-content").index(b).html(a)}var f=a.define("Tab",c);return f.extend({xConfig:{cls:"tab",direction:"h"},defItem:{xtype:"TabItem"},tmpl:["<div>","{{placeItem > TabItem}}",'<div class="c-clear"></div>',"{{placeItem > TabItem > [xrole=content]}}","</div>"].join(""),parseItem:d,setTabContent:e}),f}),$Define("C.Toolbar","C.AbstractComponent",function(a){function b(a){"Button"===a.xtype&&void 0===a.shadowSurround&&(a.shadowSurround=!0)}var c=a.define("Toolbar");return c.extend({xConfig:{cls:"tbar",title:"",isHeader:!1,isFooter:!1},defItem:{xtype:"Button",theme:"black",xrole:"content"},tmpl:['<div {{bindAttr class="isHeader?hui-header isFooter?hui-footer"}}>','<div class="hui-tbar-left">',"{{placeItem > [xrole=left]}}","</div>","{{placeItem > [xrole=content]}}",'{{#if title}}<div class="hui-tbar-title js-tbar-txt">{{title}}</div>{{/if}}','<div class="hui-tbar-right">',"{{placeItem > [xrole=right]}}","</div>","</div>"].join(""),parseItem:b}),c}),$Define("C.Tips",["C.AbstractComponent","C.Popup","C.ControlGroup"],function(a,b){function c(a){var b=this;"loading"==a.type?$H.extend(b,{text:"正在加载中...",timeout:null,noMask:!0,icon:"loading"}):"miniLoading"==a.type?$H.extend(b,{showPos:{left:"50%",top:$H.em2px(.625)},clickHide:!1,destroyWhenHide:!1,timeout:null,delayShow:!1,shadowOverlay:null,theme:"tbar-black",noMask:!0,tType:"mini",items:{xtype:"Icon",name:"loading-mini",theme:null}}):"topTips"==a.type?$H.extend(b,{showPos:"top",noMask:!0,tType:"mini"}):"inlineLoading"===a.type&&$H.extend(b,{noMask:!0,clickHide:!1,destroyWhenHide:!1,timeout:null,delayShow:!1,shadowOverlay:null,size:"mini",tType:"inline",width:"auto",style:{zIndex:0},theme:null,showPos:{left:$H.em2px(.625),top:$H.em2px(.625)},items:{xtype:"Icon",name:"loading-mini",theme:null}}),b.callSuper()}var d=a.define("Tips",b);return d.extend({xConfig:{cls:"tips",text:"",radius:"normal",hasArrow:!1,theme:"black"},timeout:2e3,tmpl:['<div {{bindAttr class="text:hui-tips-notxt c-clear"}}>',"{{placeItem}}",'{{#if text}}<span class="hui-tips-txt">{{text}}</span>{{/if}}',"{{#if hasArrow}}",'<div class="hui-triangle"><div class="hui-triangle hui-triangle-inner"></div></div>',"{{/if}}","</div>"].join(""),doConfig:c}),d}),$Define("C.Dialog",["C.AbstractComponent","C.Popup"],function(a,b){function c(a){return new g({contentMsg:a,noClose:!0,noCancel:!0})}function d(a,b){return new g({contentMsg:a,noClose:!0,okCall:function(){return b&&b(!0)},cancelCall:function(){return b&&b(!1)}})}function e(a,b,c){return c||(c=b,b=""),new g({contentMsg:a,noClose:!0,items:{xtype:"Input",xrole:"dialog-content",value:b},okCall:function(){var a=this.find("Input")[0].val();return c&&c(a)}})}function f(a){var b=this;b.callSuper();var c=a.items;if(b.title&&!b.hasConfig("[xrole=dialog-header]",c)&&b.add({xtype:"Toolbar",title:b.title,theme:"gray",xrole:"dialog-header",extCls:"hui-dialog-header",items:!b.noClose&&{xtype:"Button",radius:"big",icon:"delete",shadow:!1,shadowSurround:!1,theme:"gray",xrole:"left",click:function(){b.hide()}}}),!b.noAction&&!b.hasConfig("[xrole=dialog-action]",c)){var d=[];b.noCancel||d.push({title:{isActive:1==b.activeBtn,text:b.cancelTxt,cClass:"cancelBtn",click:function(){0!=(b.cancelCall&&b.cancelCall())&&b.hide()}}}),b.noIgnore||d.push({title:{isActive:3==b.activeBtn,text:b.ignoreTxt,cClass:"ignoreBtn",click:function(){0!=(b.ignoreCall&&b.ignoreCall())&&b.hide()}}}),b.noOk||d.push({title:{text:b.okTxt,cClass:"okBtn",isActive:2==b.activeBtn,click:function(){0!=(b.okCall&&b.okCall())&&b.hide()}}}),b.add({xtype:"Tab",xrole:"dialog-action",theme:"no-border",tType:"sep",notSelect:!0,items:d})}}var g=a.define("Dialog",b);return $H.extend(g,{alert:c,confirm:d,prompt:e}),g.extend({xConfig:{cls:"dialog",radius:"little",content:"",contentTitle:"",contentMsg:""},noIgnore:!0,okTxt:"确定",cancelTxt:"取消",ignoreTxt:"不保存",clickHide:!1,tmpl:["<div>","{{placeItem > [xrole=dialog-header]}}",'<div class="hui-dialog-body">',"{{#if content}}","{{content}}","{{else}}",'<div class="hui-body-content c-clear">','<h1 class="hui-content-title">{{contentTitle}}</h1>','<div class="hui-content-msg">{{contentMsg}}</div>',"{{placeItem > [xrole=dialog-content]}}","</div>","{{/if}}","{{#unless noAction}}",'<div class="hui-body-action">',"{{placeItem > [xrole=dialog-action]}}","</div>","{{/unless}}","</div>","</div>"].join(""),doConfig:f}),g}),$Define("C.Menu",["C.AbstractComponent","C.Popup","C.ControlGroup"],function(a,b,c){function d(){var a=this;a.callSuper(c),a.callSuper()}function e(a){var b=this;c.prototype.parseItem.call(b,a);var d=b.markType;d?"hook"==d&&(a.items={name:"check",isAlt:!0,theme:null},a.iconPos="left",a.activeCls="hui-item-select"):b.notSelect=!0,a.isActive=a.selected}var f=a.define("Menu",b);return f.extend(c.prototype),f.extend({xConfig:{cls:"menu"},markType:null,destroyWhenHide:!1,defItem:{xtype:"Button",radius:null,shadow:!1,theme:null,isInline:!1},tmpl:'<div {{bindAttr class="directionCls"}}>{{placeItem}}</div>',doConfig:d,parseItem:e}),f}),$Define("C.DatePicker",["C.AbstractComponent","C.Dialog"],function(a,b){function c(a){var b,c=a.formator||"default",d=g.instance||(g.instance={});return(b=d[c])?(b.host!=a.host&&(b.host=a.host,b.off("change confirm"),a.change&&b.on("change",a.change),a.confirm&&b.on("confirm",a.confirm),a.date&&b.val(a.date)),b.show()):b=d[c]=new g($H.extend(a,{destroyWhenHide:!1})),b}function d(a,b,c,d,e){for(var f={xtype:"Select",xrole:"dialog-content",name:"dialogSelect",value:a,width:$H.em2px(3.125),cClass:d,optionWidth:$H.em2px(6.25),iconPos:"bottom",extCls:"hui-dp-"+d,options:[],defItem:{showPos:"center"},change:function(){var a=this,b=a.parent,c=b.val(!0);if("month"==a.cClass){var d=$H.getDaysInMonth(c),e=b.find(".date > Menu")[0],f=e.find();e.val()>d&&e.val(d);for(var g=28;31>g;g++){var h=f[g];h.hidden=d>g?!1:!0}}var i=b.val();b.val(i),b.trigger("change")}},g=b;c>=g;g++)f.options.push({text:"minute"==d&&10>g?"0"+g:g,value:g,hidden:e&&g>e});return f}function e(a){var b=this;a=a||{};var c=a.date;$H.isStr(c)&&(c=$H.parseDate(c));for(var c=c||$H.now(),e=a.formator||(a.formator="yyyy-MM-dd HH:mm"),f=$H.formatDate(c,e),g=[],h=$H.getDaysInMonth(c),i=e.match(/[a-zA-Z]+/g),j=f.match(/\d+/g),k=0;k<i.length;k++){var l=i[k],m=parseInt(j[k]);switch(l){case"yyyy":g.push(d(m,m,m+10,"year"));break;case"MM":g.push(d(m,1,12,"month"));break;case"dd":g.push(d(m,1,31,"date",h));break;case"HH":g.push(d(m,0,23,"hour"));break;case"mm":g.push(d(m,0,59,"minute"))}}$H.extend(a,{contentTitle:f+" 星期"+$H.getWeek(c),items:g,okCall:function(){return b.trigger("confirm")}}),b.callSuper([a])}function f(a){var b=this,c=b.find("Select"),d=b.formator;if(!a||$H.isBool(a)){for(var e="",f=0;f<c.length;f++)1==f||2==f?e+="-":3==f?e+=" ":4==f&&(e+=":"),e+=c[f].val();var g=$H.parseDate(e);return a?g:$H.formatDate(g,d)}var e=a,h=a;$H.isStr(a)?h=$H.parseDate(a,d):e=$H.formatDate(a,d);for(var i=e.match(/\d+/g),f=0;f<c.length;f++)c[f].val(i[f]);b.set("contentTitle",e+" 星期"+$H.getWeek(h))}var g=a.define("DatePicker",b);return g.getInstance=c,g.extend({xConfig:{cls:"dp"},extCls:"hui-dialog",_customEvents:["change","confirm"],doConfig:e,val:f}),g}),$Define("C.DateSelect",["C.AbstractComponent","C.DatePicker"],function(a,b){function c(a){var b=this,c=a.date;c||(c=$H.now(),c.setMinutes(0)),b.date=c;var d=$H.formatDate(c,a.formator||(a.formator="yyyy-MM-dd HH:mm"));b.set("value",d),b.callSuper()}function d(){var a=this;b.getInstance({date:a.get("value"),formator:a.formator,host:a,confirm:function(){return a.set("value",this.val()),a.trigger("change"),a.trigger("confirm")}})}function e(a){var b=this;if(!a||$H.isBool(a)){var c=b.get("value");return a?$H.parseDate(c):c}a=$H.formatDate(a,b.formator),b.get("value")!=a&&(b.set("value",a),b.trigger("change"))}var f=a.define("DateSelect");return f.extend({xConfig:{cls:"dsel",name:"",value:"",text:{depends:["value"],parse:function(){var a=this.get("value");return a?a+" 星期"+$H.getWeek($H.parseDate(a)):"请选择..."}},radius:"little",iconPos:"right",iconPosCls:{depends:["iconPos"],parse:function(){var a=this.get("iconPos");return a?"hui-btn-icon-"+a:""}}},_customEvents:["change","confirm"],tmpl:['<div {{bindAttr class="#hui-btn #hui-btn-gray iconPosCls"}}>','<span class="hui-icon hui-alt-icon hui-icon-carat-d hui-light"></span>','<input {{bindAttr value="value" name="name"}}/>','<span class="hui-btn-txt">{{text}}</span>',"</div>"].join(""),listeners:[{name:"click",handler:function(){this.showDialog()}}],doConfig:c,showDialog:d,val:e}),f}),$Define("C.AbstractImage","C.AbstractComponent",function(a){function b(a){var b=this,c=$(a).removeAttr("width").removeAttr("height").css({width:"",height:""}),d=b.getEl()[0],e=nOrigW=a.width,f=nOrigH=a.height,g=e/f,h=b.width,i=b.height;(void 0===h||$H.isStr(h)&&h.indexOf("em")>0)&&(h=d.clientWidth),(void 0===i||$H.isStr(i)&&i.indexOf("em")>0)&&(i=d.clientHeight),(h||i)&&(h&&e!=h&&(e=h,f=Math.ceil(e/g)),i&&f>i&&(f=i,e=Math.ceil(f*g)),c.css({width:e,height:f}));var j=0,k=0;return h>e&&(j=(h-e)/2,j=Math.ceil(j)),c.css("left",j),i>f&&(k=(i-f)/2,k=Math.ceil(k)),c.css("top",k),c.removeClass("hui-unvisible"),b.trigger("imgFixed",c),{width:e,height:f,origW:nOrigW,origH:nOrigH,left:j,top:k}}var c=a.define("AbstractImage");return c.extend({_customEvents:["imgFixed"],fixImgSize:b}),c}),$Define("C.Image",["C.AbstractComponent","C.AbstractImage"],function(a,b){var c=a.define("Image",b);return c.extend({xConfig:{cls:"image",imgSrc:"",radius:"normal"},listeners:[{name:"load",el:"img",handler:function(a){var b=this,c=a.target;b.fixImgSize(c)}}],tmpl:'<div><img {{bindAttr src="imgSrc"}} class="hui-unvisible"/></div>'}),c}),$Define("C.ImgUpload",["C.AbstractComponent","U.ImgCompress","P.Device","P.Camera"],function(a,b,c,d){function e(a){var b=this;b.callSuper();var d=a.compressOptions,e=d&&d.success;b.compressOptions=$H.extend({},b.compressOptions),b.compressOptions.success=function(a){b.findEl(".js-file-content").val(a.clearBase64),e&&e(a)},void 0===a.useFileInput&&b.set("useFileInput",!c.isPhonegap()),b.get("useFileInput")||b.listen({name:"click",handler:function(){b.showSelDialog()}})}function f(){{var a=this;new $C.Dialog({contentMsg:"上传照片",width:$H.em2px(15.625),noAction:!0,clickHide:!0,items:{xtype:"Panel",xrole:"dialog-content",items:[{xtype:"Button",text:"拍照",isInline:!1,click:function(){d.getPicture({sourceType:"CAMERA",success:function(b){a.processImg(b)}})}},{xtype:"Button",text:"相册",isInline:!1,click:function(){d.getPicture({sourceType:"PHOTOLIBRARY",success:function(b){a.processImg(b)}})}}]}})}}function g(a){var c=this;if(c.crop){var d=c.cropOptions||{};d.imgSrc=a,$Require("C.CropWindow",function(e){var f=new e({cropOptions:d,width:c.cropWinW,height:c.cropWinH,success:function(d){f.hide();var e=$H.extend(d,c.compressOptions);b.compress(a,e)}})})}else b.compress(a,c.compressOptions)}function h(){this.findEl(".js-file-content").val("")}var i=a.define("ImgUpload");return i.extend({xConfig:{cls:"img-upload",transparent:!1,useFileInput:!0,showImg:!0},crop:!0,listeners:[{el:"input",name:"change",handler:function(a){var b,c,d,e,f=a.target;if(e=f.files){if(0==e.length)return;b=e[0],f.value="",c=b.name;var g=URL||webkitURL;d=g.createObjectURL(b)}else{if(f.select(),f.blur(),d=document.selection.createRange().text,!d)return;c=d}return/.+\.(jpg|gif|png|jpeg|bmp)$/.test(c)?void this.processImg(d):void $C.Tips({text:"您选择的文件不是图片",theme:"error"})}},{name:"click",el:".js-file-input",handler:function(a){$H.ie()<10&&(a.preventDefault(),$C.Tips("上传功能暂时不支持IE9及以下版本，请使用其它浏览器，推荐chrome浏览器。"))}}],tmpl:['<div {{bindAttr class="transparent?hui-transparent"}}>',"{{#unless transparent}}","<div>",'<img {{bindAttr class="#js-orig showImg?:hui-hide"}}/>',"</div>","<div>",'<img src="" class="js-preview">',"</div>","{{/unless}}",'<input type="hidden" class="js-file-content" name="fileContent">',"{{#if useFileInput}}",'<input type="file" class="js-file-input hui-file-input">',"{{/if}}","</div>"].join(""),doConfig:e,showSelDialog:f,processImg:g,cleanContent:h}),i}),$Define("C.DisplayImage",["C.AbstractComponent","C.Popup","C.AbstractImage"],function(a,b,c){function d(a){var b=this;b.findEl(".js-loading")[a===!1?"addClass":"removeClass"]("hui-hidden")}var e=a.define("DisplayImage",b);return $H.extendIf(e.prototype,c.prototype),e.extend({xConfig:{cls:"dispimg"},showPos:null,noMask:!0,isFixed:!0,listeners:[{name:"afterShow",custom:!0,handler:function(){var a=this,b=a.getEl()[0];a.findEl(".js-loading").css({left:b.clientWidth/2-$H.em2px(1.375),top:b.clientHeight/2-$H.em2px(1.375)}),a.showLoading(),a.findEl(".js-img").attr("src",a.imgSrc),a.findEl(".js-orig").attr("src",a.origSrc)}},{name:"load",el:".js-img",handler:function(a){var b=this;b.fixImgSize(a.target)}},{name:"load",el:".js-orig",handler:function(a){var b=this;b.showLoading(!1),b.findEl(".js-img").addClass("hui-hidden"),b.fixImgSize(a.target)}}],tmpl:['<div class="c-v-middle-container">','<span class="js-loading hui-icon hui-icon-loading hui-icon-bg hui-hidden"></span>','<img class="js-img hui-unvisible"/>','<img class="js-orig hui-unvisible">',"</div>"].join(""),showLoading:d}),e}),$Define("C.Crop",["C.AbstractComponent","C.AbstractImage","E.Draggable"],function(a,b,c){function d(){var a=this,b=a.origImg=a.findEl(".js-orig-img"),d=a.fixImgSize(b[0]);
a.origW=d.origW,a.origH=d.origH,a.cropImgSize?(a.cropWidth=d.width,a.cropHeight=d.height):($H.isStr(a.cropWidth)&&(a.cropWidth=$H.em2px(a.cropWidth)),$H.isStr(a.cropHeight)&&(a.cropHeight=$H.em2px(a.cropHeight)));var e=a.leftOffset=d.left,f=a.topOffset=d.top,g=d.width,h=d.height;a.scale=h/d.origH;var i=a.cropX=Math.ceil((g-a.cropWidth)/2),j=a.cropY=Math.ceil((h-a.cropHeight)/2);a.cropBox=a.findEl(".js-crop-box").css({left:e+i,top:f+j,width:a.cropWidth,height:a.cropHeight}),a.cropImg=a.findEl(".js-crop-img").css({height:h,width:g,marginLeft:-i,marginTop:-j}).removeClass("hui-unvisible"),a.draggable=new c(a.getEl(),{move:function(b){return a.move(b)},end:function(){a.dragging=!1,a.zooming=!1}})}function e(){var a=this;a.dragging=!0,a.initCropX=a.cropX,a.initCropY=a.cropY}function f(a){var b=this;b.zooming=!0,b.initCropWidth=b.cropWidth,b.initCropHeight=b.cropHeight;var c=a.currentTarget.className;b.zoomDirect=c.indexOf("-n")>0?"n":c.indexOf("-e")>0?"e":c.indexOf("-s")>0?"s":"w",b.initCropX=b.cropX,b.initCropY=b.cropY}function g(a){var b=this;return b.dragging?b.dragCrop(a):b.zooming&&b.zoomCrop(a),!1}function h(a){var b=this;b.cropX=b.initCropX+a.offsetX,b.cropY=b.initCropY+a.offsetY,b.cropImg.css({marginLeft:-b.cropX,marginTop:-b.cropY}),b.cropBox.css({left:b.leftOffset+b.cropX,top:b.topOffset+b.cropY})}function i(a){var b,c,d=this,e=d.zoomDirect,f=d.fixedScale;return"n"===e||"s"===e?(c=a.offsetY,b=f?c*f:a.offsetX):(b=a.offsetX,c=f?b/f:a.offsetY),("n"===e||"w"===e)&&(d.dragCrop({offsetX:b,offsetY:c}),b=-b,c=-c),d.cropWidth=d.initCropWidth+b,d.cropHeight=d.initCropHeight+c,d.cropBox.css({width:d.cropWidth,height:d.cropHeight}),!1}function j(){var a=this,b=a.scale,c=Math.ceil;return{cropX:c(a.cropX/b),cropY:c(a.cropY/b),cropW:c(a.cropWidth/b),cropH:c(a.cropHeight/b),origW:a.origW,origH:a.origH}}function k(){var a=this;a.draggable.destroy(),a.callSuper()}var l=a.define("Crop",b),m=$H.hasTouch()?"touchstart":"mousedown";return l.extend({xConfig:{cls:"crop"},listeners:[{name:"show",custom:!0,handler:function(){var a=this;a.findEl(".js-orig-img,.js-crop-img").attr("src",a.imgSrc)}},{name:"load",el:".js-orig-img",handler:function(){this.initCrop()}},{name:m,el:".js-box-img",handler:function(){this.startDrag()}},{name:m,el:".js-op-bar",handler:function(a){this.startZoom(a)}}],imgSrc:"",cropWidth:"9.375em",cropHeight:"9.375em",tmpl:["<div>",'<img class="js-orig-img hui-orig-img hui-unvisible">','<div class="hui-mask"></div>','<div class="js-crop-box hui-crop-box">','<div class="js-box-img hui-box-img">','<img class="js-crop-img hui-crop-img hui-unvisible">',"</div>",'<div class="hui-box-op">','<div class="hui-op-handle hui-op-handle-n"></div>','<div class="hui-op-handle hui-op-handle-e"></div>','<div class="hui-op-handle hui-op-handle-s"></div>','<div class="hui-op-handle hui-op-handle-w"></div>','<div class="js-op-bar hui-op-bar hui-op-bar-n"></div>','<div class="js-op-bar hui-op-bar hui-op-bar-e"></div>','<div class="js-op-bar hui-op-bar hui-op-bar-s"></div>','<div class="js-op-bar hui-op-bar hui-op-bar-w"></div>',"</div>","</div>","</div>"].join(""),initCrop:d,startDrag:e,startZoom:f,move:g,dragCrop:h,zoomCrop:i,getResult:j,destroy:k}),l}),$Define("C.CropWindow",["C.AbstractComponent","C.Popup","C.Crop"],function(a,b){function c(){var a=this;a.callSuper();var b={xtype:"Crop"};$H.extend(b,a.cropOptions),a.add([{xtype:"Toolbar",title:a.title,isHeader:!0,items:[{xtype:"Button",xrole:"left",theme:"dark",tType:"adapt",icon:"carat-l",click:function(){a.hide()}},{xtype:"Button",xrole:"right",theme:"dark",tType:"adapt",icon:"check",click:function(){var b=a.find("Crop")[0].getResult();a.success&&a.success(b)}}]},b])}var d=a.define("CropWindow",b);return d.extend({xConfig:{cls:"cropwin"},title:"裁切图片",showPos:null,noMask:!0,clickHide:!1,doConfig:c}),d}),$Define("C.Hcard","C.AbstractComponent",function(a){function b(a){var b=this;b.callSuper(),a.click&&void 0===b.hasArrow&&b.set("hasArrow",!0);var c=b.desc;c&&(1==c.length&&b.set("theme","little"),b.add(c)),b.imgClick&&b.listen({name:"click",selector:".js-img",method:"delegate",handler:function(){b.imgClick.call(b)}}),b.contentClick&&b.listen({name:"click",selector:".js-content",method:"delegate",handler:function(){b.contentClick.call(b)}})}var c=a.define("Hcard");return c.extend({xConfig:{cls:"hcard",image:"",title:"",titleExt:"",titleDesc:"",hasImg:!0,txtOverflow:!0,hasArrow:!1,newsNum:0,hasBorder:!1,hasImgCls:{depends:["image","hasImg"],parse:function(){return this.get("image")||this.get("hasImg")?"hui-hcard-hasimg":""}},newsNumTxt:{depends:["newsNum"],parse:function(){var a=this.get("newsNum");return a?a>9?"9+":a:0}}},defItem:{xtype:"Desc",xrole:"content"},tmpl:['<div {{bindAttr class="hasImgCls hasBorder?hui-border hasArrow?hui-hcard-padding-right"}}>',"{{#if image}}",'<div class="hui-hcard-img js-img">','<img {{bindAttr src="image"}}>',"</div>","{{/if}}",'<div class="hui-hcard-content js-content">','<div {{bindAttr class="#hui-content-title txtOverflow?c-txt-overflow"}}>',"{{title}}",'<span class="hui-title-ext">{{titleExt}}</span>','<span class="hui-title-desc">{{titleDesc}}</span>',"</div>","{{placeItem > [xrole=content]}}","</div>","{{placeItem > [xrole!=content]}}","{{#if newsNumTxt}}",'<span class="hui-news-tips">{{newsNumTxt}}</span>',"{{else}}","{{#if hasArrow}}",'<a href="javascript:;" hidefocus="true" class="hui-click-arrow" title="详情">','<span class="hui-icon hui-alt-icon hui-icon-carat-r hui-light"></span>',"</a>","{{/if}}","{{/if}}","</div>"].join(""),doConfig:b}),c}),$Define("C.Vcard","C.AbstractComponent",function(a){function b(a){var b=this;b.callSuper();var c=a.action;c&&(c=$H.extend({xtype:"Button",radius:null,isInline:!1,xrole:"action"},c),b.add(c))}var c=a.define("Vcard");return c.extend({xConfig:{cls:"vcard",hasImg:!1,title:"",hasBorder:!1,extTitle:""},tmpl:['<div {{bindAttr class="hasBorder?hui-border"}}>','<div {{bindAttr class="#hui-vcard-title hasImg?hui-title-hasimg #c-clear"}}>',"{{placeItem > [xrole=title]}}","{{#if title}}",'<div class="hui-title-txt">{{title}}</div>',"{{/if}}","{{#if extTitle}}",'<div class="hui-title-extra">{{extTitle}}</div>',"{{/if}}","</div>","{{placeItem > [xrole!=title][xrole!=action]}}",'<div class="hui-vcard-action">',"{{placeItem > [xrole=action]}}","</div>","</div>"].join(""),doConfig:b}),c}),$Define("C.Conversation","C.AbstractComponent",function(a){function b(){var a=this;a.callSuper(),a.imgClick&&a.listen({name:"click",selector:".js-conver-img",method:"delegate",handler:function(){a.imgClick.call(a)}})}var c=a.define("Conversation");return c.extend({xConfig:{cls:"conversation",theme:"left",time:"",image:"",content:""},tmpl:['<div class="c-clear">','<div class="hui-conver-time">{{time}}</div>','<div class="hui-conver-img js-conver-img">',"{{#if image}}",'<img {{bindAttr src="image"}}>',"{{else}}","{{placeItem}}","{{/if}}","</div>",'<div class="hui-conver-content">',"{{content}}",'<div class="hui-triangle">',"</div>","</div>","</div>"].join(""),doConfig:b}),c}),$Define("C.ModelList","C.AbstractComponent",function(a){function b(){var a=this;a.callSuper(),a.set("pdTxt",a.pullTxt),a.itemXtype&&((a.defItem||(a.defItem={})).xtype=a.itemXtype);var b=a.model;0==b.size()?a.set("isEmpty",!0):a.loadMore(),a.listenTo(b,{add:function(b,c){a.addListItem(c)},remove:function(b,c){a.removeListItem(c)},sortItem:function(b,c,d){var e=a.find(function(a){return a.model&&a.model.id==c.id});e=e[0];var f=e.getEl(),g=f.parent(),h=g.children("div").eq(d);h.before(f)},reset:function(){a.removeListItem("emptyAll")},sync:function(){0===b.size()&&a.set("isEmpty",!0)}});var c=a.hasPullRefresh&&window.iScroll&&!$H.ie();a.set("hasPullRefresh",c),c&&(a.listen({name:"afterRender",handler:function(){var a=this,b=a.getEl(),c=b.find(".hui-list-pulldown"),d=$H.em2px(3.125),e=$H.em2px(.313),f="hui-pd-refresh",g="hui-pd-release";a.scroller=new window.iScroll(b[0],{useTransition:!0,topOffset:d,mouseWheel:!0,vScrollbar:!1,onRefresh:function(){c.hasClass(f)&&(c.removeClass(f+" "+g),a.set("pdTxt",a.pullTxt))},onScrollMove:function(){this.y>e&&!c.hasClass(g)?(c.addClass(g),a.set("pdTxt",a.flipTxt),this.minScrollY=0):this.y<e&&c.hasClass(g)&&(c.removeClass(g),a.set("pdTxt",a.pullTxt),this.minScrollY=-d)},onScrollEnd:function(){c.hasClass(g)&&(c.addClass(f),a.set("pdTxt",a.releaseTxt),a.pulldownIsRefresh?a.refresh():a.loadMore())}})}}),a.listenTo(a.model,"sync",function(){a.set("pdTime",$H.formatDate($H.now(),"HH:mm")),a.lazyRefresh()}),a.listen({name:"afterShow",handler:function(){a.lazyRefresh(),"bottom"==a.scrollPos&&setTimeout(function(){a.scrollTo("bottom")},0)}})),a.get("hasMoreBtn")&&a.listen({name:"click",method:"delegate",selector:".hui-list-more",handler:function(){a.pulldownIsRefresh?a.loadMore():a.refresh()}})}function c(a,b){var c=this;if(c.set("isEmpty",!1),void 0===b){b=c.model.indexOf(a);var d=c.inited?c.children.length:c.items.length;b=b>d?d:b}c.add({model:a},b),c.lazyRefresh()}function d(a){var b=this;b.remove("emptyAll"==a?b.children:function(b){return b.model&&b.model.id==a.id}),0==b.children.length&&b.set("isEmpty",!0),b.lazyRefresh()}function e(){var a=this;a.scroller&&a.getEl()[0].clientHeight&&a.scroller.refresh()}function f(){var a=this;a._toRefresh||(a._toRefresh=1,setTimeout(function(){a._toRefresh=0,a.refreshScroller()},0))}function g(a,b,c){var d=this,e=d.scroller;if($H.isStr(a)){if("top"==a)e.scrollTo(0,-$H.em2px(3.125));else if("bottom"==a){var f=d.findEl(".hui-list-inner")[0].clientHeight;e.scrollTo(0,-f)}}else e.scrollTo(a,b,c)}function h(){var a=this,b=a.model,c=a.children.length,d=b.size();if(d>c){var e=a.maxNumFromCache,f=c,g=c+e;a.pulldownIsRefresh?b.each(function(b,c){b>=f&&g>b&&a.addListItem(c)}):(g=d-c,f=g-e,b.eachDesc(function(b,c){b>=f&&g>b&&a.addListItem(c,0)})),a.lazyRefresh()}else a.getMore()}function i(a){var b=this,c=b.scroller,d=c.minScrollY;if(c.minScrollY=$H.em2px(.625),a){var e=b.findEl(".hui-list-pulldown");e.addClass("hui-pd-release")}c.scrollTo(0,0,200),setTimeout(function(){c.minScrollY=d},1e3)}function j(){var a=this;a.scroller&&(a.scroller.destroy(),a.scroller=null),a.callSuper()}var k=a.define("ModelList");return k.extend({xConfig:{cls:"mlist",isEmpty:!1,emptyTips:"暂无",pdTxt:"",pdComment:"上次刷新时间：",pdTime:"",hasMoreBtn:!0,moreBtnTxt:"查看更多",showBtnIfEmpty:!1,hasPullRefresh:!1,showMoreBtn:{depends:["isEmpty","showBtnIfEmpty"],parse:function(){return this.get("showBtnIfEmpty")||!this.get("isEmpty")}}},pullTxt:"下拉可刷新",flipTxt:"松开可刷新",releaseTxt:"正在刷新",maxNumFromCache:20,scrollPos:"top",pulldownIsRefresh:!0,tmpl:['<div class="hui-list">','<div class="hui-list-inner">',"{{#if hasPullRefresh}}",'<div class="hui-list-pulldown hui-pd-pull c-h-middle-container">','<div class="c-h-middle">','<span class="hui-icon hui-alt-icon hui-icon-arrow-d hui-light"></span>','<span class="hui-icon hui-alt-icon hui-icon-loading-mini"></span>','<div class="hui-pd-txt">','{{#if pdTxt}}<div class="js-txt">{{pdTxt}}</div>{{/if}}',"{{#if pdComment}}",'<div class="js-comment hui-pd-comment">','<span class="js-pdComment">{{pdComment}}</span>','<span class="js-pdTime">{{pdTime}}</span>',"</div>","{{/if}}","</div>","</div>","</div>","{{/if}}","{{#if isEmpty}}",'<div class="hui-list-empty js-empty">{{emptyTips}}</div>',"{{/if}}",'<div class="hui-list-container js-item-container">{{placeItem}}</div>',"{{#if hasMoreBtn}}",'<div {{bindAttr class="#hui-list-more showMoreBtn:hui-hidden"}}>','<a href="javascript:;" hidefocus="true" class="hui-btn hui-btn-gray hui-shadow hui-inline hui-radius-little">','<span class="hui-btn-txt">{{moreBtnTxt}}</span>',"</a>","</div>","{{/if}}","</div>","</div>"].join(""),doConfig:b,addListItem:c,removeListItem:d,refreshScroller:e,lazyRefresh:f,scrollTo:g,loadMore:h,pullLoading:i,destroy:j}),k}),$Define("C.Editor","C.AbstractComponent",function(a){function b(){var a=this;return"<head><style>				html{word-wrap:break-word;}				body{color:"+a.color+";font-size:"+a.fontSize+";font-family:"+a.fontFamily+";line-height:1.7;padding:0.5em 0.625em;margin:0;				background-color:#ffffff;}				img{max-width:100%;}				pre{					white-space: pre-wrap; /* css-3 */					white-space: -moz-pre-wrap; /* Mozilla, since 1999 */					white-space: -pre-wrap; /* Opera 4-6 */					white-space: -o-pre-wrap; /* Opera 7 */					word-wrap: break-word; /* Internet Explorer 5.5+ */					/* white-space : normal ;Internet Explorer 5.5+ */					font-family:arial;				}				span.typoRed{border-bottom:0.125em dotted #ff0000;cursor:pointer;}				</style></head><body>"+(a.value||"")+"</body>"}function c(){var a=this,b=a.findEl("iframe")[0],c=a.ifrWin=b.contentWindow||b.window,d=a.ifrDoc=c.document,e=a.getInitHtml();d.open("text/html","replace"),d.writeln(e),d.close(),$H.ie()?"5.0"==Browser.ie()?d.designMode="on":d.body.contentEditable=!0:(d.designMode="on",d.execCommand("useCSS",!1,!0)),a.ifrBody=d.body}function d(a){var b=this,c=b.ifrBody;return void 0===a?c.innerHTML:void(c.innerHTML=a)}function e(){var a=this,b=a.val();a.findEl("textarea").val(b)}var f=a.define("Editor");return f.extend({xConfig:{cls:"editor",name:"",value:""},listeners:[{name:"afterRender",custom:!0,handler:function(){this.makeEditable()}}],color:"#333",fontSize:"1em",fontFamily:"tahoma,arial,sans-serif",value:"",tmpl:["<div>",'<iframe class="hui-editor-iframe" hideFocus=true frameborder=0></iframe>','{{textarea class="#hui-editor-textarea" name="name" placeholder="placeholder" value=value}}',"</div>"].join(""),getInitHtml:b,makeEditable:c,val:d,sync:e}),f}),$Define("C.Share","C.AbstractComponent",function(a){var b=a.define("Share");return b.extend({xConfig:{cls:"share"},listeners:[{name:"afterRender",custom:!0,handler:function(){var a=this;$Require("http://static.bshare.cn/b/buttonLite.js#style=-1&amp;bp=weixin,sinaminiblog&amp;uuid=f19aa603-e8fa-437c-8069-f5a12dff7e4e&amp;pophcol=2&amp;lang=zh",function(){a.listen({name:"click",selector:"a",method:"delegate",handler:function(b){var c={title:a.get("title")||document.title,url:a.url||location.href,summary:a.get("summary")||""};if(a.getEntry){var d=a.getEntry();$H.extend(c,d)}bShare.entries=[],bShare.addEntry(c);var e=b.currentTarget.className;bShare.share(b.originalEvent,e)}})})}}],tmpl:["<div>",'<ul class="bshare c-clear">',"<li>分享到:</li>",'<li><a title="分享到微信" class="weixin" href="javascript:void(0);" ><img src="http://static.bshare.cn/frame/images/logos/s4/weixin.gif "/></a></li>','<li><a title="分享到新浪微博" class="sinaminiblog" href="javascript:void(0);" ><img src="http://static.bshare.cn/frame/images/logos/s4/sinaminiblog.gif "/></a></li>','<li><a title="分享到QQ空间" class="qzone" href="javascript:void(0);" ><img src="http://static.bshare.cn/frame/images/logos/s4/qzone.gif "/></a></li>','<li><a title="分享到人人网" class="renren" href="javascript:void(0);" ><img src="http://static.bshare.cn/frame/images/logos/s4/renren.gif "/></a></li>','<li><a title="分享到豆瓣"  class="douban" href="javascript:void(0);" ><img src="http://static.bshare.cn/frame/images/logos/s4/douban.gif "/></a></li>','<li><a title="分享到一键通" class="bsharesync" href="javascript:void(0);" ><img src="http://static.bshare.cn/frame/images/logos/s4/bsharesync.gif "/></a></li>','<li><a class="bshareDiv" href="http://www.bshare.cn/share"></a></li>',"</ul>","</div>"].join("")}),b});