/* Handy v1.0.0-dev | 2014-02-23 | zhengyinhui100@gmail.com */
$Define("m.AbstractModule","cm.AbstractView",function(c){var b=$HO.createClass();$HO.inherit(b,c,null,{useCache:!0,initialize:function(a){this.conf=a},cache:function(){},init:function(){},beforeRender:function(){},render:function(){},afterRender:function(){},reset:function(){},exit:function(){return!0},destroy:function(){this.getEl().remove()},getHtml:function(){if(!this.tmpl)return"";"string"!=typeof this.tmpl&&(this.constructor.prototype.tmpl=this.tmpl.join(""));return $H.Template.tmpl({id:this.name,
tmpl:this.tmpl},this)}});return b});$Define("m.AbstractDao",function(){var c=$HO.createClass();$HO.extend(c,{ajax:function(b){this.beforeSend(b);b.error=$HF.intercept(this.error,b.error);b.success=$HF.intercept(this.success,b.success);return $.ajax(b)},beforeSend:$H.noop,error:$H.noop,success:$H.noop});return c});$Define("m.AbstractView",function(){var c=$HO.createClass();$HO.extend(c.prototype,{})});
$Define("m.AbstractNavigator","handy.base.Object",function(c){var b=c.createClass();c.extend(b.prototype,{navigate:function(){}});return b});
$Define("m.History","handy.base.HashChange",function(c){var b=$HO.createClass(),a=0;$HO.extend(b.prototype,{initialize:function(e){this.key=e||"handy";this.states=[];c.listen($H.Function.bind(this.stateChange,this))},stateChange:function(){var e=this.getHashParam().hKey;if(e=this.states[e])e.onStateChange(e.param,!0)},saveState:function(e){var f=this.key+ ++a;this.states.push(f);this.states[f]=e;$HU.setHash("#"+JSON.stringify({hKey:f,param:e.param}))},getHashParam:function(){try{var e=$HU.getHash().replace("#",
"");return JSON.parse(e)}catch(a){$H.Debug.warn("History.getCurrentState:parse hash error:"+a.message)}},getCurrentState:function(){try{var a=this.getHashParam();return this.states[a.hKey]}catch(f){$H.Debug.warn("History.getCurrentState:parse hash error:"+f.message)}},getPreState:function(){try{for(var a=JSON.parse($HU.getHash().replace("#","")).hKey,f=this.states,d=f.length,b=0;b++;b<d)if(f[b]==a)return 0<b?f[f[--b]]:null}catch(c){$H.Debug.error("History.getPreState error:"+c.message,c)}},back:function(){var a=
this.getPreState();if(a)a.onStateChange(a.param)}});return b});
$Define("m.ModuleManager","m.History",function(c){var b=$HO.createClass();$HO.extend(b.prototype,{_getModWrapper:function(a){a="modWrapper_"+a;var e=$("#"+a);0==e.length&&(e=$('<div id="'+a+'" class="js-module m-module"></div>'));return e},_createMod:function(a){var e=this,b=a.modName;e.modules[b]={waiting:!0};$Require(e.defModPackage+b,function(d){d=new d;d.name=b;d.mType=b;d.initParam=a;e.modules[b]=d;d.init(a);d.beforeRender();var c=e._getModWrapper(b);d._container=c;var g=d.renderTo?$(d.renderTo):
e.container;c.html(d.getHtml());g.append(c);$HL.fire("afterRender",c);d.render(c);e.currentMod==b&&e._showMod(d);d.afterRender()})},_showMod:function(a){if(this.navigator&&this.navigator.navigate(a,this))return!1;this._hideAll();a._container.show();a.isActive=!0},_hideAll:function(){var a=this.modules,b;for(b in a)a[b]._container.hide(),a[b].isActive=!1},_destroy:function(a){a.destroy();delete this.modules[a.name]},initialize:function(a){a&&(this.conf=a,$HO.extend(this,a),this.container=a.container?
$(a.container):$(document.body));this.defModPackage+=".";this.history=new c;this.modules={}},go:function(a,b){var c=a.modName,d=this.currentMod,h=this.modules,g=h[d];if(d==c)g.waiting||g.reset();else{if(g&&!g.waiting&&!g.exit())return!1;(d=h[c])?d.useCache?(this._showMod(d),d.cache(a)):d.waiting||(this._destroy(d),this._createMod(a)):this._createMod(a);!0!=b&&this.history.saveState({onStateChange:$H.Function.bind(this.go,this),param:a});this.currentMod=c}}});return b});
