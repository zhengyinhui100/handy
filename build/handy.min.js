/* Handy v1.0.0-dev | 2014-04-13 | zhengyinhui100@gmail.com */
(function(){var e=window.handy,c=window.$,b=window.handy=window.$=function(){};b.version="1.0.0";b.isDebug="undefined"==typeof gEnv?!1:"dev"==gEnv;b.expando="handy"+(b.version+Math.random()).replace(/\D/g,"");b.add=function(a,d,f){f||(f=d,d=null);b.base||(b.base={});var g=[];if(d)if("string"==typeof d)g.push(b.base.Object.ns(d));else for(var c=0;c<d.length;c++)g.push(b.base.Object.ns(d[c]));g.push(b);d=f.apply(window,g);b.base[a]=b[a]=d;if(0<="Browser,Class,Array,Cookie,Date,Events,Function,Json,Object,String,Template,Util".indexOf(a))for(var j in d)b.isDebug&&
("undefined"!=typeof b[j]&&"console"in window&&!Function[j])&&(console.log(b[j]),console.log(a+"\u547d\u540d\u51b2\u7a81:"+j)),b[j]=d[j]};b.noConflict=function(a){window.$===b&&(window.$=c);a&&window.handy===b&&(window.handy=e);return b};b.noop=function(){}})();
handy.add("Json",function(){function e(a){g.lastIndex=0;g.test(a)&&(a=a.replace(g,function(a){var d=h[a];return"string"===typeof d?d:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));return'"'+a+'"'}function c(g,b){var h,j,k,m,n=d,l,r=b[g];r&&("object"===typeof r&&"function"===typeof r.toJSON)&&(r=r.toJSON(g));"function"===typeof a&&(r=a.call(b,g,r));switch(typeof r){case "string":return e(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);case "object":if(!r)return"null";
d+=f;l=[];if("[object Array]"===Object.prototype.toString.apply(r)){m=r.length;for(h=0;h<m;h+=1)l[h]=c(h,r)||"null";k=0===l.length?"[]":d?"[\n"+d+l.join(",\n"+d)+"\n"+n+"]":"["+l.join(",")+"]";d=n;return k}if(a&&"object"===typeof a){m=a.length;for(h=0;h<m;h+=1)"string"===typeof a[h]&&(j=a[h],(k=c(j,r))&&l.push(e(j)+(d?": ":":")+k))}else for(j in r)Object.prototype.hasOwnProperty.call(r,j)&&(k=c(j,r))&&l.push(e(j)+(d?": ":":")+k);k=0===l.length?"{}":d?"{\n"+d+l.join(",\n"+d)+"\n"+n+"}":"{"+l.join(",")+
"}";d=n;return k}}var b="JSON"in window,a,d,f,g=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,k=/^[\],:{}\s]*$/,m=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,n=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,l=/(?:^|:|,)(?:\s*\[)+/g;
return{stringify:function(g,h,j,k){if(b&&!k)return JSON.stringify.apply(null,arguments);var e;f=d="";if("number"===typeof j)for(e=0;e<j;e+=1)f+=" ";else"string"===typeof j&&(f=j);if((a=h)&&"function"!==typeof h&&("object"!==typeof h||"number"!==typeof h.length))$D.error(Error("Json.stringify:\u66ff\u6362\u53c2\u6570\u53ea\u80fd\u662f\u51fd\u6570\u6216\u8005\u6570\u7ec4"));else return c("",{"":g})},parseJson:function(a,d,g){function f(a,g){var b,c,h=a[g];if(h&&"object"===typeof h)for(b in h)Object.prototype.hasOwnProperty.call(h,
b)&&(c=f(h,b),void 0!==c?h[b]=c:delete h[b]);return d.call(a,g,h)}if(b&&!g)return JSON.parse.apply(null,arguments);var c;a=String(a);j.lastIndex=0;j.test(a)&&(a=a.replace(j,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(k.test(a.replace(m,"@").replace(n,"]").replace(l,"")))return c=eval("("+a+")"),"function"===typeof d?f({"":c},""):c;$D.error(new SyntaxError("JSON.parse"))}}});
handy.add("Object",function(){var e;e=(e=window.navigator.userAgent.match(/MSIE ([\d.]+)/))&&9>parseInt(e[0])?function(b,a,d){var f=[];if(b.length){a=a||0;for(d=d||b.length;a<d;a++)f.push(b[a])}return f}:function(b,a,d){return Array.prototype.slice.call(b,a||0,d||b.length)};var c={_alias:{B:"handy.base",C:"handy.component",M:"handy.module",CM:"handy.common"},ns:function(b,a){var d=null,f,g,h,j;b=c.alias(b);g=b.split(".");d=g[0];d=(h=2==arguments.length)?eval("(function(){if (typeof "+d+' == "undefined"){'+
d+" = {};}return "+d+";})()"):eval("(function(){if (typeof "+d+' != "undefined")return '+d+";})()");f=1;for(j=g.length;f<j;++f){if(f==j-1&&h)d[g[f]]=a;else if(h||d&&d[g[f]])d[g[f]]=d[g[f]]||{};else return;d=d[g[f]]}return d},alias:function(b,a){var d=c._alias;if(a)d[b]?$D.error("\u522b\u540d\u5df2\u88ab\u4f7f\u7528"+b+":"+d[b]):d[b]=a;else{if(b){var f=b,g=b.length-1;do{if(d[f])return d[f]+b.substring(g);g=f.lastIndexOf(".")}while(0<g&&(f=f.substring(0,g)));return b}return d}},extend:function(b,a,
d){if(!a||c.isStr(a)||c.isNum(a))return b;var f=d?d.notCover:!1,g=d?d.cover:null;d=d?d.IsClone:!1;b=b||{};var h=b.constructor,j=h.$isClass,k,e;for(e in a)if(k=a[e],(!g||c.contains(g,e))&&a.hasOwnProperty(e)){var n=b.hasOwnProperty(e),l=!0===f?n:!1;c.isArr(f)?l=c.contains(f,e)&&n:c.isFunc(f)&&(l=f(e,k));l||(k=d?c.clone(k):k,j&&c.isFunc(k)&&(k.$name=e,k.$owner=h),b[e]=k)}return b},mix:function(b,a,d){b.superProto||(b.superProto={});for(var f in a)b.superProto[f]=c.isFunc(a[f])?b.superProto[f]?function(d,
b){return function(){b.apply(this,arguments);a[d].apply(this,arguments)}}(f,b.superProto[f]):a[f]:a[f],b[f]||(b[f]=a[f]);d&&c.extend(b,d);a.toString!=a.constructor.prototype.toString&&(b.superProto.toString=function(){a.toString.apply(b,arguments)});return b},isNum:function(b){return"number"==typeof b},isStr:function(b){return"string"==typeof b},isBool:function(b){return"boolean"==typeof b},isSimple:function(b){return c.isStr(b)||c.isNum(b)||c.isBool(b)},isUndef:function(b){return"undefined"==typeof b},
isFunc:function(b){return"[object Function]"===Object.prototype.toString.call(b)},isArr:function(b){return"[object Array]"===Object.prototype.toString.call(b)},isObj:function(b){return"object"==typeof b&&!c.isArr(b)},isClass:function(b){return c.isFunc(b)&&!0===b.$isClass},equals:function(b,a){if(typeof b==typeof a){if("object"!=typeof b)return b===a;if(b===a)return!0;if(c.isArr(b)&&c.isArr(a)){if(b.length!=a.length)return!1;for(var d=0,f=b.length;d<f;d++)if(!c.equals(b[d],a[d]))return!1;return!0}if(!c.isArr(b)&&
!c.isArr(a)){if(c.count(b)!=c.count(a))return!1;for(d in b)if(void 0==a[d]||!c.equals(b[d],a[d]))return!1;return!0}}return!1},clone:function(b){if(null==b||"object"!=typeof b)return b;var a=b.constructor;if(a!=Object&&a!=window.Array)return b;if(a==window.Date||a==window.RegExp||a==window.Function||a==window.String||a==window.Number||a==window.Boolean)return new a(b);try{var d=new a,f;for(f in b)d[f]=c.clone(b[f]);return d}catch(g){return b}},isEmpty:function(b){if(c.isArr(b))return 0==b.length;for(var a in b)return!1;
return!0},each:function(b,a,d){if(b){var f,g=0,h=b.length,j=void 0===h||c.isFunc(b);if(d)if(j)for(f in b){if(!1===a.apply(b[f],d))break}else for(;g<h&&!1!==a.apply(b[g],d);)f=b.length,h==f?g++:h=f;else if(j)for(f in b){if(!1===a.call(b[f],f,b[f]))break}else for(;g<h&&!1!==a.call(b[g],g,b[g]);)f=b.length,h==f?g++:h=f;return b}},contains:function(b,a){if(!b)return!1;var d=!1;c.each(b,function(b,g){if(c.equals(g,a))return d=!0,!1});return d},largeThan:function(b,a){if("object"==typeof b&&"object"==typeof a){var d=
!0;c.each(a,function(f){if(!c.equals(a[f],b[f]))return d=!1});return d}},count:function(b){if(c.isArr(b))return b.length;var a=0,d;for(d in b)a++;return a},removeUndefined:function(b,a){var d=c.isArr(b);if(a){if(d){var f=[];c.each(b,function(a,d){void 0!==d&&f.push(d)});return f}return c.extend({},b,{isClone:!0,notCover:function(a,d){return void 0===d}})}c.each(b,function(a,f){void 0===f&&(d?b.splice(a,1):delete b[a])});return b},toArray:e,fromArray:function(b){for(var a={},d=0,f=b.length;d<f;d++){var g=
b[d];a[g.name]=g.value}return a},generateMethod:function(b,a,d){a=c.isArr(a)?a:a.split(",");for(var f=0;f<a.length;f++){var g=a[f];b[g]=d(g)}}};return c});
handy.add("Browser","handy.base.Object",function(e){var c={},b={};e.generateMethod(b,"ie firefox chrome safari opera windows linux mac trident webkit gecko presto sogou maxthon tt theWorld is360 mobile android ios iPhone iPod iPad flash".split(" "),function(a){return function(d){var g=c[a];return!d&&"string"===typeof g&&/^[\d\.]+$/.test(g)?parseInt(g):g}});e=window.navigator.userAgent;var a;(a=e.match(/MSIE ([\d.]+)/))?c.ie=a[1]:(a=e.match(/Firefox\/([\d.]+)/))?c.firefox=a[1]:(a=e.match(/Chrome\/([\d.]+)/))?
c.chrome=a[1]:(a=e.match(/Opera.([\d.]+)/))?c.opera=a[1]:(a=e.match(/Version\/([\d.]+).*Safari/))?c.safari=a[1]:0;/windows|win32/i.test(e)?c.windows=!0:/linux/i.test(e)?c.linux=!0:/macintosh/i.test(e)?c.mac=!0:0;/trident/i.test(e)?c.trident=!0:/webkit/i.test(e)?c.webkit=!0:/gecko/i.test(e)?c.gecko=!0:/presto/i.test(e)?c.presto=!0:0;/MetaSr/i.test(e)?c.sogou=!0:/Maxthon/i.test(e)?c.maxthon=!0:/TencentTraveler/i.test(e)?c.tt=!0:/TheWorld/i.test(e)?c.theWorld=!0:/360[S|E]E/i.test(e)?c.is360=!0:0;var d;
if((d=e.match(/AppleWebKit\/([\d.]*)/))&&d[1])if(/ Mobile\//.test(e)&&e.match(/iPad|iPod|iPhone/)){c.mobile="ios";if((d=e.match(/OS ([^\s]*)/))&&d[1])c.ios=d[1].replace("_",".");if((d=e.match(/iPad|iPod|iPhone/))&&d[0])c[d[0].toLowerCase()]=c.ios}else if(/ Android/i.test(e)){if(/Mobile/.test(e)&&(c.mobile="android"),(d=e.match(/Android ([^\s]*);/))&&d[1])c.android=d[1]}else if(d=e.match(/NokiaN[^\/]*|Android \d\.\d|webOS\/\d\.\d/))c.mobile=d[0].toLowerCase();var f;try{if(c.ie){var g=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
g&&(f=g.getVariable("$version").split(" ")[1])}else if(navigator.plugins&&0<navigator.plugins.length&&(g=navigator.plugins["Shockwave Flash"])){var h=g.description.split(" ");a=0;for(var j=h.length;a<j;a++)if(0<parseInt(h[a])){f=h[a];break}}}catch(k){}c.flash=f?f:null;return b});
handy.add("Debug",["handy.base.Json","handy.base.Browser"],function(e,c,b){var a={level:b.isDebug?0:5,LOG_LEVEL:1,DEBUG_LEVEL:2,INFO_LEVEL:3,WARN_LEVEL:4,ERROR_LEVEL:5,showInPage:!("console"in window)||!!c.mobile(),out:function(d,f,g){g=g||"log";if(f||a.showInPage){var c=b.expando+"debugDiv",j=top.document,k=j.getElementById(c);k?k.style.display="block":(k=j.createElement("DIV"),k.id=c,k.innerHTML=['<a href="javascript:void(0)" onclick="this.parentNode.style.display=\'none\'">\u5173\u95ed</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onclick="this.parentNode.getElementsByTagName(\'DIV\')[0].innerHTML=\'\';">\u6e05\u7a7a</a>',
"<a href=\"javascript:void(0)\" onclick=\"if(this.innerHTML=='\u5168\u5c4f'){this.parentNode.style.height='"+j.body.offsetHeight+"px';this.innerHTML='\u6536\u8d77'}else{this.parentNode.style.height='100px';this.innerHTML='\u5168\u5c4f';}\">\u5168\u5c4f</a>",'<a href="javascript:void(0)" onclick="var oDv=this.parentNode.getElementsByTagName(\'div\')[0];if(this.innerHTML==\'\u5e95\u90e8\'){oDv.scrollTop=oDv.scrollHeight;this.innerHTML=\'\u9876\u90e8\';}else{oDv.scrollTop=0;this.innerHTML=\'\u5e95\u90e8\';}">\u9876\u90e8</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onclick="location.reload();">\u5237\u65b0</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onclick="history.back();">\u540e\u9000</a>'].join("&nbsp;&nbsp;&nbsp;&nbsp;")+
'<div style="padding-top:5px;height:90%;overflow:auto;"></div>',k.style.position="fixed",k.style.width=j.body.offsetWidth-20+"px",k.style.left=0,k.style.top=0,k.style.right=0,k.style.height="150px",k.style.backgroundColor="#aaa",k.style.fontSize="12px",k.style.padding="10px",k.style.zIndex=9999999999,k.style.opacity=0.8,k.style.filter="alpha(opacity=80)",j.body.appendChild(k));c=k.getElementsByTagName("DIV")[0];j=b.Json.stringify(d,null,"&nbsp;&nbsp;&nbsp;&nbsp;",!0).replace(/\n/g,"<br/>");c.innerHTML+=
g+" : "+j+"<br/>";c.scrollTop=c.scrollHeight}c=arguments.callee.caller;c.$owner||(c=c.caller);try{if(c.$owner)console[g]("["+c.$owner.$ns+"->"+c.$name+"]");console[g](d)}catch(e){}},log:function(d,b){a.level>a.LOG_LEVEL||a.out(d,!!b,"log")},info:function(d,b){this.level>a.INFO_LEVEL||a.out(d,!!b,"info")},warn:function(d,b){a.level>a.WARN_LEVEL||a.out(d,!!b,"warn")},error:function(d,b){if(!(a.level>a.ERROR_LEVEL)&&(a.out(d,!!b,"error"),d instanceof Error))throw d;},time:function(d,b,g){a.level>a.INFO_LEVEL||
(d?("boolean"==typeof b&&(g=b,b=""),a.out((b||"")+((new Date).getTime()-(a.lastTime||0)),!!g)):a.lastTime=(new Date).getTime())},debug:function(d){if(!(a.level>a.DEBUG_LEVEL)&&!1!==d)debugger}};return a});
handy.add("Function",function(e){return{bind:function(c,b,a){var d=Array.prototype.slice.call(arguments,2);return function(){Array.prototype.push.apply(d,arguments);return c.apply(b,d)}},intercept:function(c,b,a,d){return e.Object.isFunc(c)&&e.Object.isFunc(b)?function(){var f=a||this,g={},h=arguments;g.scope=d;g.target=f;g.method=c;return!1!=b.apply(g,h)?c.apply(f,h):!1}:c}}});
handy.add("Class",["B.Object","B.Debug"],function(e,c){var b={createClass:function(a){var d=function(){var a,b,c=arguments;if(this.constructor==d)a=this;else return a=c.callee,b=function(){},b.prototype=a.prototype,b=new b,a.apply(b,c),b;if(b=a.initialize){for(var j in a)"object"==typeof a[j]&&(a[j]=e.clone(a[j]));return b.apply(a,c)}};d.$isClass=!0;d.derive=function(a,d,c){var j=b.createClass();b.inherit(j,this,a,d,c);return j};d.prototype.callSuper=function(a,d){a&&(!a.$isClass&&void 0!=a.length)&&
(d=a,a=null);var b=arguments.callee.caller,c=b.$owner.superProto;d=d||b.arguments;a=a?a.prototype:c||this.constructor.superProto;b=b.$name;if(a&&(b=a[b],e.isFunc(b)))return b.apply(this,d)};a&&this.ns(a,d);return d},inherit:function(a,b,f,g,h){var j=function(){};j.prototype=b.prototype;e.extend(a,b,h);a.prototype=new j;a.prototype.constructor=a;a.superClass=b;a.superProto=b.prototype;if(b._onInherit)try{b._onInherit(a)}catch(k){c.error(k)}g&&e.extend(a,g);f&&e.extend(a.prototype,f)},getSingleton:function(a){return(a=
"string"==typeof a?e.ns(a):a)&&(a.$singleton||(a.$singleton=new a))}};return b});
handy.add("Loader",["B.Debug","B.Object","B.Function"],function(e,c,b,a){function d(a){var b={},d=[];"string"==typeof a&&(a=[a]);for(var g=0,f=a.length;g<f;g++){var h;h=a[g];h=/\.(css|js)$/.test(h)?x[h]&&"loaded"==x[h].status:s.urlMap&&s.urlMap[h]?s.urlMap[h].chkExist():c.ns(h);if(h)d.push(h);else return b.notExist=a[g],b}b.exist=d;return b}function f(a,b){function d(){d.isCalled||(d.isCalled=!0,clearTimeout(j),b())}if("SCRIPT"===a.nodeName){var c=a,f=d;c.onload=c.onerror=c.onreadystatechange=function(){/loaded|complete|undefined/.test(c.readyState)&&
(c.onload=c.onerror=c.onreadystatechange=null,n.removeChild(c),c=null,setTimeout(f,0))}}else{var h=d;window.hasOwnProperty("attachEvent")?a.attachEvent("onload",h):setTimeout(function(){g(a,h)},0)}var j=setTimeout(function(){e.error("Time is out:"+a.src);d()},s.timeout)}function g(a,b){if(!b.isCalled){var d;if(l)a.sheet&&(d=!0);else if(a.sheet)try{a.sheet.cssRules&&(d=!0)}catch(c){if("SecurityError"===c.name||"NS_ERROR_DOM_SECURITY_ERR"===c.name)d=!0}setTimeout(function(){d?b():g(a,b)},1)}}function h(a){s.showLoading(!1);
t--;x[a].status="loaded";s.traceLog&&e.info(k+"Response: "+a);j()}function j(){for(var a=q.length-1;0<=a;a--){var b=q[a],g=d(b.deps);if(g.notExist)0==a&&0==t&&$D.error(m+g.notExist);else{q.splice(a,1);b.callback.apply(null,g.exist);j();break}}}var k="[Handy Loader] ",m=k+"not found: ",n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,l=navigator.userAgent.indexOf("AppleWebKit"),q=[],t=0,x={},s={traceLog:!1,timeout:15E3,skinName:"skin",showLoading:function(){},define:function(b,
d,g){b=a.Object.alias(b);2==arguments.length&&(g=d,d=[]);s.require(d,function(){var a;if("function"==typeof g)try{a=g.apply(null,arguments),s.traceLog&&e.info(k+"define: "+b)}catch(d){d.message=k+b+":factory define error:"+d.message;e.error(d);return}else a=g;if(a){c.ns(b,a);var f=typeof a;if("object"==f||"function"==f)a.$ns=b}else $D.error(k+"factory no return: "+b)})},require:function(g,c){for(var j="string"==typeof g?[g]:g,l=[],r=[],u=!0,w=0,z=j.length;w<z;w++){var p=j[w],p=a.Object.alias(p),v=
d(p);v.notExist?(l.push(p),u&&(u=!1,q.push({deps:j,callback:c})),s.traceLog&&e.info(m+p)):r.push(v.exist[0])}if(0==l.length)return c&&c.apply(null,r),0==r.length?r[0]:r;u=!1;j=0;for(r=l.length;j<r;j++)if(w=l[j],!x[w]){u=w;p=s.urlMap&&s.urlMap[u]&&s.urlMap[u].url;if(!p){z="";p=s.rootPath;if("string"==typeof p)z=p;else if("object"==typeof p)for(v in v=void 0,p)0==u.indexOf(v)&&(z=p[v],u=u.replace(v,""));else z="";p=/.css$/.test(u)?0==u.indexOf("/")?u:"/css/"+u:/.js$/.test(u)?u:u.replace(/\./g,"/")+
".js";0!=p.indexOf("/")&&(p="/"+p);p=z+p}u=!0;x[w]={id:w,status:"loading"};z=b.bind(h,null,w);if(/.css$/.test(p))a:{w=p;p=n.getElementsByTagName("link");for(v=0;v<p.length;v++){var D=p[v].href;!s.skinNode&&0<=D.indexOf(s.skinName)&&(s.skinNode=p[v]);if(0<=D.indexOf(w)||0<=w.indexOf(D))break a}p=document.createElement("link");p.rel="stylesheet";p.href=w;f(p,z);n.insertBefore(p,s.skinNode);s.traceLog&&e.info(k+"request:"+w)}else w=p,p=document.createElement("script"),p.async="async",p.src=w,p.type=
"text/javascript",f(p,z),n.appendChild(p),s.traceLog&&e.info(k+"request:"+w);t++}u&&s.showLoading(!0)}};return s});
handy.add("Events",function(e){return{_eventCache:{},_execEvtCache:[],_parseEvents:function(c,b){var a=/\s+/;if("object"==typeof c){for(var d in c)b([d,c[d]]);return!0}if("string"==typeof c&&a.test(c)){a=c.split(a);d=0;for(var f=a.length;d<f;d++)b([a[d]]);return!0}return!1},_parseCustomEvents:function(c,b,a){var d=this,f=e.toArray(arguments,2);return d._parseEvents(b,function(a){d[c].apply(d,a.concat(f))})},_delegateHandler:function(c,b){var a=this;return function(){if(!0!=a.isSuspend)return c.apply(b||
a,arguments)}},_pushEvent:function(c){this._execEvtCache.push(c)},_execEvents:function(){var c=this,b;e.each(c._execEvtCache,function(a,d){var f=d.delegation;"number"==typeof d.times&&(1<d.times?d.times--:c.off(d.name,d.handler));b=f.apply(c,d.args)});c._execEvtCache=[];return b},on:function(c,b,a,d){if(!this._parseCustomEvents("on",c,b,a,d)){"number"==typeof a&&(d=a,a=null);var f=this._eventCache,g=f[c];g||(g=f[c]=[]);c=this._delegateHandler(b,a);g.push({times:d,handler:b,context:a,delegation:c})}},
once:function(c,b,a){var d=e.toArray(arguments);this.on.apply(this,d.push(1))},off:function(c,b){if("all"==c)return this._eventCache={},!0;if(!this._parseCustomEvents("off",c,b)){var a=this._eventCache,d=c.indexOf(".");if(!b&&0>=d){for(var f in a)(f.split(".")[0]==c||0==d&&0<=f.indexOf(c))&&delete a[f];return!0}d=a[c];if(!d)return!1;if(b){a=0;for(f=d.length;a<f;a++)if(d[a].handler==b)return d.splice(a,1),!0}else return delete a[c],!0;return!1}},suspend:function(){if(this.isSuspend)return!1;this.isSuspend=
!0},resume:function(){if(!this.isSuspend)return!1;this.isSuspend=!1},trigger:function(c,b){function a(a){if(a)for(var b=0,f=a.length;b<f;b++){var h=a[b];h.args=g;h.name=c;d._pushEvent(h)}}var d=this,f=e.toArray(arguments);f.unshift("trigger");if(!d._parseCustomEvents.apply(d,f)){var f=d._eventCache,g=e.toArray(arguments),h;if(0<c.indexOf("."))h=f[c],a(h);else for(var j in f)if(h=c.indexOf("."),j.split(".")[0]==c||0==h&&0<=j.indexOf(c))h=f[j],a(h);a(f.all);return d._execEvents()}}}});
handy.add("Date",function(){var e=window.Date,c={getWeek:function(a,b){var c=a.getDay();b&&(c=(c+(b%7+7))%7);return"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split("")[c]},isWeeken:function(a){return 0==a.getDay()||6==a.getDay()},getDaysInMonth:function(a){a=new e(a.getFullYear(),a.getMonth()+1,0);return a.getDate()},getDaysInYear:function(a){var b=new e(a.getFullYear(),0,0);a=new e(a.getFullYear()+1,0,0);return Math.floor((a.getTime()-b.getTime())/864E5)},getDayIndexOfYear:function(a){var b=new e("1/1/"+
a.getFullYear());return Math.ceil((a.getTime()-b.getTime())/864E5)},formatDate:function(a,b){b=b||"yyyy-MM-dd HH:mm:ss";a=a||new e;var f=a.getHours(),g=Math.floor((a.getMonth()+3)/3),f={"y+":a.getFullYear(),"M+":a.getMonth()+1,"d+":a.getDate(),"h+":0==f%12?12:f%12,"H+":f,"m+":a.getMinutes(),"s+":a.getSeconds(),"w+":c.getWeek(a),"q+":g,"Q+":["\u4e00","\u4e8c","\u4e09","\u56db"][g-1],"S+":a.getMilliseconds()},h;for(h in f)RegExp("("+h+")").test(b)&&(g=RegExp.$1.length,b=b.replace(RegExp.$1,1==g?f[h]:
("00"+f[h]).slice(-g)));return b},parseDate:function(a,b){var c=typeof a,g=new e;if("number"==c)return g.setTime(a),g;if("string"!=c)return a;var c=(b||"yyyy-MM-dd HH:mm:ss").match(/[a-zA-Z]+/g),h=a.match(/\d+/g);if(h){for(var j=0;j<h.length;j++){var k=c[j],m=parseInt(h[j]);switch(k){case "yyyy":g.setFullYear(m);break;case "MM":g.setMonth(m-1);break;case "dd":g.setDate(m);break;case "HH":g.setHours(m);break;case "mm":g.setMinutes(m);break;case "ss":g.setSeconds(m);break;case "SS":g.setMilliseconds(m)}}return g}},
now:function(a){var d=new e;if(a)"number"!=typeof a&&(a=c.parseDate(a).getTime()),b=a-d.getTime();else return d.setTime(d.getTime()+b),d},howLong:function(a,b){var f=c.now().getTime()-a.getTime();if(b){var g;if(60>(f/=6E4))g="\u5206\u949f",f=f||1;else if(24>(f/=60))g="\u5c0f\u65f6";else if(30>(f/=24))g="\u5929";else return"30\u5929\u524d";f=(Math.floor(f)||1)+g+"\u524d"}return f}},b=0;return c});
handy.add("String",function(){var e={stripTags:function(c){return c.replace(/<\/?[^>]+>/gi,"")},escapeHTML:function(c){var b=document.createElement("div");c=document.createTextNode(c);b.appendChild(c);return b.innerHTML},unescapeHTML:function(c){var b=document.createElement("div");b.innerHTML=e.stripTags(c);return b.childNodes[0].nodeValue},decodeHTML:function(c){c=c.replace(/&lt;/gi,"<");c=c.replace(/&gt;/gi,">");c=c.replace(/&quot;/gi,'"');c=c.replace(/&apos;/gi,"'");c=c.replace(/<\/?br>/gi,"\n");
c=c.replace(/&amp;/gi,"&");return c=c.replace(/&nbsp;/gi," ")},encodeHTML:function(c){c=c.replace(/&/gi,"&amp;");c=c.replace(/</gi,"&lt;");c=c.replace(/>/gi,"&gt;");c=c.replace(/\"/gi,"&quot;");c=c.replace(/\'/gi,"&apos;");c=c.replace(/\n/gi,"</br>");return c=c.replace(/ /gi,"&nbsp;")},trim:function(c){return c=c.replace(/(^(\s|\u3000)+)|((\s|\u3000)+$)/g,"")},check:function(c,b){b||(b=/[,%\'\"\/\\;|\<\>\^]/);return-1<c.search(b)},len:function(c){return c.replace(/[^\x00-\xff]/g,"**").length},left:function(c,
b,a){if(e.len(c)>b){!0===a?a=2:0<a||(a=0);var d=0,f=0;for(b-=a;f<b;)255<c.charCodeAt(d)?f+=2:f++,d++;c=c.substring(0,d);for(d=0;d<a;d++)c+="."}return c},isNumStr:function(c){return 0==c.search(/^\d+$/g)},hasChn:function(c){return/[\u4E00-\u9FA5]+/.test(c)},isChn:function(c){return/^[\u4E00-\u9FA5]+$/.test(c)},addParam:function(c,b){b&&(c+=(-1<c.indexOf("?")?"&":"?")+b);return c}};return e});
handy.add("Cookie",function(){return{getCookie:function(e,c){var b=e+"=",a="",d=document.cookie;if(0<d.length){var f=d.indexOf(b);-1!=f&&(f+=b.length,b=d.indexOf(";",f),-1==b&&(b=d.length),a=d.substring(f,b),c||(a=unescape(a)))}return a},setCookie:function(e,c,b){var a=[];void 0!=e&&void 0!=c&&a.push(e+"="+escape(c));b&&(void 0!=b.path&&a.push("path="+b.path),void 0!=b.domain&&a.push("domain="+b.domain),void 0!=b.expires&&a.push("expires="+b.expires),b.secure&&a.push("secure"));document.cookie=a.join(";")},
delCookie:function(e){var c=new Date;c.setTime(c.getTime()-1);document.cookie=e+"=;expires="+c.toGMTString()}}});
handy.add("Util","B.Object",function(e,c){var b=0;return{isWindow:function(a){return null!=a&&a==a.window},getUuid:function(){return b++},getHash:function(){return top.location.hash.replace(/\?.*/,"")},setHash:function(a){var b=top.location.hash;0<=b.indexOf("#")&&(a=b.replace(/#[^\?]*/,a));top.location.hash=a},distance:function(a,b,f){function g(a){a.get?a=[a.get("latitude"),a.get("longitude")]:c.isObj(a)&&(a=[a.latitude,a.longitude]);return a}var h;a=g(a);h=a[0];a=a[1];b=g(b);h=h*Math.PI/180;var j=
b[0]*Math.PI/180;b=a*Math.PI/180-b[1]*Math.PI/180;b=2*Math.asin(Math.sqrt(Math.pow(Math.sin((h-j)/2),2)+Math.cos(h)*Math.cos(j)*Math.pow(Math.sin(b/2),2)));b=Math.round(63781370*b);b=(b/1E3).toFixed(2);if(f){if(isNaN(b))return"\u672a\u77e5";b+="km"}return b},result:function(a,b){var c=a[b];return e.isFunc(c)?c():c}}});
handy.add("Array","B.Object",function(e,c){function b(a){return a}function a(a){return function(b){return b[a]}}function d(g){return null==g?b:c.isFunc(g)?g:a(g)}function f(a){return function(b){if(b===a)return!0;for(var g in a)if(a[g]!==b[g])return!1;return!0}}function g(a){return function(b,g,c){var f={};g=d(g);e.each(b,function(d,h){var e=g.call(c,h,d,b);a(f,e,h)});return f}}var h={map:function(a,b,g){var d=[];if(null==a)return d;var c=Array.prototype.map;if(c&&a.map===c)return a.map(b,g);e.each(a,
function(a,c){d.push(b.call(g,c,a))});return d},pluck:function(b,g){return this.map(b,a(g))},some:function(a,b,g){var d=!1;if(null==a||!b)return d;var f=Array.prototype.some;if(f&&a.some===f)return a.some(b,g);c.each(a,function(a,c,f){if(d||(d=b.call(g,c,a,f)))return!1});return!!d},every:function(a,b,g){var d=!0;if(null==a||!b)return d;var f=Array.prototype.every;if(f&&a.every===f)return a.every(b,g);c.each(a,function(a,c,f){if(!(d=b.call(g,c,a,f)))return!1});return!!d},indexOf:function(a,b,g){if(null==
a)return-1;var d=0,c=a.length;if(g)if("number"==typeof g)d=0>g?Math.max(0,c+g):g;else return d=h.sortedIndex(a,b),a[d]===b?d:-1;var f=Array.prototype.indexOf;if(f&&a.indexOf===f)return a.indexOf(b,g);for(;d<c;d++)if(a[d]===b)return d;return-1},find:function(a,b,g){var d;this.some(a,function(a,c,f){if(b.call(g,a,c,f))return d=a,!0});return d},filter:function(a,b,g){var d=[];if(null==a)return d;var f=Array.prototype.filter;if(f&&a.filter===f)return a.filter(b,g);c.each(a,function(a,c,f){b.call(g,c,
a,f)&&d.push(c)});return d},where:function(a,b){return this.filter(a,f(b))},findWhere:function(a,b){return this.find(a,f(b))},invoke:function(a,b){var g=Array.prototype.slice.call(arguments,2),d=e.isFunc(b);return this.map(a,function(a){return(d?b:a[b]).apply(a,g)})},sortedIndex:function(a,b,g,c){g=d(g);b=g.call(c,b);for(var f=0,h=a.length;f<h;){var e=f+h>>>1;g.call(c,a[e])<b?f=e+1:h=e}return f},sortBy:function(a,b,g){b=d(b);return this.pluck(this.map(a,function(a,d,c){return{value:a,index:d,criteria:b.call(g,
a,d,c)}}).sort(function(a,b){var g=a.criteria,d=b.criteria;if(g!==d){if(g>d||void 0===g)return 1;if(g<d||void 0===d)return-1}return a.index-b.index}),"value")},groupBy:g(function(a,b,g){a[b]?a[b].push(g):a[b]=[g]}),countBy:g(function(a,b){a[b]?a[b]++:a[b]=1})};return h});
handy.add("Template",["B.String","B.Debug"],function(e,c,b){function a(a){return j?"$r+="+a+";\n":"$r.push("+a+");\n"}function d(b){b=b.replace(/("|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n");return a('"'+b+'"')}var f={openTag:"<%",closeTag:"%>",isEscape:!0,registerHelper:function(a,b){k[a]||(m+=a+"=oHelpers."+a+",");k[a]=b},tmpl:function(e,l){var q,t,x;if("string"==typeof e)q=e;else if(void 0!=e.length)q=e.join("");else if(q=e.tmpl,x=e.id)if(g[x])t=g[x];else if(!q){var s=document.getElementById(x);
s&&(q=(s.value||s.innerHTML).replace(/\s/g,""))}if(!t){if(!q){b.Debug.error("\u6a21\u677f\u672a\u5b9a\u4e49");return}a:{var y=m+"$r="+(j?'""':"[]")+";\n";b.Object.each(q.split(f.openTag),function(b,g){var c=g.split(f.closeTag);if(1==c.length)y+=d(c[0]);else{var e=y,j=c[0],j=j.replace(/this/g,"$data");0==j.indexOf("=")&&(j="("+j.replace(h,"")+")",j=a(j+'==undefined?"":'+j));y=e+(j+"\n");c[1]&&(y+=d(c[1]))}});y+="return "+(j?"$r;":'$r.join("");');try{var B=new Function("$data",y)}catch(C){c.log(y);
c.error(C);t=void 0;break a}B.$helpers=k;t=B}x&&(g[x]=t)}return l?t(l):t}},g={},h=/^=/,j="".trim,k={escape:e.escapeHTML,trim:e.trim},m="var oHelpers=arguments.callee.$helpers,escape=oHelpers.escape,trim=oHelpers.trim,";return f});
handy.add("HashChange",["handy.base.Debug","handy.base.Util"],function(e,c,b){function a(a){if(a==m)return!1;var b=k.contentWindow.document;b.open();b.write("<!doctype html><html><body>"+a+"</body></html>");b.close();m=a;e.log("set:"+k.contentWindow.document.body.innerText)}function d(){var b=c.getHash(),g=k.contentWindow.document.body.innerText;b!=m?(a(b),f(b)):g!=m&&(e.log("update:"+k.contentWindow.document.body.innerText),c.setHash(g))}function f(a){var b=q.listeners,g;for(g in b)b[g](a)}var g,
h=0,j=document,k,m,n=j.documentMode,l="onhashchange"in window&&(void 0===n||7<n),q={delay:50,listen:function(e,m){if(!g&&!g)if(g=!0,q.listeners={},l)$(window).on("hashchange",function(){f(c.getHash())});else k=$('<iframe id="fff" tabindex="-1" style="display:none" width=0 height=0 title="empty" />').appendTo(j.body)[0],$(k).one("load",function(){a(c.getHash());setInterval(d,q.delay)});if(m in q.listeners)$D.error(Error("Duplicate name"));else return m=m||b.expando+ ++h,q.listeners[m]=e,m},unListen:function(a){for(var b in q.listeners)(!a||
a==b)&&delete q.listeners[b]}};return q});handy.add("Support","B.Browser",function(e){var c={mediaQuery:function(){var a;if(e.mobile())a="hui-mobile";else{a="hui-pc";var b=e.ie();b&&(a+=" ie"+b)}document.documentElement.className+=" "+a}};c.mediaQuery();if(6==e.ie())try{document.execCommand("BackgroundImageCache",!1,!0)}catch(b){}return c});
handy.add("Validator",["B.String","B.Object"],function(e,c){var b={messages:{required:"{name}\u4e0d\u80fd\u4e3a\u7a7a",email:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u4ef6\u5730\u5740",url:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u94fe\u63a5\u5730\u5740",date:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u65e5\u671f",dateISO:"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u7684\u65e5\u671f",number:"{name}\u987b\u662f\u6570\u5b57",digits:"{name}\u987b\u662f\u6574\u6570",creditcard:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u4fe1\u7528\u5361\u53f7\u7801",
equalTo:"\u8bf7\u8f93\u5165\u76f8\u540c\u7684{name}",min:"{name}\u4e0d\u80fd\u5c0f\u4e8e{0}",max:"{name}\u4e0d\u80fd\u5927\u4e8e{0}",range:"{name}\u8981\u5728{0}\u5230{1}\u4e4b\u95f4",maxlength:"{name}\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7{0}",minlength:"{name}\u957f\u5ea6\u4e0d\u80fd\u5c11\u4e8e{0}",rangelength:"{name}\u957f\u5ea6\u8981\u5728{0}\u5230{1}\u4e4b\u95f4"},valid:function(a,d){var c=d.rules,g;for(g in c){var h=c[g],e=("function"==typeof h?h:b[g])(a,h);if(!e)return c=d.error||b.error,g=d.messages&&
d.messages[g]||b.messages[g],g=g.replace(/\{([^\}]+)\}/g,function(a,b){return h[b]||0==b&&h||d[b]||h||""}),c&&c(g),e}return!0},required:function(a){return 0<e.trim(""+a).length},email:function(a){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)},
url:function(a){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},
date:function(a){return!/Invalid|NaN/.test((new Date(a)).toString())},dateISO:function(a){return/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(a)},number:function(a){return/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)},digits:function(a){return/^\d+$/.test(a)},creditcard:function(a){if(/[^0-9 \-]+/.test(a))return!1;var b=0,c=0,g=!1;a=a.replace(/\D/g,"");for(var h=a.length-1;0<=h;h--){c=a.charAt(h);c=parseInt(c,10);if(g&&9<(c*=2))c-=9;b+=c;g=!g}return 0===b%10},min:function(a,b){return a>=b},max:function(a,
b){return a<=b},range:function(a,b){return a>=b[0]&&a<=b[1]},minlength:function(a,b){return(c.isArr(a)?a.length:e.trim(""+a).length)>=b},maxlength:function(a,b){return(c.isArr(a)?a.length:e.trim(""+a).length)<=b},rangelength:function(a,b){var f=c.isArr(a)?a.length:e.trim(""+a).length;return f>=b[0]&&f<=b[1]},equalTo:function(a,b){return a===b}};return b});
handy.add("LocalStorage",["B.Browser","B.Events","B.Json"],function(e,c,b){c={_init:function(){!a&&e.ie()&&(f=document.getElementById("LocalStorageUserDataDiv"),f||(f=document.createElement("DIV"),f.style.display="none",f.id="LocalStorageUserDataDiv",f.addBehavior("#default#userData"),document.body.appendChild(f),f.load(g)))},getItem:function(g){g=a?d.getItem(g):f.getAttribute(g);return g=b.parseJson(g)},setItem:function(c,e){e=b.stringify(e);try{a?d.setItem(c,e):(f.setAttribute(c,e),f.save(g))}catch(k){return $D.error(k),
!1}return!0},removeItem:function(b){a?d.removeItem(b):(f.removeAttribute(b),f.save(g))},clear:function(){a?d.clear():f.unload()}};var a=window.localStorage&&window.localStorage.getItem,d=window.localStorage,f,g=document.domain;c._init();return c});(function(e){Hui=H=$H=e.noConflict();$D=$H.Debug;$HD=$H.Date;$Define=$H.Loader.define;$Require=$H.Loader.require;$G={config:{}};e=window.$;e.fn.remove=$H.intercept(e.fn.remove,function(){$H.trigger("removeEl",this.target)})})(handy);
$Define("CM.AbstractEvents",function(){var e=$H.createClass();$H.extend(e.prototype,$H.Events);$H.extend(e.prototype,{_eventCache:{},_listenTo:[],_parseListenToEvents:function(c,b,a,d){var f=this,g=$H.toArray(arguments,3);return f._parseEvents(a,function(a){a.unshift(b);f[c].apply(f,a.concat(g))})},listenTo:function(c,b,a,d,f){if(!this._parseListenToEvents("listenTo",c,b,a,d,f)){"number"==typeof d&&(f=d,d=null);d=d||this;var g=this._delegateHandler(a,d);this._listenTo.push({target:c,name:b,delegation:g,
handler:a});c.on(b,g,d,f)}},unlistenTo:function(c,b,a){if(!this._parseListenToEvents("unlistenTo",c,b,a)){var d=this._listenTo,f="all"==c;$H.each(d,function(g,h){if(f||h.name==b&&h.handler==a&&h.target==c)h.target.off(h.name,h.delegation),d.splice(g,1)})}}});return e});
$Define("CM.DataStore",function(){var e=$H.createClass();$H.extend(e.prototype,{get:function(b,a){var d;if(d=c[b])return a?$H.where(d,a):d},push:function(b,a){"string"!=typeof b&&(a=b,b=null);var d=a.constructor.$ns;(c[d]||(c[d]=[])).push(a);b&&(c[b]||(c[b]=a))}});var c={};$S=$H.getSingleton(e);return e});
$Define("CM.AbstractDao","B.LocalStorage",function(e){var c=$H.createClass();$H.extend(c.prototype,{_ajaxMethodMap:{create:"POST",update:"POST",patch:"PATCH","delete":"DELETE",read:"GET"},_localMethodMap:{create:"setItem",update:"setItem",patch:"setItem","delete":"removeItem",read:"getItem"},ajax:function(b){this.beforeSend(b);b.error=$H.intercept(this.error,b.error);b.success=$H.intercept(this.success,b.success);return $.ajax(b)},beforeSend:$H.noop,error:$H.noop,success:$H.noop,get:function(){},
set:function(){},remove:function(){},sync:function(b,a,d){d=d||{};var c=d.storeType||"remote",g={type:"POST",dataType:"json"};d.url||(g.url=a.getUrl());if(null==d.data&&a&&("create"===b||"update"===b||"patch"===b))g.data=d.attrs||a.toJSON(d);if("remote"==c)g.url+="/"+b+".do",$H.extend(g,d),this.ajax(g);else e[this._localMethodMap[b]](g);a.trigger("request",a,d)}});return c});
$Define("CM.AbstractManager",function(){var e=$H.createClass();$H.extend(e.prototype,{_types:{},_all:{},type:"manager",registerType:function(c,b){this._types[c]=b;b.prototype.xtype=c},getClass:function(c){return $H.isClass(c)?c:this._types[c]||$H.ns(c)},register:function(c){this._all[c.getId()]=c},unregister:function(c){var b=this._all,a=c.getId();b[a]==c&&delete b[a]},eachInEl:function(c,b){var a=this;c.find(".js-"+a.type).each(function(d,c){c=$(c);var g=c.attr("id");(g=a.get(g))&&b(g)})},generateId:function(c,
b){var a=$H.expando+"_"+this.type+"_"+(c||$H.Util.getUuid());if(!0!=b&&this._all[a])$D.error("id\u91cd\u590d:"+a);else return a},get:function(c){var b=this._all;return b[c]||b[this.generateId(c,!0)]}});return e});
$Define("CM.ViewManager","CM.AbstractManager",function(e){var c=$H.createClass();$H.inherit(c,e,{type:"view",initialize:function(){var b=this;$H.on("afterRender",function(a,d){b.afterRender(d)});$H.on("removeEl",function(a,d){b.destroy(d)})},afterRender:function(b){this.eachInEl(b,function(a){a.afterRender()})},destroy:function(b){this.eachInEl(b,function(a){a.destroy(!0)})}});$V=$H.getSingleton(c);return c});
$Define("CM.View",["CM.ViewManager","CM.AbstractEvents","B.Template"],function(e,c){var b=/^(<[a-zA-Z]+)/,a=/^[^>]+class=/,d=/(class=")/,f=c.derive({xtype:"View",_placeholder:'<script id="" type="text/x-placeholder">\x3c/script>',autoRender:!0,renderBy:"append",listeners:[],items:[],tmpl:'<div><%=this.findHtml(">*")%></div>',children:[],_customEvents:"beforeRender render afterRender beforeShow show afterShow beforeHide hide afterHide beforeUpdate update afterUpdate beforeDestroy destroy afterDestroy add remove".split(" "),
_defaultEvents:"mousedown mouseup mouseover mousemove mouseenter mouseleave dragstart drag dragenter dragleave dragover drop dragend touchstart touchmove touchend touchcancel keydown keyup keypress click dblclick focus focusin focusout contextmenu change submit".split(" "),_applyArray:function(a,b){var d=arguments,c=d.callee.caller,f=c.$owner.prototype;0==d.length?(d=c.arguments,d=$H.toArray(d),a=c.$name,b=d.shift()):d=$H.toArray(d,2);if($H.isArr(b)){for(var c=0,e=b.length;c<e;c++)f[a].apply(this,
[b[c]].concat(d));return!0}return!1},_parseListenEvents:function(a,b){var d=this;return d._parseEvents(b.name,function(c){b.name=c[0];2==c.length&&(b.handler=c[1]);d[a].call(d,b)})},initialize:function(a){if(!this.inited){this.manager=this.constructor.manager||$H.getSingleton(e);var b=this.tmpl;$H.isFunc(b)||(this.tmpl=this.constructor.prototype.tmpl=$H.tmpl(b));this.doConfig(a);this.init&&this.init(a);this.parseItems();!1!=this.autoRender&&this.render();this.manager.register(this);this.inited=!0}},
doConfig:function(a){var b=this;b.initParam=a;"string"==typeof a&&(a={text:a});var d=a||{};$H.extend(b,d,{notCover:function(a,g){var c=$H.contains(b._customEvents,a);if($H.contains(b._defaultEvents,a))return b.listeners.push({name:a,handler:d[a]}),!0;if(c)return b.on(a,d[a]),!0;if("defItem"==a)return b[a]=$H.extend(b[a],g),!0;if("listener"==a)return b.listeners=b.listeners.concat($H.isArr(g)?g:[g]),!0;if("items"==a)return b.add(g),!0;if("extCls"==a&&b[a])return b[a]+=" "+g,!0;if("xtype"==a)return"View"==
b[a]&&(b[a]="string"==typeof g?g:g.$ns),!0}});b.renderTo=d.renderTo?$(d.renderTo):$(document.body)},getEl:function(){return this._container},getId:function(){return this._id||(this._id=this.manager.generateId(this.cid))},initHtml:function(){return this.tmpl(this)},getHtml:function(){var g=this.getId(),c;c="visibility"==this.displayMode?"visibility:hidden;":"display:none;";var f=this.initHtml(),e=a.test(f),m="js-"+this.manager.type+" js-"+this.xtype+" "+this.extCls+" ";e&&(f=f.replace(d,"$1"+m));return f=
f.replace(b,'$1 id="'+g+'" style="'+c+'"'+(e?"":' class="'+m+'"'))},findHtml:function(a){a=this.find(a);for(var b=[],d=0;d<a.length;d++)b.push(a[d].getHtml());return b.join("")},initStyle:function(){var a=this.getEl(),b=this.style||{};void 0!=this.width&&(b.width=this.width);void 0!=this.height&&(b.height=this.height);a.css(b)},beforeRender:function(){return this.trigger("beforeRender")},render:function(){if(!1==this.beforeRender())return!1;this.trigger("render");var a=this.getHtml();this.renderTo[this.renderBy](a);
this.afterRender()},afterRender:function(){if(this.rendered)return!1;this.callChild();this._container=$("#"+this.getId());this.rendered=!0;this.initStyle();!0!=this.notListen&&this.initListeners();this.disabled&&this.disable();this.trigger("afterRender");this.hidden||this.show()},beforeShow:function(){return this.trigger("beforeShow")},show:function(a,b){var d=this;if(!1==d.beforeShow()||d.showed||b&&d.hidden)return!1;if(!a&&d.delayShow)setTimeout(function(){f.prototype.show.call(d,!0)},0);else{d.trigger("show");
d.showed=!0;var c=d.getEl();"visibility"==d.displayMode?c.css({visibility:"visible"}):c.show();d.callChild([null,!0]);d.afterShow()}},afterShow:function(){this.trigger("afterShow")},beforeHide:function(){return this.trigger("beforeHide")},hide:function(){if(!1==this.beforeHide()||!this.showed)return!1;this.showed=!1;var a=this.getEl();"visibility"==this.displayMode?a.css({visibility:"hidden"}):a.hide();this.trigger("hide");this.afterHide()},afterHide:function(){this.trigger("afterHide")},enable:function(){this.resume();
this.getEl().removeClass("hui-disable").find("input,textarea,select").removeAttr("disabled")},disable:function(){this.suspend();this.getEl().addClass("hui-disable").find("input,textarea,select").attr("disabled","disabled")},getContent:function(a,b){b?!b instanceof f&&(b=this.find(b)[0]):b=this;return!1==a?b.children:b.getEl().html()},setContent:function(a,b){if(b)return!b instanceof f&&(b=this.find(b)[0]),b.setContent(a);var d=this.getEl();d.contents().remove();if("string"==typeof a)d.html(a);else return this.add(a)},
listen:function(a){if(!this._parseListenEvents("listen",a)){var b=a.name,d=a.context,c=a.times,f=a.target,e=a.custom,l=a.handler;$H.isFunc(f)&&(f=f.call(this));if(f||e)a=$H.removeUndefined([f,b,l,d,c]),this[e?"on":"listenTo"].apply(this,a);else{var e=this._listeners,c=a.el,f=a.method||"bind",q=a.selector,t=a.data,d=a.delegation=this._delegateHandler(l,d);$H.isFunc(c)&&(c=c.call(this));$H.mobile()&&"click"==b&&(b="touchend");c=c?"string"==typeof c?this.findEl(c):c:this.getEl();if(q)if(t)c[f](q,b,t,
d);else c[f](q,b,d);else if(t)c[f](b,t,d);else c[f](b,d);e.push(a)}}},unlisten:function(a){if(!this._parseListenEvents("unlisten",a)){var b=a.name,d=a.handler;if(a.custom)this.off(b,d);else{var c=a.el,f="delegate"==a.method?"undelegate":"unbind";a=a.selector;var e;$H.mobile()&&"click"==b&&(b="touchend");for(var c=c?"string"==typeof c?this.findEl(c):c:this.getEl(),l=this._listeners.length-1;0<=l;l--){var q=this._listeners[l];if(q.handler==d){e=q.delegation;this._listeners.splice(l,1);break}}if(a)c[f](a,
b,e);else c[f](b,e)}}},initListeners:function(){if(this.listened)return!1;this.listened=!0;var a=this.listeners;this._listeners=[];for(var b=a.length-1;0<=b;b--)this.listen(a[b]);this.callChild()},clearListeners:function(){for(var a=this._listeners,b=a.length-1;0<=b;b--)this.unlisten(a[b]);this.off("all");this.unlistenTo("all");this.callChild()},suspend:function(){if(this.isSuspend)return!1;this.isSuspend=!0;this.callChild()},resume:function(){if(!this.isSuspend)return!1;this.isSuspend=!1;this.callChild()},
findEl:function(a){return this.getEl().find(a)},parentsEl:function(a){return this.getEl().parents(a)},each:function(a,b){for(var d=this.children,c=d.length,f,e=0;e<c;){f=d[e];f=b?a.apply(f,b):a(e,f);if(!1===f)break;c==d.length?e++:c=d.length}},match:function(a,b){if("*"==a)return!0;var d=b||this,c,f,e;a=a.replace(/#([^\s,\[]+)/,"[cid=$1]");a=a.replace(/^([^\[]+)/,"[xtype=$1]");for(var l=/\[([^=|\!]+)(=|\!=)([^=]+)\]/g;c=l.exec(a);){f=c[1];e=c[2];c=c[3];if("false"==c||"true"==c)c=eval(c);if("="===
e?d[f]!=c:d[f]==c)return!1}return!0},find:function(a,b){var d=this;b=b||[];if($H.isNum(a))b.push(d.children[a]);else if($H.isStr(a)){if(0<a.indexOf(","))return $H.each(a.split(","),function(a,c){b=b.concat(d.find(c))}),b;var c=0==a.indexOf(">"),f=a.replace(/^>?\s?/,""),e=f.search(/\s|>/),l;0<e&&(l=f.substring(e),f=f.substring(0,e));d.each(function(d,e){e.match(f)&&(l?e.find(l,b):b.push(e));c||e.find(a,b)})}else $H.isFunc(a)&&d.each(function(d,c){a(c)&&b.push(c);c.find(a,b)});return b},parents:function(a){for(var b=
this;b.parent;)if(b=b.parent,a&&this.match(a,b))return b;return a||b===this?null:b},index:function(){var a=this,b=a.parent;if(b){var d;b.each(function(b,c){if(c==a)return d=b,!1});return d}return null},callChild:function(a,b){0!=this.children.length&&(a&&"string"!=typeof a&&(b=a,a=null),a=a||arguments.callee.caller.$name,this.each(function(d,c){b?c[a].apply(c,b):c[a].call(c)}))},add:function(a,b){if(!this._applyArray()){var c=void 0==b;if(this.startParseItems){if(a instanceof f)a.parent=this;else{this.defItem&&
$H.extend(a,this.defItem,{notCover:!0});this.parseItem(a);var d=this.manager.getClass(a.xtype);d?(a.renderTo||(this.inited?a.renderTo=this.getEl():a.autoRender=!1),a.parent=this,a=new d(a)):$D.error("xtype:"+a.xtype+"\u672a\u627e\u5230")}d=this.children;c?d.push(a):d.splice(b,0,a);this.trigger("add",a);return a}d=this.items;c?d.push(a):d.splice(b,0,a)}},remove:function(a){if(!this._applyArray()){var b=this.children,d=!1,c;if($H.isNum(a))c=a,a=b[c];else if($H.isStr(a)||$H.isFunc(a)){a=this.find(a);
for(var e=0,n=a.length;e<n;e++){if(!1==this.remove(a[e]))return!1;d=!0}}else if(a instanceof f)if(a.parent==this){e=0;for(n=b.length;e<n;e++)if(b[e]==a){c=e;break}}else return a.parent.remove(a);void 0!=c&&!1!=a.destroy(!0)&&(b.splice(c,1),d=!0);this.trigger("remove",a);return d}},parseItem:function(){},parseItems:function(){this.startParseItems=!0;var a=this.items;if(a)for(var a=$H.isArr(a)?a:[a],b=0,d=a.length;b<d;b++)this.add(a[b])},beforeUpdate:function(){return this.trigger("beforeUpdate")},
update:function(a){if(!1==this.beforeUpdate())return!1;var b=this.parent,d=$("<span></span>").insertBefore(this.getEl());a=$H.extend(a||this.initParam,{xtype:this.xtype,renderBy:"replaceWith",renderTo:d});if(!a.cid||a.cid==this.cid)a._id=this._id;if(b){var c=this.index();if(!1==b.remove(this))return d.remove(),!1;a=b.add(a,c)}else{if(!1==this.destroy())return d.remove(),!1;a=new this.constructor(a)}this.trigger("update",a);this.afterUpdate(a);return a},afterUpdate:function(a){this.trigger("afterUpdate",
a)},beforeDestroy:function(){return this.trigger("beforeDestroy")},destroy:function(a){if(!1==this.beforeDestroy())return!1;if(!this.destroyed)return this.callChild(),this.trigger("destroy"),this.clearListeners(),this.getEl().remove(),this.destroyed=!0,!a&&this.parent&&this.parent.remove(this),this.manager.unregister(this),delete this.initParam,delete this._container,delete this.renderTo,delete this._listeners,delete this.children,this.afterDestroy(),!0},afterDestroy:function(){this.trigger("afterDestroy")}},
{extend:function(a){var b=this.prototype;$H.extend(b,a,{notCover:function(d){if($H.contains(["_customEvents","listeners"],d))return b[d]=(a[d]||[]).concat(b[d]||[]),!0;if("xtype"==d||"constructor"==d)return!0}})},html:function(a){return(new this($H.extend({autoRender:!1},a))).getHtml()}});return f});
$Define("CM.Model",["CM.AbstractDao","CM.AbstractEvents"],function(e,c){return c.derive({idAttribute:"id",_pending:!1,_validate:function(b,a){if(!a.validate||!this.validate)return!0;b=$H.extend({},this._attributes,b);var d=this.validationError=this.validate(b,a)||null;if(!d)return!0;this.trigger("invalid",this,d,$H.extend(a,{validationError:d}));return!1},_initDepFields:function(){var b=this,a=b.fields,d,c;for(c in a)if(d=a[c],d=d.depends)for(var g=0;g<d.length;g++)b.on("change:"+d[g],function(){b.set(c)})},
_parseFields:function(b){var a;if(!(a=this.fields))return b;var d,c,g,e={},j;for(j in b){c=b[j];if(d=a[j]){g=$H.isObj(d)?d.type:d;if(d=d.parse)c=d.apply(this,[c,b]);$H.isStr(g)&&("Date"==g?c=$H.parseDate(c):0<g.indexOf(".")&&(g=$H.ns(g)));$H.isClass(g)&&!(c instanceof g)&&(c=new g(c),c.on("all",$H.bind(this._onAttrEvent,this,j)))}e[j]=c}return e},_onAttrEvent:function(b,a){if(!("invalid"==a||"sync"==a)){var c=this.get(b);0!=a.indexOf("change:")&&(this.trigger("change:"+b,this,c),this.trigger("change",
this))}},initialize:function(b,a){this.dao=this.dao||$H.getSingleton(e);this._initDepFields();var c=b||{};a||(a={});this.cid=$H.Util.getUuid();this._attributes={};a.collection&&(this.collection=a.collection);a.parse&&(c=this.parse(c,a)||{});c=$H.extend(c,$H.Util.result(this,"defaults"),{notCover:!0});this.set(c,a);this._changed={};$S.push(this)},toJSON:function(){return $H.clone(this._attributes)},sync:function(b,a,c){return this.dao.sync(b,a,c)},get:function(b){return this._attributes[b]},escape:function(b){return $H.String.escapeHTML(this.get(b))},
has:function(b){b=this.get(b);return null!=b&&void 0!=b},set:function(b,a,c){var f;"object"===typeof b?(f=b,c=a):(f={})[b]=a;c||(c={});f=this._parseFields(f);if(!this._validate(f,c))return!1;var g=c.unset;b=c.silent;var e=[],j=this._changing;this._changing=!0;j||(this._previousAttributes=$H.Object.clone(this._attributes),this._changed={});var k=this._attributes,m=this._previousAttributes;this.idAttribute in f&&(this.id=f[this.idAttribute]);for(var n in f)a=f[n],$H.equals(k[n],a)||e.push(n),$H.equals(m[n],
a)?delete this._changed[n]:this._changed[n]=a,g?delete k[n]:k[n]=a;if(!b){e.length&&(this._pending=c);a=0;for(f=e.length;a<f;a++)this.trigger("change:"+e[a],this,k[e[a]],c)}if(j)return this;if(!b)for(;this._pending;)c=this._pending,this._pending=!1,this.trigger("change",this,c);this._changing=this._pending=!1;return this},unset:function(b,a){a=a||{};a.unset=!0;return this.set(b,void 0,a)},clear:function(b){var a={},c;for(c in this._attributes)a[c]=void 0;b=b||{};b.unset=!0;return this.set(a,b)},hasChanged:function(b){var a=
this._changed;return null==b?!$H.isEmpty(a):$H.contains(a,b)},changedAttrbutes:function(b){if(!b)return this.hasChanged()?$H.clone(this._changed):!1;var a,c=!1,f=this._changing?this._previousAttributes:this._attributes,g;for(g in b)if(!$H.equals(f[g],a=b[g]))(c||(c={}))[g]=a;return c},previous:function(b){return null==b||!this._previousAttributes?null:this._previousAttributes[b]},fetch:function(b){var a=this;b=b?$H.clone(b):{};void 0===b.parse&&(b.parse=!0);var c=b.success;b.success=function(f){if(!a.set(a.parse(f,
b),b))return!1;c&&c(a,f,b);a.trigger("sync",a,f,b)};a.sync("read",a,b)},save:function(b,a,c){var f=this,g;null==b||"object"===typeof b?(g=b,c=a):(g={})[b]=a;c=$H.extend({validate:!0},c);if(g&&c.now){if(!f.set(g,c))return!1}else if(!f._validate(g,c))return!1;void 0===c.parse&&(c.parse=!0);var e=c.success;c.success=function(a){var b=f.parse(a,c);c.now||(b=$H.extend(g||{},b));if($H.isObj(b)&&!f.set(b,c))return!1;e&&e(f,a,c);f.trigger("sync",f,a,c)};b=f.isNew()?"create":c.update?"update":"patch";if("patch"===
b){a=f.changedAttrbutes(g);if(!a){e&&e(f,c);return}c.attrs=a}else a=$H.extend({},f._attributes),c.attrs=$H.extend(a,g);f.sync(b,f,c)},destroy:function(b){var a=this;b=b?$H.clone(b):{};var c=b.success,f=function(){a.trigger("destroy",a,a.collection,b);a.off("all")};b.success=function(g){(!b.now||a.isNew())&&f();c&&c(a,g,b);a.isNew()||a.trigger("sync",a,g,b)};if(a.isNew())return b.success(),!1;a.sync("delete",a,b);b.now&&f()},getUrl:function(){var b=$H.result(this,"url")||$H.result(this.collection,
"url");b||$D.error(Error("\u5fc5\u987b\u8bbe\u7f6e\u4e00\u4e2aurl\u5c5e\u6027\u6216\u8005\u51fd\u6570"));return this.isNew()?b:b.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(b){return b.code&&b.data?b.data:b},clone:function(){return new this.constructor(this._attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(b){return this._validate({},$H.extend(b||{},{validate:!0}))}})});
$Define("CM.Collection",["CM.AbstractDao","CM.AbstractEvents","CM.Model"],function(e,c,b){var a=c.derive({_reset:function(){this.length=0;this._models=[];this._byId={}},_prepareModel:function(a,c){if(a instanceof b)return a;c=c?$H.clone(c):{};c.collection=this;var d=$S.get(this.model.$ns,{id:c.id});if(d=d&&d[0])return d;d=new this.model(a,c);if(!d.validationError)return d;this.trigger("invalid",this,d.validationError,c);return!1},_addReference:function(a){this._byId[a.cid]=a;null!=a.id&&(this._byId[a.id]=
a);a.collection||(a.collection=this);a.on("all",this._onModelEvent,this)},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"===a||"remove"===a)&&c!==this||("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))},initialize:function(a,b){this.dao=this.dao||$H.getSingleton(e);b||(b=
{});b.model&&(this.model=b.model);b.url&&(this.url=b.url);void 0!==b.comparator&&(this.comparator=b.comparator);this._reset();a&&this.reset(a,$H.extend({silent:!0},b))},toJSON:function(a){return $H.map(this._models,function(b){return b.toJSON(a)})},sync:function(a,b,c){return this.dao.sync(a,b,c)},add:function(a,b){b=$H.extend({add:!0,remove:!1,merge:!1},b);return this.set(a,b)},remove:function(a,b){var c=!$H.isArr(a);a=c?[a]:$H.clone(a);b||(b={});var d,e,m,n;d=0;for(e=a.length;d<e;d++)if(n=a[d]=
this.get(a[d]))delete this._byId[n.id],delete this._byId[n.cid],m=this.indexOf(n),this._models.splice(m,1),this.length--,b.silent||(b.index=m,n.trigger("remove",n,this,b)),this._removeReference(n,b);return c?a[0]:a},set:function(a,c){c=$H.extend({add:!0,remove:!0,merge:!0},c);c.parse&&(a=this.parse(a,c));var d=!$H.isArr(a),e=d?a?[a]:[]:$H.clone(a),k,m,n,l,q,t,x,s=c.at,y=this.model,B=this.comparator&&null==s&&!1!==c.sort,C="string"==typeof this.comparator?this.comparator:null,A=[],r=[],u={},w=c.add,
z=c.merge,p=c.remove,v=!B&&w&&p?[]:!1;k=0;for(m=e.length;k<m;k++){q=e[k]||{};n=q instanceof b?l=q:q[y.prototype.idAttribute||"id"];if(t=this.get(n))p&&(u[t.cid]=!0),z&&(q=q===l?l.attributes:q,c.parse&&(q=t.parse(q,c)),t.set(q,c),B&&(!x&&t.hasChanged(C))&&(x=!0)),e[k]=t;else if(w){c.id=n;l=e[k]=this._prepareModel(q,c);if(!l)continue;A.push(l);this._addReference(l,c)}l=t||l;v&&(l.isNew()||!u[l.id])&&v.push(l);u[l.id]=!0}if(p){k=0;for(m=this.length;k<m;++k)u[(l=this._models[k]).cid]||r.push(l);r.length&&
this.remove(r,c)}if(A.length||v&&v.length)if(B&&(x=!0),this.length+=A.length,null!=s){k=0;for(m=A.length;k<m;k++)this._models.splice(s+k,0,A[k])}else{v&&(this._models.length=0);n=v||A;k=0;for(m=n.length;k<m;k++)this._models.push(n[k])}x&&this.sort({silent:!0});if(!c.silent){k=0;for(m=A.length;k<m;k++)(l=A[k]).trigger("add",l,this,c);(x||v&&v.length)&&this.trigger("sort",this,c)}return d?e[0]:e},reset:function(a,b){b||(b={});for(var c=0,d=this._models.length;c<d;c++)this._removeReference(this._models[c],
b);b.previousModels=this._models;this._reset();a=this.add(a,$H.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return a},push:function(a,b){return this.add(a,$H.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){return this.add(a,$H.extend({at:0},b))},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(){return Array.prototype.slice.apply(this._models,arguments)},get:function(a){return null==
a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},size:function(){return this.length},at:function(a){return this._models[a]},where:function(a,b){return $H.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){this.comparator||$D.error(Error("\u6ca1\u6709\u6bd4\u8f83\u5668"));a||(a={});"string"==typeof this.comparator||1===this.comparator.length?this._models=this.sortBy(this.comparator,
this):this._models.sort($H.Function.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},pluck:function(a){return $H.invoke(this._models,"get",a)},getUrl:function(){return this.url},fetch:function(a){var b=this;a=a?$H.clone(a):{};void 0===a.parse&&(a.parse=!0);var c=a.success;a.success=function(d){b[a.reset?"reset":"set"](d,a);c&&c(b,d,a);b.trigger("sync",b,d,a)};return b.sync("read",b,a)},create:function(a,b){var c=this;b=b?$H.clone(b):{};if(!(a=c._prepareModel(a,b)))return!1;
b.now&&c.add(a,b);var d=b.success;b.success=function(a,f){b.now||c.add(a,b);d&&d(a,f,b)};a.save(null,b);return a},parse:function(a){return a.data},clone:function(){return new this.constructor(this._models)}}),d=$H.Array;$H.each("map some every find filter invoke indexOf".split(" "),function(b,c){a.prototype[c]=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this._models);return d[c].apply(d,a)}});$H.each(["sortBy","groupBy","countBy"],function(b){a.prototype[b]=function(a,c){var e=
$H.isFunc(a)?a:function(b){return b.get(a)};return d[b](this._models,e,c)}});return a});$Define("C.ComponentManager",["CM.AbstractManager","CM.ViewManager"],function(e,c){var b=e.derive({type:"component",initialize:function(){var a=$H.getSingleton(c);this._types=a._types;this._all=a._all}});$CM=new b;return b});
$Define("C.AbstractComponent",["CM.ViewManager","CM.View"],function(e,c){$C=$H.ns("C",{});var b=$H.createClass();$H.inherit(b,c,{xtype:"AbstractComponent",activeCls:"hui-active",hasConfig:function(a,b){if(!b)return!1;if($H.isArr(b))for(var c=0,e=b.length;c<e;c++){if(this.match(a,b[c]))return!0}else if(this.match(a,b))return!0;return!1},doConfig:function(){this.callSuper();this.cls||(this.cls=this.xtype.toLowerCase());this.extCls=this.getExtCls();this.icon&&this.add({xtype:"Icon",name:this.icon});
this.isMini&&(this.defItem=$H.extend({isMini:!0},this.defItem))},getExtCls:function(){var a=["js-component","hui-"+this.cls];this.extCls&&a.push(this.extCls);this.theme&&a.push("hui-"+this.cls+"-"+this.theme);this.radius&&a.push("hui-radius-"+this.radius);this.isMini&&a.push("hui-mini");this.shadow&&a.push("hui-shadow");this.shadowSurround&&a.push("hui-shadow-surround");this.shadowOverlay&&a.push("hui-shadow-overlay");this.shadowInset&&a.push("hui-shadow-inset");this.isActive&&a.push(this.activeCls);
this.isFocus&&a.push("hui-focus");this.isInline&&a.push("hui-inline");return 0<a.length?a.join(" "):""},active:function(){this.getEl().addClass(this.activeCls)},unactive:function(){this.getEl().removeClass(this.activeCls)},txt:function(a){var b=this.findEl(".js-"+this.cls+"-txt");0==b.length&&(b=this.findEl(".hui-"+this.cls+"-txt"));if(void 0!=a)b.text(a);else return b.text()},valid:function(){var a=this.validator;if(a){var b=this.val();a.error||(a.error=function(a){new $C.Tips({text:a,theme:"error"})});
return a=$H.Validator.valid(b,a)}for(var b=this.children,c=0,e=b.length;c<e;c++)if(a=b[c].valid(),!a)return a;return!0}},{define:function(a,c){var f=$H.createClass();$H.inherit(f,c||b,null,null,{notCover:function(a){return"define"==a}});$H.getSingleton(e).registerType(a,f);return $C[a]=f}});return b});$Define("C.Panel","C.AbstractComponent",function(e){e=e.define("Panel");e.extend({tmpl:['<div><%=this.content||this.findHtml(">*")%></div>']});return e});
$Define("C.Popup","C.AbstractComponent",function(e){e=e.define("Popup");var c=0,b;e.extend({delayShow:!0,clickHide:!0,showPos:"center",shadowOverlay:!0,tmpl:['<div><%=this.findHtml(">*")%></div>'],doConfig:function(){this.callSuper();this.clickHide&&this.listeners.push({name:"click",el:$(document),handler:function(){this.hide()}});$H.android()&&(this.listeners.push({name:"show",custom:!0,handler:function(){!0!=$H.Events.trigger("component.popup.show")&&$("input,textarea,select").attr("disabled","disabled")}}),
this.listeners.push({name:"hide",custom:!0,handler:function(){!0!=$H.Events.trigger("component.popup.hide")&&setTimeout(function(){$("input,textarea,select").removeAttr("disabled")},500)}}))},afterShow:function(){var a=this,b=a.getEl();b.css("z-index",1E3*c+1E3);if(!a.width&&a.parent){var f=a.width=a.parent.getEl().outerWidth();b.css("width",f)}b=a.showPos;if("string"==typeof b)a[b]();else"function"==typeof b&&b.call(a);a.noMask||a.mask();a.timeout&&setTimeout(function(){a.destroyed||a.hide()},a.timeout)},
hide:function(){!1!=this.callSuper()&&(this.noMask||this.unmask(),this.notDestroy||this.destroy())},center:function(){var a=this.getEl(),b=this.width||a.width(),c=this.height||a.height(),e=document,b=((e.documentElement.offsetWidth||e.body.offsetWidth)-b)/2,c=((e.documentElement.clientHeight||e.body.clientHeight)-c)/2+(e.documentElement.scrollTop||e.body.scrollTop),c=10>c?window.screen.height/2-200:c;a.css({left:b+"px",top:c-(this.offsetTop||0)+"px"})},followEl:function(a){a=(a||this.parent.getEl()).position();
this.getEl().css(a)},mask:function(){b||(b=$('<div class="hui-mask" style="display:none;"></div>').appendTo(document.body));b.css("z-index",1E3*c+998);0==c&&b.show();c++},unmask:function(){c--;0==c?b.hide():b.css("z-index",1E3*(c-1)+998)}});return e});
$Define("C.ControlGroup","C.AbstractComponent",function(e){e=e.define("ControlGroup");e.extend({multi:!1,cls:"ctrlgp",defItem:{xtype:"Button",extCls:"js-item",radius:null,shadow:!1,isInline:!1},tmpl:['<div class="<%if(this.direction=="h"){%> hui-ctrlgp-h<%}else{%> hui-ctrlgp-v<%}%>">','<%=this.findHtml(">*")%>',"</div>"],listeners:[{name:"click",selector:".js-item",method:"delegate",handler:function(c){var b=$(c.currentTarget),b=this.find(">[_id="+b.attr("id")+"]");0<b.length&&(b=b[0].index(),this.onItemClick(c,
b))}}],select:function(c){if(!this.notSelect&&(c="number"==typeof c?this.children[c]:"string"==typeof c?this.find(c)[0]:c))if(!this.multi&&!c.multi){var b=this.getSelected();b&&this.selectItem(b,!1);this.selectItem(c)}else this.selectItem(c,!c.selected)},getSelected:function(c){var b=[];this.each(function(a,d){d.selected&&b.push(c?a:d)});return 0<b.length?this.multi?b:b[0]:null},selectItem:function(c,b){(b=!1!=b)?(c.selected=b,c.select?c.select():c.active()):(c.selected=b,c.select?c.select(b):c.unactive())},
val:function(c){if(c){var b=c.split(",");this.each(function(a,c){c.select($H.contains(b,c.value))})}else return c=this.find(">[selected=true]"),b=[],$H.each(c,function(a,c){b.push(c.value)}),b.join(",")},onItemClick:function(c,b){this.select(b);this.itemClick&&this.itemClick(this.children[b],b)}});return e});
$Define("C.Icon","C.AbstractComponent",function(e){e=e.define("Icon");e.extend({tmpl:'<span class=";<%if(this.isAlt){%>; hui-alt-icon;<%}%>; hui-icon-<%=this.name%>;<%if(!this.noBg){%>; hui-icon-bg;<%}%>"></span>'.split(";"),doConfig:function(c){$H.isStr(c)&&(c={name:c});this.callSuper([c])}});return e});
$Define("C.Button","C.AbstractComponent",function(e){e=e.define("Button");e.extend({iconPos:"left",theme:"gray",activeCls:"hui-btn-active",cls:"btn",defItem:{xtype:"Icon"},radius:"normal",shadow:!0,isInline:!0,tmpl:'<a href="javascript:;" hidefocus="true" class=",<%if(!this.text){%> hui-btn-icon-notxt<%},if(this.isBack){%> hui-btn-back<%},if(this.hasIcon&&this.text){%> hui-btn-icon-<%=this.iconPos%><%}%>">,<span class="hui-btn-txt"><%=this.text%></span>,<%=this.findHtml(">*")%>,</a>'.split(","),parseItem:function(c){"Icon"==
c.xtype&&(this.hasIcon=!0)}});return e});
$Define("C.Radio","C.AbstractComponent",function(e){e=e.define("Radio");e.extend({tmpl:'<div class="hui-btn hui-btn-gray<%if(this.selected){%> hui-radio-on<%}%>">;<span class="hui-icon hui-icon-radio"></span>;<input type="radio"<%if(this.selected){%> checked=true<%}%>;<%if(this.name){%> name="<%=this.name%>"<%}%>;<%if(this.value){%> value="<%=this.value%>"<%}%>/>;<span class="hui-radio-txt"><%=this.text%></span>;</div>'.split(";"),select:function(c){this.selected=c=!1!=c;var b=this.findEl("input"),
a=this.getEl();c?(b.attr("checked",!0),a.addClass("hui-radio-on")):(b.removeAttr("checked"),a.removeClass("hui-radio-on"))},val:function(c){if(c)this.value=c,this.findEl("input").val(c);else return this.value}});return e});
$Define("C.Checkbox","C.AbstractComponent",function(e){e=e.define("Checkbox");e.extend({text:"",value:"",selected:!1,multi:!0,cls:"chkbox",tmpl:'<div class="hui-btn hui-btn-gray<%if(this.selected){%> hui-chkbox-on<%}%>">;<span class="hui-icon hui-icon-chkbox"></span>;<input type="checkbox"<%if(this.selected){%> checked=true<%}%>;<%if(this.name){%> name="<%=this.name%>"<%}%>;<%if(this.value){%> value="<%=this.value%>"<%}%>/>;<span class="hui-chkbox-txt"><%=this.text%></span>;</div>'.split(";"),select:function(c){this.selected=
c=!1!=c;var b=this.findEl("input"),a=this.getEl();c?(b.attr("checked",!0),a.addClass("hui-chkbox-on")):(b.removeAttr("checked"),a.removeClass("hui-chkbox-on"))},val:function(c){if(c)this.value=c,this.findEl("input").val(c);else return this.value}});return e});
$Define("C.Select","C.AbstractComponent",function(e){e=e.define("Select");e.extend({text:"\u8bf7\u9009\u62e9...",value:"",radius:"little",optionClick:function(){},defItem:{xtype:"Menu",hidden:!0,markType:"dot",renderTo:"body"},_customEvents:["change"],tmpl:['<div class="hui-btn hui-btn-gray hui-btn-icon-right">','<span class="hui-icon hui-alt-icon hui-icon-carat-d hui-light"></span>','<input value="<%=this.value%>" name="<%=this.name%>"/>','<span class="hui-btn-txt js-select-txt"><%=this.text%></span>',
"</div>"],listeners:[{name:"click",handler:function(){this.showOptions()}}],doConfig:function(c){var b=this;b.callSuper();for(var a=c.options,d=!1,e=0,g=a.length;e<g;e++){var h=a[e];if(h.value==c.value){b.text=h.text;d=h.selected=!0;break}}d||delete b.value;b.add({itemClick:function(a){b.val(a.value)},width:b.width,items:a})},showOptions:function(){this.children[0].show()},val:function(c){if(c){if(this.value!=c){var b=this.children[0],a=b.find(">[value="+c+"]");0<a.length&&(this.trigger("change"),
a=a[0],this.value=c,this.findEl("input").attr("value",c),this.txt(a.text),b.select(a))}}else return this.value}});return e});
$Define("C.Input","C.AbstractComponent",function(e){e=e.define("Input");e.extend({radius:"little",iconPos:"left",btnPos:"right",tmpl:'<div class=";<%if(this.hasIcon){%>; hui-input-icon-<%=this.iconPos%>;<%}%>;<%if(this.hasBtn){%>; hui-input-btn-<%=this.btnPos%>;<%}%>">;<%=this.findHtml(">*")%>;<%if(this.type=="textarea"){%>;<textarea class="js-input";<%}else{%>;<input type="text" class="js-input hui-input-txt";<%}%> ; name="<%=this.name%>";<%if(this.placeholder){%>; placeholder="<%=this.placeholder%>";<%}%>;<%if(this.type=="textarea"){%>;><%=this.value%></textarea>;<%}else{%>; value="<%=this.value%>"/>;<%}%> ;</div>'.split(";"),listeners:[{name:"focus",
el:".js-input",handler:function(){this.getEl().addClass("hui-focus")}},{name:"blur",el:".js-input",handler:function(){this.getEl().removeClass("hui-focus")}}],doConfig:function(){var c=this;c.callSuper();"search"==c.type?c.icon="search":"textarea"==c.type&&c.listeners.push({name:"input propertychange",el:".js-input",handler:function(){var b=c.findEl(".js-input"),a=b[0].scrollHeight;50<=a&&b.css("height",a)}});c.withClear&&c.add({xtype:"Button",radius:"big",icon:"delete",click:function(){this.parent.findEl("input").val("").focus()}})},
parseItem:function(c){"Icon"==c.xtype?this.hasIcon=!0:"Button"==c.xtype&&(this.hasBtn=!0)},val:function(c){var b=this.findEl("input,textarea");if(c)b.val(c);else return b.val()},focus:function(){this.findEl("input").focus()}});return e});
$Define("C.Label","C.AbstractComponent",function(e){e=e.define("Label");e.extend({tmpl:['<label class="','<%if(this.color){%> hui-label-<%=this.color%><%}%><%if(this.textAlign){%> c-txt-<%=this.textAlign%><%}%>" for="<%=this.forName%>">',"<%=this.text%>","</label>"]});return e});
$Define("C.RowItem","C.AbstractComponent",function(e){e=e.define("RowItem");e.extend({cls:"rowitem",tmpl:'<div class="<%if(this.text){%> hui-rowitem-txt<%}%><%if(this.underline){%> hui-rowitem-underline<%}%>">,<%=this.text%>,<%=this.findHtml(">*")%>,<%if(this.hasArrow){%>,<a href="javascript:;" hidefocus="true" class="hui-click-arrow" title="\u8be6\u60c5"><span class="hui-icon hui-alt-icon hui-icon-carat-r hui-light"></span></a>,<%}%>,</div>'.split(","),doConfig:function(c){this.callSuper();this.text&&
void 0==this.underline&&(this.underline=!0);c.click&&void 0==this.hasArrow&&(this.hasArrow=!0)}});return e});$Define("C.Set","C.AbstractComponent",function(e){e=e.define("Set");e.extend({tmpl:'<div>;<h1 class="hui-set-title"><%=this.title%></h1>;<div class="hui-set-content">;<%=this.findHtml(">*")%>;</div>;</div>'.split(";")});return e});
$Define("C.Field","C.AbstractComponent",function(e){e=e.define("Field");e.extend({defItem:{xtype:"RowItem",xrole:"content"},tmpl:'<div class="<%if(this.noPadding){%> hui-field-nopadding<%}%>">;<div class="hui-field-left">;<%=this.findHtml(">[xrole=title]")%>;</div>;<div class="hui-field-right">;<%=this.findHtml(">[xrole=content]")%>;</div>;</div>'.split(";"),doConfig:function(c){this.callSuper();var b=this.title;$H.isSimple(b)&&(b={text:b});b=$H.extend({xtype:"Label",xrole:"title"},b);this.add(b);
b=this.content;void 0==b&&!c.items&&(b="");$H.isSimple(b)&&(b={text:b,underline:!0});b&&(this.noPadding=!0,this.add(b))}});return e});$Define("C.Form","C.AbstractComponent",function(e){e=e.define("Form");e.extend({tmpl:'<div>;<form action="">;<div class="hui-form-tips c-error"></div>;<%=this.findHtml(">*")%>;</form>;</div>'.split(";")});return e});
$Define("C.TabItem",["C.AbstractComponent","C.Panel"],function(e){e=e.define("TabItem");e.extend({defItem:{xtype:"Button",xrole:"title",radius:null,isInline:!1,iconPos:"top",shadow:!1},extCls:"js-item",tmpl:['<div><%=this.findHtml(">[xrole=title]")%></div>'],initialize:function(){this.callSuper();this.titleCmp=this.find(">[xrole=title]")[0];this.contentCmp=this.find(">[xrole=content]")[0]},doConfig:function(c){this.callSuper();var b=c.title;"string"==typeof b&&(b={text:b});"object"==typeof b&&this.add(b);
c=c.content;"string"==typeof c&&(c={xtype:"Panel",content:c});"object"==typeof c&&($H.extend(c,{xrole:"content",hidden:!this.selected,extCls:"js-content"}),this.add(c));this.activeType&&(this.defItem.activeCls="hui-btn-active-"+this.activeType)},parseItem:function(c){this.selected&&"title"==c.xrole&&(c.isActive=!0)},select:function(c){var b=this.titleCmp,a=this.contentCmp;!1==c?(b.unactive(),a&&a.hide()):(b.active(),a&&a.show())},getContent:function(c,b){b||(b=this.contentCmp);return this.callSuper([c,
b])},setContent:function(c,b){b||(b=this.contentCmp);return this.callSuper([c,b])}});return e});
$Define("C.Tab",["C.AbstractComponent","C.TabItem","C.ControlGroup"],function(e,c,b){e=e.define("Tab",b);e.extend({cls:"tab",defItem:{xtype:"TabItem"},listeners:[{name:"afterRender add remove",custom:!0,handler:function(){this.layout()}}],tmpl:["<div>",'<ul class="js-tab-btns c-clear">','<%var aBtns=this.find(">TabItem");',"for(var i=0,len=aBtns.length;i<len;i++){%>",'<li class="hui-tab-item">',"<%=aBtns[i].getHtml()%>","</li>","<%}%>","</ul>",'<%=this.findHtml(">TabItem>[xrole=content]")%>',"</div>"],
doConfig:function(){this.callSuper();this.activeType&&(this.defItem.activeType=this.activeType)},layout:function(){var a=this.children.length,b=Math.floor(100/a);this.findEl(".js-tab-btns>li").each(function(c,e){e.style.width=c<a-1?b+"%":100-b*(a-1)+"%"})},setTabContent:function(a,b){b=b||this.getSelected(!0);this.findEl(".js-tab-content").index(b).html(a)}});return e});
$Define("C.Toolbar","C.AbstractComponent",function(e){e=e.define("Toolbar");e.extend({cls:"tbar",defItem:{xtype:"Button",theme:"black"},tmpl:['<div class="<%if(this.type=="header"){%> hui-header<%}else if(this.type=="footer"){%> hui-footer<%}%>">','<%=this.findHtml(">*")%>','<%if(this.title){%><h1 class="hui-tbar-title js-tbar-txt"><%=this.title%></h1><%}%>',"</div>"],parseItem:function(c){"Button"==c.xtype&&(c.shadowSurround=!0,"left"==c.pos?c.extCls=(c.extCls||"")+" hui-tbar-btn-left":"right"==
c.pos&&(c.extCls=(c.extCls||"")+" hui-tbar-btn-right"))}});return e});$Define("C.Tips",["C.AbstractComponent","C.Popup","C.ControlGroup"],function(e,c){var b=e.define("Tips",c);b.extend({cls:"tips",theme:"black",timeout:1E3,radius:"normal",tmpl:['<div class="<%if(!this.text){%> hui-tips-notxt<%}%>">','<%=this.findHtml(">*")%>','<%if(this.text){%><span class="hui-tips-txt"><%=this.text%></span><%}%>',"</div>"]});return b});
$Define("C.Dialog",["C.AbstractComponent","C.Popup"],function(e,c){var b=e.define("Dialog",c);$H.extend(b,{alert:function(a){return new b({contentMsg:a,noClose:!0,noCancel:!0})},confirm:function(a,c){return new b({contentMsg:a,noClose:!0,okCall:function(){return c&&c(!0)},cancelCall:function(){return c&&c(!1)}})},prompt:function(a,c,e){e||(e=c,c="");return new b({contentMsg:a,noClose:!0,items:{xtype:"Input",xrole:"dialog-content",value:c},okCall:function(){var a=this.find("Input")[0].val();return e&&
e(a)}})}});b.extend({okTxt:"\u786e\u5b9a",cancelTxt:"\u53d6\u6d88",clickHide:!1,radius:"little",tmpl:'<div>;<%=this.findHtml(">[xrole=dialog-header]")%>;<div class="hui-dialog-body">;<%if(this.content){%><%=this.content%><%}else{%>;<div class="hui-body-content">;<h1 class="hui-content-title"><%=this.contentTitle%></h1>;<div class="hui-content-msg"><%=this.contentMsg%></div>;<%=this.findHtml(">[xrole=dialog-content]")%>;</div>;<%}%>;<%if(!this.noAction){%>;<div class="hui-body-action">;<%=this.findHtml(">[xrole=dialog-action]")%>;</div>;<%}%>;</div>;</div>'.split(";"),
doConfig:function(a){var b=this;b.callSuper();a=a.items;b.title&&!b.hasConfig("[xrole=dialog-header]",a)&&b.add({xtype:"Toolbar",title:b.title,theme:"gray",xrole:"dialog-header",extCls:"hui-dialog-header",items:!b.noClose&&{xtype:"Button",radius:"big",icon:"delete",isMini:!1,theme:"gray",pos:"left",click:function(){b.hide()}}});!b.noAction&&!b.hasConfig("[xrole=dialog-action]",a)&&(a=[],b.noCancel||a.push({title:{isActive:1==b.activeBtn,text:b.cancelTxt,click:function(){!1!=(b.cancelCall&&b.cancelCall())&&
b.hide()}}}),b.noOk||a.push({title:{text:b.okTxt,isActive:2==b.activeBtn,click:function(){!1!=(b.okCall&&b.okCall())&&b.hide()}}}),b.add({xtype:"Tab",xrole:"dialog-action",theme:"border-top",notSelect:!0,items:a}))}});return b});
$Define("C.Menu",["C.AbstractComponent","C.Popup","C.ControlGroup"],function(e,c,b){e=e.define("Menu",c);e.extend(b.prototype);e.extend({notDestroy:!0,cls:"menu",tmpl:['<div class="<%if(this.markType=="dot"){%> hui-menu-mark<%}%>">',"<ul>","<%for(var i=0,len=this.children.length;i<len;i++){%>",'<li class="hui-menu-item<%if(this.children[i].selected){%> hui-item-mark<%}%>">',"<%=this.children[i].getHtml()%>",'<%if(this.markType=="dot"){%><span class="hui-icon-mark"></span><%}%>',"</li>","<%}%>","</ul>",
"</div>"],selectItem:function(a,c){c=!1!=c;"dot"==this.markType?(a.selected=c,a.getEl().parent()[!1==c?"removeClass":"addClass"]("hui-item-mark")):"active"==this.markType?b.prototype.selectItem.call(this,a,c):a.selected=c}});return e});
$Define("C.Hcard","C.AbstractComponent",function(e){e=e.define("Hcard");e.extend({tmpl:'<div class="hui-hcard,<%if(this.image){%> hui-hcard-hasimg">,<div class="hui-hcard-img">,<img src="<%=this.image%>">,</div>,<%}else{%>,"><%}%>,<div class="hui-hcard-content">,<div class="hui-content-title"><%=this.title%></div>,<%var aDesc=this.desc;aDesc=$H.isArr(aDesc)?aDesc:[aDesc];for(var i=0;i<aDesc.length;i++){%>,<div class="hui-content-desc">,<%var icon;if(icon=aDesc[i].icon){%>,<span class="hui-icon hui-mini hui-alt-icon hui-icon-<%=icon%> hui-light"></span>,<%}%>,<%=aDesc[i].text%>,</div>,<%}%>,</div>,<%if(this.hasArrow){%>,<a href="javascript:;" hidefocus="true" class="hui-click-arrow" title="\u8be6\u60c5">,<span class="hui-icon hui-alt-icon hui-icon-carat-r hui-light"></span>,</a>,<%}%>,</div>'.split(","),doConfig:function(c){this.callSuper();
c.click&&void 0==this.hasArrow&&(this.hasArrow=!0)}});return e});
$Define("C.Vcard","C.AbstractComponent",function(e){e=e.define("Vcard");e.extend({tmpl:'<div class="hui-vcard">;<div class="hui-vcard-title hui-title-hasimg c-clear">;<div class="hui-title-img">;<img alt="" src="<%=this.image%>">;</div>;<div class="hui-title-txt"><%=this.title%></div>;<div class="hui-title-extra"><%=this.extraTitle%></div>;</div>;<%=this.findHtml(">[xrole!=action]")%>;<div class="hui-vcard-action">;<%=this.findHtml(">[xrole=action]")%>;</div>;</div>'.split(";"),doConfig:function(c){this.callSuper();
if(c=c.action)c=$H.extend({xtype:"Button",radius:null,isInline:!1,xrole:"action"},c),this.add(c)}});return e});$Define("C.List",["C.AbstractComponent","C.ControlGroup"],function(e,c){var b=e.define("List",c);b.extend({cls:"list",tmpl:["<div>",'<div class="hui-list-item c-clear">',"</div>","</div>"]});return b});
$Define("M.AbstractModule","CM.View",function(e){var c=$H.createClass();$H.inherit(c,e,{useCache:$H.noop,cache:$H.noop,init:$H.noop,reset:$H.noop,exit:function(){return!0},cleanCache:function(){this.clearCache=!0}});return c});$Define("M.AbstractNavigator","handy.base.Object",function(e){var c=$H.createClass();e.extend(c.prototype,{navigate:function(){}});return c});
$Define("M.History","handy.base.HashChange",function(e){var c=$H.createClass(),b=0;$H.extend(c.prototype,{initialize:function(a,b){"function"==typeof a&&(b=a,a=null);this.error=b||$H.noop;this.key=a||"handy";this.states=[];e.listen($H.Function.bind(this.stateChange,this))},stateChange:function(){var a=this.getHashParam(),b=a.hKey,c=this.currentKey,e=this.states,h=e[c];if(b==c)return!1;(e=e[b])?a=e.onStateChange(e.param,!0):($D.warn("hisory state not found"),a=this.error("stateNotFound",a));!0!=a?
(a={hKey:c,param:h.param},this.saveHash(a)):this.currentKey=b},saveState:function(a){var c=this.currentKey=this.key+ ++b;this.states.push(c);this.states[c]=a;this.saveHash({hKey:c,param:a.param})},saveHash:function(a){$H.setHash("#"+$H.Json.stringify(a))},getHashParam:function(){try{var a=$H.getHash().replace("#","");return $H.parseJson(a)}catch(b){$H.Debug.warn("History.getCurrentState:parse hash error:"+b.message)}},getCurrentState:function(){try{var a=this.getHashParam();return this.states[a.hKey]}catch(b){$H.Debug.warn("History.getCurrentState:parse hash error:"+
b.message)}},getPreState:function(){try{for(var a=this.getHashParam().hKey,b=this.states,c=b.length,e=0;e++;e<c)if(b[e]==a)return 0<e?b[b[--e]]:null}catch(h){$H.Debug.error("History.getPreState error:"+h.message,h)}},back:function(){var a=this.getPreState();if(a)a.onStateChange(a.param)}});return c});
$Define("M.ModuleManager",["M.History","CM.AbstractManager"],function(e,c){var b=$H.createClass();$H.inherit(b,c,{type:"module",_createMod:function(a){var b=this,c=a.modName;b.modules[c]={waiting:!0};$Require(b.defModPackage+c,function(e){var h={renderTo:b.container,name:c,xtype:c,_id:b.generateId(),extCls:"js-module m-module m-"+c.replace(/\./g,"-"),hidden:!0};$H.extend(h,a);e=new e(h);b.modules[c]=e;$H.trigger("afterRender",e.getEl());b.requestMod==c&&b._showMod(e)})},_showMod:function(a){var b=
this.modules[this.currentMod];if(!this.navigator||!this.navigator.navigate(a,b,this))b&&b.hide(),a.show();b&&(b.isActive=!1);a.isActive=!0;this.currentMod=a.name},_destroy:function(a){a.destroy();delete this.modules[a.name]},initialize:function(a){var b=this;a&&(b.conf=a,$H.extend(b,a),b.container=a.container?$(a.container):$(document.body));b.defModPackage+=".";b.history=new e(function(a,c){b.go(c.param)});b.modules={}},go:function(a,b){"string"==typeof a&&(a={modName:a});var c=a.modName,e=this.currentMod,
h=this.modules,j=h[e];if(e==c)j.waiting||j.reset();else{if(j&&!j.waiting)if(j._forceExit)j._forceExit=!1;else if(!1==j.exit())return!1;this.requestMod=c;(c=h[c])?!0!=c.notCache&&!0!=c.clearCache&&!1!=c.useCache(a)?(!1==c.clearCache,this._showMod(c),c.cache(a)):c.waiting||(this._destroy(c),this._createMod(a)):this._createMod(a);!0!=b&&this.history.saveState({onStateChange:$H.Function.bind(this.go,this),param:a});return!0}},update:function(a,b){var c=a.update(b);c&&(this.modules[a.name]=c,$H.trigger("afterRender",
c.getEl()))},clearCache:function(a){a.notCache=!0},back:function(a){a&&(this.modules[this.currentMod]._forceExit=!0);history.back()}});return b});
