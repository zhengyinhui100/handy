/* Handy v1.0.0-dev | 2014-05-22 | zhengyinhui100@gmail.com */
(function(){var f=window.handy,b=window.$,c=window.handy=window.$=function(){};c.version="1.0.0";c.isDebug="undefined"==typeof gEnv?!1:"dev"==gEnv;c.expando=("handy-"+c.version).replace(/\./g,"_");c.add=function(a,d,g){g||(g=d,d=null);c.base||(c.base={});var e=[];if(d)if("string"==typeof d)e.push(c.base.Object.ns(d));else for(var b=0;b<d.length;b++)e.push(c.base.Object.ns(d[b]));e.push(c);d=g.apply(window,e);c.base[a]=c[a]=d;if(0<="Browser,Class,Array,Geo,Cookie,Date,Events,Function,Json,Object,String,Template,Util".indexOf(a))for(var j in d)c.isDebug&&
("undefined"!=typeof c[j]&&"console"in window&&!Function[j])&&(console.log(c[j]),console.log(a+"\u547d\u540d\u51b2\u7a81:"+j)),c[j]=d[j]};c.noConflict=function(a){window.$===c&&(window.$=b);a&&window.handy===c&&(window.handy=f);return c};c.noop=function(){}})();
handy.add("Json",function(){function f(a){e.lastIndex=0;e.test(a)&&(a=a.replace(e,function(a){var e=h[a];return"string"===typeof e?e:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));return'"'+a+'"'}function b(e,c){var h,j,m,l,n=d,x,k=c[e];k&&("object"===typeof k&&"function"===typeof k.toJSON)&&(k=k.toJSON(e));"function"===typeof a&&(k=a.call(c,e,k));switch(typeof k){case "undefined":return"undefined";case "string":return f(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);
case "object":if(!k)return"null";d+=g;x=[];if("[object Array]"===Object.prototype.toString.apply(k)){l=k.length;for(h=0;h<l;h+=1)x[h]=b(h,k)||"null";m=0===x.length?"[]":d?"[\n"+d+x.join(",\n"+d)+"\n"+n+"]":"["+x.join(",")+"]";d=n;return m}if(a&&"object"===typeof a){l=a.length;for(h=0;h<l;h+=1)"string"===typeof a[h]&&(j=a[h],(m=b(j,k))&&x.push(f(j)+(d?": ":":")+m))}else for(j in k)Object.prototype.hasOwnProperty.call(k,j)&&(m=b(j,k))&&x.push(f(j)+(d?": ":":")+m);m=0===x.length?"{}":d?"{\n"+d+x.join(",\n"+
d)+"\n"+n+"}":"{"+x.join(",")+"}";d=n;return m}}var c="JSON"in window,a,d,g,e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m=/^[\],:{}\s]*$/,l=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,n=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
k=/(?:^|:|,)(?:\s*\[)+/g;return{stringify:function(e,h,j,f){if(c&&!f)return JSON.stringify.apply(null,arguments);var m;g=d="";if("number"===typeof j)for(m=0;m<j;m+=1)g+=" ";else"string"===typeof j&&(g=j);if((a=h)&&"function"!==typeof h&&("object"!==typeof h||"number"!==typeof h.length))$D.error(Error("Json.stringify:\u66ff\u6362\u53c2\u6570\u53ea\u80fd\u662f\u51fd\u6570\u6216\u8005\u6570\u7ec4"));else return b("",{"":e})},parseJson:function(a,e,d){function g(a,d){var b,c,h=a[d];if(h&&"object"===typeof h)for(b in h)Object.prototype.hasOwnProperty.call(h,
b)&&(c=g(h,b),void 0!==c?h[b]=c:delete h[b]);return e.call(a,d,h)}if(c&&!d)return JSON.parse.apply(null,arguments);var b;a=String(a);j.lastIndex=0;j.test(a)&&(a=a.replace(j,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(m.test(a.replace(l,"@").replace(n,"]").replace(k,"")))return b=eval("("+a+")"),"function"===typeof e?g({"":b},""):b;$D.error(new SyntaxError("JSON.parse"))}}});
handy.add("Object",function(){var f;f=(f=window.navigator.userAgent.match(/MSIE ([\d.]+)/))&&9>parseInt(f[0])?function(a,d,g){var e=[];if(a.length){d=d||0;for(g=g||a.length;d<g;d++)e.push(a[d])}return e}:function(a,d,g){return Array.prototype.slice.call(a,d||0,g||a.length)};var b={_alias:{B:"handy.base",C:"handy.component",M:"handy.module",CM:"handy.common"},ns:function(a,d){var g=null,e,c,j,f;a=b.alias(a);c=a.split(".");g=c[0];g=(j=2==arguments.length)?eval("(function(){if (typeof "+g+' == "undefined"){'+
g+" = {};}return "+g+";})()"):eval("(function(){if (typeof "+g+' != "undefined")return '+g+";})()");e=1;for(f=c.length;e<f;++e){if(e==f-1&&j)g[c[e]]=d;else if(j||g&&g[c[e]])g[c[e]]=g[c[e]]||{};else return;g=g[c[e]]}return g},alias:function(a,d){var g=b._alias;if(d)g[a]?$D.error("\u522b\u540d\u5df2\u88ab\u4f7f\u7528"+a+":"+g[a]):g[a]=d;else{if(a){var e=a,c=a.length-1;do{if(g[e])return g[e]+a.substring(c);c=e.lastIndexOf(".")}while(0<c&&(e=e.substring(0,c)));return a}return g}},extend:function(a,d,
g){if(!d||b.isStr(d)||b.isNum(d))return a;var e=g?g.notCover:!1,c=g?g.cover:null;g=g?g.IsClone:!1;a=a||{};var j=a.constructor,f=j.$isClass,l,n;for(n in d)if(l=d[n],(!c||b.contains(c,n))&&d.hasOwnProperty(n)){var k=a.hasOwnProperty(n),q=!0===e?k:!1;b.isArr(e)?q=b.contains(e,n)&&k:b.isFunc(e)&&(q=e(n,l));q||(l=g?b.clone(l):l,f&&b.isFunc(l)&&(l.$name=n,l.$owner=j),a[n]=l)}return a},extendIf:function(a,d){return b.extend(a,d,{notCover:!0})},mix:function(a,d,g){a.superProto||(a.superProto={});for(var e in d)a.superProto[e]=
b.isFunc(d[e])?a.superProto[e]?function(a,e){return function(){e.apply(this,arguments);d[a].apply(this,arguments)}}(e,a.superProto[e]):d[e]:d[e],a[e]||(a[e]=d[e]);g&&b.extend(a,g);d.toString!=d.constructor.prototype.toString&&(a.superProto.toString=function(){d.toString.apply(a,arguments)});return a},isNum:function(a){return"number"==typeof a},isStr:function(a){return"string"==typeof a},isBool:function(a){return"boolean"==typeof a},isSimple:function(a){return b.isStr(a)||b.isNum(a)||b.isBool(a)},
isUndef:function(a){return"undefined"==typeof a},isFunc:function(a){return"[object Function]"===c.prototype.toString.call(a)},isArr:function(a){return"[object Array]"===c.prototype.toString.call(a)},isObj:function(a){return"object"==typeof a&&!b.isArr(a)},isClass:function(a){return b.isFunc(a)&&!0===a.$isClass},equals:function(a,d){if(typeof a==typeof d){if("object"!=typeof a)return a===d;if(a===d)return!0;if(b.isArr(a)&&b.isArr(d)){if(a.length!=d.length)return!1;for(var g=0,e=a.length;g<e;g++)if(!b.equals(a[g],
d[g]))return!1;return!0}if(!b.isArr(a)&&!b.isArr(d)){if(b.count(a)!=b.count(d))return!1;for(g in a)if(void 0===d[g]||!b.equals(a[g],d[g]))return!1;return!0}}return!1},clone:function(a){if(null==a||"object"!=typeof a)return a;var d=a.constructor;if(d!=c&&d!=window.Array)return a;if(d==window.Date||d==window.RegExp||d==window.Function||d==window.String||d==window.Number||d==window.Boolean)return new d(a);try{var g=new d,e;for(e in a)g[e]=b.clone(a[e]);return g}catch(h){return a}},isEmpty:function(a){if(b.isArr(a))return 0==
a.length;for(var d in a)return!1;return!0},each:function(a,d,g){if(a){var e,c=0,j=a.length,f=void 0===j||b.isFunc(a);if(g)if(f)for(e in a){if(!1===d.apply(a[e],g))break}else for(;c<j&&!1!==d.apply(a[c],g);)e=a.length,j==e?c++:j=e;else if(f)for(e in a){if(!1===d.call(a[e],e,a[e]))break}else for(;c<j&&!1!==d.call(a[c],c,a[c]);)e=a.length,j==e?c++:j=e;return a}},contains:function(a,d){if(!a)return!1;var g=!1;b.each(a,function(a,c){if(b.equals(c,d))return g=!0,!1});return g},largeThan:function(a,d){if("object"==
typeof a&&"object"==typeof d){var g=!0;b.each(d,function(e){if(!b.equals(d[e],a[e]))return g=!1});return g}},count:function(a){if(b.isArr(a))return a.length;var d=0,g;for(g in a)d++;return d},removeUndefined:function(a,d){var g=b.isArr(a);if(d){if(g){var e=[];b.each(a,function(a,d){void 0!==d&&e.push(d)});return e}return b.extend({},a,{isClone:!0,notCover:function(a,e){return void 0===e}})}b.each(a,function(e,d){void 0===d&&(g?a.splice(e,1):delete a[e])});return a},toArray:f,fromArray:function(a){for(var d=
{},g=0,e=a.length;g<e;g++){var c=a[g];d[c.name]=c.value}return d},generateMethod:function(a,d,g){d=b.isArr(d)?d:d.split(",");for(var e=0;e<d.length;e++){var c=d[e];a[c]=g(c)}}},c=window.Object;return b});
handy.add("Browser","handy.base.Object",function(f){var b={},c={};f.generateMethod(c,"ie firefox chrome safari opera windows linux mac trident webkit gecko presto sogou maxthon tt theWorld is360 mobile android ios iPhone iPod iPad flash".split(" "),function(a){return function(e){var d=b[a];return!e&&"string"===typeof d&&/^[\d\.]+$/.test(d)?parseInt(d):d}});f=window.navigator.userAgent;var a;(a=f.match(/MSIE ([\d.]+)/))?b.ie=a[1]:(a=f.match(/Firefox\/([\d.]+)/))?b.firefox=a[1]:(a=f.match(/Chrome\/([\d.]+)/))?
b.chrome=a[1]:(a=f.match(/Opera.([\d.]+)/))?b.opera=a[1]:(a=f.match(/Version\/([\d.]+).*Safari/))?b.safari=a[1]:0;/windows|win32/i.test(f)?b.windows=!0:/linux/i.test(f)?b.linux=!0:/macintosh/i.test(f)?b.mac=!0:0;/trident/i.test(f)?b.trident=!0:/webkit/i.test(f)?b.webkit=!0:/gecko/i.test(f)?b.gecko=!0:/presto/i.test(f)?b.presto=!0:0;/MetaSr/i.test(f)?b.sogou=!0:/Maxthon/i.test(f)?b.maxthon=!0:/TencentTraveler/i.test(f)?b.tt=!0:/TheWorld/i.test(f)?b.theWorld=!0:/360[S|E]E/i.test(f)?b.is360=!0:0;var d;
if((d=f.match(/AppleWebKit\/([\d.]*)/))&&d[1])if(/ Mobile\//.test(f)&&f.match(/iPad|iPod|iPhone/)){b.mobile="ios";if((d=f.match(/OS ([^\s]*)/))&&d[1])b.ios=d[1].replace("_",".");if((d=f.match(/iPad|iPod|iPhone/))&&d[0])b[d[0].toLowerCase()]=b.ios}else if(/ Android/i.test(f)){if(/Mobile/.test(f)&&(b.mobile="android"),(d=f.match(/Android ([^\s]*);/))&&d[1])b.android=d[1]}else if(d=f.match(/NokiaN[^\/]*|Android \d\.\d|webOS\/\d\.\d/))b.mobile=d[0].toLowerCase();var g;try{if(b.ie){var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
e&&(g=e.getVariable("$version").split(" ")[1])}else if(navigator.plugins&&0<navigator.plugins.length&&(e=navigator.plugins["Shockwave Flash"])){var h=e.description.split(" ");a=0;for(var j=h.length;a<j;a++)if(0<parseInt(h[a])){g=h[a];break}}}catch(m){}b.flash=g?g:null;return c});
handy.add("Debug",["handy.base.Json","handy.base.Browser"],function(f,b,c){var a={level:c.isDebug?0:5,LOG_LEVEL:1,DEBUG_LEVEL:2,INFO_LEVEL:3,WARN_LEVEL:4,ERROR_LEVEL:5,showInPage:!("console"in window)||!!b.mobile(),out:function(d,g,e){e=e||"log";if(g||a.showInPage){var b=c.expando+"debugDiv",j=top.document,f=j.getElementById(b);f?f.style.display="block":(f=j.createElement("DIV"),f.id=b,f.innerHTML=['<a href="javascript:void(0)" onclick="this.parentNode.style.display=\'none\'">\u5173\u95ed</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onclick="this.parentNode.getElementsByTagName(\'DIV\')[0].innerHTML=\'\';">\u6e05\u7a7a</a>',
"<a href=\"javascript:void(0)\" onclick=\"if(this.innerHTML=='\u5168\u5c4f'){this.parentNode.style.height='"+j.body.offsetHeight+"px';this.innerHTML='\u6536\u8d77'}else{this.parentNode.style.height='100px';this.innerHTML='\u5168\u5c4f';}\">\u6536\u8d77</a>",'<a href="javascript:void(0)" onclick="var oDv=this.parentNode.getElementsByTagName(\'div\')[0];if(this.innerHTML==\'\u5e95\u90e8\'){oDv.scrollTop=oDv.scrollHeight;this.innerHTML=\'\u9876\u90e8\';}else{oDv.scrollTop=0;this.innerHTML=\'\u5e95\u90e8\';}">\u9876\u90e8</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onclick="location.reload();">\u5237\u65b0</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onclick="history.back();">\u540e\u9000</a>'].join("&nbsp;&nbsp;&nbsp;&nbsp;")+
'<div style="padding-top:5px;height:90%;overflow:auto;"></div>',f.style.position="fixed",f.style.width="100%",f.style.left=0,f.style.top=0,f.style.right=0,f.style.height="100%",f.style.backgroundColor="#aaa",f.style.fontSize="12px",f.style.padding="10px",f.style.zIndex=9999999999,f.style.opacity=0.95,f.style.filter="alpha(opacity=95)",j.body.appendChild(f));b=f.getElementsByTagName("DIV")[0];j="string"==typeof d?d:c.Json.stringify(d,null,"&nbsp;&nbsp;&nbsp;&nbsp;",!0);j=j.replace(/\n|\\n/g,"<br/>");
b.innerHTML+="<div"+("log"==e?"":' style="color:'+("error"==e?"red":"info"==e?"green":"yellow"))+'">'+e+":<br/>"+j+"</div><br/><br/>";b.scrollTop=b.scrollHeight}b=arguments.callee.caller;b.$owner||(b=b.caller);try{if(b.$owner)console[e]("["+b.$owner.$ns+"->"+b.$name+"]");console[e](d)}catch(l){}},log:function(d,g){a.level>a.LOG_LEVEL||a.out(d,!!g,"log")},info:function(d,g){this.level>a.INFO_LEVEL||a.out(d,!!g,"info")},warn:function(d,g){a.level>a.WARN_LEVEL||a.out(d,!!g,"warn")},error:function(d,
g){if(!(a.level>a.ERROR_LEVEL)&&(a.out(d,!!g,"error"),d instanceof Error))throw d;},time:function(d,g,e){a.level>a.INFO_LEVEL||(d?("boolean"==typeof g&&(e=g,g=""),a.out((g||"")+((new Date).getTime()-(a.lastTime||0)),!!e)):a.lastTime=(new Date).getTime())},debug:function(d){if(!(a.level>a.DEBUG_LEVEL)&&!1!==d)debugger}};return a});
handy.add("Function",function(f){return{bind:function(b,c,a){var d=Array.prototype.slice.call(arguments,2);return function(){var a=d.slice();Array.prototype.push.apply(a,arguments);return b.apply(c,a)}},intercept:function(b,c,a,d){return f.Object.isFunc(b)&&f.Object.isFunc(c)?function(){var g=a||this,e={},h=arguments;e.scope=d;e.target=g;e.method=b;return!1!=c.apply(e,h)?b.apply(g,h):!1}:b}}});
handy.add("Class",["B.Object","B.Debug"],function(f,b){var c={createClass:function(a){var d=function(){var a,e,c=arguments;if(this.constructor==d)a=this;else return a=c.callee,e=function(){},e.prototype=a.prototype,e=new e,a.apply(e,c),e;if(e=a.initialize)return e.apply(a,c)};d.$isClass=!0;d.derive=function(a,e,d){var b=c.createClass();c.inherit(b,this,a,e,d);return b};d.prototype.callSuper=function(a,e){a&&(!a.$isClass&&void 0!==a.length)&&(e=a,a=null);var d=arguments.callee.caller,c=d.$owner.superProto;
e=e||d.arguments;a=a?a.prototype:c||this.constructor.superProto;d=d.$name;if(a&&(d=a[d],f.isFunc(d)))return d.apply(this,e)};a&&this.ns(a,d);return d},inherit:function(a,d,c,e,h){var j=function(){};j.prototype=d.prototype;f.extend(a,d,h);a.prototype=new j;a.prototype.constructor=a;a.superClass=d;a.superProto=d.prototype;if(d._onInherit)try{d._onInherit(a)}catch(m){b.error(m)}e&&f.extend(a,e);c&&f.extend(a.prototype,c)},getSingleton:function(a){return(a="string"==typeof a?f.ns(a):a)&&(a.$singleton||
(a.$singleton=new a))}};return c});
handy.add("Loader",["B.Debug","B.Object","B.Function"],function(f,b,c,a){function d(a){var e={},d=[];"string"==typeof a&&(a=[a]);for(var c=0,g=a.length;c<g;c++){var h;h=a[c];h=/\.(css|js)$/.test(h)?s[h]&&"loaded"==s[h].status:p.urlMap&&p.urlMap[h]?p.urlMap[h].chkExist():b.ns(h);if(h)d.push(h);else return e.notExist=a[c],e}e.exist=d;return e}function g(a,d){function c(){c.isCalled||(c.isCalled=!0,clearTimeout(l),d())}if("SCRIPT"===a.nodeName){var g=a,b=c,h=function(){/loaded|complete|undefined/.test(g.readyState)&&(g.onload=
g.onerror=g.onreadystatechange=null,n.removeChild(g),g=null,setTimeout(b,0))};g.onload=g.onreadystatechange=h;g.onerror=function(){f.error(m+"load script error:\n"+g.src);h()}}else{var j=c;window.hasOwnProperty("attachEvent")?a.attachEvent("onload",j):setTimeout(function(){e(a,j)},0)}var l=setTimeout(function(){f.error("Time is out:"+a.src);c()},p.timeout)}function e(a,d){if(!d.isCalled){var c;if(k)a.sheet&&(c=!0);else if(a.sheet)try{a.sheet.cssRules&&(c=!0)}catch(g){if("SecurityError"===g.name||
"NS_ERROR_DOM_SECURITY_ERR"===g.name)c=!0}setTimeout(function(){c?d():e(a,d)},1)}}function h(a){p.showLoading(!1);v--;s[a].status="loaded";p.traceLog&&f.log(m+"Response:\n"+a);j()}function j(){for(var a=q.length-1;0<=a;a--){var e=q[a],c=d(e.deps);if(c.notExist)0==a&&0==v&&f.error(l+c.notExist);else{q.splice(a,1);e.callback.apply(null,c.exist);j();break}}}var m="[Handy Loader] ",l=m+"not found: ",n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,k=navigator.userAgent.indexOf("AppleWebKit"),
q=[],v=0,s={},p={traceLog:!1,timeout:15E3,skinName:"skin",showLoading:function(){},define:function(e,d,c){e=a.Object.alias(e);2==arguments.length&&(c=d,d=[]);p.require(d,function(){var a;if("function"==typeof c)try{p.traceLog&&f.log(m+"define:\n"+e),a=c.apply(null,arguments)}catch(d){d.message=m+e+":\nfactory define error:\n"+d.message;f.error(d);return}else a=c;if(a){b.ns(e,a);var g=typeof a;if("object"==g||"function"==g)a.$ns=e}else f.error(m+"factory no return:\n"+e)})},require:function(e,b){for(var j=
"string"==typeof e?[e]:e,k=[],A=[],t=!0,y=0,z=j.length;y<z;y++){var r=j[y],r=a.Object.alias(r),u=d(r);u.notExist?(k.push(r),t&&(t=!1,q.push({deps:j,callback:b})),p.traceLog&&f.log(l+r)):A.push(u.exist[0])}if(0==k.length)return b&&b.apply(null,A),1==A.length?A[0]:A;t=!1;j=0;for(A=k.length;j<A;j++)if(y=k[j],!s[y]){t=y;r=p.urlMap&&p.urlMap[t]&&p.urlMap[t].url;if(!r){z="";r=p.rootPath;if("string"==typeof r)z=r;else if("object"==typeof r)for(u in u=void 0,r)0==t.indexOf(u)&&(z=r[u],t=t.replace(u,""));
else z="";r=/.css$/.test(t)?0==t.indexOf("/")?t:"/css/"+t:/.js$/.test(t)?t:t.replace(/\./g,"/")+".js";r=z.replace(/\/$/,"")+"/"+r.replace(/^\//,"")}t=!0;s[y]={id:y,status:"loading"};z=c.bind(h,null,y);p.traceLog&&f.log(m+"request:\n"+r);if(/.css$/.test(r))a:{y=r;r=n.getElementsByTagName("link");for(u=0;u<r.length;u++){var w=r[u].href;!p.skinNode&&0<=w.indexOf(p.skinName)&&(p.skinNode=r[u]);if(0<=w.indexOf(y)||0<=y.indexOf(w))break a}r=document.createElement("link");r.rel="stylesheet";r.href=y;g(r,
z);p.skinNode?n.insertBefore(r,p.skinNode):n.appendChild(r)}else y=r,r=document.createElement("script"),r.async="async",r.src=y,r.type="text/javascript",g(r,z),n.appendChild(r);v++}t&&p.showLoading(!0)}};return p});
handy.add("Events",function(f){return{_eventCache:{},_execEvtCache:[],_parseEvents:function(b,c){var a=/\s+/;if("object"==typeof b){for(var d in b)c([d,b[d]]);return!0}if("string"==typeof b&&a.test(b)){a=b.split(a);d=0;for(var g=a.length;d<g;d++)c([a[d]]);return!0}return!1},_parseCustomEvents:function(b,c,a){var d=this,g=f.toArray(arguments,2);return d._parseEvents(c,function(a){d[b].apply(d,a.concat(g))})},_delegateHandler:function(b,c){var a=this;return function(){if(!0!=a.isSuspend)return b.apply(c||
a,arguments)}},_pushEvent:function(b){this._execEvtCache.push(b)},_execEvents:function(){var b=this,c,a=b._execEvtCache;f.each(a,function(d,g){a.splice(d,1);var e=g.delegation;"number"==typeof g.times&&(1<g.times?g.times--:b.off(g.name,g.handler));c=e.apply(b,g.args)});return c},on:function(b,c,a,d){if(!this._parseCustomEvents("on",b,c,a,d)){"number"==typeof a&&(d=a,a=null);var g=this._eventCache,e=g[b];e||(e=g[b]=[]);b=this._delegateHandler(c,a);e.push({times:d,handler:c,context:a,delegation:b})}},
once:function(b,c,a){var d=f.toArray(arguments);d.push(1);this.on.apply(this,d)},off:function(b,c){if("all"==b)return this._eventCache={},!0;if(!this._parseCustomEvents("off",b,c)){var a=this._eventCache,d=b.indexOf(".");if(!c&&0>=d){for(var g in a)(g.split(".")[0]==b||0==d&&0<=g.indexOf(b))&&delete a[g];return!0}d=a[b];if(!d)return!1;if(c){a=0;for(g=d.length;a<g;a++)if(d[a].handler==c)return d.splice(a,1),!0}else return delete a[b],!0;return!1}},suspend:function(){if(this.isSuspend)return!1;this.isSuspend=
!0},resume:function(){if(!this.isSuspend)return!1;this.isSuspend=!1},trigger:function(b,c){function a(a){if(a)for(var c=0,g=a.length;c<g;c++){var h=a[c];h.args=e;h.name=b;d._pushEvent(h)}}var d=this,g=f.toArray(arguments);g.unshift("trigger");if(!d._parseCustomEvents.apply(d,g)){var g=d._eventCache,e=f.toArray(arguments),h;if(0<b.indexOf("."))h=g[b],a(h);else for(var j in g)if(h=b.indexOf("."),j.split(".")[0]==b||0==h&&0<=j.indexOf(b))h=g[j],a(h);a(g.all);return d._execEvents()}}}});
handy.add("Date",function(){var f=window.Date,b={getWeek:function(a,d){var c=a.getDay();d&&(c=(c+(d%7+7))%7);return"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split("")[c]},isWeeken:function(a){return 0==a.getDay()||6==a.getDay()},getDaysInMonth:function(a){a=new f(a.getFullYear(),a.getMonth()+1,0);return a.getDate()},getDaysInYear:function(a){var d=new f(a.getFullYear(),0,0);a=new f(a.getFullYear()+1,0,0);return Math.floor((a.getTime()-d.getTime())/864E5)},getDayIndexOfYear:function(a){var d=new f("1/1/"+
a.getFullYear());return Math.ceil((a.getTime()-d.getTime())/864E5)},formatDate:function(a,d){d=d||"yyyy-MM-dd HH:mm:ss";var c=a.getHours(),e=Math.floor((a.getMonth()+3)/3),c={"y+":a.getFullYear(),"M+":a.getMonth()+1,"d+":a.getDate(),"h+":0==c%12?12:c%12,"H+":c,"m+":a.getMinutes(),"s+":a.getSeconds(),"w+":b.getWeek(a),"q+":e,"Q+":["\u4e00","\u4e8c","\u4e09","\u56db"][e-1],"S+":a.getMilliseconds()},h;for(h in c)RegExp("("+h+")").test(d)&&(e=RegExp.$1.length,d=d.replace(RegExp.$1,1==e?c[h]:("00"+c[h]).slice(-e)));
return d},parseDate:function(a,d){var c=typeof a,e=new f;if("number"==c)return e.setTime(a),e;if("string"!=c)return a;var c=(d||"yyyy-MM-dd HH:mm:ss").match(/[a-zA-Z]+/g),b=a.match(/\d+/g);if(b){for(var j=0;j<b.length;j++){var m=c[j],l=parseInt(b[j]);switch(m){case "yyyy":e.setFullYear(l);break;case "MM":e.setMonth(l-1);break;case "dd":e.setDate(l);break;case "HH":e.setHours(l);break;case "mm":e.setMinutes(l);break;case "ss":e.setSeconds(l);break;case "SS":e.setMilliseconds(l)}}return e}},now:function(a){var d=
new f;if(a)"number"!=typeof a&&(a=b.parseDate(a).getTime()),c=a-d.getTime();else return d.setTime(d.getTime()+c),d},howLong:function(a,d){if(a){var c=b.now().getTime()-a.getTime();if(!1!=d){var e;if(60>(c/=6E4))e="\u5206\u949f",c=c||1;else if(24>(c/=60))e="\u5c0f\u65f6";else if(30>(c/=24))e="\u5929";else return"30\u5929\u524d";c=(Math.floor(c)||1)+e+"\u524d"}return c}}},c=0;return b});
handy.add("String",function(){var f={stripTags:function(b){return b.replace(/<\/?[^>]+>/gi,"")},escapeHTML:function(b){if(!b)return b;var c=document.createElement("div");b=document.createTextNode(b);c.appendChild(b);return c.innerHTML},unescapeHTML:function(b){var c=document.createElement("div");c.innerHTML=f.stripTags(b);return c.childNodes[0].nodeValue},decodeHTML:function(b){b=b.replace(/&lt;/gi,"<");b=b.replace(/&gt;/gi,">");b=b.replace(/&quot;/gi,'"');b=b.replace(/&apos;/gi,"'");b=b.replace(/<\/?br>/gi,
"\n");b=b.replace(/&amp;/gi,"&");return b=b.replace(/&nbsp;/gi," ")},encodeHTML:function(b){b=b.replace(/&/gi,"&amp;");b=b.replace(/</gi,"&lt;");b=b.replace(/>/gi,"&gt;");b=b.replace(/\"/gi,"&quot;");b=b.replace(/\'/gi,"&apos;");b=b.replace(/\n/gi,"</br>");return b=b.replace(/ /gi,"&nbsp;")},trim:function(b){return b=b.replace(/(^(\s|\u3000)+)|((\s|\u3000)+$)/g,"")},check:function(b,c){c||(c=/[,%\'\"\/\\;|\<\>\^]/);return-1<b.search(c)},len:function(b){return b.replace(/[^\x00-\xff]/g,"**").length},
left:function(b,c,a){if(f.len(b)>c){!0===a?a=2:0<a||(a=0);var d=0,g=0;for(c-=a;g<c;)255<b.charCodeAt(d)?g+=2:g++,d++;b=b.substring(0,d);for(d=0;d<a;d++)b+="."}return b},isNumStr:function(b){return 0==b.search(/^\d+$/g)},hasChn:function(b){return/[\u4E00-\u9FA5]+/.test(b)},isChn:function(b){return/^[\u4E00-\u9FA5]+$/.test(b)},addParam:function(b,c){c&&(b+=(-1<b.indexOf("?")?"&":"?")+c);return b}};return f});
handy.add("Cookie",function(){return{getCookie:function(f,b){var c=f+"=",a="",d=document.cookie;if(0<d.length){var g=d.indexOf(c);-1!=g&&(g+=c.length,c=d.indexOf(";",g),-1==c&&(c=d.length),a=d.substring(g,c),b||(a=unescape(a)))}return a},setCookie:function(f,b,c){var a=[];void 0!==f&&void 0!==b&&a.push(f+"="+escape(b));c&&(void 0!==c.path&&a.push("path="+c.path),void 0!==c.domain&&a.push("domain="+c.domain),void 0!==c.expires&&a.push("expires="+c.expires),c.secure&&a.push("secure"));document.cookie=
a.join(";")},delCookie:function(f){var b=new Date;b.setTime(b.getTime()-1);document.cookie=f+"=;expires="+b.toGMTString()}}});
handy.add("Util","B.Object",function(f){var b=0;return{isWindow:function(c){return null!=c&&c==c.window},uuid:function(){return++b},getHash:function(){return top.location.hash.replace(/\?.*/,"")},setHash:function(c){var a=top.location.hash;0<=a.indexOf("#")&&(c=a.replace(/#[^\?]*/,c));top.location.hash=c},position:function(c){for(var a=0,d=0;c;)a+=c.offsetLeft,d+=c.offsetTop,c=c.offsetParent;return{top:d,left:a}},result:function(c,a){var d=c[a];return f.isFunc(d)?d():d}}});
handy.add("Array","B.Object",function(f,b){function c(a){return a}function a(a){return function(e){return e[a]}}function d(e){return null==e?c:b.isFunc(e)?e:a(e)}function g(a){return function(e){if(e===a)return!0;for(var d in a)if(a[d]!==e[d])return!1;return!0}}function e(a){return function(e,c,b){var g={};c=d(c);f.each(e,function(d,h){var f=c.call(b,h,d,e);a(g,f,h)});return g}}var h={map:function(a,e,d){var c=[];if(null==a)return c;var b=Array.prototype.map;if(b&&a.map===b)return a.map(e,d);f.each(a,
function(a,b){c.push(e.call(d,b,a))});return c},pluck:function(e,d){return this.map(e,a(d))},some:function(a,e,d){var c=!1;if(null==a||!e)return c;var g=Array.prototype.some;if(g&&a.some===g)return a.some(e,d);b.each(a,function(a,b,g){if(c||(c=e.call(d,b,a,g)))return!1});return!!c},every:function(a,e,d){var c=!0;if(null==a||!e)return c;var g=Array.prototype.every;if(g&&a.every===g)return a.every(e,d);b.each(a,function(a,b,g){if(!(c=e.call(d,b,a,g)))return!1});return!!c},indexOf:function(a,e,d){if(null==
a)return-1;var c=0,b=a.length;if(d)if("number"==typeof d)c=0>d?Math.max(0,b+d):d;else return c=h.sortedIndex(a,e),a[c]===e?c:-1;var g=Array.prototype.indexOf;if(g&&a.indexOf===g)return a.indexOf(e,d);for(;c<b;c++)if(a[c]===e)return c;return-1},find:function(a,e,d){var c;this.some(a,function(a,b,g){if(e.call(d,a,b,g))return c=a,!0});return c},filter:function(a,e,c){var d=[];if(null==a)return d;var g=Array.prototype.filter;if(g&&a.filter===g)return a.filter(e,c);b.each(a,function(a,b,g){e.call(c,b,
a,g)&&d.push(b)});return d},where:function(a,e){return this.filter(a,g(e))},findWhere:function(a,e){return this.find(a,g(e))},invoke:function(a,e){var d=Array.prototype.slice.call(arguments,2),c=f.isFunc(e);return this.map(a,function(a){return(c?e:a[e]).apply(a,d)})},sortedIndex:function(a,e,c,b){c=d(c);e=c.call(b,e);for(var g=0,h=a.length;g<h;){var f=g+h>>>1;c.call(b,a[f])<e?g=f+1:h=f}return g},sortBy:function(a,e,c){e=d(e);return this.pluck(this.map(a,function(a,d,b){return{value:a,index:d,criteria:e.call(c,
a,d,b)}}).sort(function(a,e){var c=a.criteria,d=e.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(c<d||void 0===d)return-1}return a.index-e.index}),"value")},groupBy:e(function(a,e,c){a[e]?a[e].push(c):a[e]=[c]}),countBy:e(function(a,e){a[e]?a[e]++:a[e]=1})};return h});
handy.add("Geo",function(f){return{distance:function(b,c,a){function d(a){a.get?a=[a.get("latitude"),a.get("longitude")]:f.isObj(a)&&(a=[a.latitude,a.longitude]);return a}var g,e;b=d(b);g=b[0];b=b[1];c=d(c);e=c[0];c=c[1];g=g*Math.PI/180;e=e*Math.PI/180;b=6371*Math.acos(Math.cos(e)*Math.cos(g)*Math.cos(b*Math.PI/180-c*Math.PI/180)+Math.sin(e)*Math.sin(g));b=b.toFixed(2);if(!1!=a){if(isNaN(b))return"\u672a\u77e5";b+="km"}return b}}});
handy.add("Template",["B.Object","B.String","B.Debug","B.Function"],function(f,b,c){function a(a){var e=typeof a;"string"!==e&&(a="number"===e?a+"":"");return a}function d(a,e){var c=e.fn,d="";if(a){if(void 0!==a.length)for(var b=0,g=a.length;b<g;b++)d+=c(a[b]);else for(b in a)d+=c(a[b]);return d}}function g(a,e){var c=e.fn,d=[];if(a){if(void 0!==a.length)for(var b=0,g=a.length;b<g;b++)d.push(c(a[b]));else for(b in a)d.push(c(a[b]));return d.join("")}}function e(a){a=a.replace(/("|\\)/g,"\\$1").replace(/\r/g,
"\\r").replace(/\n/g,"\\n");return q?"$r+="+('"'+a+'"')+";":"$r.push("+('"'+a+'"')+");"}function h(a,e){e=e||{};var c=a.exp.replace(/"/g,"'"),c=b.trim(c).replace(/\s{2,}/g," "),d=e.helpers,g=d&&d.parseValue,h=a.blockName,f=a.children,j=a.num,p,n="\nif($tmp||$tmp===0){"+(q?"$r+=$tmp;":"$r.push($tmp);")+"}";p=(a.inverse?"inverse:true,":"")+"num:"+j+',context:$me,exp:"'+c+'",helpers:$helpers,data:$data}';d=d&&d.getValue?'$helpers.getValue.call($me,"'+c+'",$data,{'+p+")":"($data&&$data."+c+")";h?(c="$program"+
j,p='$tmp = $helpers["'+h+'"].call($me,'+d+", {fn:"+c+","+p+");"+n,f&&(n=m(f,e),n=s[0]+"\n"+n.join("\n")+"\n"+s[1],k.splice(2,0,"\nfunction "+c+"($data){\n"+n+"\n}\n"))):((f=c.match(/([^\s]+)\s([^\n]+)/))?(c=f[1],p="if (helper = $helpers."+c+') {\n$tmp = helper.call($me,"'+f[2]+'",{'+p+'); \n}else{$tmp="";}'):p="if (helper = $helpers."+c+') {\n$tmp = helper.call($me,"",{'+p+"); \n}else{\nhelper = "+d+"; $tmp = typeof helper === functionType ? helper.call($me,{"+p+") : helper;\n}"+(g?"\n$tmp=$helpers.parseValue.call($me,$tmp,{"+
p+");":l.isEscape?"\n$tmp=escape($tmp);":""),p+=n);return p}function j(a,e){if(a){var d=e||{},b=l.openTag,g=l.closeTag,h,f;d.children?f=d.children:d.children=f=[];if(0<=(h=a.indexOf(b))){var m=a.substring(0,h);m&&f.push({html:m});a=a.substring(h+b.length);if(0==a.indexOf("#"))if(a=a.substring(1),m=a.match(/^[a-z]+/)){var p=m[0];h=a.indexOf(g);m=a.substring(p.length+1,h);a=a.substring(h+g.length);m={num:++v,blockName:p,exp:m};f.push(m);var k=b+"/"+p+g;a:{h=a;for(var g=RegExp(b+"[#/]"+p+"((?!"+g+").)*"+
g,"ig"),n=0;b=g.exec(h);)if(b[0]==k)if(0==n){h=b.index;break a}else n--;else n++;h=-1}if(-1==h){c.error("\u672a\u627e\u5230\u5757\u7ed3\u675f\u4f4d\u7f6e:"+k);return}b=a.substring(0,h);a=a.substring(h+k.length);j(b,m);if("if"==p){p=m.children;k=0;for(b=p.length;k<b;k++)g=p[k],"else"==g.exp&&(g.exp=m.exp,g.blockName="if",g.num=++v,g.inverse=!0,g.children=p.slice(k+1),f.push(g),m.children=p.slice(0,k))}}else{c.error("\u627e\u4e0d\u5230\u8f85\u52a9\u51fd\u6570:"+a);return}else h=a.indexOf(g),f.push({num:++v,
exp:a.substring(0,h)}),a=a.substring(h+g.length);j(a,d)}else a&&f.push({html:a});return d}}function m(a,c){var d=[];if(a)for(var b=0,g=a.length;b<g;b++){var f=a[b];f.html?d.push(e(f.html)):f.exp&&d.push(h(f,c))}return d}var l={openTag:"{{",closeTag:"}}",isTrim:!0,isEscape:!1,getIfPlusJoin:function(){return q},registerHelper:function(a,e,d){f.isObj(e)?(p[a]||(p[a]={}),f.extend(p[a],e)):p[a][e]=d},tmpl:function(a,e,d){var b,g,h;if("string"==typeof a)b=a;else if(void 0!==a.length)b=a.join("");else if(b=
a.tmpl,h=a.id)if(n[h])g=n[h];else if(!b){var q=document.getElementById(h);q&&(b=(q.value||q.innerHTML).replace(/\s/g,""))}if(!g){if(!b){c.error("\u6a21\u677f\u672a\u5b9a\u4e49");return}a:{var q=l.openTag,z=l.closeTag;b=b.replace(RegExp(q+"!((?!"+z+").)*"+z,"ig"),"");l.isTrim&&(b=b.replace(/^[\s\n]+/,"").replace(/[\s\n]+$/,"").replace(RegExp("("+z+"|\\>)(\\s|\\n)+(?=("+q+"|<))","ig"),"$1").replace(RegExp(z+"[\\s\\n]+([^\\n]+)[\\s\\n]+(?=("+q+"|<))","ig"),z+"$1"));k=[s[0]];k.push('var escape=$helpers.escape,functionType="function",$me=this;');
var q=a&&a.ns,r;q?(r=f.extend({},p["default"]),r=f.extend(r,p[q])):r=p["default"];a.helpers=r;b=j(b);v=0;a=m(b.children,a);k=k.concat(a);k.push(s[1]);a=k.join("\n");try{var u=window.Function.apply(null,["$T","$helpers","$data",a]);g=function(a,e){return u.call(e||a,l,r,a)};break a}catch(w){c.log(a),c.error(w)}g=void 0}h&&(n[h]=g)}if(e)try{return g(e,d)}catch(I){c.log(g.toString()),c.error(I)}else return g}},n={},k,q="".trim,v=0,s=["var $r="+(q?'""':"[]")+",$tmp,helper;","return "+(q?"$r;":'$r.join("");')],
p={"default":{"if":function(a,e){var d=e.data;f.isFunc(a)&&(a=a.call(d));if(a&&!e.inverse||!a&&e.inverse)return e.fn(d)},unless:function(a,e){e.inverse=!0;return e.helpers["if"].call(this,a,e)},each:q?d:g,escape:function(e){return b.encodeHTML(a(e))},trim:b.trim}};return l});
handy.add("HashChange",["handy.base.Debug","handy.base.Util"],function(f,b,c){function a(a){if(a==l)return!1;var e=m.contentWindow.document;e.open();e.write("<!doctype html><html><body>"+a+"</body></html>");e.close();l=a;f.log("set:"+m.contentWindow.document.body.innerText)}function d(){var e=b.getHash(),d=m.contentWindow.document.body.innerText;e!=l?(a(e),g(e)):d!=l&&(f.log("update:"+m.contentWindow.document.body.innerText),b.setHash(d))}function g(a){var e=q.listeners,d;for(d in e)e[d](a)}var e,
h=0,j=document,m,l,n=j.documentMode,k="onhashchange"in window&&(void 0===n||7<n),q={delay:50,listen:function(f,l){if(!e&&!e)if(e=!0,q.listeners={},k)$(window).on("hashchange",function(){g(b.getHash())});else m=$('<iframe id="fff" tabindex="-1" style="display:none" width=0 height=0 title="empty" />').appendTo(j.body)[0],$(m).one("load",function(){a(b.getHash());setInterval(d,q.delay)});if(l in q.listeners)$D.error(Error("Duplicate name"));else return l=l||c.expando+ ++h,q.listeners[l]=f,l},unListen:function(a){for(var e in q.listeners)(!a||
a==e)&&delete q.listeners[e]}};return q});handy.add("Support","B.Browser",function(f){var b={mediaQuery:function(){var a;if(f.mobile())a="hui-mobile";else{a="hui-pc";var d=f.ie();d&&(a+=" ie"+d)}document.documentElement.className+=" "+a}};b.mediaQuery();if(6==f.ie())try{document.execCommand("BackgroundImageCache",!1,!0)}catch(c){}return b});
handy.add("Validator",["B.String","B.Object"],function(f,b){var c={messages:{required:"{name}\u4e0d\u80fd\u4e3a\u7a7a",email:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u4ef6\u5730\u5740",url:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u94fe\u63a5\u5730\u5740",date:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u65e5\u671f",dateISO:"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u7684\u65e5\u671f",number:"{name}\u987b\u662f\u6570\u5b57",digits:"{name}\u987b\u662f\u6574\u6570",creditcard:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u4fe1\u7528\u5361\u53f7\u7801",
equalTo:"\u8bf7\u8f93\u5165\u76f8\u540c\u7684{name}",min:"{name}\u4e0d\u80fd\u5c0f\u4e8e{0}",max:"{name}\u4e0d\u80fd\u5927\u4e8e{0}",range:"{name}\u8981\u5728{0}\u5230{1}\u4e4b\u95f4",maxlength:"{name}\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7{0}",minlength:"{name}\u957f\u5ea6\u4e0d\u80fd\u5c11\u4e8e{0}",rangelength:"{name}\u957f\u5ea6\u8981\u5728{0}\u5230{1}\u4e4b\u95f4"},valid:function(a,d){var b=d.rules,e;for(e in b){var h=b[e],f=("function"==typeof h?h:c[e])(a,h);if(!f)return b=d.error||c.error,e=d.messages&&
d.messages[e]||c.messages[e],e=e.replace(/\{([^\}]+)\}/g,function(a,e){return h[e]||0==e&&h||d[e]||h||""}),b&&b(e),f}return!0},required:function(a){return 0<f.trim(""+a).length},email:function(a){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)},
url:function(a){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},
date:function(a){return!/Invalid|NaN/.test((new Date(a)).toString())},dateISO:function(a){return/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(a)},number:function(a){return/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)},digits:function(a){return/^\d+$/.test(a)},creditcard:function(a){if(/[^0-9 \-]+/.test(a))return!1;var d=0,c=0,e=!1;a=a.replace(/\D/g,"");for(var b=a.length-1;0<=b;b--){c=a.charAt(b);c=parseInt(c,10);if(e&&9<(c*=2))c-=9;d+=c;e=!e}return 0===d%10},min:function(a,d){return a>=d},max:function(a,
d){return a<=d},range:function(a,d){return a>=d[0]&&a<=d[1]},minlength:function(a,d){return(b.isArr(a)?a.length:f.trim(""+a).length)>=d},maxlength:function(a,d){return(b.isArr(a)?a.length:f.trim(""+a).length)<=d},rangelength:function(a,d){var c=b.isArr(a)?a.length:f.trim(""+a).length;return c>=d[0]&&c<=d[1]},equalTo:function(a,d){return a===d}};return c});
handy.add("LocalStorage",["B.Browser","B.Events","B.Json"],function(f,b,c){b={_init:function(){!a&&f.ie()&&(g=document.getElementById("LocalStorageUserDataDiv"),g||(g=document.createElement("DIV"),g.style.display="none",g.id="LocalStorageUserDataDiv",g.addBehavior("#default#userData"),document.body.appendChild(g),g.load(e)))},getItem:function(e){e=a?d.getItem(e):g.getAttribute(e);return e=c.parseJson(e)},setItem:function(b,f){f=c.stringify(f);try{a?d.setItem(b,f):(g.setAttribute(b,f),g.save(e))}catch(m){return $D.error(m),
!1}return!0},removeItem:function(c){a?d.removeItem(c):(g.removeAttribute(c),g.save(e))},clear:function(){a?d.clear():g.unload()}};var a=window.localStorage&&window.localStorage.getItem,d=window.localStorage,g,e=document.domain;b._init();return b});(function(f){Hui=H=$H=f.noConflict();$D=$H.Debug;$HD=$H.Date;$Define=$H.Loader.define;$Require=$H.Loader.require;$G={config:{}};f=window.$;f.fn.remove=$H.intercept(f.fn.remove,function(){$H.trigger("removeEl",this.target)})})(handy);
$Define("CM.AbstractEvents",function(){var f=$H.createClass();$H.extend(f.prototype,$H.Events);$H.extend(f.prototype,{initialize:function(){this._eventCache={};this._listenTo=[]},_parseListenToEvents:function(b,c,a,d){var g=this,e=$H.toArray(arguments,3);return g._parseEvents(a,function(a){a.unshift(c);g[b].apply(g,a.concat(e))})},listenTo:function(b,c,a,d,g){if(!this._parseListenToEvents("listenTo",b,c,a,d,g)){"number"==typeof d&&(g=d,d=null);d=d||this;var e=this._delegateHandler(a,d);this._listenTo.push({target:b,
name:c,delegation:e,handler:a});b.on(c,e,d,g)}},unlistenTo:function(b,c,a){if(!this._parseListenToEvents("unlistenTo",b,c,a)){var d=this._listenTo,g="all"==b;$H.each(d,function(e,h){if(g||h.name==c&&h.handler==a&&h.target==b)h.target.off(h.name,h.delegation),d.splice(e,1)})}}});return f});
$Define("CM.DataStore",function(){var f=$H.createClass();$H.extend(f.prototype,{get:function(c,a){var d;if(d=b[c])return a?$H.where(d,a):d},push:function(c,a){"string"!=typeof c&&(a=c,c=null);var d=a.constructor.$ns;(b[d]||(b[d]=[])).push(a);c&&(b[c]||(b[c]=a))}});var b={};$S=$H.getSingleton(f);return f});
$Define("CM.AbstractDao","B.LocalStorage",function(f){var b=$H.createClass();$H.extend(b.prototype,{_ajaxMethodMap:{create:"POST",update:"POST",patch:"PATCH","delete":"DELETE",read:"GET"},_localMethodMap:{create:"setItem",update:"setItem",patch:"setItem","delete":"removeItem",read:"getItem"},ajax:function(c){c=this.parseParam(c);var a=$H.intercept(c.error,this.error);c.error=$H.intercept(a,c.beforeErr);a=$H.intercept(c.success,this.success);c.success=$H.intercept(a,c.beforeSucc);c.beforeSend=$H.intercept($H.bind(this.beforeSend,
this),c.beforeSend);c.complete=$H.intercept($H.bind(this.complete,this),c.complete);return $.ajax(c)},parseParam:$H.noop,beforeSend:function(){this.showLoading(!0)},complete:function(){this.showLoading(!1)},error:$H.noop,success:$H.noop,showLoading:$H.noop,get:function(){},set:function(){},remove:function(){},sync:function(c,a,d){d=d||{};var b=d.storeType||"remote",e={type:"POST",dataType:"json"};d.url||(e.url=a.getUrl());if(null==d.data&&a&&("create"===c||"update"===c||"patch"===c))e.data=d.attrs||
a.toJSON(d);if("remote"==b)e.url+="/"+c+".do",$H.extend(e,d),this.ajax(e);else f[this._localMethodMap[c]](e);a.trigger("request",a,d)}});return b});
$Define("CM.Model",["CM.AbstractDao","CM.AbstractEvents","CM.DataStore"],function(f,b){return b.derive({idAttribute:"id",_pending:!1,_validate:function(c,a){if(!a.validate||!this.validate)return!0;c=$H.extend({},this._attributes,c);var d=this.validationError=this.validate(c,a)||null;if(!d)return!0;this.trigger("invalid",this,d,$H.extend(a,{validationError:d}));return!1},_doDepends:function(c,a){var d=this.fields,b,e,h={},f;for(f in d)if((b=d[f])&&(e=b.depends))for(b=0;b<e.length;b++)if(c.hasOwnProperty(e[b])){h[f]=
0;break}this.set(h,null,{silent:a})},_parseFields:function(c){var a;if(!(a=this.fields))return c;var d,b,e,h={},f;for(f in c){b=c[f];if(d=a[f]){e=d.type;if(d=d.parse)b=d.apply(this,[b,c]);$H.isStr(e)&&("Date"==e?b=$H.parseDate(b):0<e.indexOf(".")&&(e=$H.ns(e)));$H.isClass(e)&&!(b instanceof e)&&(b=new e(b),b.on("all",$H.bind(this._onAttrEvent,this,f)))}h[f]=b}return h},_onAttrEvent:function(c,a){if(!("invalid"==a||"sync"==a)){var d=this.get(c);0!=a.indexOf("change:")&&(this.trigger("change:"+c,this,
d),this.trigger("change",this))}},initialize:function(c,a){this.callSuper();this.uuid=$H.uuid();this.dao=this.dao||$H.getSingleton(f);var d=c||{};a||(a={});this.cid=$H.Util.uuid();this._attributes={};a.collection&&(this.collection=a.collection);a.parse&&(d=this.parse(d,a)||{});d=$H.extendIf(d,this.getDefaults());this.set(d,a);this._changed={};$S.push(this)},getDefaults:function(){var c={},a;if(a=this.fields)for(var d in a){var b=a[d];c[d]=b&&$H.isObj(b)?b.def:b}return c},toJSON:function(){return $H.clone(this._attributes)},
sync:function(c,a,d){return this.dao.sync(c,a,d)},get:function(c){return this._attributes[c]},escape:function(c){return $H.String.escapeHTML(this.get(c))},has:function(c){c=this.get(c);return null!==c&&void 0!==c},set:function(c,a,d){var b;"object"===typeof c?(b=c,d=a):(b={})[c]=a;d||(d={});b=this._parseFields(b);if(!this._validate(b,d))return!1;var e=d.unset;c=d.silent;var h={},f=this._changing;this._changing=!0;f||(this._previousAttributes=$H.Object.clone(this._attributes),this._changed={});var m=
this._attributes,l=this._previousAttributes;this.idAttribute in b&&(this.id=b[this.idAttribute]);for(var n in b)a=b[n],$H.equals(m[n],a)||(h[n]=a),$H.equals(l[n],a)?delete this._changed[n]:this._changed[n]=a,e?delete m[n]:m[n]=a;a=!$H.isEmpty(h);if(!c){a&&(this._pending=d);for(var k in h)this.trigger("change:"+k,this,m[k],d)}if(f)return this;if(!c)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);this._changing=this._pending=!1;a&&this._doDepends(h,c);return this},
unset:function(c,a){a=a||{};a.unset=!0;return this.set(c,void 0,a)},clear:function(c){var a={},d;for(d in this._attributes)a[d]=void 0;c=c||{};c.unset=!0;return this.set(a,c)},each:function(c){$H.each(this._attributes,c)},hasChanged:function(c){var a=this._changed;return null==c?!$H.isEmpty(a):$H.contains(a,c)},changedAttrbutes:function(c){if(!c)return this.hasChanged()?$H.clone(this._changed):!1;var a,d=!1,b=this._changing?this._previousAttributes:this._attributes,e;for(e in c)if(!$H.equals(b[e],
a=c[e]))(d||(d={}))[e]=a;return d},previous:function(c){return null==c||!this._previousAttributes?null:this._previousAttributes[c]},fetch:function(c){var a=this;c=c?$H.clone(c):{};void 0===c.parse&&(c.parse=!0);var d=c.success,b=c.beforeSet;c.success=function(e){if(!(b&&!1==b(a,e,c))){if(!a.set(a.parse(e,c),c))return!1;d&&d(a,e,c);a.trigger("sync",a,e,c)}};a.sync("read",a,c)},save:function(c,a,d){var b=this,e;null==c||"object"===typeof c?(e=c,d=a):(e={})[c]=a;$H.isFunc(d)&&(d={success:d});d=$H.extend({validate:!0},
d);if(e&&d.now){if(!b.set(e,d))return!1}else if(!b._validate(e,d))return!1;void 0===d.parse&&(d.parse=!0);var h=d.success;d.success=function(a){var c=b.parse(a,d);d.now||(c=$H.extend(e||{},c));if($H.isObj(c)&&!b.set(c,d))return!1;h&&h(b,a,d);b.trigger("sync",b,a,d)};c=b.isNew()?"create":d.update?"update":"patch";if("patch"===c){a=b.changedAttrbutes(e);if(!a){h&&h(b,d);return}d.attrs=a}else a=$H.extend({},b._attributes),d.attrs=$H.extend(a,e);b.sync(c,b,d)},destroy:function(c){var a=this;c=c?$H.clone(c):
{};var d=c.success,b=function(){a.trigger("destroy",a,a.collection,c);a.off("all")};c.success=function(e){(!c.now||a.isNew())&&b();d&&d(a,e,c);a.isNew()||a.trigger("sync",a,e,c)};if(a.isNew())return c.success(),!1;a.sync("delete",a,c);c.now&&b()},getUrl:function(){var c=$H.result(this,"url")||$H.result(this.collection,"url");c||$D.error(Error("\u5fc5\u987b\u8bbe\u7f6e\u4e00\u4e2aurl\u5c5e\u6027\u6216\u8005\u51fd\u6570"));return this.isNew()?c:c.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},
parse:function(c){return c.code&&c.data?c.data:c},clone:function(){return new this.constructor(this._attributes)},isNew:function(){return void 0===this.id},isValid:function(c){return this._validate({},$H.extend(c||{},{validate:!0}))}})});
$Define("CM.Collection",["CM.AbstractDao","CM.AbstractEvents","CM.Model","CM.DataStore"],function(f,b,c){var a=b.derive({model:c,_reset:function(){this.length=0;this._models=[];this._byId={}},_prepareModel:function(a,e){if(a instanceof c)return a;e=e?$H.clone(e):{};e.collection=this;var d;if(e.id&&(d=(d=$S.get(this.model.$ns,{id:e.id}))&&d[0]))return d.set(a,e),d;d=new this.model(a,e);if(!d.validationError)return d;this.trigger("invalid",this,d.validationError,e);return!1},_addReference:function(a){this._byId[a.cid]=
a;null!=a.id&&(this._byId[a.id]=a);a.collection||(a.collection=this);a.on("all",this._onModelEvent,this)},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,e,d,c){("add"===a||"remove"===a)&&d!==this||("destroy"===a&&this.remove(e,c),e&&a==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))},initialize:function(a,e){this.callSuper();
this.dao=this.dao||$H.getSingleton(f);e||(e={});e.model&&(this.model=e.model);e.url&&(this.url=e.url);void 0!==e.comparator&&(this.comparator=e.comparator);this._reset();a&&this.reset(a,$H.extend({silent:!0},e))},toJSON:function(a){return $H.map(this._models,function(e){return e.toJSON(a)})},sync:function(a,e,d){return this.dao.sync(a,e,d)},add:function(a,e){e=$H.extend({add:!0,remove:!1,merge:!1},e);return this.set(a,e)},remove:function(a,e){var d=!$H.isArr(a);a=d?[a]:$H.clone(a);e||(e={});var c,
b,f,n;c=0;for(b=a.length;c<b;c++)if(n=a[c]=this.get(a[c]))delete this._byId[n.id],delete this._byId[n.cid],f=this.indexOf(n),this._models.splice(f,1),this.length--,e.silent||(e.index=f,n.trigger("remove",n,this,e)),this._removeReference(n,e);return d?a[0]:a},set:function(a,e){if(a){e=$H.extend({add:!0,remove:!0,merge:!0},e);e.parse&&(a=this.parse(a,e));var d=!$H.isArr(a),b=d?a?[a]:[]:$H.clone(a),f,l,n,k,q,v,s,p=e.at,F=this.model,B=this.comparator&&null==p&&!1!==e.sort,G="string"==typeof this.comparator?
this.comparator:null,x=[],A=[],t={},y=e.add,z=e.merge,r=e.remove,u=!B&&y&&r?[]:!1;f=0;for(l=b.length;f<l;f++){q=b[f]||{};n=q instanceof c?k=q:q[F.prototype.idAttribute||"id"];if(v=this.get(n))r&&(t[v.cid]=!0),z&&(q=q===k?k.attributes:q,e.parse&&(q=v.parse(q,e)),v.set(q,e),B&&(!s&&v.hasChanged(G))&&(s=!0)),b[f]=v;else if(y){e.id=n;k=b[f]=this._prepareModel(q,e);if(!k)continue;x.push(k);this._addReference(k,e)}k=v||k;u&&(k.isNew()||!t[k.id])&&u.push(k);t[k.id]=!0}if(r){f=0;for(l=this.length;f<l;++f)t[(k=
this._models[f]).cid]||A.push(k);A.length&&this.remove(A,e)}if(x.length||u&&u.length)if(B&&(s=!0),this.length+=x.length,null!=p){f=0;for(l=x.length;f<l;f++)this._models.splice(p+f,0,x[f])}else{u&&(this._models.length=0);n=u||x;f=0;for(l=n.length;f<l;f++)this._models.push(n[f])}s&&this.sort({silent:!0});if(!e.silent){f=0;for(l=x.length;f<l;f++)(k=x[f]).trigger("add",k,this,e);(s||u&&u.length)&&this.trigger("sort",this,e)}return d?b[0]:b}},each:function(a){$H.each(this._models,a)},reset:function(a,
e){e||(e={});for(var d=0,c=this._models.length;d<c;d++)this._removeReference(this._models[d],e);e.previousModels=this._models;this._reset();a&&(a=this.add(a,$H.extend({silent:!0},e)));e.silent||this.trigger("reset",this,e);return a},push:function(a,e){return this.add(a,$H.extend({at:this.length},e))},pop:function(a){var e=this.at(this.length-1);this.remove(e,a);return e},unshift:function(a,e){return this.add(a,$H.extend({at:0},e))},shift:function(a){var e=this.at(0);this.remove(e,a);return e},slice:function(){return Array.prototype.slice.apply(this._models,
arguments)},get:function(a){return null==a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},size:function(){return this.length},at:function(a){return this._models[a]},where:function(a,e){return $H.isEmpty(a)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var d in a)if(a[d]!==e.get(d))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){this.comparator||$D.error(Error("\u6ca1\u6709\u6bd4\u8f83\u5668"));a||(a={});"string"==typeof this.comparator||1===this.comparator.length?
this._models=this.sortBy(this.comparator,this):this._models.sort($H.Function.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},pluck:function(a){return $H.invoke(this._models,"get",a)},getUrl:function(){return this.url},fetch:function(a){var e=this;a=a?$H.clone(a):{};void 0===a.parse&&(a.parse=!0);var d=a.success,c=a.beforeSet;a.success=function(b){c&&!1==c(e,b,a)||(e[a.reset?"reset":a.add?"add":"set"](b,a),d&&d(e,b,a),e.trigger("sync",e,b,a))};return e.sync("read",e,
a)},create:function(a,e){var d=this;e=e?$H.clone(e):{};if(!(a=d._prepareModel(a,e)))return!1;e.now&&d.add(a,e);var c=e.success;e.success=function(a,b){e.now||d.add(a,e);c&&c(a,b,e)};a.save(null,e);return a},parse:function(a){return a.data},clone:function(){return new this.constructor(this._models)}}),d=$H.Array;$H.each("map some every find filter invoke indexOf".split(" "),function(c,e){a.prototype[e]=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this._models);return d[e].apply(d,
a)}});$H.each(["sortBy","groupBy","countBy"],function(c){a.prototype[c]=function(a,b){var f=$H.isFunc(a)?a:function(d){return d.get(a)};return d[c](this._models,f,b)}});return a});
$Define("CM.AbstractManager",function(){var f=$H.createClass();$H.extend(f.prototype,{initialize:function(){this._types={};this._all={}},type:"manager",registerType:function(b,c){this._types[b]=c;c.prototype.xtype=b},getClass:function(b){return $H.isClass(b)?b:this._types[b]||$H.ns(b)},register:function(b,c){var a=b.cid=c.cid||$H.uuid(),d=b._id=this.generateId(a,b.xtype);this._all[d]=b;this._all[a]=b},unregister:function(b){var c=this._all,a=b.getId(),d=b.getCid();c[a]==b&&delete c[a];c[d]==b&&delete c[d]},
eachInEl:function(b,c){var a=this;b.find(".js-"+a.type).each(function(d,b){b=$(b);var e=b.attr("id");(e=a.get(e))&&c(e)})},generateId:function(b,c){var a=$H.expando+"-"+this.type+"-"+c+"-"+(b||$H.uuid());if(this._all[a])$D.error("id\u91cd\u590d:"+a);else return a},get:function(b){return this._all[b]}});return f});
$Define("CM.ViewManager","CM.AbstractManager",function(f){var b=$H.createClass();$H.inherit(b,f,{type:"view",initialize:function(){var c=this;c.callSuper();$H.on("afterRender",function(a,d){c.afterRender(d)});$H.on("removeEl",function(a,d){c.destroy(d)})},afterRender:function(c){this.eachInEl(c,function(a){a.afterRender()})},destroy:function(c){this.eachInEl(c,function(a){a.destroy(!0)})}});$V=$H.getSingleton(b);return b});
$Define("CM.AbstractView",["CM.ViewManager","CM.AbstractEvents"],function(f,b){return b.derive({xtype:"View",renderBy:"append",autoRender:!0,listeners:[],_parseListenEvents:function(c,a){var d=this;return d._parseEvents(a.name,function(b){var e=$H.extend({},a);e.name=b[0];2==b.length&&(e.handler=b[1]);d[c].call(d,e)})},initialize:function(c){this.callSuper();this._listeners=[];this.listeners=$H.clone(this.listeners);this.manager=this.constructor.manager||$H.getSingleton(f);this.manager.register(this,
c);this.doConfig(c);this.init(c);this.parseItems();!1!=this.autoRender&&this.render();this.inited=!0},init:$H.noop,doConfig:function(c){c=(this.initParam=c)||{};$H.extend(this,c);var a;this.renderTo=(a=c.renderTo)?$(a):$(document.body)},getId:function(){return this._id},getCid:function(){return this.cid},getEl:function(){return this._container},getHtml:function(){return this.html},render:function(){var c=this.getHtml();this.renderTo[this.renderBy](c);this._container=$("#"+this.getId());this.initListeners()},
findEl:function(c){return this.getEl().find(c)},parseItems:$H.noop,callChild:$H.noop,listen:function(c){if(!this._parseListenEvents("listen",c)){var a=c.name,d=c.context,b=c.times,e=c.target,f=c.custom||e||$H.contains(this._customEvents,a),j=c.handler;$H.isFunc(e)&&(e=e.call(this));if(f)c=$H.removeUndefined([e,a,j,d,b]),this[e?"listenTo":"on"].apply(this,c);else if(this.listened){var e=this._listeners,b=c.el,f=c.method||"bind",m=c.selector,l=c.data,d=c.delegation=this._delegateHandler(j,d);$H.isFunc(b)&&
(b=b.call(this));b=b?"string"==typeof b?this.findEl(b):b:this.getEl();if(m)if(l)b[f](m,a,l,d);else b[f](m,a,d);else if(l)b[f](a,l,d);else b[f](a,d);e.push(c)}else this.listeners.push(c)}},unlisten:function(c){if(!this._parseListenEvents("unlisten",c)){var a=c.name,d=c.handler;if(c.custom)this.off(a,d);else{var b=c.el,e="delegate"==c.method?"undelegate":"unbind";c=c.selector;for(var f,b=b?"string"==typeof b?this.findEl(b):b:this.getEl(),j=this._listeners.length-1;0<=j;j--){var m=this._listeners[j];
if(m.handler==d){f=m.delegation;this._listeners.splice(j,1);break}}if(c)b[e](c,a,f);else b[e](a,f)}}},initListeners:function(){if(this.listened)return!1;this.listened=!0;for(var b=this.listeners,a=b.length-1;0<=a;a--)this.listen(b[a]);this.callChild()},clearListeners:function(){for(var b=this._listeners,a=b.length-1;0<=a;a--)this.unlisten(b[a]);this.off("all");this.unlistenTo("all");this.callChild()},destroy:function(){if(!this.destroyed)return this.clearListeners(),this.unlistenTo("all"),this.getEl().remove(),
this.destroyed=!0,this.manager.unregister(this),delete this._container,delete this.renderTo,delete this.html,!0}})});
$Define("CM.ModelView",["B.Template","CM.AbstractView","CM.Model","CM.Collection"],function(f,b,c,a){function d(a,e){return e.get?e.get(a):e[a]}function g(a,b){for(var d=b.context,c=b.data,f=b.num,g=b.type,j="bindAttr-"+(d.getCid()+"-"+f),l=[],k=[],n=d.ifBind(f,c),q=g&&d.ifBind(f,c,!0);f=m.exec(a);)"id"==f[2]?j=0==f[3].indexOf("this.")?d[f[3].substring(5)]:e(f[3],c):k.push(f);l.push('id="'+j+'"');for(var w,s,v,C,D=0,J=k.length;D<J;D++){f=k[D];s=f[2];w=f[3];w=w.split(" ");v=[];for(var E=0;E<w.length;E++)((C=
h(d,j,s,w[E],n,q,c))||0===C)&&v.push(C);w=v.join(" ");s?(g&&"value"==s&&(b.value=w),w=(f[1]||"")+w+f[4]):w&&(w=w+'="'+w+'"');w&&l.push(w)}return" "+l.join(" ")+" "}function e(a,e){return!a?a:0==a.indexOf("#")?a.substring(1):d(a,e)}function h(a,b,d,c,f,g,h){var j;b="#"+b;var l=c.indexOf("?"),m=c.indexOf(":");if(0==c.indexOf("this."))return a[c.substring(5)];if(0<l||0<m){g=c.substring(0,0<l?l:m);var k=0>l?"":c.substring(l+1,0<m?m:c.length),n=0>m?"":c.substring(m+1,c.length);j=e(g,h);f&&0!=g.indexOf("#")&&
a.listenTo(h,"change:"+g,function(a,e,c){a=$(b);d?"class"==d?c?(n&&a.removeClass(n),k&&a.addClass(k)):(k&&a.removeClass(k),n&&a.addClass(n)):a.attr(d,c?k:n):c?a.prop(k,!0):a.prop(k,!1)});return j?k:n}j=e(c,h);0!=c.indexOf("#")&&(f&&a.listenTo(h,"change:"+c,function(a,e,c){a=$(b);"class"==d?(a.removeClass(j),a.addClass(c),j=c):a.attr(d,c||"")}),"value"==d&&g&&a.listen({name:"input propertychange",el:b,handler:function(a){h.set(c,a.target.value)}}));return j}b=b.derive({bindType:"both",initialize:function(){this._bindModelNums=
{};this._bindElNums={};this.callSuper()},doConfig:function(){this.callSuper();var a=this.modelClass||c;this.model||(this.model=new a(this.data));this.xmodel=this.model},preTmpl:function(){var a=this.tmpl;$H.isArr(a)&&(a=a.join(""));var e=n.test(a),b="#js-"+this.manager.type+" #js-"+this.xtype;if(e){if(e=a.match(k)[1])v.test(a)||(e=e.replace(/([^\s]+)/g,"#$1")),b+=" "+e;a=a.replace(k,"")}b=' id=this._id class="'+b+'"';this.tmpl=a=q.test(a)?a.replace(s,"$1"+b):a.replace(l,"$1 {{bindAttr"+b+"}}")},getTmplFn:function(){var a=
this.tmpl,e=this.constructor;if(!$H.isFunc(a)&&!$H.isFunc(a=e.tmpl))this.preTmpl(),a=e.tmpl=$H.tmpl({tmpl:this.tmpl,ns:"ModelView"});return this.tmpl=a},getHtml:function(){return this.html?this.html:this.html=this.getTmplFn()(this.xmodel,this)},ifBind:function(e,b,d){if(!d&&"el"==this.bindType||d&&"model"==this.bindType)return!1;d=d?this._bindElNums:this._bindModelNums;b=!d[e]&&(b instanceof c||b instanceof a);d[e]=1;return b},updateMetaMorph:function(a,e,b){if("append"==b)$("#metamorph-"+a+"-end").before(e);
else{var d=$("#metamorph-"+a+"-start");if(0!=d.length){a="metamorph-"+a+"-end";for(var c=d[0].nextSibling,f;c&&c.id!=a;)f=$(c),c=c.nextSibling,f.remove();e&&d.after(e);"remove"==b&&(d.remove(),$(c).remove())}}},wrapMetaMorph:function(a,e){return'<script id="metamorph-'+a+'-start" type="text/x-placeholder">\x3c/script>'+(e||"")+'<script id="metamorph-'+a+'-end" type="text/x-placeholder">\x3c/script>'},get:function(a){return this.xmodel.get(a)},set:function(a,e){this.xmodel.set(a,e)},update:function(a){this.xmodel.set(a)},
getXmodel:function(){return this.xmodel}});f.registerHelper("ModelView",{"if":function(a,e){var b=e.context,d=e.data,c=e.exp;$H.isFunc(a)&&(a=a.call(d));var f;if(a&&!e.inverse||!a&&e.inverse)f=e.fn(d);var g=e.num,h=b.getCid()+"-"+g;b.ifBind(g,d)&&b.listenTo(d,"change:"+c,function(a,d,f){var g;if(f&&!e.inverse||!f&&e.inverse)a={},a[c]=f,g=e.fn(a);b.updateMetaMorph(h,g)});return b.wrapMetaMorph(h,f)},unless:function(a,e){e.inverse=!0;return e.helpers["if"].call(this,a,e)},each:function(e,b){var d=b.context,
c=b.fn,f=j?"":[],g=b.num,h=d.getCid()+"-"+g;if(e){var m;if(e instanceof a)e.each(function(a,e){m=d.wrapMetaMorph(h+"-"+e.uuid,c(e));j?f+=m:f.push(m)}),d.ifBind(g,e)&&(d.listenTo(e,"add",function(a,e,b,f){a=d.wrapMetaMorph(h+"-"+e.uuid,c(e));(f=f.at)?(b=b.at(f-1),$("#metamorph-"+(h+"-"+b.uuid)+"-end").after(a)):$("#metamorph-"+h+"-end").before(a)}),d.listenTo(e,"remove",function(a,e){d.updateMetaMorph(h+"-"+e.uuid,"","remove")}));else if(void 0!==e.length)for(var l=0,g=e.length;l<g;l++)m=d.wrapMetaMorph(h+
"-"+l,c(e[l])),j?f+=m:f.push(m);else for(l in e)m=d.wrapMetaMorph(h+"-"+l,c(e[l])),j?f+=m:f.push(m);return d.wrapMetaMorph(h,j?f:f.join(""))}},getValue:d,parseValue:function(a,e){var b=e.context,d=e.data,c=e.exp,g=f.isEscape,h=e.helpers,j=e.num,m=b.getCid()+"-"+j;b.ifBind(j,d)&&b.listenTo(d,"change:"+c,function(a,e,d){g&&(d=h.escape(d));b.updateMetaMorph(m,d)});g&&(a=h.escape(a));return b.wrapMetaMorph(m,a)},bindAttr:g,input:function(a,e){e.type="input";return"<input "+g(a,e)+"/>"},textarea:function(a,
e){e.type="textarea";return"<textarea "+g(a,e)+">"+e.value+"</textarea>"}});var j=f.getIfPlusJoin(),m=/((\w+)=['"]?)?([#\w][\s\w\.\?:#-]*)(['"]?)(?!\w*=)/g,l=/[^<]*(<[a-zA-Z]+)/,n=/^[^>]+class=/,k=/class=['"]?([#\w][\s\w\.\?:#-]*)(['"]?)(?!\w*=)/,q=/^[^>]+{{bindAttr/,v=/^[^>]+{{bindAttr((?!}}).)class=/,s=/({{bindAttr)/;return b});
$Define("CM.View",["CM.ViewManager","CM.ModelView","CM.Model","B.Template"],function(f,b,c,a){var d=/^(<[a-zA-Z]+)/,g=b.derive({xtype:"View",xConfig:{},tmpl:"<div>{{placeItem}}</div>",bindRefType:"bindRef",_customEvents:"beforeRender render afterRender beforeShow show afterShow beforeHide hide afterHide beforeUpdate update afterUpdate beforeDestroy destroy afterDestroy add remove".split(" "),_defaultEvents:"mousedown mouseup mouseover mousemove mouseenter mouseleave dragstart drag dragenter dragleave dragover drop dragend touchstart touchmove touchend touchcancel keydown keyup keypress click dblclick focus focusin focusout contextmenu change submit".split(" "),
_applyArray:function(a,d){var b=this,c=arguments,f=c.callee.caller,g=f.$owner.prototype;0==c.length?(c=f.arguments,c=$H.toArray(c),a=f.$name,d=c.shift()):c=$H.toArray(c,2);return $H.isArr(d)?($H.each(d,function(d,f){g[a].apply(b,[f].concat(c))}),!0):!1},initialize:function(){this.items=[];this.children=[];this.callSuper()},doConfig:function(a){var d=this;d.initParam=a;"string"==typeof a&&(a={text:a});var b=a||{};$H.extend(d,b,{notCover:function(a,e){var c;if(c=/^{{(((?!}}).)+)}}$/.exec(e))c=c[1],
(d.refModelAttrs||(d.refModelAttrs={}))[c]=a;c=$H.contains(d._customEvents,a);if($H.contains(d._defaultEvents,a))return d.listeners.push({name:a,handler:b[a]}),!0;if(c)return d.on(a,b[a]),!0;if("defItem"==a)return d[a]=$H.extend(d[a],e),!0;if("listener"==a)return d.listeners=d.listeners.concat($H.isArr(e)?e:[e]),!0;if("items"==a)return d.add(e),!0;if("extCls"==a&&d[a])return d[a]+=" "+e,!0;if("xtype"==a)return"View"==d[a]&&(d[a]="string"==typeof e?e:e.$ns),!0}});if(a=b.renderTo){if($H.isFunc(a))a=
a.call(d);else if($H.isStr(a)&&0==a.indexOf(">")){var f=d.parent;a=f.inited&&f.findEl(a.substring(1))}else a=$(a);d.renderTo=a}else d.renderTo=$(document.body);if(a=d.getRefModel()){var f=d.refModelAttrs,g;for(g in f)d[f[g]]=a.get(g)}g=d.xConfig;a=d.modelClass;if(!a&&!(a=d.constructor.modelClass))a=g?c.derive({fields:g}):c,a=d.constructor.modelClass=a;var n={};$H.each(g,function(a){var e=d[a];void 0!==e&&(n[a]=e)});d.xmodel=new a(n);d.bindRefModel()},getHtml:function(){this.getId();var a,b=this.extCls||
"";"visibility"==this.displayMode?a="visibility:hidden;":b+=" hui-hidden";var c=this.callSuper();a&&(c=c.replace(d,'$1 style="'+a+'"'));b&&(c=c.replace(/(class=['"])/,"$1"+b+" "));if(a=this.wrapHtml)c=a[0]+c+a[1];return this.html=c},findHtml:function(a){a=this.find(a);for(var d=[],b=0;b<a.length;b++)d.push(a[b].getHtml());return d.join("")},initStyle:function(){var a=this.getEl(),d=this.style||{};void 0!==this.width&&(d.width=this.width);void 0!==this.height&&(d.height=this.height);a.css(d)},beforeRender:function(){return this.trigger("beforeRender")},
render:function(){if(!1==this.beforeRender())return!1;var a=this.getHtml();this.renderTo[this.renderBy](a);this.afterRender()},afterRender:function(){if(this.rendered)return!1;this.trigger("render");this.callChild();this._container=$("#"+this.getId());this.rendered=!0;this.initStyle();!0!=this.notListen&&this.initListeners();this.disabled&&this.disable();this.trigger("afterRender");this.hidden||this.show()},beforeShow:function(){return this.trigger("beforeShow")},show:function(a,d){var b=this;if(!1==
b.beforeShow()||b.showed||d&&b.hidden)return!1;if(!a&&b.delayShow)setTimeout(function(){g.prototype.show.call(b,!0)},0);else{b.trigger("show");b.showed=!0;var c=b.getEl();"visibility"==b.displayMode?c.css({visibility:"visible"}):c.removeClass("hui-hidden");b.callChild([null,!0]);b.afterShow()}},afterShow:function(){var a=this;setTimeout(function(){a.trigger("afterShow")},0)},beforeHide:function(){return this.trigger("beforeHide")},hide:function(){if(!1==this.beforeHide()||!this.showed)return!1;this.showed=
!1;var a=this.getEl();"visibility"==this.displayMode?a.css({visibility:"hidden"}):a.addClass("hui-hidden");this.trigger("hide");this.afterHide()},afterHide:function(){this.trigger("afterHide")},enable:function(){this.resume();this.getEl().removeClass("hui-disable").find("input,textarea,select").removeAttr("disabled")},disable:function(){this.suspend();this.getEl().addClass("hui-disable").find("input,textarea,select").attr("disabled","disabled")},getContent:function(a,d){d?!d instanceof g&&(d=this.find(d)[0]):
d=this;return!1==a?d.children:d.getEl().html()},setContent:function(a,d){if(d)return!d instanceof g&&(d=this.find(d)[0]),d.setContent(a);var b=this.getEl();b.contents().remove();if("string"==typeof a)b.html(a);else return this.add(a)},suspend:function(){if(this.isSuspend)return!1;this.isSuspend=!0;this.callChild()},resume:function(){if(!this.isSuspend)return!1;this.isSuspend=!1;this.callChild()},parentsEl:function(a){return this.getEl().parents(a)},get:function(a){return void 0===this.xConfig[a]?
this[a]:this.xmodel.get(a)},set:function(a,d){void 0===this.xConfig[a]?this[a]=d:this.xmodel.set(a,d)},getRefModel:function(){if(this.refModel)return this.refModel;for(var a=this.parent;a;){if(a.refModel)return this.refModel=a.refModel;if(a.parent)a=a.parent;else return a.model}},bindRefModel:function(){function a(c,e){("both"==b||"bindRef"==b)&&d.listenTo(f,"change:"+c,function(a,b,c){d.set(e,c)});("both"==b||"bindXmodel"==b)&&d.listenTo(g,"change:"+e,function(a,d,b){f.set(c,b)})}var d=this,b=d.bindRefType,
c=d.refModelAttrs;if(b&&c){var f=d.getRefModel(),g=d.xmodel,k;for(k in c)a(k,c[k])}},each:function(a,d){for(var b=this.children,c=b.length,f,g=0;g<c;){f=b[g];f=d?a.apply(f,d):a(g,f);if(!1===f)break;c==b.length?g++:c=b.length}},match:function(a,d){if("*"==a)return!0;d=d||this;var b,c,f;a=a.replace(/^#([^\s,\[]+)/,"[cid=$1]");a=a.replace(/^\.([^\s,\[]+)/,"[cClass=$1]");a=a.replace(/^([^\[]+)/,"[xtype=$1]");for(var g=/\[([^=|\!]+)(=|\!=)([^=]+)\]/g;b=g.exec(a);){c=b[1];f=b[2];b=b[3];if("false"==b||"true"==
b)b=eval(b);c=d.get?d.get(c):d[c];if("="===f?c!=b:c==b)return!1}return!0},find:function(a,d){var b=this;d=d||[];if(a)if($H.isNum(a))d.push(b.children[a]);else if($H.isStr(a)){if(0<a.indexOf(","))return $H.each(a.split(","),function(a,c){d=d.concat(b.find(c))}),d;var c=0==a.indexOf(">"),f=a.replace(/^>?\s?/,""),g=f.search(/\s|>/),k;0<g&&(k=f.substring(g),f=f.substring(0,g));b.each(function(b,g){g.match(f)&&(k?g.find(k,d):d.push(g));c||g.find(a,d)})}else{if($H.isFunc(a)){var q=$H.isClass(a);b.each(function(b,
c){(q&&c instanceof a||!q&&a(c))&&d.push(c);c.find(a,d)})}}else d=d.concat(b.children);return d},parents:function(a){for(var d=this;d.parent;)if(d=d.parent,a&&this.match(a,d))return d;return a||d===this?null:d},index:function(){var a=this,d=a.parent;if(d){var b;d.each(function(d,c){if(c==a)return b=d,!1});return b}return null},callChild:function(a,d){0!=this.children.length&&(a&&"string"!=typeof a&&(d=a,a=null),a=a||arguments.callee.caller.$name,this.each(function(b,c){d?c[a].apply(c,d):c[a].call(c)}))},
add:function(a,d){if(!this._applyArray()){var b=void 0===d;if(this.startParseItems){if(a instanceof g)a.parent=this;else{this.defItem&&$H.extend(a,this.defItem,{notCover:!0});this.parseItem(a);var c=this.manager.getClass(a.xtype);if(c){var f=a.renderTo;!this.inited&&($H.isStr(f)&&0==f.indexOf(">"))&&(f=null);f||(this.inited?a.renderTo=this.getEl():a.autoRender=!1);a.parent=this;a=new c(a)}else $D.error("xtype:"+a.xtype+"\u672a\u627e\u5230")}c=this.children;b?c.push(a):c.splice(d,0,a);this.trigger("add",
a);return a}c=this.items;b?c.push(a):c.splice(d,0,a)}},remove:function(a){if(!this._applyArray()){var d=this.children,b=!1,c;if($H.isNum(a))c=a,a=d[c];else if($H.isStr(a)||$H.isFunc(a)){a=this.find(a);for(var f=0,n=a.length;f<n;f++){if(!1==this.remove(a[f]))return!1;b=!0}}else if(a instanceof g)if(a.parent==this){f=0;for(n=d.length;f<n;f++)if(d[f]==a){c=f;break}}else return a.parent.remove(a);void 0!==c&&!1!=a.destroy(!0)&&(d.splice(c,1),b=!0);this.trigger("remove",a);return b}},parseItem:function(){},
parseItems:function(){this.startParseItems=!0;var a=this.items;if(a)for(var a=$H.isArr(a)?a:[a],d=0,b=a.length;d<b;d++)this.add(a[d])},beforeUpdate:function(){return this.trigger("beforeUpdate")},update:function(a,d){if(!a||!1==this.beforeUpdate())return!1;var b=this.xConfig,c=!0;$H.each(a,function(a){if("undefined"==typeof b[a])return c=!1});var f;if(c)this.xmodel.set(a),f=this;else{f=this.parent;var g=$("<span></span>").insertBefore(this.getEl());d||(void 0===a.autoRender&&(a.autoRender=!0),a=$H.extend(a,
this.initParam,{notCover:!0}));a=$H.extend(a,{xtype:this.xtype,renderBy:"replaceWith",renderTo:g},{notCover:["xtype"]});if(!a.cid||a.cid==this.cid)a._id=this._id;if(f){var k=this.index();if(!1==f.remove(this))return g.remove(),!1;f=f.add(a,k)}else{if(!1==this.destroy())return g.remove(),!1;f=new this.constructor(a)}}this.trigger("update",f);this.afterUpdate(f);return f},replace:function(a){return this.update(a,!0)},afterUpdate:function(a){this.trigger("afterUpdate",a)},beforeDestroy:function(){return this.trigger("beforeDestroy")},
destroy:function(a){if(!1==this.beforeDestroy())return!1;if(!this.destroyed)return this.callChild(),this.trigger("destroy"),this.clearListeners(),this.getEl().remove(),this.destroyed=!0,!a&&this.parent&&this.parent.remove(this),this.manager.unregister(this),delete this.initParam,delete this._container,delete this.renderTo,delete this._listeners,delete this.html,delete this.xmodel,delete this.children,this.afterDestroy(),!0},afterDestroy:function(){this.trigger("afterDestroy")}},{extend:function(a){var d=
this.prototype;$H.extend(d,a,{notCover:function(b){if("_customEvents"==b||"listeners"==b)return d[b]=(a[b]||[]).concat(d[b]||[]),!0;if("xtype"==b||"constructor"==b)return!0;if("xConfig"==b)return d[b]=$H.extendIf(a[b],d[b]),!0}})},html:function(a){return(new this($H.extend({autoRender:!1},a))).getHtml()}});a.registerHelper("ModelView",{placeItem:function(a,d){var b=d.context,c=d.num,c=b.getCid()+"-"+c,f=b.findHtml(a);return b.wrapMetaMorph(c,f)}});d=/[^<]*(<[a-zA-Z]+)/;return g});
$Define("C.ComponentManager",["CM.AbstractManager","CM.ViewManager"],function(f,b){var c=f.derive({type:"component",initialize:function(){var a=$H.getSingleton(b);this._types=a._types;this._all=a._all}});$CM=new c;return c});
$Define("C.AbstractComponent",["CM.ViewManager","CM.View"],function(f,b){$C=$H.ns("C",{});var c=$H.createClass();$H.inherit(c,b,{xtype:"AbstractComponent",xConfig:{extCls:"",tType:"",theme:"",cls:"",radius:null,shadow:!1,shadowInset:!1,shadowSurround:!1,shadowOverlay:!1,isMini:!1,isActive:!1,isFocus:!1,isInline:!1,activeCls:"hui-active",cmpCls:{depends:["cls"],parse:function(){return"hui-"+this.get("cls")}},tTypeCls:{depends:["tType"],parse:function(){var a=this.get("tType");return a?"hui-"+this.get("cls")+
"-"+a:""}},themeCls:{depends:["theme"],parse:function(){return this.get("theme")?"hui-"+this.get("cls")+"-"+this.get("theme"):""}},activeClass:{depends:["isActive","activeCls"],parse:function(){return this.get("isActive")?this.get("activeCls"):""}},radiusCls:{depends:["radius"],parse:function(){var a=this.get("radius");return a?"hui-radius-"+a:""}}},hasConfig:function(a,d){if(!d)return!1;if($H.isArr(d))for(var b=0,c=d.length;b<c;b++){if(this.match(a,d[b]))return!0}else if(this.match(a,d))return!0;
return!1},doConfig:function(){this.callSuper();this.icon&&this.add({xtype:"Icon",name:this.icon});this.isMini&&(this.defItem=$H.extend({isMini:!0},this.defItem))},preTmpl:function(){this.callSuper();this.tmpl=this.tmpl.replace(/(class=['"])/,"$1#js-component cmpCls tTypeCls themeCls radiusCls isMini?hui-mini shadow?hui-shadow shadowSurround?hui-shadow-surround shadowOverlay?hui-shadow-overlay shadowInset?hui-shadow-inset activeClass isFocus?hui-focus isInline?hui-inline ")},active:function(){this.update({isActive:!0})},
unactive:function(){this.update({isActive:!1})},txt:function(a){return void 0!==a?this.set("text",a):this.get("text")},valid:function(){var a=this.validator;if(a){var d=this.val();a.error||(a.error=function(a){new $C.Tips({text:a,theme:"error"})});return a=$H.Validator.valid(d,a)}for(var d=this.children,b=0,c=d.length;b<c;b++)if(a=d[b].valid(),!a)return a;return!0}},{define:function(a,d){var b=$H.createClass();$H.inherit(b,d||c,null,null,{notCover:function(a){return"define"==a}});$H.getSingleton(f).registerType(a,
b);return $C[a]=b}});return c});$Define("C.Icon","C.AbstractComponent",function(f){f=f.define("Icon");f.extend({xConfig:{cls:"icon",hasBg:!0,isAlt:!1,name:"",iconName:{depends:["name"],parse:function(){return"hui-icon-"+this.get("name")}}},tmpl:'<span {{bindAttr class="isAlt?hui-alt-icon iconName hasBg?hui-icon-bg"}}></span>',doConfig:function(b){$H.isStr(b)&&(b={name:b});this.callSuper([b])}});return f});
$Define("C.Button","C.AbstractComponent",function(f){f=f.define("Button");f.extend({xConfig:{cls:"btn",text:"",theme:"gray",iconPos:"",activeCls:"hui-btn-active",isBack:!1,radius:"little",shadow:!0,isInline:!0,iconPosCls:{depends:["iconPos"],parse:function(){var b=this.get("iconPos");return b?"hui-btn-icon-"+b:""}}},cls:"btn",defItem:{xtype:"Icon"},tmpl:'<a href="javascript:;" hidefocus="true" {{bindAttr class="text:hui-btn-icon-notxt isBack?hui-btn-back iconPosCls"}}><span class="hui-btn-txt">{{text}}</span>{{placeItem}}</a>'});
return f});
$Define("C.Panel","C.AbstractComponent",function(f){f=f.define("Panel");f.extend({xConfig:{cls:"panel",content:"",isLoading:!1,loadingTxt:"\u6b63\u5728\u52a0\u8f7d\u4e2d..."},tmpl:'<div>{{#if isLoading}}<div class="hui-panel-loading"><div class="hui-mask"></div><div class="hui-loading-container"><div class="hui-tips hui-tips-big hui-tips-black hui-radius-little"><span class="hui-icon hui-icon-loading"></span><span class="hui-tips-txt">{{loadingTxt}}</span></div></div></div>{{/if}}{{content}}{{placeItem}}</div>'});return f});
$Define("C.Popup","C.AbstractComponent",function(f){f=f.define("Popup");var b=0,c;f.extend({delayShow:!0,clickHide:!0,showPos:"center",destroyWhenHide:!0,shadowOverlay:!0,tmpl:"<div>{{placeItem}}</div>",doConfig:function(){this.callSuper();this.clickHide&&this.listeners.push({name:"click",el:$(document),handler:function(){this.hide()}});$H.android()&&(this.listeners.push({name:"show",custom:!0,handler:function(){!0!=$H.Events.trigger("component.popup.show")&&$("input,textarea,select").attr("disabled",
"disabled")}}),this.listeners.push({name:"hide",custom:!0,handler:function(){!0!=$H.Events.trigger("component.popup.hide")&&setTimeout(function(){$("input,textarea,select").removeAttr("disabled")},500)}}))},afterShow:function(){var a=this,d=a.getEl();d.css("z-index",1E3*b+1E3);if(!a.width&&a.parent){var c=a.width=a.parent.getEl().outerWidth();d.css("width",c)}d=a.showPos;if("string"==typeof d)a[d]();else"function"==typeof d&&d.call(a);a.noMask||a.mask();a.timeout&&setTimeout(function(){a.destroyed||
a.hide()},a.timeout)},hide:function(){!1!=this.callSuper()&&(this.noMask||this.unmask(),this.destroyWhenHide&&this.destroy())},top:function(){this.getEl().css({left:"80px",top:"8px",position:"fixed"})},center:function(){var a=this.getEl(),d=this.width||a.outerWidth(),b=this.height||a.outerHeight(),c=document,d=((c.documentElement.offsetWidth||c.body.offsetWidth)-d)/2,b=((c.documentElement.clientHeight||c.body.clientHeight)-b)/2+(c.documentElement.scrollTop||c.body.scrollTop),b=10>b?window.screen.height/
2-200:b;a.css({left:d+"px",top:b-(this.offsetTop||0)+"px"})},followEl:function(a){a=a||this.parent.getEl();a=$H.position(a[0]);this.getEl().css(a)},mask:function(){c||(c=$('<div class="hui-mask" style="display:none;"></div>').appendTo(document.body));c.css("z-index",1E3*b+998);0==b&&c.show();b++},unmask:function(){b--;0==b?c.hide():c.css("z-index",1E3*(b-1)+998)}});return f});
$Define("C.ControlGroup","C.AbstractComponent",function(f){f=f.define("ControlGroup");f.extend({xConfig:{cls:"ctrlgp",direction:"v",directionCls:{depends:["direction"],parse:function(){return"hui-ctrlgp-"+this.get("direction")}}},multi:!1,defItem:{xtype:"Button",radius:null,shadow:!1,isInline:!1},tmpl:'<div {{bindAttr class="directionCls"}}>{{placeItem}}</div>',listeners:[{name:"click",selector:".js-item",method:"delegate",handler:function(b){var c=$(b.currentTarget),c=this.find(">[_id="+c.attr("id")+
"]");0<c.length&&(c=c[0].index(),this.onItemClick(b,c))}}],parseItem:function(b){b.extCls=(b.extCls||"")+"js-item"},select:function(b){if(!this.notSelect&&(b="number"==typeof b?this.children[b]:"string"==typeof b?this.find(b)[0]:b))if(!this.multi&&!b.multi){var c=this.getSelected();c&&this.selectItem(c,!1);this.selectItem(b)}else this.selectItem(b,!b.get("selected"))},getSelected:function(b){var c=[];this.each(function(a,d){if(d.get(d.select?"selected":"isActive"))c.push(b?a:d)});return 0<c.length?
this.multi?c:c[0]:null},selectItem:function(b,c){(c=!1!=c)?b.select?b.select():b.active():b.select?b.select(c):b.unactive()},val:function(b){if(b){var c=b.split(",");this.each(function(a,d){d.select($H.contains(c,d.value))})}else return c=[],this.each(function(a,d){d.get("selected")&&c.push(d.value)}),c.join(",")},onItemClick:function(b,c){this.select(c);this.itemClick&&this.itemClick(this.children[c],c)}});return f});
$Define("C.Radio","C.AbstractComponent",function(f){f=f.define("Radio");f.extend({xConfig:{cls:"radio",name:"",text:"",value:"",selected:!1},tmpl:'<div {{bindAttr class="#hui-btn #hui-btn-gray selected?hui-radio-on"}}><span class="hui-icon hui-icon-radio"></span><input type="radio" {{bindAttr selected?checked name="name" value="value"}}/><span class="hui-radio-txt">{{text}}</span></div>',select:function(b){this.update({selected:!1!=b})},val:function(b){if(b)this.set("value",b);else return this.get("value")}});
return f});
$Define("C.Checkbox","C.AbstractComponent",function(f){f=f.define("Checkbox");f.extend({xConfig:{cls:"chkbox",name:"",text:"",value:"",selected:!1},multi:!0,tmpl:'<div {{bindAttr class="#hui-btn #hui-btn-gray selected?hui-chkbox-on"}}><span class="hui-icon hui-icon-chkbox"></span><input type="checkbox" {{bindAttr selected?checked name="name" value="value"}}/><span class="hui-chkbox-txt">{{text}}</span></div>',select:function(b){this.update({selected:!1!=b})},val:function(b){if(b)this.set("value",b);
else return this.get("value")}});return f});
$Define("C.Select","C.AbstractComponent",function(f){f=f.define("Select");f.extend({xConfig:{cls:"select",name:"",text:"\u8bf7\u9009\u62e9...",value:"",radius:"little"},optionClick:function(){},defItem:{xtype:"Menu",hidden:!0,markType:"hook",showPos:"followEl",renderTo:"body"},_customEvents:["change"],tmpl:'<div class="hui-btn hui-btn-gray hui-btn-icon-right"><span class="hui-icon hui-alt-icon hui-icon-carat-d hui-light"></span><input {{bindAttr value="value" name="name"}}/><span class="hui-btn-txt js-select-txt">{{text}}</span></div>',listeners:[{name:"click",
handler:function(){this.showOptions()}}],doConfig:function(b){var c=this;c.callSuper();for(var a=b.options,d=!1,f=0,e=a.length;f<e;f++){var h=a[f];if(h.value==b.value){c.set("text",h.text);d=h.selected=!0;break}}d||delete c.value;c.add({itemClick:function(a){a=a.get("value");c.val(a)},width:c.width,items:a})},showOptions:function(){this.children[0].show()},val:function(b){if(b){if(this.get("value")!=b){var c=this.children[0],a=c.find(">[value="+b+"]");0<a.length&&(this.trigger("change"),a=a[0],this.set("value",
b),this.txt(a.get("text")),c.select(a))}}else return this.get("value")}});return f});
$Define("C.Input","C.AbstractComponent",function(f){f=f.define("Input");f.extend({xConfig:{cls:"input",isTextarea:!1,value:"",placeholder:"",radius:"little",iconPos:"",btnPos:"",iconPosCls:{depends:["iconPos"],parse:function(){var b=this.get("iconPos");return b?"hui-input-icon-"+b:""}},btnPosCls:{depends:["btnPos"],parse:function(){var b=this.get("btnPos");return b?"hui-input-btn-"+b:""}}},type:"",withClear:!1,tmpl:'<div {{bindAttr class="iconPosCls btnPosCls"}}>{{placeItem}}{{#if isTextarea}}{{textarea class="#js-input" name="name" placeholder="placeholder" value=value}}{{else}}{{input type="#text" class="#js-input #hui-input-txt" name="name" placeholder="placeholder" value="value"}}{{/if}}</div>',listeners:[{name:"focus",
el:".js-input",handler:function(){this.getEl().addClass("hui-focus")}},{name:"blur",el:".js-input",handler:function(){this.getEl().removeClass("hui-focus")}}],doConfig:function(b){var c=this;"search"==b.type&&(c.icon="search");c.callSuper();b.isTextarea&&c.listeners.push({name:"input propertychange",el:".js-input",handler:function(){var a=c.findEl(".js-input"),d=a[0].scrollHeight;50<=d&&a.css("height",d)}});c.withClear&&c.add({xtype:"Button",radius:"big",icon:"delete",click:function(){this.parent.findEl("input").val("").focus()}})},
parseItem:function(b){"Icon"==b.xtype?this.get("iconPos")||this.set("iconPos","left"):"Button"==b.xtype&&(this.get("btnPos")||this.set("btnPos","right"))},val:function(b){var c=this.findEl("input,textarea");if(b)c.val(b);else return c.val()},focus:function(){this.findEl("input").focus()}});return f});
$Define("C.Label","C.AbstractComponent",function(f){f=f.define("Label");f.extend({xConfig:{cls:"label",text:"",color:"",textAlign:"",forName:"",colorCls:{depends:["color"],parse:function(){var b=this.get("color");return b?"hui-label-"+b:""}},textAlignCls:{depends:["textAlign"],parse:function(){var b=this.get("textAlign");return b?"c-txt-"+b:""}}},tmpl:'<label {{bindAttr class="colorCls textAlignCls" for="forName"}}>{{text}}</label>'});return f});
$Define("C.RowItem","C.AbstractComponent",function(f){f=f.define("RowItem");f.extend({xConfig:{cls:"rowitem",text:"",underline:!1,hasArrow:!1},tmpl:'<div {{bindAttr class="text?hui-rowitem-txt underline?hui-rowitem-underline"}}>{{text}}{{placeItem}}{{#if hasArrow}}<a href="javascript:;" hidefocus="true" class="hui-click-arrow" title="\u8be6\u60c5"><span class="hui-icon hui-alt-icon hui-icon-carat-r hui-light"></span></a>{{/if}}</div>',doConfig:function(b){this.callSuper();this.get("text")||this.set("text",
"&nbsp;");this.text&&void 0===this.underline&&this.set("underline",!0);b.click&&void 0===this.hasArrow&&this.set("hasArrow",!0)}});return f});$Define("C.Set","C.AbstractComponent",function(f){f=f.define("Set");f.extend({xConfig:{cls:"set",title:""},tmpl:'<div><h1 class="hui-set-title">{{title}}</h1><div class="hui-set-content">{{placeItem}}</div></div>'});return f});
$Define("C.Field","C.AbstractComponent",function(f){f=f.define("Field");f.extend({xConfig:{cls:"field",noPadding:!1},defItem:{xtype:"RowItem",xrole:"content"},tmpl:'<div {{bindAttr class="noPadding?hui-field-nopadding"}}><div class="hui-field-left">{{placeItem >[xrole=title]}}</div><div class="hui-field-right">{{placeItem >[xrole=content]}}</div></div>',doConfig:function(b){this.callSuper();var c=this.title;$H.isSimple(c)&&(c={text:c});c=$H.extend({xtype:"Label",xrole:"title"},c);this.add(c);c=this.content;
void 0===c&&!b.items&&(c="");$H.isSimple(c)&&(c={text:c,underline:!0});c&&(this.noPadding=!0,this.add(c))}});return f});$Define("C.Form","C.AbstractComponent",function(f){f=f.define("Form");f.extend({xConfig:{cls:"form"},tmpl:'<div><form action=""><div class="hui-form-tips c-txt-error"></div>{{placeItem}}</form></div>'});return f});
$Define("C.TabItem",["C.AbstractComponent","C.Panel"],function(f){f=f.define("TabItem");f.extend({xConfig:{cls:"tabitem",extCls:"js-item"},wrapHtml:['<li class="hui-tab-item">',"</li>"],defItem:{xtype:"Button",xrole:"title",radius:null,isInline:!1,shadow:!1},tmpl:"<div>{{placeItem >[xrole=title]}}</div>",initialize:function(){this.callSuper();this.titleCmp=this.find(">[xrole=title]")[0];this.contentCmp=this.find(">[xrole=content]")[0]},doConfig:function(b){this.callSuper();var c=b.title;"string"==
typeof c&&(c={text:c});"object"==typeof c&&this.add(c);b=b.content;"string"==typeof b&&(b={xtype:"Panel",content:b});"object"==typeof b&&($H.extend(b,{xrole:"content",hidden:!this.selected,extCls:"js-content"}),this.add(b))},parseItem:function(b){this.selected&&"title"==b.xrole&&(b.isActive=!0);b.icon&&void 0===b.iconPos&&(b.iconPos="top");this.activeType&&(b.activeCls="hui-btn-active-"+this.activeType)},select:function(b){var c=this.titleCmp,a=this.contentCmp;!1==b?(c.unactive(),a&&a.hide(),this.set("selected",
!1)):(c.active(),a&&a.show(),this.set("selected",!0))},getContent:function(b,c){c||(c=this.contentCmp);return this.callSuper([b,c])},setContent:function(b,c){c||(c=this.contentCmp);return this.callSuper([b,c])}});return f});
$Define("C.Tab",["C.AbstractComponent","C.TabItem","C.ControlGroup"],function(f,b,c){f=f.define("Tab",c);f.extend({xConfig:{cls:"tab"},defItem:{xtype:"TabItem"},listeners:[{name:"afterRender add remove",custom:!0,handler:function(){this.layout()}}],tmpl:'<div><ul class="js-tab-btns c-clear">{{placeItem >TabItem}}</ul>{{placeItem >TabItem>[xrole=content]}}</div>',parseItem:function(a){this.activeType&&(a.activeType=this.activeType);this.callSuper()},layout:function(){var a=this.children.length,d=Math.floor(100/
a);this.findEl(".js-tab-btns>li").each(function(b,c){c.style.width=b<a-1?d+"%":100-d*(a-1)+"%"})},setTabContent:function(a,d){d=d||this.getSelected(!0);this.findEl(".js-tab-content").index(d).html(a)}});return f});
$Define("C.Toolbar","C.AbstractComponent",function(f){f=f.define("Toolbar");f.extend({xConfig:{cls:"tbar",title:"",isHeader:!1,isFooter:!1},defItem:{xtype:"Button",theme:"black"},tmpl:'<div {{bindAttr class="isHeader?hui-header isFooter?hui-footer"}}>{{placeItem}}{{#if title}}<h1 class="hui-tbar-title js-tbar-txt">{{title}}</h1>{{/if}}</div>',parseItem:function(b){"Button"==b.xtype&&(b.shadowSurround=!0,"left"==b.pos?b.extCls=(b.extCls||"")+" hui-tbar-btn-left":"right"==b.pos&&(b.extCls=(b.extCls||
"")+" hui-tbar-btn-right"))}});return f});
$Define("C.Tips",["C.AbstractComponent","C.Popup","C.ControlGroup"],function(f,b){var c=f.define("Tips",b);c.extend({xConfig:{cls:"tips",text:"",radius:"normal",tType:"big",theme:"black"},timeout:1E3,tmpl:'<div {{bindAttr class="text:hui-tips-notxt"}}>{{placeItem}}{{#if text}}<span class="hui-tips-txt">{{text}}</span>{{/if}}</div>',doConfig:function(a){"loading"==a.type?$H.extend(this,{text:"\u6b63\u5728\u52a0\u8f7d\u4e2d...",timeout:null,noMask:!0,icon:"loading"}):"miniLoading"==a.type?$H.extend(this,
{showPos:"top",clickHide:!1,destroyWhenHide:!1,timeout:null,delayShow:!1,shadowOverlay:null,theme:null,noMask:!0,tType:"mini",items:{xtype:"Icon",name:"loading-mini",hasBg:!1}}):"topTips"==a.type&&$H.extend(this,{showPos:"top",noMask:!0,tType:"mini"});this.callSuper()}});return c});
$Define("C.Dialog",["C.AbstractComponent","C.Popup"],function(f,b){var c=f.define("Dialog",b);$H.extend(c,{alert:function(a){return new c({contentMsg:a,noClose:!0,noCancel:!0})},confirm:function(a,d){return new c({contentMsg:a,noClose:!0,okCall:function(){return d&&d(!0)},cancelCall:function(){return d&&d(!1)}})},prompt:function(a,d,b){b||(b=d,d="");return new c({contentMsg:a,noClose:!0,items:{xtype:"Input",xrole:"dialog-content",value:d},okCall:function(){var a=this.find("Input")[0].val();return b&&
b(a)}})}});c.extend({xConfig:{cls:"dialog",radius:"little",content:"",contentTitle:"",contentMsg:""},okTxt:"\u786e\u5b9a",cancelTxt:"\u53d6\u6d88",clickHide:!1,tmpl:'<div>{{placeItem >[xrole=dialog-header]}}<div class="hui-dialog-body">{{#if content}}{{content}}{{else}}<div class="hui-body-content"><h1 class="hui-content-title">{{contentTitle}}</h1><div class="hui-content-msg">{{contentMsg}}</div>{{placeItem >[xrole=dialog-content]}}</div>{{/if}}{{#unless noAction}}<div class="hui-body-action">{{placeItem >[xrole=dialog-action]}}</div>{{/unless}}</div></div>',
doConfig:function(a){var d=this;d.callSuper();a=a.items;d.title&&!d.hasConfig("[xrole=dialog-header]",a)&&d.add({xtype:"Toolbar",title:d.title,theme:"gray",xrole:"dialog-header",extCls:"hui-dialog-header",items:!d.noClose&&{xtype:"Button",radius:"big",icon:"delete",isMini:!1,theme:"gray",pos:"left",click:function(){d.hide()}}});!d.noAction&&!d.hasConfig("[xrole=dialog-action]",a)&&(a=[],d.noCancel||a.push({title:{isActive:1==d.activeBtn,text:d.cancelTxt,click:function(){!1!=(d.cancelCall&&d.cancelCall())&&
d.hide()}}}),d.noOk||a.push({title:{text:d.okTxt,isActive:2==d.activeBtn,click:function(){!1!=(d.okCall&&d.okCall())&&d.hide()}}}),d.add({xtype:"Tab",xrole:"dialog-action",theme:"border-top",notSelect:!0,items:a}))}});return c});
$Define("C.Menu",["C.AbstractComponent","C.Popup","C.ControlGroup"],function(f,b,c){f=f.define("Menu",b);f.extend(c.prototype);f.extend({xConfig:{cls:"menu"},markType:null,destroyWhenHide:!1,defItem:{xtype:"Button",radius:null,shadow:!1,isInline:!1},tmpl:'<div {{bindAttr class="directionCls"}}>{{placeItem}}</div>',parseItem:function(a){c.prototype.parseItem.call(this,a);var d=this.markType;d?"hook"==d&&(a.items={name:"check",isAlt:!0,hasBg:!1},a.iconPos="left",a.activeCls="hui-item-select"):this.notSelect=
!0;a.isActive=a.selected}});return f});
$Define("C.Hcard",["C.AbstractComponent","CM.Model","CM.Collection"],function(f,b,c){f=f.define("Hcard");f.extend({xConfig:{cls:"hcard",image:"",title:"",hasArrow:!1,desc:null,descs:{depends:["desc"],type:c.derive({model:b.derive({fields:{iconCls:{depends:["icon"],parse:function(){var a=this.get("icon");return a?"hui-icon-"+a:""}}}})}),parse:function(){var a=this.get("desc");return a?$H.isArr(a)?a:[a]:a}}},tmpl:'<div {{bindAttr class="image?hui-hcard-hasimg"}}>{{#if image}}<div class="hui-hcard-img"><img {{bindAttr src="image"}}></div>{{/if}}<div class="hui-hcard-content"><div class="hui-content-title">{{title}}</div>{{#each descs}}<div class="hui-content-desc">{{#if icon}}<span {{bindAttr class="#hui-icon #hui-mini #hui-alt-icon iconCls #hui-light"}}></span>{{/if}}{{text}}</div>{{/each}}</div>{{placeItem}}{{#if hasArrow}}<a href="javascript:;" hidefocus="true" class="hui-click-arrow" title="\u8be6\u60c5"><span class="hui-icon hui-alt-icon hui-icon-carat-r hui-light"></span></a>{{/if}}</div>',doConfig:function(a){this.callSuper();
a.click&&void 0===this.hasArrow&&(this.hasArrow=!0)}});return f});
$Define("C.Vcard","C.AbstractComponent",function(f){f=f.define("Vcard");f.extend({xConfig:{cls:"vcard",image:"",title:"",extraTitle:""},tmpl:'<div><div class="hui-vcard-title hui-title-hasimg c-clear"><div class="hui-title-img"><img {{bindAttr src="image"}}></div><div class="hui-title-txt">{{title}}</div><div class="hui-title-extra">{{extraTitle}}</div></div>{{placeItem >[xrole!=action]}}<div class="hui-vcard-action">{{placeItem >[xrole=action]}}</div></div>',doConfig:function(b){this.callSuper();
if(b=b.action)b=$H.extend({xtype:"Button",radius:null,isInline:!1,xrole:"action"},b),this.add(b)}});return f});
$Define("C.ModelList","C.AbstractComponent",function(f){f=f.define("ModelList");f.extend({xConfig:{cls:"mlist",isEmpty:!1,emptyTips:"\u6682\u65e0\u7ed3\u679c",pdText:"\u4e0b\u62c9\u53ef\u5237\u65b0",pdComment:"\u4e0a\u6b21\u5237\u65b0\u65f6\u95f4\uff1a",pdTime:"",hasPullRefresh:!1},tmpl:'<div class="hui-list"><div class="hui-list-inner">{{#if isEmpty}}<div class="hui-list-empty js-empty">{{emptyTips}}/div>{{/if}}{{#if hasPullRefresh}}<div class="hui-list-pulldown hui-pd-pull c-h-middle-container"><div class="c-h-middle"><span class="hui-icon hui-alt-icon hui-icon-arrow-d hui-light"></span><span class="hui-icon hui-alt-icon hui-icon-loading-mini"></span><div class="hui-pd-txt">{{#if pdText}}<div class="js-txt">{{pdText}}</div>{{/if}}{{#if pdComment}}<div class="js-comment hui-pd-comment"><span class="js-pdComment">{{pdComment}}</span><span class="js-pdTime">{{pdTime}}</span></div>{{/if}}</div></div></div>{{/if}}<div class="js-item-container">{{placeItem}}</div>{{#if hasPullRefresh}}<div class="hui-list-more"><a href="javascript:;" hidefocus="true" class="hui-btn hui-btn-gray hui-shadow hui-inline hui-radius-normal"><span class="hui-btn-txt">\u67e5\u770b\u66f4\u591a</span></a></div>{{/if}}</div></div>',init:function(){var b=
this;b.itemXtype&&((b.defItem||(b.defItem={})).xtype=b.itemXtype);var c=b.model;c.each(function(a,d){b.addListItem(d)});b.listenTo(c,{add:function(a,d){b.addListItem(d)},remove:function(a,d){b.removeListItem(d)},reset:function(){b.removeListItem("emptyAll")}});b.hasPullRefresh=b.hasPullRefresh&&window.iScroll;b.hasPullRefresh&&(b.listen({name:"afterRender",handler:function(){var a=this,d=a.getEl(),b=d.find(".hui-list-pulldown");a.scroller=new window.iScroll(d[0],{useTransition:!0,topOffset:50,onRefresh:function(){b.hasClass("hui-pd-refresh")&&
(b.removeClass("hui-pd-refresh hui-pd-release"),a.set("pdText","\u4e0b\u62c9\u53ef\u5237\u65b0"))},onScrollMove:function(){5<this.y&&!b.hasClass("hui-pd-release")?(b.addClass("hui-pd-release"),a.set("pdText","\u677e\u5f00\u53ef\u5237\u65b0"),this.minScrollY=0):5>this.y&&b.hasClass("hui-pd-release")&&(b.removeClass("hui-pd-release"),a.set("pdText","\u4e0b\u62c9\u53ef\u5237\u65b0"),this.minScrollY=-50)},onScrollEnd:function(){b.hasClass("hui-pd-release")&&(b.addClass("hui-pd-refresh"),a.set("pdText",
"\u6b63\u5728\u5237\u65b0"),a.refresh())}})}}),b.listenTo(b.model,"sync",function(){b.findEl(".js-pdTime").html($H.formatDate($H.now(),"HH:mm"));setTimeout(function(){b.refreshScroller()},0)}),b.listen({name:"afterShow",handler:function(){b.refreshScroller()}}),b.listen({name:"click",method:"delegate",selector:".hui-list-more",handler:function(){b.getMore()}}))},addListItem:function(b){this.set("isEmpty",!1);this.add({model:b})},removeListItem:function(b){"emptyAll"==b?this.remove(this.children):
this.remove(function(c){return c.model&&c.model.id==b.id});0==this.children.length&&this.set("isEmpty",!0)},refreshScroller:function(){this.scroller&&this.getEl()[0].clientHeight&&this.scroller.refresh()},destroy:function(){this.scroller&&(this.scroller.destroy(),this.scroller=null);this.callSuper()}});return f});
$Define("M.AbstractModule","CM.View",function(f){var b=$H.createClass();$H.inherit(b,f,{useCache:$H.noop,cache:$H.noop,init:$H.noop,reset:$H.noop,exit:function(){return!0},cleanCache:function(){this.clearCache=!0}});return b});$Define("M.AbstractNavigator","handy.base.Object",function(f){var b=$H.createClass();f.extend(b.prototype,{navigate:function(){}});return b});
$Define("M.History","handy.base.HashChange",function(f){var b=$H.createClass(),c=0;$H.extend(b.prototype,{initialize:function(a,d){"function"==typeof a&&(d=a,a=null);this.error=d||$H.noop;this.key=a||"handy";this.states=[];f.listen($H.Function.bind(this.stateChange,this))},stateChange:function(){var a=this.getHashParam(),d=a.hKey,b=this.currentKey,c=this.states,f=c[b];if(d==b)return!1;(c=c[d])?a=c.onStateChange(c.param,!0):($D.warn("hisory state not found"),a=this.error("stateNotFound",a));!0!=a?
(a={hKey:b,param:f.param},this.saveHash(a)):this.currentKey=d},saveState:function(a){var d=this.currentKey=this.key+ ++c;this.states.push(d);this.states[d]=a;this.saveHash({hKey:d,param:a.param})},saveHash:function(a){$H.setHash("#"+$H.Json.stringify(a))},getHashParam:function(){try{var a=$H.getHash().replace("#","");return $H.parseJson(a)}catch(d){$H.Debug.warn("History.getCurrentState:parse hash error:"+d.message)}},getCurrentState:function(){try{var a=this.getHashParam();return this.states[a.hKey]}catch(d){$H.Debug.warn("History.getCurrentState:parse hash error:"+
d.message)}},getPreState:function(){try{for(var a=this.getHashParam().hKey,d=this.states,b=d.length,c=0;c++;c<b)if(d[c]==a)return 0<c?d[d[--c]]:null}catch(f){$H.Debug.error("History.getPreState error:"+f.message,f)}},back:function(){var a=this.getPreState();if(a)a.onStateChange(a.param)}});return b});
$Define("M.ModuleManager",["M.History","CM.AbstractManager"],function(f,b){var c=$H.createClass();$H.inherit(c,b,{type:"module",_createMod:function(a){var d=this,b=a.modName;d.modules[b]={waiting:!0};$Require(d.defModPackage+b,function(c){var f={renderTo:d.container,name:b,xtype:b,extCls:"js-module m-module m-"+b.replace(/\./g,"-"),hidden:!0};$H.extend(f,a);c=new c(f);d.modules[b]=c;$H.trigger("afterRender",c.getEl());d.requestMod==b&&d._showMod(c)})},_showMod:function(a){var b=this.modules[this.currentMod];
if(!this.navigator||!this.navigator.navigate(a,b,this))b&&b.hide(),a.show();b&&(b.isActive=!1);a.isActive=!0;this.currentMod=a.name},_destroy:function(a){a.destroy();delete this.modules[a.name]},initialize:function(a){var b=this;b.callSuper();a&&(b.conf=a,$H.extend(b,a),b.container=a.container?$(a.container):$(document.body));b.defModPackage+=".";b.history=new f(function(a,c){b.go(c.param)});b.modules={}},go:function(a,b){"string"==typeof a&&(a={modName:a});var c=a.modName,e=this.currentMod,f=this.modules,
j=f[e];if(e==c)j.waiting||j.reset();else{if(j&&!j.waiting)if(j._forceExit)j._forceExit=!1;else if(!1==j.exit())return!1;this.requestMod=c;(c=f[c])?!0!=c.notCache&&!0!=c.clearCache&&!1!=c.useCache(a)?(!1==c.clearCache,this._showMod(c),c.cache(a)):c.waiting||(this._destroy(c),this._createMod(a)):this._createMod(a);!0!=b&&this.history.saveState({onStateChange:$H.Function.bind(this.go,this),param:a});return!0}},update:function(a,b){var c=a.update(b);c&&(this.modules[a.name]=c,$H.trigger("afterRender",
c.getEl()));return c},clearCache:function(a){a.notCache=!0},back:function(a){a&&(this.modules[this.currentMod]._forceExit=!0);history.back()}});return c});
