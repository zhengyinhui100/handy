/* Handy v1.0.0-dev | 2014-03-17 | zhengyinhui100@gmail.com */
$Define("CM.AbstractView","CM.ViewManager",function(l){var d=$HO.createClass(),a=/^(<[a-zA-Z]+)/,b=/^[^>]+class=/,c=/(class=")/;$HO.extend(d,{extend:function(a){var b=this.prototype;$HO.extend(b,a,{notCover:function(e){if($HO.contains(["_customEvents","listeners"],e))return b[e]=(a[e]||[]).concat(b[e]||[]),!0;if("xtype"==e||"constructor"==e)return!0}})},html:function(a){return(new this($HO.extend({autoRender:!1},a))).getHtml()}});$HO.extend(d.prototype,$H.Events);$HO.extend(d.prototype,{xtype:"AbstractView",
autoRender:!0,renderBy:"append",children:[],_customEvents:"beforeRender render afterRender beforeShow afterShow hide destroy".split(" "),_defaultEvents:"mousedown mouseup mouseover mousemove mouseenter mouseleave dragstart drag dragenter dragleave dragover drop dragend touchstart touchmove touchend touchcancel keydown keyup keypress click dblclick focus focusin focusout contextmenu change submit".split(" "),initialize:function(a){this.manager=this.constructor.manager||l;this.doConfig(a);this.beforeRender();
!1!=this.autoRender&&(this.render(),this.afterRender());this.manager.register(this)},doConfig:function(a){var b=this;b.params=a;b.settings=$HO.clone(a);b.renderTo=a.renderTo?$(a.renderTo):$(document.body);var e=b.listeners||[];a.listeners&&(e=e.concat(a.listeners));b._listeners=e;$HO.extend(b,a,{notCover:function(e){var c=b[e],j=$HO.contains(b._customEvents,e);if($HO.contains(b._defaultEvents,e))b._listeners.push({name:e,handler:a[e]});else if(j)b.on(e,a[e]);if(null!=c&&"object"==typeof c||$HO.isFunction(c))return!0}});
a.defItem&&$HO.extend(b.defItem,a.defItem)},getEl:function(){return this._container},getId:function(){return this._id||(this._id=this.manager.generateId(this.cid))},initHtml:function(){"string"!=typeof this.tmpl&&(this.tmpl=this.constructor.prototype.tmpl=this.tmpl.join(""));return $H.Template.tmpl({id:this.xtype,tmpl:this.tmpl},this)},getHtml:function(){var m=this.getId(),g;g="visibility"==this.displayMode?"visibility:hidden;":"display:none;";var e=this.initHtml(),k=b.test(e),f=this.extCls+" ";k&&
(e=e.replace(c,"$1"+f));return e=e.replace(a,'$1 id="'+m+'" style="'+g+'"'+(k?"":' class="'+f+'"'))},findHtml:function(a){a=">*"==a?this.children:this.find(a);for(var b=[],e=0;e<a.length;e++)b.push(a[e].getHtml());return b.join("")},initStyle:function(){var a=this.getEl(),b=this.style||{};void 0!=this.width&&(b.width=this.width);void 0!=this.height&&(b.height=this.height);a.css(b)},beforeRender:function(){this.parseItems();this.trigger("beforeRender")},render:function(){this.trigger("render");var a=
this.getHtml();this.renderTo[this.renderBy](a)},afterRender:function(){if(this.rendered)return!1;this.callChild();this._container=$("#"+this.getId());this.rendered=!0;this.initStyle();!0!=this.notListen&&this.initListeners();this.disabled&&this.disable();this.trigger("afterRender");this.hidden||this.show()},hide:function(){if(!this.showed)return!1;this.showed=!1;var a=this.getEl();"visibility"==this.displayMode?a.css({visibility:"hidden"}):a.hide();this.trigger("hide")},show:function(a,b){var e=this;
if(e.showed||b&&e.hidden)return!1;if(!a&&e.delayShow)setTimeout(function(){d.prototype.show.call(e,!0)},0);else{e.trigger("beforeShow");e.showed=!0;var c=e.getEl();"visibility"==e.displayMode?c.css({visibility:"visible"}):c.show();e.callChild([null,!0]);e.afterShow()}},afterShow:function(){this.trigger("afterShow")},enable:function(){this.resume();this.getEl().removeClass("hui-disable").find("input,textarea,select").removeAttr("disabled")},disable:function(){this.suspend();this.getEl().addClass("hui-disable").find("input,textarea,select").attr("disabled",
"disabled")},listen:function(a){var b=this,e=a.name,c=a.context,f=a.handler;if(a.custom)b.on(e,f,c);else{var j=b._listeners,h=a.el,d=a.method||"bind",r=a.selector,l=a.data,q=a.delegation=function(){if(!0!=b.isSuspend)return f.apply(c||b,arguments)};$H.Browser.mobile()&&"click"==e&&(e="touchend");h=h?"string"==typeof h?b.find(h):h:b.getEl();if(r)if(l)h[d](r,e,l,q);else h[d](r,e,q);else if(l)h[d](e,l,q);else h[d](e,q);j.push(a)}},unlisten:function(a){var b=a.name,e=a.handler;if(a.custom)this.off(b,
e);else{var c=a.el,f="delegate"==a.method?"undelegate":"unbind";a=a.selector;var j;$H.Browser.mobile()&&"click"==b&&(b="touchend");for(var c=c?"string"==typeof c?this.find(c):c:this.getEl(),d=this._listeners.length-1;0<=d;d--){var l=this._listeners[d];if(l.handler==e){j=l.delegation;this._listeners.splice(d,1);break}}if(a)c[f](a,b,j);else c[f](b,j)}},initListeners:function(){if(this.listened)return!1;this.listened=!0;var a=this._listeners;this._listeners=[];for(var b=a.length-1;0<=b;b--)this.listen(a[b]);
this.callChild()},clearListeners:function(){for(var a=this._listeners,b=a.length-1;0<=b;b--)this.unlisten(a[b]);this.off("all");this.callChild()},suspend:function(){if(this.isSuspend)return!1;this.isSuspend=!0;this.callChild()},resume:function(){if(!this.isSuspend)return!1;this.isSuspend=!1;this.callChild()},each:function(a,b){for(var e=this.children,c=e.length,f,d=0;d<c;){f=e[d];f=b?a.apply(f,b):a(d,f);if(!1===f)break;c==e.length?d++:c=e.length}},match:function(a,b){if("*"==a)return!0;var e=b||this,
c,f,d;a=a.replace(/^([^\[]+)/,'[xtype="$1"]');for(var h=/\[([^=|\!]+)(=|\!=)([^=]+)\]/g;c=h.exec(a);)if(f=c[1],d=c[2],c=eval(c[3]),"="===d?e[f]!=c:e[f]==c)return!1;return!0},find:function(a,b){var c=this;if(0!=a.indexOf("$"))return c.getEl().find(a);b=b||[];if(0<a.indexOf(","))return $HO.each(a.split(","),function(a,m){b=b.concat(c.find(m))}),b;var d=1==a.indexOf(">"),f=a.replace(/^\$>?\s?/,""),j=f.search(/\s|>/),h;0<j&&(h=f.substring(j),f=f.substring(0,j));c.each(function(c,e){e.match(f)&&(h?e.find("$"+
h,b):b.push(e));d||e.find(a,b)});return b},parents:function(a){if(a&&0!=a.indexOf("$"))return this.getEl().parents(a);for(var b=this;b.parent;)if(b=b.parent,a&&this.match(a,b))return b;return a||b===this?null:b},index:function(){var a=this,b=a.parent;if(b){var c;b.each(function(b,g){if(g==a)return c=b,!1});return c}return null},callChild:function(a,b){0!=this.children.length&&(a&&"string"!=typeof a&&(b=a,a=null),a=a||arguments.callee.caller.$name,this.each(function(c,d){b?d[a].apply(d,b):d[a].call(d)}))},
add:function(a){this.children.push(a);a.parent=this},remove:function(a){for(var b=this.children,c=!1,d=0,f=b.length;d<f;d++)b[d]==a&&(b.splice(d,1),a.destroy(),c=!0);return c},addItem:function(a){var b=this.settings,c=b.items;c?$HO.isArray(c)||(b.items=[c]):b.items=[];b.items.push(a)},parseItem:function(){},parseItems:function(){var a=this.settings.items;if(a)for(var a=a.length?a:[a],b=0,c=a.length;b<c;b++){var d=a[b];this.defItem&&$HO.extend(d,this.defItem,{notCover:!0});this.parseItem(d);var f=
this.manager.getClass(d.xtype);f?(d.renderTo||(d.autoRender=!1),d=new f(d),this.add(d)):$D.error("xtype:"+d.xtype+"\u672a\u627e\u5230")}},update:function(){},destroy:function(){if(this.destroyed)return!1;this.callChild();this.trigger("destroy");this.clearListeners();this.getEl().remove();this.destroyed=!0;this.parent&&this.parent.remove(this);this.manager.unregister(this);delete this.params;delete this.settings;delete this._container;delete this.renderTo;delete this._listeners;delete this.children}});
return d});
$Define("CM.AbstractManager",function(){var l=$HO.createClass();$HO.extend(l.prototype,{_types:{},_all:{},type:"manager",registerType:function(d,a){this._types[d]=a;a.prototype.xtype=d;this[d]=a},getClass:function(d){return this._types[d]},register:function(d){this._all[d.getId()]=d},unregister:function(d){delete this._all[d.getId()]},eachInEl:function(d,a){var b=this;d.find(".js-"+b.type).each(function(c,d){d=$(d);var g=d.attr("id");(g=b.get(g))&&a(g)})},generateId:function(d,a){var b=$H.expando+
"_"+this.type+"_"+(d||$H.Util.getUuid());if(!0!=a&&this._all[b])$D.error("id\u91cd\u590d:"+b);else return b},get:function(d){var a=this._all;return a[d]||a[this.generateId(d,!0)]}});return l});
$Define("C.Model",function(){var l=$HO.createClass();$HO.extend(l.prototype,$H.Events);$HO.extend(l.prototype,{_pending:!1,idAttribute:"id",_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=$HO.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;if(!c)return!0;this.trigger("invalid",this,c,$HO.extend(b,{validationError:c}));return!1},initialize:function(a,b){var c=a||{};b||(b={});this.cid=$H.Util.getUuid();this.attributes={};b.collection&&(this.collection=
b.collection);b.parse&&(c=this.parse(c,b)||{});c=$HO.extend(c,$H.Util.result(this,"defaults"),{notCover:!0});this.set(c,b);this.changed={}},toJson:function(){return $HO.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){return $H.String.escapeHTML(this.get(a))},has:function(a){a=this.get(a);return null!=a&&void 0!=a},set:function(a,b,c){var d;"object"===typeof a?(d=a,c=b):(d={})[a]=b;c||(c={});if(!this._validate(d,c))return!1;var g=c.unset;a=c.silent;var e=[],k=
this._changing;this._changing=!0;k||(this._previousAttributes=$H.Object.clone(this.attributes),this.changed={});var f=this.attributes,j=this._previousAttributes;this.idAttribute in d&&(this.id=d[this.idAttribute]);for(var h in d)b=d[h],$HO.equals(f[h],b)||e.push(h),$HO.equals(j[h],b)?delete this.changed[h]:this.changed[h]=b,g?delete f[h]:f[h]=b;if(!a){e.length&&(this._pending=c);b=0;for(d=e.length;b<d;b++)this.trigger("change:"+e[b],this,f[e[b]],c)}if(k)return this;if(!a)for(;this._pending;)c=this._pending,
this._pending=!1,this.trigger("change",this,c);this._changing=this._pending=!1;return this},unset:function(a,b){b=b||{};b.unset=!0;return this.set(a,void 0,b)},clear:function(a){var b={},c;for(c in this.attributes)b[c]=void 0;a=a||{};a.unset=!0;return this.set(b,a)},hasChanged:function(a){var b=this.changed;return null==a?!$HO.isEmpty(b):$HO.contains(b,a)},changedAttrbutes:function(a){if(!a)return this.hasChanged()?$HO.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes,
g;for(g in a)if(!$HO.equals(d[g],b=a[g]))(c||(c={}))[g]=b;return c},previous:function(a){return null==a||!this._previousAttributes?null:this._previousAttributes[a]},fetch:function(a){var b=this;a=a?$HO.clone(a):{};void 0===a.parse&&(a.parse=!0);var c=a.success;a.success=function(d){if(!b.set(b.parse(d,a),a))return!1;c&&c(b,d,a);b.trigger("sync",b,d,a)};d(b,a);return b.sync("read",b,a)},save:function(a,b,c){var m,g=this.attributes;null==a||"object"===typeof a?(m=a,c=b):(m={})[a]=b;c=$HO.extend({validate:!0},
c);if(m&&!c.wait){if(!this.set(m,c))return!1}else if(!this._validate(m,c))return!1;m&&c.wait&&(this.attributes=$HO.extend({},g,m));void 0===c.parse&&(c.parse=!0);var e=this,k=c.success;c.success=function(a){e.attributes=g;var b=e.parse(a,c);c.wait&&(b=$HO.extend(m||{},b));if($HO.isObject(b)&&!e.set(b,c))return!1;k&&k(e,a,c);e.trigger("sync",e,a,c)};d(this,c);a=this.isNew()?"create":c.patch?"patch":"update";"patch"===a&&(c.oAttrs=m);a=this.sync(a,this,c);m&&c.wait&&(this.attributes=g);return a},destroy:function(a){a=
a?$HO.clone(a):{};var b=this,c=a.success,m=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(e){(a.wait||b.isNew())&&m();c&&c(b,e,a);b.isNew()||b.trigger("sync",b,e,a)};if(this.isNew())return a.success(),!1;d(this,a);var g=this.sync("delete",this,a);a.wait||m();return g},url:function(){var a=$H.Util.result(this,"urlRoot")||$H.Util.result(this.collection,"url");a||$D.error("\u5fc5\u987b\u8bbe\u7f6e\u4e00\u4e2aurl\u5c5e\u6027\u6216\u8005\u51fd\u6570",Error("\u5fc5\u987b\u8bbe\u7f6e\u4e00\u4e2aurl\u5c5e\u6027\u6216\u8005\u51fd\u6570"));
return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},$HO.extend(a||{},{validate:!0}))}});var d;return l});
$Define("C.Collection","C.Model",function(l){var d=$HO.createClass();$HO.extend(d.prototype,$H.Events);$HO.extend(d.prototype,{_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(a instanceof l)return a;b=b?$HO.clone(b):{};b.collection=this;var c=new this.model(a,b);if(!c.validationError)return c;this.trigger("invalid",this,c.validationError,b);return!1},_addReference:function(a){this._byId[a.cid]=a;null!=a.id&&(this._byId[a.id]=a);a.collection||(a.collection=
this);a.on("all",this._onModelEvent,this)},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"===a||"remove"===a)&&c!==this||("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))},initialize:function(a,b){b||(b={});b.model&&(this.model=b.model);void 0!==b.comparator&&(this.comparator=
b.comparator);this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,$HO.extend({silent:!0},b))},toJSON:function(a){return $H.Collection.map(this,function(b){return b.toJSON(a)})},add:function(a,b){$HO.extend(b,{add:!0,remove:!1,merge:!1});return this.set(a,b)},remove:function(a,b){var c=!$HO.isArray(a);a=c?[a]:$HO.clone(a);b||(b={});var d,g,e,k;d=0;for(g=a.length;d<g;d++)if(k=a[d]=this.get(a[d]))delete this._byId[k.id],delete this._byId[k.cid],e=this.indexOf(k),this.models.splice(e,
1),this.length--,b.silent||(b.index=e,k.trigger("remove",k,this,b)),this._removeReference(k,b);return c?a[0]:a},set:function(a,b){b=$H.Util.extend(b,{add:!0,remove:!0,merge:!0});b.parse&&(a=this.parse(a,b));var c=!$HO.isArray(a),d=c?a?[a]:[]:$HO.clone(a),g,e,k,f,j,h,t=b.at,r=this.model,u=this.comparator&&null==t&&!1!==b.sort,q="string"==typeof this.comparator?this.comparator:null,n=[],v=[],s={},x=b.add,y=b.merge,w=b.remove,p=!u&&x&&w?[]:!1;g=0;for(e=d.length;g<e;g++){j=d[g]||{};k=j instanceof l?f=
j:j[r.prototype.idAttribute||"id"];if(k=this.get(k))w&&(s[k.cid]=!0),y&&(j=j===f?f.attributes:j,b.parse&&(j=k.parse(j,b)),k.set(j,b),u&&(!h&&k.hasChanged(q))&&(h=!0)),d[g]=k;else if(x){f=d[g]=this._prepareModel(j,b);if(!f)continue;n.push(f);this._addReference(f,b)}f=k||f;p&&(f.isNew()||!s[f.id])&&p.push(f);s[f.id]=!0}if(w){g=0;for(e=this.length;g<e;++g)s[(f=this.models[g]).cid]||v.push(f);v.length&&this.remove(v,b)}if(n.length||p&&p.length)if(u&&(h=!0),this.length+=n.length,null!=t){g=0;for(e=n.length;g<
e;g++)this.models.splice(t+g,0,n[g])}else{p&&(this.models.length=0);j=p||n;g=0;for(e=j.length;g<e;g++)this.models.push(j[g])}h&&this.sort({silent:!0});if(!b.silent){g=0;for(e=n.length;g<e;g++)(f=n[g]).trigger("add",f,this,b);(h||p&&p.length)&&this.trigger("sort",this,b)}return c?d[0]:d},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c],b);b.previousModels=this.models;this._reset();a=this.add(a,$HO.extend({silent:!0},b));b.silent||this.trigger("reset",
this,b);return a},push:function(a,b){return this.add(a,$HO.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){return this.add(a,$HO.extend({at:0},b))},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,
b){return $HO.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var d in a)if(a[d]!==b.get(d))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){this.comparator||$D.error("\u6ca1\u6709\u6bd4\u8f83\u5668",Error("\u6ca1\u6709\u6bd4\u8f83\u5668"));a||(a={});"string"==typeof this.comparator||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort($H.Function.bind(this.comparator,this));a.silent||this.trigger("sort",this,
a);return this},pluck:function(a){return $H.Collection.invoke(this.models,"get",a)},parse:function(a){return a},clone:function(){return new this.constructor(this.models)}});$HO.each(["some","every","find","filter","invoke"],function(a){d.prototype[a]=function(){var b=Array.prototype.slice.call(arguments),c=$H.Collection;b.unshift(this.models);return c[a].apply(c,b)}});return d});
