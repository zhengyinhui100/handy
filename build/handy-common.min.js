/* Handy v1.0.0-dev | 2014-03-30 | zhengyinhui100@gmail.com */
$Define("CM.AbstractEvents",function(){var l=$H.createClass();$H.extend(l.prototype,$H.Events);$H.extend(l.prototype,{_eventCache:{},_listenTo:[],_parseListenToEvents:function(f,b,d,e){var c=this,a=$H.toArray(arguments,3);return c._parseEvents(d,function(g){g.unshift(b);c[f].apply(c,g.concat(a))})},listenTo:function(f,b,d,e,c){if(!this._parseListenToEvents("listenTo",f,b,d,e,c)){"number"==typeof e&&(c=e,e=null);e=e||this;var a=this._delegateHandler(d,e);this._listenTo.push({target:f,name:b,delegation:a,
handler:d});f.on(b,a,e,c)}},unlistenTo:function(f,b,d){if(!this._parseListenToEvents("unlistenTo",f,b,d)){var e=this._listenTo,c="all"==f;$H.each(e,function(a,g){if(c||g.name==b&&g.handler==d&&g.target==f)g.target.off(g.name,g.delegation),e.splice(a,1)})}}});return l});
$Define("CM.AbstractDao","B.LocalStorage",function(l){var f=$H.createClass();$H.extend(f.prototype,{_ajaxMethodMap:{create:"POST",update:"POST",patch:"PATCH","delete":"DELETE",read:"GET"},_localMethodMap:{create:"setItem",update:"setItem",patch:"setItem","delete":"removeItem",read:"getItem"},ajax:function(b){this.beforeSend(b);b.error=$H.intercept(this.error,b.error);b.success=$H.intercept(this.success,b.success);return $.ajax(b)},beforeSend:$H.noop,error:$H.noop,success:$H.noop,get:function(){},
set:function(){},remove:function(){},sync:function(b,d,e){e=e||{};var c=e.storeType||"remote",a={type:"POST",dataType:"json"};e.url||(a.url=d.getUrl());if(null==e.data&&d&&("create"===b||"update"===b||"patch"===b))a.data=e.attrs||d.toJSON(e);if("remote"==c)a.url+="/"+b+".do",$H.extend(a,e),this.ajax(a);else l[this._localMethodMap[b]](a);d.trigger("request",d,e)}});return f});
$Define("CM.AbstractManager",function(){var l=$H.createClass();$H.extend(l.prototype,{_types:{},_all:{},type:"manager",registerType:function(f,b){this._types[f]=b;b.prototype.xtype=f},getClass:function(f){return $H.isClass(f)?f:this._types[f]||$H.namespace(f)},register:function(f){this._all[f.getId()]=f},unregister:function(f){var b=this._all,d=f.getId();b[d]==f&&delete b[d]},eachInEl:function(f,b){var d=this;f.find(".js-"+d.type).each(function(e,c){c=$(c);var a=c.attr("id");(a=d.get(a))&&b(a)})},
generateId:function(f,b){var d=$H.expando+"_"+this.type+"_"+(f||$H.Util.getUuid());if(!0!=b&&this._all[d])$D.error("id\u91cd\u590d:"+d);else return d},get:function(f){var b=this._all;return b[f]||b[this.generateId(f,!0)]}});return l});
$Define("CM.ViewManager","CM.AbstractManager",function(l){var f=$H.createClass();$H.inherit(f,l,{type:"view",initialize:function(){var b=this;$H.on("afterRender",function(d,e){b.afterRender(e)});$H.on("removeEl",function(d,e){b.destroy(e)})},afterRender:function(b){this.eachInEl(b,function(b){b.afterRender()})},destroy:function(b){this.eachInEl(b,function(b){b.destroy(!0)})}});$V=$H.getSingleton(f);return f});
$Define("CM.View",["CM.ViewManager","CM.AbstractEvents","B.Template"],function(l,f){var b=/^(<[a-zA-Z]+)/,d=/^[^>]+class=/,e=/(class=")/,c=f.derive({xtype:"View",_placeholder:'<script id="" type="text/x-placeholder">\x3c/script>',autoRender:!0,renderBy:"append",listeners:[],items:[],children:[],_customEvents:"beforeRender render afterRender beforeShow show afterShow beforeHide hide afterHide beforeUpdate update afterUpdate beforeDestroy destroy afterDestroy add remove".split(" "),_defaultEvents:"mousedown mouseup mouseover mousemove mouseenter mouseleave dragstart drag dragenter dragleave dragover drop dragend touchstart touchmove touchend touchcancel keydown keyup keypress click dblclick focus focusin focusout contextmenu change submit".split(" "),
_applyArray:function(a,g){var c=arguments,b=c.callee.caller,d=b.$owner.prototype;0==c.length?(c=b.arguments,c=$H.toArray(c),a=b.$name,g=c.shift()):c=$H.toArray(c,2);if($H.isArray(g)){for(var b=0,e=g.length;b<e;b++)d[a].apply(this,[g[b]].concat(c));return!0}return!1},_parseListenEvents:function(a,g){var c=this;return c._parseEvents(g.name,function(b){g.name=b[0];2==b.length&&(g.handler=b[0]);c[a].call(c,g)})},initialize:function(a){this.inited||(this.manager=this.constructor.manager||$H.getSingleton(l),
this.doConfig(a),this.parseItems(),!1!=this.autoRender&&this.render(),this.manager.register(this),this.inited=!0)},doConfig:function(a){var g=this;g.initParam=a;"string"==typeof a&&(a={text:a});var c=a||{};$H.extend(g,c,{notCover:function(a,b){var d=$H.contains(g._customEvents,a);if($H.contains(g._defaultEvents,a))return g.listeners.push({name:a,handler:c[a]}),!0;if(d)return g.on(a,c[a]),!0;if("defItem"==a)return $H.extend(g[a],b),!0;if("listener"==a)return g.listeners=g.listeners.concat($H.isArray(b)?
b:[b]),!0;if("items"==a)return g.add(b),!0;if("xtype"==a)return"View"==g[a]&&(g[a]="string"==typeof b?b:b.$ns),!0}});g.renderTo=c.renderTo?$(c.renderTo):$(document.body)},getEl:function(){return this._container},getId:function(){return this._id||(this._id=this.manager.generateId(this.cid))},initHtml:function(){"string"!=typeof this.tmpl&&(this.tmpl=this.constructor.prototype.tmpl=this.tmpl.join(""));return $H.Template.tmpl({id:this.xtype,tmpl:this.tmpl},this)},getHtml:function(){var a=this.getId(),
c;c="visibility"==this.displayMode?"visibility:hidden;":"display:none;";var p=this.initHtml(),k=d.test(p),n="js-"+this.manager.type+" js-"+this.xtype+" "+this.extCls+" ";k&&(p=p.replace(e,"$1"+n));return p=p.replace(b,'$1 id="'+a+'" style="'+c+'"'+(k?"":' class="'+n+'"'))},findHtml:function(a){a=this.find(a);for(var c=[],b=0;b<a.length;b++)c.push(a[b].getHtml());return c.join("")},initStyle:function(){var a=this.getEl(),c=this.style||{};void 0!=this.width&&(c.width=this.width);void 0!=this.height&&
(c.height=this.height);a.css(c)},beforeRender:function(){return this.trigger("beforeRender")},render:function(){if(!1==this.beforeRender())return!1;this.trigger("render");var a=this.getHtml();this.renderTo[this.renderBy](a);this.afterRender()},afterRender:function(){if(this.rendered)return!1;this.callChild();this._container=$("#"+this.getId());this.rendered=!0;this.initStyle();!0!=this.notListen&&this.initListeners();this.disabled&&this.disable();this.trigger("afterRender");this.hidden||this.show()},
beforeShow:function(){return this.trigger("beforeShow")},show:function(a,g){var b=this;if(!1==b.beforeShow()||b.showed||g&&b.hidden)return!1;if(!a&&b.delayShow)setTimeout(function(){c.prototype.show.call(b,!0)},0);else{b.trigger("show");b.showed=!0;var k=b.getEl();"visibility"==b.displayMode?k.css({visibility:"visible"}):k.show();b.callChild([null,!0]);b.afterShow()}},afterShow:function(){this.trigger("afterShow")},beforeHide:function(){return this.trigger("beforeHide")},hide:function(){if(!1==this.beforeHide()||
!this.showed)return!1;this.showed=!1;var a=this.getEl();"visibility"==this.displayMode?a.css({visibility:"hidden"}):a.hide();this.trigger("hide");this.afterHide()},afterHide:function(){this.trigger("afterHide")},enable:function(){this.resume();this.getEl().removeClass("hui-disable").find("input,textarea,select").removeAttr("disabled")},disable:function(){this.suspend();this.getEl().addClass("hui-disable").find("input,textarea,select").attr("disabled","disabled")},getContent:function(a,b){b?!b instanceof
c&&(b=this.find(b)[0]):b=this;return!1==a?b.children:b.getEl().html()},setContent:function(a,b){if(b)return!b instanceof c&&(b=this.find(b)[0]),b.setContent(a);var d=this.getEl();d.contents().remove();if("string"==typeof a)d.html(a);else return this.add(a)},listen:function(a){if(!this._parseListenEvents("listen",a)){var c=a.name,b=a.context,k=a.times,d=a.target,e=a.custom,f=a.handler;$H.isFunction(d)&&(d=d.call(this));if(d||e)a=$H.removeUndefined([d,c,f,b,k]),this[e?"on":"listenTo"].apply(this,a);
else{var e=this._listeners,k=a.el,d=a.method||"bind",m=a.selector,s=a.data,b=a.delegation=this._delegateHandler(f,b);$H.isFunction(k)&&(k=k.call(this));$H.mobile()&&"click"==c&&(c="touchend");k=k?"string"==typeof k?this.findEl(k):k:this.getEl();if(m)if(s)k[d](m,c,s,b);else k[d](m,c,b);else if(s)k[d](c,s,b);else k[d](c,b);e.push(a)}}},unlisten:function(a){if(!this._parseListenEvents("unlisten",a)){var c=a.name,b=a.handler;if(a.custom)this.off(c,b);else{var d=a.el,e="delegate"==a.method?"undelegate":
"unbind";a=a.selector;var f;$H.mobile()&&"click"==c&&(c="touchend");for(var d=d?"string"==typeof d?this.findEl(d):d:this.getEl(),j=this._listeners.length-1;0<=j;j--){var m=this._listeners[j];if(m.handler==b){f=m.delegation;this._listeners.splice(j,1);break}}if(a)d[e](a,c,f);else d[e](c,f)}}},initListeners:function(){if(this.listened)return!1;this.listened=!0;var a=this.listeners;this._listeners=[];for(var c=a.length-1;0<=c;c--)this.listen(a[c]);this.callChild()},clearListeners:function(){for(var a=
this._listeners,c=a.length-1;0<=c;c--)this.unlisten(a[c]);this.off("all");this.unlistenTo("all");this.callChild()},suspend:function(){if(this.isSuspend)return!1;this.isSuspend=!0;this.callChild()},resume:function(){if(!this.isSuspend)return!1;this.isSuspend=!1;this.callChild()},findEl:function(a){return this.getEl().find(a)},parentsEl:function(a){return this.getEl().parents(a)},each:function(a,c){for(var b=this.children,d=b.length,e,f=0;f<d;){e=b[f];e=c?a.apply(e,c):a(f,e);if(!1===e)break;d==b.length?
f++:d=b.length}},match:function(a,c){if("*"==a)return!0;var b=c||this,d,e,f;a=a.replace(/^([^\[]+)/,'[xtype="$1"]');for(var j=/\[([^=|\!]+)(=|\!=)([^=]+)\]/g;d=j.exec(a);)if(e=d[1],f=d[2],d=eval(d[3]),"="===f?b[e]!=d:b[e]==d)return!1;return!0},find:function(a,c){var b=this;c=c||[];if($H.isNumber(a))c.push(b.children[a]);else if($H.isString(a)){if(0<a.indexOf(","))return $H.each(a.split(","),function(a,d){c=c.concat(b.find(d))}),c;var d=0==a.indexOf(">"),e=a.replace(/^>?\s?/,""),f=e.search(/\s|>/),
j;0<f&&(j=e.substring(f),e=e.substring(0,f));b.each(function(b,p){p.match(e)&&(j?p.find(j,c):c.push(p));d||p.find(a,c)})}else $H.isFunction(a)&&b.each(function(b,d){a(d)&&c.push(d);d.find(a,c)});return c},parents:function(a){for(var c=this;c.parent;)if(c=c.parent,a&&this.match(a,c))return c;return a||c===this?null:c},index:function(){var a=this,c=a.parent;if(c){var b;c.each(function(c,d){if(d==a)return b=c,!1});return b}return null},callChild:function(a,c){0!=this.children.length&&(a&&"string"!=typeof a&&
(c=a,a=null),a=a||arguments.callee.caller.$name,this.each(function(b,d){c?d[a].apply(d,c):d[a].call(d)}))},add:function(a,b){if(!this._applyArray()){var d=void 0==b;if(this.startParseItems){if(a instanceof c)a.parent=this;else{this.defItem&&$H.extend(a,this.defItem,{notCover:!0});this.parseItem(a);var e=this.manager.getClass(a.xtype);e?(a.renderTo||(this.inited?a.renderTo=this.getEl():a.autoRender=!1),a.parent=this,a=new e(a)):$D.error("xtype:"+a.xtype+"\u672a\u627e\u5230")}e=this.children;d?e.push(a):
e.splice(b,0,a);this.trigger("add",a);return a}e=this.items;d?e.push(a):e.splice(b,0,a)}},remove:function(a){if(!this._applyArray()){var b=this.children,d=!1,e;if($H.isNumber(a))e=a,a=b[e];else if($H.isString(a)||$H.isFunction(a)){a=this.find(a);for(var f=0,h=a.length;f<h;f++){if(!1==this.remove(a[f]))return!1;d=!0}}else if(a instanceof c)if(a.parent==this){f=0;for(h=b.length;f<h;f++)if(b[f]==a){e=f;break}}else return a.parent.remove(a);void 0!=e&&!1!=a.destroy(!0)&&(b.splice(e,1),d=!0);this.trigger("remove",
a);return d}},parseItem:function(){},parseItems:function(){this.startParseItems=!0;var a=this.items;if(a)for(var a=$H.isArray(a)?a:[a],c=0,b=a.length;c<b;c++)this.add(a[c])},beforeUpdate:function(){return this.trigger("beforeUpdate")},update:function(a){if(!1==this.beforeUpdate())return!1;var c=this.parent,b=$("<span></span>").insertBefore(this.getEl());a=$H.extend(a||this.initParam,{xtype:this.xtype,renderBy:"replaceWith",renderTo:b});if(!a.cid||a.cid==this.cid)a._id=this._id;if(c){var d=this.index();
if(!1==c.remove(this))return b.remove(),!1;a=c.add(a,d)}else{if(!1==this.destroy())return b.remove(),!1;a=new this.constructor(a)}this.trigger("update",a);this.afterUpdate(a);return a},afterUpdate:function(a){this.trigger("afterUpdate",a)},beforeDestroy:function(){return this.trigger("beforeDestroy")},destroy:function(a){if(!1==this.beforeDestroy())return!1;if(!this.destroyed)return this.callChild(),this.trigger("destroy"),this.clearListeners(),this.getEl().remove(),this.destroyed=!0,!a&&this.parent&&
this.parent.remove(this),this.manager.unregister(this),delete this.initParam,delete this._container,delete this.renderTo,delete this._listeners,delete this.children,this.afterDestroy(),!0},afterDestroy:function(){this.trigger("afterDestroy")}},{extend:function(a){var c=this.prototype;$H.extend(c,a,{notCover:function(b){if($H.contains(["_customEvents","listeners"],b))return c[b]=(a[b]||[]).concat(c[b]||[]),!0;if("xtype"==b||"constructor"==b)return!0}})},html:function(a){return(new this($H.extend({autoRender:!1},
a))).getHtml()}});return c});
$Define("CM.Model",["CM.AbstractDao","CM.AbstractEvents"],function(l,f){return f.derive({_pending:!1,idAttribute:"id",_validate:function(b,d){if(!d.validate||!this.validate)return!0;b=$H.extend({},this.attributes,b);var e=this.validationError=this.validate(b,d)||null;if(!e)return!0;this.trigger("invalid",this,e,$H.extend(d,{validationError:e}));return!1},initialize:function(b,d){this.dao=this.dao||$H.getSingleton(l);var e=b||{};d||(d={});this.cid=$H.Util.getUuid();this.attributes={};d.collection&&
(this.collection=d.collection);d.parse&&(e=this.parse(e,d)||{});e=$H.extend(e,$H.Util.result(this,"defaults"),{notCover:!0});this.set(e,d);this.changed={}},toJSON:function(){return $H.clone(this.attributes)},sync:function(b,d,e){return this.dao.sync(b,d,e)},get:function(b){return this.attributes[b]},escape:function(b){return $H.String.escapeHTML(this.get(b))},has:function(b){b=this.get(b);return null!=b&&void 0!=b},set:function(b,d,e){var c;"object"===typeof b?(c=b,e=d):(c={})[b]=d;e||(e={});if(!this._validate(c,
e))return!1;var a=e.unset;b=e.silent;var g=[],f=this._changing;this._changing=!0;f||(this._previousAttributes=$H.Object.clone(this.attributes),this.changed={});var k=this.attributes,n=this._previousAttributes;this.idAttribute in c&&(this.id=c[this.idAttribute]);for(var h in c)d=c[h],$H.equals(k[h],d)||g.push(h),$H.equals(n[h],d)?delete this.changed[h]:this.changed[h]=d,a?delete k[h]:k[h]=d;if(!b){g.length&&(this._pending=e);d=0;for(c=g.length;d<c;d++)this.trigger("change:"+g[d],this,k[g[d]],e)}if(f)return this;
if(!b)for(;this._pending;)e=this._pending,this._pending=!1,this.trigger("change",this,e);this._changing=this._pending=!1;return this},unset:function(b,d){d=d||{};d.unset=!0;return this.set(b,void 0,d)},clear:function(b){var d={},e;for(e in this.attributes)d[e]=void 0;b=b||{};b.unset=!0;return this.set(d,b)},hasChanged:function(b){var d=this.changed;return null==b?!$H.isEmpty(d):$H.contains(d,b)},changedAttrbutes:function(b){if(!b)return this.hasChanged()?$H.clone(this.changed):!1;var d,e=!1,c=this._changing?
this._previousAttributes:this.attributes,a;for(a in b)if(!$H.equals(c[a],d=b[a]))(e||(e={}))[a]=d;return e},previous:function(b){return null==b||!this._previousAttributes?null:this._previousAttributes[b]},fetch:function(b){var d=this;b=b?$H.clone(b):{};void 0===b.parse&&(b.parse=!0);var e=b.success;b.success=function(c){if(!d.set(d.parse(c,b),b))return!1;e&&e(d,c,b);d.trigger("sync",d,c,b)};d.sync("read",d,b)},save:function(b,d,e){var c=this,a,g=c.attributes;null==b||"object"===typeof b?(a=b,e=d):
(a={})[b]=d;e=$H.extend({validate:!0},e);if(a&&e.now){if(!c.set(a,e))return!1}else if(!c._validate(a,e))return!1;a&&!e.now&&(b=$H.extend({},g),c.attributes=$H.extend(b,a));void 0===e.parse&&(e.parse=!0);var f=e.success;e.success=function(b){c.attributes=g;var d=c.parse(b,e);e.now||(d=$H.extend(a||{},d));if($H.isObject(d)&&!c.set(d,e))return!1;f&&f(c,b,e);c.trigger("sync",c,b,e)};b=c.isNew()?"create":e.update?"update":"patch";"patch"===b&&(e.attrs=a);c.sync(b,c,e);a&&!e.now&&(c.attributes=g)},destroy:function(b){var d=
this;b=b?$H.clone(b):{};var e=b.success,c=function(){d.trigger("destroy",d,d.collection,b)};b.success=function(a){(!b.now||d.isNew())&&c();e&&e(d,a,b);d.isNew()||d.trigger("sync",d,a,b)};if(d.isNew())return b.success(),!1;d.sync("delete",d,b);b.now&&c()},getUrl:function(){var b=$H.result(this,"url")||$H.result(this.collection,"url");b||$D.error(Error("\u5fc5\u987b\u8bbe\u7f6e\u4e00\u4e2aurl\u5c5e\u6027\u6216\u8005\u51fd\u6570"));return this.isNew()?b:b.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},
parse:function(b){return b.code&&b.data?b.data:b},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(b){return this._validate({},$H.extend(b||{},{validate:!0}))}})});
$Define("CM.Collection",["CM.AbstractDao","CM.AbstractEvents","CM.Model"],function(l,f,b){var d=f.derive({_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(c,a){if(c instanceof b)return c;a=a?$H.clone(a):{};a.collection=this;var d=new this.model(c,a);if(!d.validationError)return d;this.trigger("invalid",this,d.validationError,a);return!1},_addReference:function(c){this._byId[c.cid]=c;null!=c.id&&(this._byId[c.id]=c);c.collection||(c.collection=this);c.on("all",this._onModelEvent,
this)},_removeReference:function(c){this===c.collection&&delete c.collection;c.off("all",this._onModelEvent,this)},_onModelEvent:function(c,a,b,d){("add"===c||"remove"===c)&&b!==this||("destroy"===c&&this.remove(a,d),a&&c==="change:"+a.idAttribute&&(delete this._byId[a.previous(a.idAttribute)],null!=a.id&&(this._byId[a.id]=a)),this.trigger.apply(this,arguments))},initialize:function(c,a){this.dao=this.dao||$H.getSingleton(l);a||(a={});a.model&&(this.model=a.model);void 0!==a.comparator&&(this.comparator=
a.comparator);this._reset();c&&this.reset(c,$H.extend({silent:!0},a))},toJSON:function(c){return $H.Collection.map(this.models,function(a){return a.toJSON(c)})},sync:function(c,a,b){return this.dao.sync(c,a,b)},add:function(c,a){a=$H.extend({add:!0,remove:!1,merge:!1},a);return this.set(c,a)},remove:function(c,a){var b=!$H.isArray(c);c=b?[c]:$H.clone(c);a||(a={});var d,e,f,h;d=0;for(e=c.length;d<e;d++)if(h=c[d]=this.get(c[d]))delete this._byId[h.id],delete this._byId[h.cid],f=this.indexOf(h),this.models.splice(f,
1),this.length--,a.silent||(a.index=f,h.trigger("remove",h,this,a)),this._removeReference(h,a);return b?c[0]:c},set:function(c,a){a=$H.extend({add:!0,remove:!0,merge:!0},a);a.parse&&(c=this.parse(c,a));var d=!$H.isArray(c),e=d?c?[c]:[]:$H.clone(c),f,n,h,j,m,l,u=a.at,z=this.model,v=this.comparator&&null==u&&!1!==a.sort,A="string"==typeof this.comparator?this.comparator:null,q=[],w=[],t={},y=a.add,B=a.merge,x=a.remove,r=!v&&y&&x?[]:!1;f=0;for(n=e.length;f<n;f++){m=e[f]||{};h=m instanceof b?j=m:m[z.prototype.idAttribute||
"id"];if(h=this.get(h))x&&(t[h.cid]=!0),B&&(m=m===j?j.attributes:m,a.parse&&(m=h.parse(m,a)),h.set(m,a),v&&(!l&&h.hasChanged(A))&&(l=!0)),e[f]=h;else if(y){j=e[f]=this._prepareModel(m,a);if(!j)continue;q.push(j);this._addReference(j,a)}j=h||j;r&&(j.isNew()||!t[j.id])&&r.push(j);t[j.id]=!0}if(x){f=0;for(n=this.length;f<n;++f)t[(j=this.models[f]).cid]||w.push(j);w.length&&this.remove(w,a)}if(q.length||r&&r.length)if(v&&(l=!0),this.length+=q.length,null!=u){f=0;for(n=q.length;f<n;f++)this.models.splice(u+
f,0,q[f])}else{r&&(this.models.length=0);m=r||q;f=0;for(n=m.length;f<n;f++)this.models.push(m[f])}l&&this.sort({silent:!0});if(!a.silent){f=0;for(n=q.length;f<n;f++)(j=q[f]).trigger("add",j,this,a);(l||r&&r.length)&&this.trigger("sort",this,a)}return d?e[0]:e},reset:function(c,a){a||(a={});for(var b=0,d=this.models.length;b<d;b++)this._removeReference(this.models[b],a);a.previousModels=this.models;this._reset();c=this.add(c,$H.extend({silent:!0},a));a.silent||this.trigger("reset",this,a);return c},
push:function(c,a){return this.add(c,$H.extend({at:this.length},a))},pop:function(c){var a=this.at(this.length-1);this.remove(a,c);return a},unshift:function(c,a){return this.add(c,$H.extend({at:0},a))},shift:function(c){var a=this.at(0);this.remove(a,c);return a},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},get:function(c){return null==c?void 0:this._byId[c]||this._byId[c.id]||this._byId[c.cid]},at:function(c){return this.models[c]},where:function(c,a){return $H.isEmpty(c)?
a?void 0:[]:this[a?"find":"filter"](function(a){for(var b in c)if(c[b]!==a.get(b))return!1;return!0})},findWhere:function(c){return this.where(c,!0)},sort:function(c){this.comparator||$D.error(Error("\u6ca1\u6709\u6bd4\u8f83\u5668"));c||(c={});"string"==typeof this.comparator||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort($H.Function.bind(this.comparator,this));c.silent||this.trigger("sort",this,c);return this},pluck:function(c){return $H.Collection.invoke(this.models,
"get",c)},getUrl:function(){return this.url},fetch:function(c){var a=this;c=c?$H.clone(c):{};void 0===c.parse&&(c.parse=!0);var b=c.success;c.success=function(d){a[c.reset?"reset":"set"](d,c);b&&b(a,d,c);a.trigger("sync",a,d,c)};return a.sync("read",a,c)},create:function(b,a){var d=this;a=a?$H.clone(a):{};if(!(b=d._prepareModel(b,a)))return!1;a.now&&d.add(b,a);var e=a.success;a.success=function(b,c){a.now||d.add(b,a);e&&e(b,c,a)};b.save(null,a);return b},parse:function(b){return b.data},clone:function(){return new this.constructor(this.models)}}),
e=$H.Array;$H.each("map some every find filter invoke indexOf".split(" "),function(b,a){d.prototype[a]=function(){var b=Array.prototype.slice.call(arguments);b.unshift(this.models);return e[a].apply(e,b)}});$H.each(["sortBy","groupBy","countBy"],function(b){d.prototype[b]=function(a,d){var f=$H.isFunction(a)?a:function(b){return b.get(a)};return e[b](this.models,f,d)}});return d});
