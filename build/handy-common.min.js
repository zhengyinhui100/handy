/* Handy v1.0.0-dev | 2014-03-14 | zhengyinhui100@gmail.com */
$Define("cm.AbstractView",function(){var l=$HO.createClass(),e=/^(<[a-zA-Z]+)/,a=/^[^>]+class=/,b=/(class=")/;$HO.extend(l.prototype,{xtype:"AbstractView",autoRender:!0,renderBy:"append",_customEvents:"beforeRender render afterRender beforeShow afterShow hide destroy".split(" "),_defaultEvents:"mousedown mouseup mouseover mousemove mouseenter mouseleave dragstart drag dragenter dragleave dragover drop dragend touchstart touchmove touchend touchcancel keydown keyup keypress click dblclick focus focusin focusout contextmenu change submit".split(" "),
initialize:function(a){this.doConfig(a);this.beforeRender();!1!=this.autoRender&&(this.render(),this.afterRender())},doConfig:function(a){var b=this;b.params=a;b.settings=$HO.clone(a);b.renderTo=a.renderTo?$(a.renderTo):$(document.body);var c=b.listeners||[];a.listeners&&(c=c.concat(a.listeners));b._listeners=c;$HO.extend(b,a,{notCover:function(c){var g=b[c],m=$HO.contains(b._customEvents,c),j=$HO.contains(b._defaultEvents,c);(m||j)&&b._listeners.push({type:c,notEl:m,handler:a[c]});if(null!=g&&"object"==
typeof g||$HO.isFunction(g))return!0}})},getEl:function(){return this._container},getId:function(){return this._id},initHtml:function(){"string"!=typeof this.tmpl&&(this.tmpl=this.constructor.prototype.tmpl=this.tmpl.join(""));return $H.Template.tmpl({id:this.xtype,tmpl:this.tmpl},this)},getHtml:function(){var d=this.getId(),f;f="visibility"==this.displayMode?"visibility:hidden;":"display:none;";var c=this.initHtml(),h=a.test(c),g=this.extCls+" ";h&&(c=c.replace(b,"$1"+g));return c=c.replace(e,'$1 id="'+
d+'" style="'+f+'"'+(h?"":' class="'+g+'"'))},initStyle:function(){var a=this.getEl(),b=this.style||{};void 0!=this.width&&(b.width=this.width);void 0!=this.height&&(b.height=this.height);a.css(b)},beforeRender:function(){this.fire("beforeRender")},render:function(){this.fire("render");var a=this.getHtml();this.renderTo[this.renderBy](a)},afterRender:function(){if(this.rendered)return!1;this._container=$("#"+this.getId());this.rendered=!0;this.initStyle();!0!=this.notListen&&this.initListeners();
this.disabled&&this.disable();this.fire("afterRender");this.hidden||this.show()},hide:function(){if(!this.showed)return!1;this.showed=!1;var a=this.getEl();"visibility"==this.displayMode?a.css({visibility:"hidden"}):a.hide();this.fire("hide")},show:function(){if(this.showed)return!1;this.fire("beforeShow");this.showed=!0;var a=this.getEl();"visibility"==this.displayMode?a.css({visibility:"visible"}):a.show();this.afterShow()},afterShow:function(){this.fire("afterShow")},enable:function(){this.resumeListeners();
this.getEl().removeClass("hui-disable").find("input,textarea,select").removeAttr("disabled")},disable:function(){this.suspendListeners();this.getEl().addClass("hui-disable").find("input,textarea,select").attr("disabled","disabled")},fire:function(a,b){for(var c=this._listeners.length-1;0<=c;c--){var h=this._listeners[c];if(h.type==a){var g=h.delegation;b?g.apply(null,b.shift(h)):g(h)}}},listen:function(a){var b=this,c=a.type,h=b._listeners,g=a.el,m=a.method||"bind",j=a.selector,e=a.data,l=a.delegation=
function(){if(!0!=b.isSuspend)return a.handler.apply(a.scope||b,arguments)};$H.Browser.mobile()&&"click"==c&&(c="touchend");g=g?"string"==typeof g?b.find(g):g:b.getEl();if(!a.notEl)if(j)if(e)g[m](j,c,e,l);else g[m](j,c,l);else if(e)g[m](c,e,l);else g[m](c,l);h.push(a)},unlisten:function(a){var b=a.type,c=a.el,h="delegate"==a.method?"undelegate":"unbind",g=a.selector,m;$H.Browser.mobile()&&"click"==b&&(b="touchend");for(var c=c?"string"==typeof c?this.find(c):c:this.getEl(),e=this._listeners.length-
1;0<=e;e--){var k=this._listeners[e];if(k.handler==a.handler){m=k.delegation;this._listeners.splice(e,1);break}}if(!a.notEl)if(g)c[h](g,b,m);else c[h](b,m)},initListeners:function(){if(this.listened)return!1;this.listened=!0;var a=this._listeners;this._listeners=[];for(var b=a.length-1;0<=b;b--)this.listen(a[b])},clearListeners:function(){for(var a=this._listeners,b=a.length-1;0<=b;b--)this.unlisten(a[b])},suspendListeners:function(){if(this.isSuspend)return!1;this.isSuspend=!0},resumeListeners:function(){if(!this.isSuspend)return!1;
this.isSuspend=!1},destroy:function(){if(this.destroyed)return!1;this.fire("destroy");this.clearListeners();this.getEl().remove();this.destroyed=!0}});return l});
$Define("cm.AbstractManager",function(){var l=$HO.createClass();$HO.extend(l.prototype,{_types:{},_all:{},type:"manager",registerType:function(e,a){this._types[e]=a;a.prototype.xtype=e;$C[e]=a},getClass:function(e){return this._types[e]},register:function(e){this._all[e.getId()]=e},unregister:function(e){delete this._all[e.getId()]},eachInEl:function(e,a){var b=this;e.find(".js-"+b.type).each(function(d,f){f=$(f);var c=f.attr("id");(c=b.get(c))&&a(c)})},generateId:function(e,a){var b=$H.expando+"_"+
this.type+"_"+(e||$H.Util.getUuid());if(!0!=a&&this._all[b])$D.error("id\u91cd\u590d:"+b);else return b},get:function(e){var a=this._all;return a[e]||a[this.generateId(e,!0)]}});return l});
$Define("c.Model",function(){var l=$HO.createClass();$HO.extend(l.prototype,{_pending:!1,idAttribute:"id",_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=$HO.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;if(!d)return!0;this.trigger("invalid",this,d,$HO.extend(b,{validationError:d}));return!1},initialize:function(a,b){var d=a||{};b||(b={});this.cid=$H.Util.getUuid();this.attributes={};b.collection&&(this.collection=b.collection);b.parse&&(d=this.parse(d,
b)||{});d=$HO.extend(d,$H.Util.result(this,"defaults"),{notCover:!0});this.set(d,b);this.changed={}},toJson:function(){return $HO.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){return $H.String.escapeHTML(this.get(a))},has:function(a){a=this.get(a);return null!=a&&void 0!=a},set:function(a,b,d){var f;"object"===typeof a?(f=a,d=b):(f={})[a]=b;d||(d={});if(!this._validate(f,d))return!1;var c=d.unset;a=d.silent;var h=[],g=this._changing;this._changing=!0;g||(this._previousAttributes=
$H.Object.clone(this.attributes),this.changed={});var m=this.attributes,e=this._previousAttributes;this.idAttribute in f&&(this.id=f[this.idAttribute]);for(var k in f)b=f[k],$HO.equals(m[k],b)||h.push(k),$HO.equals(e[k],b)?delete this.changed[k]:this.changed[k]=b,c?delete m[k]:m[k]=b;if(!a){h.length&&(this._pending=d);b=0;for(f=h.length;b<f;b++)this.trigger("change:"+h[b],this,m[h[b]],d)}if(g)return this;if(!a)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);this._changing=
this._pending=!1;return this},unset:function(a,b){b=b||{};b.unset=!0;return this.set(a,void 0,b)},clear:function(a){var b={},d;for(d in this.attributes)b[d]=void 0;a=a||{};a.unset=!0;return this.set(b,a)},hasChanged:function(a){var b=this.changed;return null==a?!$HO.isEmpty(b):$HO.contains(b,a)},changedAttrbutes:function(a){if(!a)return this.hasChanged()?$HO.clone(this.changed):!1;var b,d=!1,f=this._changing?this._previousAttributes:this.attributes,c;for(c in a)if(!$HO.equals(f[c],b=a[c]))(d||(d=
{}))[c]=b;return d},previous:function(a){return null==a||!this._previousAttributes?null:this._previousAttributes[a]},fetch:function(a){var b=this;a=a?$HO.clone(a):{};void 0===a.parse&&(a.parse=!0);var d=a.success;a.success=function(f){if(!b.set(b.parse(f,a),a))return!1;d&&d(b,f,a);b.trigger("sync",b,f,a)};e(b,a);return b.sync("read",b,a)},save:function(a,b,d){var f,c=this.attributes;null==a||"object"===typeof a?(f=a,d=b):(f={})[a]=b;d=$HO.extend({validate:!0},d);if(f&&!d.wait){if(!this.set(f,d))return!1}else if(!this._validate(f,
d))return!1;f&&d.wait&&(this.attributes=$HO.extend({},c,f));void 0===d.parse&&(d.parse=!0);var h=this,g=d.success;d.success=function(a){h.attributes=c;var b=h.parse(a,d);d.wait&&(b=$HO.extend(f||{},b));if($HO.isObject(b)&&!h.set(b,d))return!1;g&&g(h,a,d);h.trigger("sync",h,a,d)};e(this,d);a=this.isNew()?"create":d.patch?"patch":"update";"patch"===a&&(d.oAttrs=f);a=this.sync(a,this,d);f&&d.wait&&(this.attributes=c);return a},destroy:function(a){a=a?$HO.clone(a):{};var b=this,d=a.success,f=function(){b.trigger("destroy",
b,b.collection,a)};a.success=function(c){(a.wait||b.isNew())&&f();d&&d(b,c,a);b.isNew()||b.trigger("sync",b,c,a)};if(this.isNew())return a.success(),!1;e(this,a);var c=this.sync("delete",this,a);a.wait||f();return c},url:function(){var a=$H.Util.result(this,"urlRoot")||$H.Util.result(this.collection,"url");a||$D.error("\u5fc5\u987b\u8bbe\u7f6e\u4e00\u4e2aurl\u5c5e\u6027\u6216\u8005\u51fd\u6570",Error("\u5fc5\u987b\u8bbe\u7f6e\u4e00\u4e2aurl\u5c5e\u6027\u6216\u8005\u51fd\u6570"));return this.isNew()?
a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},$HO.extend(a||{},{validate:!0}))}});var e;return l});
$Define("c.Collection","c.Model",function(l){var e=$HO.createClass();$HO.extend(e.prototype,{_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(a instanceof l)return a;b=b?$HO.clone(b):{};b.collection=this;var d=new this.model(a,b);if(!d.validationError)return d;this.trigger("invalid",this,d.validationError,b);return!1},_addReference:function(a){this._byId[a.cid]=a;null!=a.id&&(this._byId[a.id]=a);a.collection||(a.collection=this);a.on("all",this._onModelEvent,
this)},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,d,f){("add"===a||"remove"===a)&&d!==this||("destroy"===a&&this.remove(b,f),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))},initialize:function(a,b){b||(b={});b.model&&(this.model=b.model);void 0!==b.comparator&&(this.comparator=b.comparator);this._reset();this.initialize.apply(this,
arguments);a&&this.reset(a,$HO.extend({silent:!0},b))},toJSON:function(a){return $H.Collection.map(this,function(b){return b.toJSON(a)})},add:function(a,b){$HO.extend(b,{add:!0,remove:!1,merge:!1});return this.set(a,b)},remove:function(a,b){var d=!$HO.isArray(a);a=d?[a]:$HO.clone(a);b||(b={});var f,c,h,g;f=0;for(c=a.length;f<c;f++)if(g=a[f]=this.get(a[f]))delete this._byId[g.id],delete this._byId[g.cid],h=this.indexOf(g),this.models.splice(h,1),this.length--,b.silent||(b.index=h,g.trigger("remove",
g,this,b)),this._removeReference(g,b);return d?a[0]:a},set:function(a,b){b=$H.Util.extend(b,{add:!0,remove:!0,merge:!0});b.parse&&(a=this.parse(a,b));var d=!$HO.isArray(a),f=d?a?[a]:[]:$HO.clone(a),c,h,g,e,j,k,r=b.at,w=this.model,s=this.comparator&&null==r&&!1!==b.sort,x="string"==typeof this.comparator?this.comparator:null,n=[],t=[],q={},v=b.add,y=b.merge,u=b.remove,p=!s&&v&&u?[]:!1;c=0;for(h=f.length;c<h;c++){j=f[c]||{};g=j instanceof l?e=j:j[w.prototype.idAttribute||"id"];if(g=this.get(g))u&&(q[g.cid]=
!0),y&&(j=j===e?e.attributes:j,b.parse&&(j=g.parse(j,b)),g.set(j,b),s&&(!k&&g.hasChanged(x))&&(k=!0)),f[c]=g;else if(v){e=f[c]=this._prepareModel(j,b);if(!e)continue;n.push(e);this._addReference(e,b)}e=g||e;p&&(e.isNew()||!q[e.id])&&p.push(e);q[e.id]=!0}if(u){c=0;for(h=this.length;c<h;++c)q[(e=this.models[c]).cid]||t.push(e);t.length&&this.remove(t,b)}if(n.length||p&&p.length)if(s&&(k=!0),this.length+=n.length,null!=r){c=0;for(h=n.length;c<h;c++)this.models.splice(r+c,0,n[c])}else{p&&(this.models.length=
0);j=p||n;c=0;for(h=j.length;c<h;c++)this.models.push(j[c])}k&&this.sort({silent:!0});if(!b.silent){c=0;for(h=n.length;c<h;c++)(e=n[c]).trigger("add",e,this,b);(k||p&&p.length)&&this.trigger("sort",this,b)}return d?f[0]:f},reset:function(a,b){b||(b={});for(var d=0,e=this.models.length;d<e;d++)this._removeReference(this.models[d],b);b.previousModels=this.models;this._reset();a=this.add(a,$HO.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return a},push:function(a,b){return this.add(a,
$HO.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){return this.add(a,$HO.extend({at:0},b))},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){return $HO.isEmpty(a)?b?void 0:[]:this[b?"find":
"filter"](function(b){for(var e in a)if(a[e]!==b.get(e))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){this.comparator||$D.error("\u6ca1\u6709\u6bd4\u8f83\u5668",Error("\u6ca1\u6709\u6bd4\u8f83\u5668"));a||(a={});"string"==typeof this.comparator||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort($H.Function.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},pluck:function(a){return $H.Collection.invoke(this.models,
"get",a)},parse:function(a){return a},clone:function(){return new this.constructor(this.models)}});$HO.each(["some","every","find","filter","invoke"],function(a){e.prototype[a]=function(){var b=Array.prototype.slice.call(arguments),d=$H.Collection;b.unshift(this.models);return d[a].apply(d,b)}});return e});
