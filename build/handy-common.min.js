/* Handy v1.0.0-dev | 2014-03-29 | zhengyinhui100@gmail.com */
$Define("CM.AbstractEvents",function(){var j=$H.createClass();$H.extend(j.prototype,$H.Events);$H.extend(j.prototype,{_eventCache:{},_listenTo:[],_parseListenToEvents:function(e,c,d,a){var b=this,f=$H.toArray(arguments,3);return b._parseEvents(d,function(a){a.unshift(c);b[e].apply(b,a.concat(f))})},listenTo:function(e,c,d,a,b){if(!this._parseListenToEvents("listenTo",e,c,d,a,b)){"number"==typeof a&&(b=a,a=null);a=a||this;var f=this._delegateHandler(d,a);this._listenTo.push({target:e,name:c,delegation:f,
handler:d});e.on(c,f,a,b)}},unlistenTo:function(e,c,d){if(!this._parseListenToEvents("unlistenTo",e,c,d)){var a=this._listenTo,b="all"==e;$H.each(a,function(f,r){if(b||r.name==c&&r.handler==d&&r.target==e)r.target.off(r.name,r.delegation),a.splice(f,1)})}}});return j});
$Define("CM.AbstractDao","B.LocalStorage",function(j){var e=$H.createClass();$H.extend(e.prototype,{_ajaxMethodMap:{create:"POST",update:"POST",patch:"PATCH","delete":"DELETE",read:"GET"},_localMethodMap:{create:"setItem",update:"setItem",patch:"setItem","delete":"removeItem",read:"getItem"},ajax:function(c){this.beforeSend(c);c.error=$H.intercept(this.error,c.error);c.success=$H.intercept(this.success,c.success);return $.ajax(c)},beforeSend:$H.noop,error:$H.noop,success:$H.noop,get:function(){},
set:function(){},remove:function(){},sync:function(c,d,a){a=a||{};var b=a.storeType||"remote",f={type:"POST",dataType:"json"};a.url||(f.url=d.getUrl());if(null==a.data&&d&&("create"===c||"update"===c||"patch"===c))f.data=a.attrs||d.toJSON(a);if("remote"==b)"update"==c&&(c="patch"),f.url+="/"+c+".do",$H.extend(f,a),this.ajax(f);else j[this._localMethodMap[c]](f);d.trigger("request",d,a)}});return e});
$Define("CM.AbstractManager",function(){var j=$H.createClass();$H.extend(j.prototype,{_types:{},_all:{},type:"manager",registerType:function(e,c){this._types[e]=c;c.prototype.xtype=e},getClass:function(e){return $H.isClass(e)?e:this._types[e]||$H.namespace(e)},register:function(e){this._all[e.getId()]=e},unregister:function(e){var c=this._all,d=e.getId();c[d]==e&&delete c[d]},eachInEl:function(e,c){var d=this;e.find(".js-"+d.type).each(function(a,b){b=$(b);var f=b.attr("id");(f=d.get(f))&&c(f)})},
generateId:function(e,c){var d=$H.expando+"_"+this.type+"_"+(e||$H.Util.getUuid());if(!0!=c&&this._all[d])$D.error("id\u91cd\u590d:"+d);else return d},get:function(e){var c=this._all;return c[e]||c[this.generateId(e,!0)]}});return j});
$Define("CM.ViewManager","CM.AbstractManager",function(j){var e=$H.createClass();$H.inherit(e,j,{type:"view",initialize:function(){var c=this;$H.on("afterRender",function(d,a){c.afterRender(a)});$H.on("removeEl",function(d,a){c.destroy(a)})},afterRender:function(c){this.eachInEl(c,function(c){c.afterRender()})},destroy:function(c){this.eachInEl(c,function(c){c.destroy(!0)})}});$V=$H.getSingleton(e);return e});
$Define("CM.View",["CM.ViewManager","CM.AbstractEvents","B.Template"],function(j,e){var c=/^(<[a-zA-Z]+)/,d=/^[^>]+class=/,a=/(class=")/,b=e.derive({xtype:"View",_placeholder:'<script id="" type="text/x-placeholder">\x3c/script>',autoRender:!0,renderBy:"append",listeners:[],items:[],children:[],_customEvents:"beforeRender render afterRender beforeShow show afterShow beforeHide hide afterHide beforeUpdate update afterUpdate beforeDestroy destroy afterDestroy add remove".split(" "),_defaultEvents:"mousedown mouseup mouseover mousemove mouseenter mouseleave dragstart drag dragenter dragleave dragover drop dragend touchstart touchmove touchend touchcancel keydown keyup keypress click dblclick focus focusin focusout contextmenu change submit".split(" "),
_applyArray:function(f,a){var b=arguments,c=b.callee.caller,d=c.$owner.prototype;0==b.length?(b=c.arguments,b=$H.toArray(b),f=c.$name,a=b.shift()):b=$H.toArray(b,2);if($H.isArray(a)){for(var c=0,h=a.length;c<h;c++)d[f].apply(this,[a[c]].concat(b));return!0}return!1},_parseListenEvents:function(f,a){var b=this;return b._parseEvents(a.name,function(c){a.name=c[0];2==c.length&&(a.handler=c[0]);b[f].call(b,a)})},initialize:function(f){this.inited||(this.manager=this.constructor.manager||$H.getSingleton(j),
this.doConfig(f),this.parseItems(),!1!=this.autoRender&&this.render(),this.manager.register(this),this.inited=!0)},doConfig:function(f){var a=this;f=a.initParam=f||{};$H.extend(a,f,{notCover:function(b,c){var d=$H.contains(a._customEvents,b);if($H.contains(a._defaultEvents,b))return a.listeners.push({name:b,handler:f[b]}),!0;if(d)return a.on(b,f[b]),!0;if("defItem"==b)return $H.extend(a[b],c),!0;if("listener"==b)return a.listeners=a.listeners.concat($H.isArray(c)?c:[c]),!0;if("items"==b)return a.add(c),
!0;if("xtype"==b)return"View"==a[b]&&(a[b]="string"==typeof c?c:c.$ns),!0}});a.renderTo=f.renderTo?$(f.renderTo):$(document.body)},getEl:function(){return this._container},getId:function(){return this._id||(this._id=this.manager.generateId(this.cid))},initHtml:function(){"string"!=typeof this.tmpl&&(this.tmpl=this.constructor.prototype.tmpl=this.tmpl.join(""));return $H.Template.tmpl({id:this.xtype,tmpl:this.tmpl},this)},getHtml:function(){var f=this.getId(),b;b="visibility"==this.displayMode?"visibility:hidden;":
"display:none;";var k=this.initHtml(),q=d.test(k),g="js-"+this.manager.type+" js-"+this.xtype+" "+this.extCls+" ";q&&(k=k.replace(a,"$1"+g));return k=k.replace(c,'$1 id="'+f+'" style="'+b+'"'+(q?"":' class="'+g+'"'))},findHtml:function(f){0!=f.indexOf("$")&&(f="$"+f);f="$>*"==f?this.children:this.find(f);for(var a=[],b=0;b<f.length;b++)a.push(f[b].getHtml());return a.join("")},initStyle:function(){var f=this.getEl(),a=this.style||{};void 0!=this.width&&(a.width=this.width);void 0!=this.height&&(a.height=
this.height);f.css(a)},beforeRender:function(){return this.trigger("beforeRender")},render:function(){if(!1==this.beforeRender())return!1;this.trigger("render");var f=this.getHtml();this.renderTo[this.renderBy](f);this.afterRender()},afterRender:function(){if(this.rendered)return!1;this.callChild();this._container=$("#"+this.getId());this.rendered=!0;this.initStyle();!0!=this.notListen&&this.initListeners();this.disabled&&this.disable();this.trigger("afterRender");this.hidden||this.show()},beforeShow:function(){return this.trigger("beforeShow")},
show:function(f,a){var c=this;if(!1==c.beforeShow()||c.showed||a&&c.hidden)return!1;if(!f&&c.delayShow)setTimeout(function(){b.prototype.show.call(c,!0)},0);else{c.trigger("show");c.showed=!0;var d=c.getEl();"visibility"==c.displayMode?d.css({visibility:"visible"}):d.show();c.callChild([null,!0]);c.afterShow()}},afterShow:function(){this.trigger("afterShow")},beforeHide:function(){return this.trigger("beforeHide")},hide:function(){if(!1==this.beforeHide()||!this.showed)return!1;this.showed=!1;var f=
this.getEl();"visibility"==this.displayMode?f.css({visibility:"hidden"}):f.hide();this.trigger("hide");this.afterHide()},afterHide:function(){this.trigger("afterHide")},enable:function(){this.resume();this.getEl().removeClass("hui-disable").find("input,textarea,select").removeAttr("disabled")},disable:function(){this.suspend();this.getEl().addClass("hui-disable").find("input,textarea,select").attr("disabled","disabled")},getContent:function(f,a){a?!a instanceof b&&(a=this.find(a),$H.isArray(a)&&(a=
a[0])):a=this;return!1==f?a.children:a.getEl().html()},setContent:function(f,a){if(a)return!a instanceof b&&(a=this.find(a),$H.isArray(a)&&(a=a[0])),a.setContent(f);var c=this.getEl();c.contents().remove();if("string"==typeof f)c.html(f);else return this.add(f)},listen:function(a){if(!this._parseListenEvents("listen",a)){var b=a.name,c=a.context,d=a.times,g=a.target,h=a.custom,e=a.handler;$H.isFunction(g)&&(g=g.call(this));if(g||h)a=$H.removeUndefined([g,b,e,c,d]),this[h?"on":"listenTo"].apply(this,
a);else if(a.custom)this.on.apply(this,b,e,c,d);else{var h=this._listeners,d=a.el,g=a.method||"bind",j=a.selector,m=a.data,c=a.delegation=this._delegateHandler(e,c);$H.isFunction(d)&&(d=d.call(this));$H.mobile()&&"click"==b&&(b="touchend");d=d?"string"==typeof d?this.find(d):d:this.getEl();if(j)if(m)d[g](j,b,m,c);else d[g](j,b,c);else if(m)d[g](b,m,c);else d[g](b,c);h.push(a)}}},unlisten:function(a){if(!this._parseListenEvents("unlisten",a)){var b=a.name,c=a.handler;if(a.custom)this.off(b,c);else{var d=
a.el,g="delegate"==a.method?"undelegate":"unbind";a=a.selector;var h;$H.mobile()&&"click"==b&&(b="touchend");for(var d=d?"string"==typeof d?this.find(d):d:this.getEl(),e=this._listeners.length-1;0<=e;e--){var j=this._listeners[e];if(j.handler==c){h=j.delegation;this._listeners.splice(e,1);break}}if(a)d[g](a,b,h);else d[g](b,h)}}},initListeners:function(){if(this.listened)return!1;this.listened=!0;var a=this.listeners;this._listeners=[];for(var b=a.length-1;0<=b;b--)this.listen(a[b]);this.callChild()},
clearListeners:function(){for(var a=this._listeners,b=a.length-1;0<=b;b--)this.unlisten(a[b]);this.off("all");this.unlistenTo("all");this.callChild()},suspend:function(){if(this.isSuspend)return!1;this.isSuspend=!0;this.callChild()},resume:function(){if(!this.isSuspend)return!1;this.isSuspend=!1;this.callChild()},each:function(a,b){for(var c=this.children,d=c.length,g,h=0;h<d;){g=c[h];g=b?a.apply(g,b):a(h,g);if(!1===g)break;d==c.length?h++:d=c.length}},match:function(a,b){if("*"==a)return!0;var c=
b||this,d,g,h;a=a.replace(/^([^\[]+)/,'[xtype="$1"]');for(var e=/\[([^=|\!]+)(=|\!=)([^=]+)\]/g;d=e.exec(a);)if(g=d[1],h=d[2],d=eval(d[3]),"="===h?c[g]!=d:c[g]==d)return!1;return!0},find:function(a,b){var c=this;if("number"==typeof a)return c.children[a];if(0!=a.indexOf("$"))return c.getEl().find(a);b=b||[];if(0<a.indexOf(","))return $H.each(a.split(","),function(a,f){b=b.concat(c.find(f))}),b;var d=1==a.indexOf(">"),g=a.replace(/^\$>?\s?/,""),e=g.search(/\s|>/),j;0<e&&(j=g.substring(e),g=g.substring(0,
e));c.each(function(c,k){k.match(g)&&(j?k.find("$"+j,b):b.push(k));d||k.find(a,b)});return b},parents:function(a){if(a&&0!=a.indexOf("$"))return this.getEl().parents(a);for(var b=this;b.parent;)if(b=b.parent,a&&this.match(a,b))return b;return a||b===this?null:b},index:function(){var a=this,b=a.parent;if(b){var c;b.each(function(b,d){if(d==a)return c=b,!1});return c}return null},callChild:function(a,b){0!=this.children.length&&(a&&"string"!=typeof a&&(b=a,a=null),a=a||arguments.callee.caller.$name,
this.each(function(c,d){b?d[a].apply(d,b):d[a].call(d)}))},add:function(a,c){if(!this._applyArray()){var d=void 0==c;if(this.startParseItems){if(a instanceof b)a.parent=this;else{this.defItem&&$H.extend(a,this.defItem,{notCover:!0});this.parseItem(a);var e=this.manager.getClass(a.xtype);e?(a.renderTo||(this.inited?a.renderTo=this.getEl():a.autoRender=!1),a.parent=this,a=new e(a)):$D.error("xtype:"+a.xtype+"\u672a\u627e\u5230")}e=this.children;d?e.push(a):e.splice(c,0,a);this.trigger("add",a);return a}e=
this.items;d?e.push(a):e.splice(c,0,a)}},remove:function(a){var c=this.children,d=!1,e;if("number"==typeof a)e=a,a=c[e];else if("string"==typeof a){a=this.find(a);for(var g=0,h=a.length;g<h;g++){if(!1==this.remove(a))return!1;d=!0}}else if(a instanceof b)if(a.parent==this){g=0;for(h=c.length;g<h;g++)if(c[g]==a){e=g;break}}else return a.parent.remove(a);void 0!=e&&!1!=a.destroy(!0)&&(c.splice(e,1),d=!0);this.trigger("remove",a);return d},parseItem:function(){},parseItems:function(){this.startParseItems=
!0;var a=this.items;if(a)for(var a=$H.isArray(a)?a:[a],b=0,c=a.length;b<c;b++)this.add(a[b])},beforeUpdate:function(){return this.trigger("beforeUpdate")},update:function(a){if(!1==this.beforeUpdate())return!1;var b=this.parent,c=$("<span></span>").insertBefore(this.getEl());a=$H.extend(a||this.initParam,{xtype:this.xtype,renderBy:"replaceWith",renderTo:c});if(!a.cid||a.cid==this.cid)a._id=this._id;if(b){var d=this.index();if(!1==b.remove(this))return c.remove(),!1;a=b.add(a,d)}else{if(!1==this.destroy())return c.remove(),
!1;a=new this.constructor(a)}this.trigger("update",a);this.afterUpdate(a);return a},afterUpdate:function(a){this.trigger("afterUpdate",a)},beforeDestroy:function(){return this.trigger("beforeDestroy")},destroy:function(a){if(!1==this.beforeDestroy())return!1;if(!this.destroyed)return this.callChild(),this.trigger("destroy"),this.clearListeners(),this.getEl().remove(),this.destroyed=!0,!a&&this.parent&&this.parent.remove(this),this.manager.unregister(this),delete this.initParam,delete this._container,
delete this.renderTo,delete this._listeners,delete this.children,this.afterDestroy(),!0},afterDestroy:function(){this.trigger("afterDestroy")}},{extend:function(a){var b=this.prototype;$H.extend(b,a,{notCover:function(c){if($H.contains(["_customEvents","listeners"],c))return b[c]=(a[c]||[]).concat(b[c]||[]),!0;if("xtype"==c||"constructor"==c)return!0}})},html:function(a){return(new this($H.extend({autoRender:!1},a))).getHtml()}});return b});
$Define("CM.Model",["CM.AbstractDao","CM.AbstractEvents"],function(j,e){return e.derive({_pending:!1,idAttribute:"id",_validate:function(c,d){if(!d.validate||!this.validate)return!0;c=$H.extend({},this.attributes,c);var a=this.validationError=this.validate(c,d)||null;if(!a)return!0;this.trigger("invalid",this,a,$H.extend(d,{validationError:a}));return!1},initialize:function(c,d){this.dao=this.dao||$H.getSingleton(j);var a=c||{};d||(d={});this.cid=$H.Util.getUuid();this.attributes={};d.collection&&
(this.collection=d.collection);d.parse&&(a=this.parse(a,d)||{});a=$H.extend(a,$H.Util.result(this,"defaults"),{notCover:!0});this.set(a,d);this.changed={}},toJSON:function(){return $H.clone(this.attributes)},sync:function(c,d,a){return this.dao.sync(c,d,a)},get:function(c){return this.attributes[c]},escape:function(c){return $H.String.escapeHTML(this.get(c))},has:function(c){c=this.get(c);return null!=c&&void 0!=c},set:function(c,d,a){var b;"object"===typeof c?(b=c,a=d):(b={})[c]=d;a||(a={});if(!this._validate(b,
a))return!1;var f=a.unset;c=a.silent;var e=[],k=this._changing;this._changing=!0;k||(this._previousAttributes=$H.Object.clone(this.attributes),this.changed={});var q=this.attributes,g=this._previousAttributes;this.idAttribute in b&&(this.id=b[this.idAttribute]);for(var h in b)d=b[h],$H.equals(q[h],d)||e.push(h),$H.equals(g[h],d)?delete this.changed[h]:this.changed[h]=d,f?delete q[h]:q[h]=d;if(!c){e.length&&(this._pending=a);d=0;for(b=e.length;d<b;d++)this.trigger("change:"+e[d],this,q[e[d]],a)}if(k)return this;
if(!c)for(;this._pending;)a=this._pending,this._pending=!1,this.trigger("change",this,a);this._changing=this._pending=!1;return this},unset:function(c,d){d=d||{};d.unset=!0;return this.set(c,void 0,d)},clear:function(c){var d={},a;for(a in this.attributes)d[a]=void 0;c=c||{};c.unset=!0;return this.set(d,c)},hasChanged:function(c){var d=this.changed;return null==c?!$H.isEmpty(d):$H.contains(d,c)},changedAttrbutes:function(c){if(!c)return this.hasChanged()?$H.clone(this.changed):!1;var d,a=!1,b=this._changing?
this._previousAttributes:this.attributes,f;for(f in c)if(!$H.equals(b[f],d=c[f]))(a||(a={}))[f]=d;return a},previous:function(c){return null==c||!this._previousAttributes?null:this._previousAttributes[c]},fetch:function(c){var d=this;c=c?$H.clone(c):{};void 0===c.parse&&(c.parse=!0);var a=c.success;c.success=function(b){if(!d.set(d.parse(b,c),c))return!1;a&&a(d,b,c);d.trigger("sync",d,b,c)};(void 0)(d,c);return d.sync("read",d,c)},save:function(c,d,a){var b=this,f,e=b.attributes;null==c||"object"===
typeof c?(f=c,a=d):(f={})[c]=d;a=$H.extend({validate:!0},a);if(f&&a.now){if(!b.set(f,a))return!1}else if(!b._validate(f,a))return!1;f&&!a.now&&(c=$H.extend({},e),b.attributes=$H.extend(c,f));void 0===a.parse&&(a.parse=!0);var k=a.success;a.success=function(c){b.attributes=e;var d=b.parse(c,a);a.now||(d=$H.extend(f||{},d));if($H.isObject(d)&&!b.set(d,a))return!1;k&&k(b,c,a);b.trigger("sync",b,c,a)};c=b.isNew()?"create":a.patch?"patch":"update";"patch"===c&&(a.attrs=f);b.sync(c,b,a);f&&!a.now&&(b.attributes=
e)},destroy:function(c){var d=this;c=c?$H.clone(c):{};var a=c.success,b=function(){d.trigger("destroy",d,d.collection,c)};c.success=function(f){(!c.now||d.isNew())&&b();a&&a(d,f,c);d.isNew()||d.trigger("sync",d,f,c)};if(d.isNew())return c.success(),!1;var f=d.sync("delete",d,c);c.now&&b();return f},getUrl:function(){var c=$H.result(this,"url")||$H.result(this.collection,"url");c||$D.error(Error("\u5fc5\u987b\u8bbe\u7f6e\u4e00\u4e2aurl\u5c5e\u6027\u6216\u8005\u51fd\u6570"));return this.isNew()?c:c.replace(/([^\/])$/,
"$1/")+encodeURIComponent(this.id)},parse:function(c){return c.code&&c.data?c.data:c},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(c){return this._validate({},$H.extend(c||{},{validate:!0}))}})});
$Define("CM.Collection",["CM.AbstractDao","CM.AbstractEvents","CM.Model"],function(j,e,c){var d=e.derive({_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(a instanceof c)return a;b=b?$H.clone(b):{};b.collection=this;var d=new this.model(a,b);if(!d.validationError)return d;this.trigger("invalid",this,d.validationError,b);return!1},_addReference:function(a){this._byId[a.cid]=a;null!=a.id&&(this._byId[a.id]=a);a.collection||(a.collection=this);a.on("all",this._onModelEvent,
this)},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"===a||"remove"===a)&&c!==this||("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))},initialize:function(a,b){this.dao=this.dao||$H.getSingleton(j);b||(b={});b.model&&(this.model=b.model);void 0!==b.comparator&&(this.comparator=
b.comparator);this._reset();a&&this.reset(a,$H.extend({silent:!0},b))},toJSON:function(a){return $H.Collection.map(this.models,function(b){return b.toJSON(a)})},sync:function(a,b,c){return this.dao.sync(a,b,c)},add:function(a,b){$H.extend(b,{add:!0,remove:!1,merge:!1});return this.set(a,b)},remove:function(a,b){var c=!$H.isArray(a);a=c?[a]:$H.clone(a);b||(b={});var d,e,j,g;d=0;for(e=a.length;d<e;d++)if(g=a[d]=this.get(a[d]))delete this._byId[g.id],delete this._byId[g.cid],j=this.indexOf(g),this.models.splice(j,
1),this.length--,b.silent||(b.index=j,g.trigger("remove",g,this,b)),this._removeReference(g,b);return c?a[0]:a},set:function(a,b){b=$H.extend(b,{add:!0,remove:!0,merge:!0});b.parse&&(a=this.parse(a,b));var d=!$H.isArray(a),e=d?a?[a]:[]:$H.clone(a),k,j,g,h,l,s,m=b.at,y=this.model,u=this.comparator&&null==m&&!1!==b.sort,z="string"==typeof this.comparator?this.comparator:null,n=[],v=[],t={},x=b.add,A=b.merge,w=b.remove,p=!u&&x&&w?[]:!1;k=0;for(j=e.length;k<j;k++){l=e[k]||{};g=l instanceof c?h=l:l[y.prototype.idAttribute||
"id"];if(g=this.get(g))w&&(t[g.cid]=!0),A&&(l=l===h?h.attributes:l,b.parse&&(l=g.parse(l,b)),g.set(l,b),u&&(!s&&g.hasChanged(z))&&(s=!0)),e[k]=g;else if(x){h=e[k]=this._prepareModel(l,b);if(!h)continue;n.push(h);this._addReference(h,b)}h=g||h;p&&(h.isNew()||!t[h.id])&&p.push(h);t[h.id]=!0}if(w){k=0;for(j=this.length;k<j;++k)t[(h=this.models[k]).cid]||v.push(h);v.length&&this.remove(v,b)}if(n.length||p&&p.length)if(u&&(s=!0),this.length+=n.length,null!=m){k=0;for(j=n.length;k<j;k++)this.models.splice(m+
k,0,n[k])}else{p&&(this.models.length=0);l=p||n;k=0;for(j=l.length;k<j;k++)this.models.push(l[k])}s&&this.sort({silent:!0});if(!b.silent){k=0;for(j=n.length;k<j;k++)(h=n[k]).trigger("add",h,this,b);(s||p&&p.length)&&this.trigger("sort",this,b)}return d?e[0]:e},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c],b);b.previousModels=this.models;this._reset();a=this.add(a,$H.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return a},
push:function(a,b){return this.add(a,$H.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){return this.add(a,$H.extend({at:0},b))},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){return $H.isEmpty(a)?
b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){this.comparator||$D.error(Error("\u6ca1\u6709\u6bd4\u8f83\u5668"));a||(a={});"string"==typeof this.comparator||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort($H.Function.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},pluck:function(a){return $H.Collection.invoke(this.models,
"get",a)},getUrl:function(){return this.url},fetch:function(a){var b=this;a=a?$H.clone(a):{};void 0===a.parse&&(a.parse=!0);var c=a.success;a.success=function(d){b[a.reset?"reset":"set"](d,a);c&&c(b,d,a);b.trigger("sync",b,d,a)};return b.sync("read",b,a)},create:function(a,b){var c=this;b=b?$H.clone(b):{};if(!(a=c._prepareModel(a,b)))return!1;b.now&&c.add(a,b);var d=b.success;b.success=function(a,e){b.now||c.add(a,b);d&&d(a,e,b)};a.save(null,b);return a},parse:function(a){return a.data},clone:function(){return new this.constructor(this.models)}});
$H.each(["some","every","find","filter","invoke"],function(a){d.prototype[a]=function(){var b=Array.prototype.slice.call(arguments),c=$H.Collection;b.unshift(this.models);return c[a].apply(c,b)}});return d});
