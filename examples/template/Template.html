<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>handy tmpl</title>
<script type="text/javascript">
gEnv='dev';
</script>
<script type="text/javascript"
	src="../../lib/modernizr.js"></script>
<script type="text/javascript"
	src="../../lib/jquery.js"></script>
<script type="text/javascript"
	src="../../src/js/base/base.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Json.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Object.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Browser.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Debug.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Function.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Class.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Loader.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Events.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Date.js"></script>
<script type="text/javascript"
	src="../../src/js/base/String.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Cookie.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Util.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Array.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Geo.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Template.js"></script>
<script type="text/javascript"
	src="../../src/js/base/HashChange.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Support.js"></script>
<script type="text/javascript"
	src="../../src/js/base/Validator.js"></script>
<script type="text/javascript"
	src="../../src/js/base/LocalStorage.js"></script>
<script type="text/javascript"
	src="../../src/js/base/adapt.js"></script>
<script type="text/javascript" src="../../../lib/handlebars-v1.3.0.js"></script>
</head>
<body>
<input value="按钮" type="button" id="button"/>
<script id="entry-template" type="text/x-handlebars-template">
<div {{bindAttr class="#entry #dddd"}}>
  <h1>{{title}}</h1>
	输入框的值:{{value}}
  <div class="body">
	{{#if body}}
    	<div>if body:{{body}}
		{{#if value}}
			<div>if value:{{value}}</div>
		{{/if}}
		</div>
	{{else}}
	<div>else body</div>
	{{/if}}
	{{#unless tt}}
		<div>unless</div>
	{{/unless}}
	<input type="text" {{bindAttr id="#input133" disabled?disabled value="value" class="isRed?red:green extCls #static-cls"}}/>
	<input type="checkbox" name="name" value="1" {{bindAttr isChk?checked}}/>
	<div class="items">
	{{#each items}}
		<span class="item">{{name}}</span>||
		{{#if value}}
			<span>value:{{value}}</span>
		{{/if}}
		<br/>
	{{/each}}
	</div>
  </div>
</div>
</script>
<script type="text/javascript">
$H.Loader.rootPath={
	'handy'        : '../../src/js'
}

function test(){
	var sTmpl   = document.getElementById("entry-template").innerHTML;
	var aItems=[];
	for(var i=0;i<5;i++){
		aItems.push({
			name:'name'+i,
			value:'value'+i
		});
	}
	var oData = {
		title: "模型视图测试", 
		name:'email',
		disabled:false,
		value:"my value",
		isRed:true,
		isChk:false,
		extCls:'ext-cls',
		body: "这是测试",
		items:aItems
   	}

	/* var nTimes=20000;
	var fn=$H.tmpl(sTmpl);
	$D.log(fn);
	$(document.body).append(fn(oData));
	$D.time();
	for(var i=0;i<nTimes;i++){
		fn(oData);
	}
	$D.time(true);
	var fn = Handlebars.compile(sTmpl);
	$D.time();
	for(var i=0;i<nTimes;i++){
		fn(oData);
	}
	$D.time(true);
	return; */
	
	$Require(['CM.ModelView','CM.Model','CM.Collection'],function(ModelView,Model,Collection){
		
		var CusModel=Model.derive({
			fields:{
				items:{type:Collection}
			}
		});
		var oModel=new CusModel(oData);
		var oView=new ModelView({
			tmpl:sTmpl,
			model:oModel
		});
		console.log(oModel);
		console.log(oModel.get('items'));
		var i=0,value;
		$("#button").click(function(){
			i++;
			value=value?'':'content';
			var oItems=oModel.get('items');
			oItems.at(2).set({name:'change name'+i,value:value});
			if(value){
				oItems.add({name:'new name'+i,value:'new value'},{at:4});
			}else{
				oItems.remove(oItems.at(0));
			}
			oView.updateXmodel({
				title:'title'+i,
				body:value,
				value:value,
				name:(value?'email':'pwd'),
				value:value,
				disabled:(value?true:false),
				isRed:(value?true:false),
				isChk:(value?true:false),
				extCls:(value?'ext-cls':'cls')
		   	});
		});
		
	})
}

test();

</script>

</body>
</html>